{"version":3,"file":"DbbWWgvA.js","sources":["../../../../../../src/lib/services/learning-paths.ts"],"sourcesContent":["import { getDB } from '$lib/db/idb';\nimport type { Lesson, DifficultyLevel } from '$lib/types/lesson';\nimport type { LearningPath, LearningPathProgress } from '$lib/types/learning-path';\n\n// Minimal real dataset seeded for Day 6-7 integration\nconst lessons: Lesson[] = [\n  {\n    id: 'de-a1-greetings-01',\n    title: 'BegrÃ¼ÃŸungen und Kennenlernen',\n    order: 1,\n    path: 'de-a1-greetings',\n    contentUrl: '/lessons/de-a1-greetings/lesson-1.md',\n    duration: 15,\n    difficulty: 'A1',\n    vocabularyIds: ['zdravej_001', 'zusammen_bg_zaedno_sample'],\n    grammarTopics: ['greetings', 'basic-formalities'],\n    objectives: [\n      'BegrÃ¼ÃŸungen im Deutschen sicher anwenden',\n      'Erste Fragen zum Kennenlernen stellen'\n    ]\n  },\n  {\n    id: 'de-a1-greetings-02',\n    title: 'Tageszeiten und Abschied',\n    order: 2,\n    path: 'de-a1-greetings',\n    contentUrl: '/lessons/de-a1-greetings/lesson-2.md',\n    duration: 15,\n    difficulty: 'A1',\n    vocabularyIds: ['guten_morgen_001', 'gute_nacht_001'],\n    grammarTopics: ['times-of-day'],\n    objectives: [\n      'TageszeitabhÃ¤ngige GrÃ¼ÃŸe korrekt nutzen',\n      'HÃ¶fliche Abschiedsformeln anwenden'\n    ]\n  },\n  {\n    id: 'de-a1-greetings-03',\n    title: 'HÃ¶flichkeit und Bitten',\n    order: 3,\n    path: 'de-a1-greetings',\n    contentUrl: '/lessons/de-a1-greetings/lesson-3.md',\n    duration: 15,\n    difficulty: 'A1',\n    vocabularyIds: ['bitte_001', 'danke_001'],\n    grammarTopics: ['politeness'],\n    objectives: [\n      'Dank und Bitte situativ angemessen ausdrÃ¼cken',\n      'HÃ¶fliche Frageformen nutzen'\n    ]\n  },\n  {\n    id: 'bg-a1-essentials-01',\n    title: 'ÐŸÐ¾Ð·Ð´Ñ€Ð°Ð²Ð¸ Ð¸ Ð·Ð°Ð¿Ð¾Ð·Ð½Ð°Ð½ÑÑ‚Ð²Ð°',\n    order: 1,\n    path: 'bg-a1-essentials',\n    contentUrl: '/lessons/bg-a1-essentials/lesson-1.md',\n    duration: 15,\n    difficulty: 'A1',\n    vocabularyIds: ['zdravej_001', 'dobur_den_001'],\n    grammarTopics: ['greetings', 'basic-formalities'],\n    objectives: [\n      'Ð˜Ð·Ð¿Ð¾Ð»Ð·Ð²Ð°Ð½Ðµ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ð½Ð¸ Ð¿Ð¾Ð·Ð´Ñ€Ð°Ð²Ð¸ Ð½Ð° Ð±ÑŠÐ»Ð³Ð°Ñ€ÑÐºÐ¸',\n      'ÐŸÑŠÑ€Ð²Ð¸ Ð²ÑŠÐ¿Ñ€Ð¾ÑÐ¸ Ð¿Ñ€Ð¸ Ð·Ð°Ð¿Ð¾Ð·Ð½Ð°Ð½ÑÑ‚Ð²Ð¾'\n    ]\n  },\n  {\n    id: 'bg-a1-essentials-02',\n    title: 'Ð£Ñ‡Ñ‚Ð¸Ð²Ð¾ÑÑ‚ Ð¸ Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ð½Ð¾ÑÑ‚',\n    order: 2,\n    path: 'bg-a1-essentials',\n    contentUrl: '/lessons/bg-a1-essentials/lesson-2.md',\n    duration: 15,\n    difficulty: 'A1',\n    vocabularyIds: ['molq_001', 'blagodarya_001'],\n    grammarTopics: ['politeness'],\n    objectives: [\n      'Ð¤Ð¾Ñ€Ð¼ÑƒÐ»Ð¸Ñ€Ð°Ð½Ðµ Ð½Ð° Ð¼Ð¾Ð»Ð±Ð° Ð¿Ð¾ ÑƒÑ‡Ñ‚Ð¸Ð² Ð½Ð°Ñ‡Ð¸Ð½',\n      'Ð˜Ð·Ñ€Ð°Ð·ÑÐ²Ð°Ð½Ðµ Ð½Ð° Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ð½Ð¾ÑÑ‚ Ð² Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð½Ð¸ ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ð¸Ð¸'\n    ]\n  }\n];\n\nconst learningPaths: LearningPath[] = [\n  {\n    id: 'de-a1-greetings',\n    title: 'Deutsch A1: BegrÃ¼ÃŸungen',\n    subtitle: 'Erste Schritte und HÃ¶flichkeitsformen',\n    description: 'Starte mit den wichtigsten BegrÃ¼ÃŸungen, Tageszeiten und hÃ¶flichen Floskeln.',\n    difficulty: 'A1' as DifficultyLevel,\n    lessons: lessons.filter((l) => l.path === 'de-a1-greetings'),\n    totalDuration: 45,\n    totalVocabulary: 8,\n    icon: 'ðŸ‘‹',\n    color: '#2563eb',\n    order: 1\n  },\n  {\n    id: 'bg-a1-essentials',\n    title: 'Ð‘ÑŠÐ»Ð³Ð°Ñ€ÑÐºÐ¸ A1: ÐžÑÐ½Ð¾Ð²Ð¸',\n    subtitle: 'ÐŸÐ¾Ð·Ð´Ñ€Ð°Ð²Ð¸, ÑƒÑ‡Ñ‚Ð¸Ð²Ð¾ÑÑ‚ Ð¸ Ð¿ÑŠÑ€Ð²Ð¸ Ñ„Ñ€Ð°Ð·Ð¸',\n    description: 'ÐžÑÐ²Ð¾Ð¸ Ð±Ð°Ð·Ð¾Ð²Ð¸ Ð¿Ð¾Ð·Ð´Ñ€Ð°Ð²Ð¸ Ð¸ ÑƒÑ‡Ñ‚Ð¸Ð²Ð¸ Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ð¸ Ð½Ð° Ð±ÑŠÐ»Ð³Ð°Ñ€ÑÐºÐ¸ Ð·Ð° ÐµÐ¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¸ ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ð¸Ð¸.',\n    difficulty: 'A1' as DifficultyLevel,\n    lessons: lessons.filter((l) => l.path === 'bg-a1-essentials'),\n    totalDuration: 30,\n    totalVocabulary: 6,\n    icon: 'ðŸŒ±',\n    color: '#059669',\n    order: 2\n  }\n];\n\nexport async function getLearningPaths(): Promise<LearningPath[]> {\n  return learningPaths;\n}\n\nexport async function getLessonsForPath(pathId: string): Promise<Lesson[]> {\n  const pathLessons = lessons.filter((lesson) => lesson.path === pathId);\n  return pathLessons.sort((a, b) => a.order - b.order);\n}\n\nexport async function getLearningPathProgress(pathId: string): Promise<LearningPathProgress> {\n  const db = await getDB();\n  const existing = await db.get('learningPathProgress', pathId);\n  if (existing) return existing;\n\n  const firstLessonId = lessons.find((lesson) => lesson.path === pathId)?.id ?? '';\n  const baseline: LearningPathProgress = {\n    pathId,\n    currentLesson: firstLessonId,\n    completedLessons: [],\n    progress: 0,\n    timeSpent: 0,\n    startedAt: new Date().toISOString()\n  };\n\n  await db.put('learningPathProgress', baseline);\n  return baseline;\n}\n\nexport async function markLessonComplete(\n  pathId: string,\n  lessonId: string,\n  timeSpentMinutes?: number\n): Promise<LearningPathProgress> {\n  const db = await getDB();\n  const current = await getLearningPathProgress(pathId);\n  const pathLessons = await getLessonsForPath(pathId);\n\n  if (pathLessons.length === 0) return current;\n\n  const targetLesson = pathLessons.find((lesson) => lesson.id === lessonId);\n  if (!targetLesson) return current;\n\n  const alreadyCompleted = current.completedLessons.includes(lessonId);\n  const completedLookup = new Set(current.completedLessons);\n  completedLookup.add(lessonId);\n\n  const orderedCompleted = pathLessons\n    .filter((lesson) => completedLookup.has(lesson.id))\n    .map((lesson) => lesson.id);\n\n  const totalLessons = pathLessons.length;\n  const completionPercentage = totalLessons > 0 ? Math.round((orderedCompleted.length / totalLessons) * 100) : 0;\n  const nextLessonId = pathLessons.find((lesson) => !completedLookup.has(lesson.id))?.id ?? lessonId;\n  const elapsedMinutes = alreadyCompleted ? 0 : timeSpentMinutes ?? targetLesson.duration ?? 0;\n\n  const updated: LearningPathProgress = {\n    pathId: current.pathId,\n    currentLesson: nextLessonId,\n    completedLessons: orderedCompleted,\n    progress: completionPercentage,\n    timeSpent: Math.max(0, current.timeSpent + elapsedMinutes),\n    completedAt: completionPercentage === 100 ? current.completedAt ?? new Date().toISOString() : undefined,\n    startedAt: current.startedAt\n  };\n\n  await db.put('learningPathProgress', updated);\n  return updated;\n}\n"],"names":["lessons","id","title","order","path","contentUrl","duration","difficulty","vocabularyIds","grammarTopics","objectives","learningPaths","subtitle","description","filter","l","totalDuration","totalVocabulary","icon","color","async","getLearningPaths","getLessonsForPath","pathId","lesson","sort","a","b","getLearningPathProgress","db","getDB","existing","get","firstLessonId","find","baseline","currentLesson","completedLessons","progress","timeSpent","startedAt","Date","toISOString","put","markLessonComplete","lessonId","timeSpentMinutes","current","pathLessons","length","targetLesson","alreadyCompleted","includes","completedLookup","Set","add","orderedCompleted","has","map","totalLessons","completionPercentage","Math","round","nextLessonId","elapsedMinutes","updated","max","completedAt"],"mappings":"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"}