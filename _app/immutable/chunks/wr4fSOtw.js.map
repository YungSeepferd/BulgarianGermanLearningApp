{"version":3,"mappings":"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","names":["createClassPartObject","nextPart","Map","validators","classGroupId","CLASS_PART_SEPARATOR","EMPTY_CONFLICTS","createClassGroupUtils","config","classMap","createClassMap","conflictingClassGroups","conflictingClassGroupModifiers","getClassGroupId","className","startsWith","endsWith","getGroupIdForArbitraryProperty","classParts","split","startIndex","length","getGroupRecursive","getConflictingClassGroupIds","hasPostfixModifier","modifierConflicts","baseConflicts","array1","array2","combinedArray","Array","i","concatArrays","classPartObject","currentClassPart","nextClassPartObject","get","result","classRest","join","slice","validatorsLength","validatorObj","validator","indexOf","content","colonIndex","property","theme","classGroups","processClassGroups","group","processClassesRecursively","classGroup","len","classDefinition","processClassDefinition","processObjectDefinition","processFunctionDefinition","processStringDefinition","getPart","isThemeGetter","push","createClassValidatorObject","entries","Object","key","value","path","current","parts","part","next","set","func","createLruCache","maxCacheSize","cacheSize","cache","create","previousCache","update","EMPTY_MODIFIERS","createResultObject","modifiers","hasImportantModifier","baseClassName","maybePostfixModifierPosition","isExternal","createParseClassName","prefix","experimentalParseClassName","parseClassName","postfixModifierPosition","bracketDepth","parenDepth","modifierStart","index","currentCharacter","baseClassNameWithImportantModifier","fullPrefix","parseClassNameOriginal","createSortModifiers","modifierWeights","orderSensitiveModifiers","forEach","mod","currentSegment","modifier","isArbitrary","isOrderSensitive","has","sort","SPLIT_CLASSES_REGEX","toValue","mix","resolvedValue","string","k","createTailwindMerge","createConfigFirst","createConfigRest","configUtils","cacheGet","cacheSet","functionToCall","tailwindMerge","classList","cachedResult","sortModifiers","classGroupsInConflict","classNames","trim","originalClassName","substring","variantModifier","modifierId","classId","conflictGroups","mergeClassList","reduce","previousConfig","createConfigCurrent","createConfigUtils","args","classLists","argument","twJoin","fallbackThemeArr","fromTheme","themeGetter","arbitraryValueRegex","arbitraryVariableRegex","fractionRegex","tshirtUnitRegex","lengthUnitRegex","colorFunctionRegex","shadowRegex","imageRegex","isFraction","test","isNumber","Number","isNaN","isInteger","isPercent","isTshirtSize","isAny","isLengthOnly","isNever","isShadow","isImage","isAnyNonArbitrary","isArbitraryValue","isArbitraryVariable","isArbitrarySize","getIsArbitraryValue","isLabelSize","isArbitraryLength","isLabelLength","isArbitraryNumber","isLabelNumber","isArbitraryPosition","isLabelPosition","isArbitraryImage","isLabelImage","isArbitraryShadow","isLabelShadow","isArbitraryVariableLength","getIsArbitraryVariable","isArbitraryVariableFamilyName","isLabelFamilyName","isArbitraryVariablePosition","isArbitraryVariableSize","isArbitraryVariableImage","isArbitraryVariableShadow","testLabel","testValue","exec","shouldMatchNoLabel","label","getDefaultConfig","themeColor","themeFont","themeText","themeFontWeight","themeTracking","themeLeading","themeBreakpoint","themeContainer","themeSpacing","themeRadius","themeShadow","themeInsetShadow","themeTextShadow","themeDropShadow","themeBlur","themePerspective","themeAspect","themeEase","themeAnimate","scalePositionWithArbitrary","scaleUnambiguousSpacing","scaleInset","scaleGridTemplateColsRows","scaleGridColRowStartAndEnd","span","scaleGridColRowStartOrEnd","scaleGridAutoColsRows","scaleMargin","scaleSizing","scaleColor","scaleBgPosition","position","scaleBgSize","size","scaleGradientStopPosition","scaleRadius","scaleBorderWidth","scaleMaskImagePosition","scaleBlur","scaleRotate","scaleScale","scaleSkew","scaleTranslate","animate","aspect","blur","breakpoint","color","container","ease","font","leading","perspective","radius","shadow","spacing","text","tracking","columns","box","display","sr","float","clear","isolation","object","overflow","overscroll","inset","start","end","top","right","bottom","left","visibility","z","basis","flex","grow","shrink","order","col","row","gap","justify","items","baseline","self","p","px","py","ps","pe","pt","pr","pb","pl","m","mx","my","ms","me","mt","mr","mb","ml","w","screen","h","list","placeholder","decoration","indent","align","whitespace","break","wrap","hyphens","bg","repeat","linear","to","radial","conic","from","via","rounded","border","divide","outline","ring","opacity","mask","closest","farthest","filter","brightness","contrast","grayscale","invert","saturate","sepia","table","caption","transition","duration","delay","backface","rotate","scale","skew","transform","origin","translate","accent","appearance","caret","scheme","cursor","resize","scroll","snap","touch","select","fill","stroke","overrideProperty","baseObject","overrideKey","overrideValue","overrideConfigProperties","overrideObject","mergeConfigProperties","mergeObject","mergeArrayProperties","mergeValue","concat","extendTailwindMerge","configExtension","createConfig","baseConfig","extend","override","mergeConfigs","twMerge","cn","inputs","clsx","_Debug","enable","enabled","log","disable","context","message","data","console","PREFIX","error","warn","Debug","AppError","Error","constructor","super","this","name","StateError","DataError","StorageError","ErrorHandler","handleError","eventBus","err","String","stack","emit","timestamp","Date","catch","emitError","EventBus","listeners","subscribe","eventType","callback","Set","add","delete","listenersCopy","listener","EventTypes","PartOfSpeechSchema","z.enum","VocabularyCategorySchema","LanguageLevelSchema","VerbAspectSchema","z.union","z.literal","NounGenderSchema","TransliterationSchema","z.object","german","z.string","optional","describe","bulgarian","AudioSchema","url","GrammarSchema","gender","pluralForm","verbAspect","verbPartnerId","conjugation","z.record","declension","singular","plural","EnrichmentSchema","enriched","z.boolean","confidence","z.number","min","max","sourceURL","enrichedAt","datetime","source","partial","DefinitionLinkSchema","language","ExampleSchema","default","NotesSchema","general","forBulgarianSpeakers","forGermanSpeakers","linguistic","linguisticForBulgarians","linguisticForGermans","VocabularyMetadataSchema","frequency","level","isCommon","isVerified","learningPhase","xpValue","components","z.array","meaning","notes","mnemonic","etymology","culturalNote","sourceFiles","mergeSources","createdBy","lastUpdatedBy","links","UnifiedVocabularyItemSchema","id","partOfSpeech","difficulty","cefrLevel","categories","transliteration","emoji","literalBreakdown","segment","literal","grammarTag","audio","audioUrl","grammar","examples","culturalNotes","author","upvotes","int","createdAt","mnemonics","synonyms","antonyms","relatedWords","type","tags","xp_value","global_stats","correct_count","incorrect_count","success_rate","metadata","enrichment","definitions","z.date","str","updatedAt","version","UnifiedVocabularyCollectionSchema","uuid","description","languagePair","difficultyRange","z.tuple","itemCount","statistics","byPartOfSpeech","byDifficulty","byCategory","byLevel","ResilientUnifiedVocabularyItemSchema","ctx","input","now","crypto","randomUUID","_createFallbackUnifiedItem","ResilientUnifiedVocabularyCollectionSchema","SimplifiedVocabularyCollectionSchema","parseInt","v","lastUpdated","totalItems","direction","CACHE_KEY","async","loadVocabulary","process","versions","node","fs","__vitePreload","import","__VITE_PRELOAD__","fileURLToPath","dirname","__dirname","filePath","readFile","jsonData","JSON","parse","parsed","flatMap","item","response","fetch","base","ok","status","json","isArray","validatedItems","map","Math","random","toString","substr","typedError","loadFromStaticEndpoint","localStorage","cachedData","getItem","cacheDate","hoursDiff","getTime","cacheExpiryHours","loadFromCache","cacheError","typedCacheError","_fetchError","_parseError","fallbackCollection","loadBundledData","bundledError","typedBundledError","loadVocabularyBySearch","params","query","toLowerCase","includes","some","example","category","total","limit","offset","hasMore","loadVocabularyByCategory","options","getRandomVocabulary","count","shuffled","vocabularyRepository","$.state","$.proxy","__privateSet","_loaded","load","loaded","collection","invalidate","getAll","getById","find","basicSearch","q","tag","byteToHex","getRandomValues","rnds8","Uint8Array","native","bind","_v4","buf","rnds","rng","arr","unsafeStringify","v4","PracticeSessionSchema","currentItemId","startTime","endTime","score","itemsPracticed","correctAnswers","incorrectAnswers","sessionType","completed","LegacyIdSchema","positive","val","VocabularyCategorySchemaWithFallback","or","BaseVocabularyItemSchema","VocabularyItemSchema","sortBy","sortOrder","userId","vocabularyId","learned","proficiency","lastReviewed","reviewCount","nextReviewDate","PracticeStatSchema","correct","nonnegative","incorrect","lastPracticed","UserProgressStorageSchema","stats","favorites","recentSearches","progress","session","exportedAt","_LocalStorageManager","saveUserProgress","dataToSave","toISOString","validationResult","safeParse","success","setItem","USER_PROGRESS_KEY","stringify","loadUserProgress","safeValidateUserProgressStorage","statsMap","isPracticeStat","savePracticeSession","SESSION_KEY","loadPracticeSession","parsedData","clearPracticeSession","removeItem","exportUserData","importUserData","clearAllData","keys","LocalStorageManager","VocabularyMasterySchema","itemId","correctCount","incorrectCount","totalAttempts","nullable","masteryLevel","isMastered","LessonProgressSchema","lessonId","completionPercentage","lastAccessed","completedAt","QuizPerformanceSchema","quizId","sessionId","totalQuestions","timeTaken","QuestionPerformanceSchema","quizPerformanceId","questionId","questionType","wasCorrect","userAnswer","correctAnswer","DailyProgressSchema","date","xpEarned","wordsPracticed","lessonsCompleted","quizzesTaken","timeSpent","OverallProgressSchema","totalXP","totalWordsPracticed","totalLessonsCompleted","totalQuizzesTaken","totalTimeSpent","currentLevel","currentStreak","longestStreak","lastActiveDate","ProgressDataSchema","vocabularyMastery","lessonProgress","quizPerformance","questionPerformance","dailyProgress","overallProgress","calculateMasteryLevel","mastery","round","calculateLevel","floor","sqrt","calculateXPForLevel","pow","LearningSession","_isActive","_currentStreak","_sessionXP","_dailyXP","_lastPracticeDate","_totalXP","dailyTarget","xpEventUnsubscribe","levelUpEventUnsubscribe","_nextLevelXP","$.derived","xpInLevel","currentLevelStartXP","levelSpan","nextLevelXP","dailyXP","_isDailyGoalReached","loadState","event","handleXPEarned","handleLevelUp","levelProgress","progressPercentage","isDailyGoalReached","startSession","isActive","sessionXP","checkStreak","endSession","saveState","awardXP","amount","isFinite","reason","oldLevel","newLevel","getTotalXP","today","lastPracticeDate","yesterday","setDate","getDate","yesterdayStr","saved","hasSavedData","currentStreakType","dailyXPType","lastPracticeDateType","totalXPType","destroy","window","addEventListener","ProgressService","progressData","getDefaultProgressData","loadProgress","getInstance","instance","uuidv4","recordVocabularyPractice","_responseTime","updateOverallProgress","XP_VALUES","VOCABULARY_PRACTICE","responseTime","VOCABULARY_MASTERED","saveProgress","getVocabularyMastery","getAllVocabularyMastery","getVocabularyNeedingPractice","values","a","b","recordLessonProgress","LESSON_COMPLETED","getLessonProgress","getAllLessonProgress","recordQuizPerformance","QUIZ_COMPLETED","recordQuestionPerformance","getQuizPerformance","getAllQuizPerformance","getQuizPerformanceByQuizId","performance","recordDailyProgress","getDailyProgress","getAllDailyProgress","getRecentDailyProgress","days","dateStr","updateStreak","getOverallProgress","getLevelInfo","currentXP","currentLevelXP","_reason","savedData","_error","exportProgress","importProgress","validatedData","resetProgress","getProgressSummary","levelInfo","dailyGoalProgress","getVocabularyMasteryStats","allItems","masteredItems","masteryPercentage","averageMasteryLevel","sum","getLessonCompletionStats","allLessons","completedLessons","lesson","totalLessons","DAILY_GOAL","LessonGenerationError","TemplateRenderingError","DataValidationError","isLessonDifficulty","isLessonType","lessonTemplateRepository","templates","_initialized","templateCache","initialized","initialize","loadTemplates","cacheTemplates","getTemplate","cacheKey","matchingTemplates","template","isDifficultyInRange","selectedTemplate","getTemplateById","templateId","t","getAllTemplates","validateTemplate","isValidDifficultyRange","variables","variable","required","defaultValue","isValidDefaultValue","templateModules","assign","_path","importFn","createFallbackTemplate","getDifficultiesInRange","range","difficultyOrder","minIndex","maxIndex","difficultyIndex","culturalGrammarService","grammarConcepts","loadGrammarData","criteria","concept","difficultyMatch","posMatch","conceptAppliesToPartOfSpeech","conceptTypeMatch","conceptType","relatedConcepts","getAllConcepts","concepts","getFallbackGrammarData","validConcepts","validateConcept","culturalContext","commonMistakes","pos","bulgarianPerspective","germanPerspective","crossLinguisticExplanation","bgToDe","deToBg","explanationBgToDe","explanationDeToBg","getSourceText","appState","languageMode","getTargetText","getSourceLanguage","getTargetLanguage","getSourceLanguageName","getTargetLanguageName","getDirectionArrow","getDirectionText","getOppositeDirectionText","getLanguageProperty","obj","sourceLang","getOppositeLanguageProperty","targetLang","formatBilingualExample","getDirectionalTemplate","templateDE","templateBG","templateRenderer","render","validateData","renderTemplate","isValidValue","templateString","previousContent","passCount","processLoops","processConditionals","processVariables","resolveValue","extendedData","replace","_match","variableName","blockContent","Boolean","fullBlockContent","condition","elseSplit","trueBlock","falseBlock","eachRegex","match","fullMatch","arrayName","arrayValue","lastIndex","renderedItems","iterationContext","processedBlock","LessonGenerationEngine","templateRepository","grammarService","renderer","vocabularyCache","generateLesson","normalizedParams","normalizeLessonType","normalizeCategories","generateThematicLesson","generateGrammarLesson","generateContextualLesson","includePractice","includeReview","sections","allVocabularyItems","learningObjectives","vocabulary","normalizeVocabularyItem","maxItems","numericDifficulty","mapDifficultyToNumber","vocabularyItems","ceil","filteredItems","validatePartOfSpeech","normalizeVocabularyList","introTemplate","themeName","c","charAt","toUpperCase","enhancedVocabularyItems","correctedPartOfSpeech","correctPartOfSpeech","grammarInfo","getFallbackGrammarInfo","introContext","sectionTitle","learningTip","introContent","title","practiceTemplate","practiceContext","instructions","practiceContent","reviewTemplate","reviewItems","reviewContext","reviewContent","_options","includeComparison","queryParams","mainConcept","exampleVocabulary","searchParams","searchResult","conceptTemplate","conceptContext","grammarConcept","conceptContent","conceptId","comparisonTemplate","comparisonContext","comparisonContent","normalizedCategory","renderedContent","createLessonObject","generateAdaptiveLesson","A1","A2","B1","B2","C1","allowed","normalized","word","commonMisclassifications","zdravej_001","dobro_utro_002","guten_tag","guten_abend","gute_nacht","auf_wiedersehen","bitte","entschuldigung","es_tut_mir_leid","a1_question_001","a1_question_003","a1_question_004","a1_question_005","a1_question_006","a1_question_007","a1_question_008","a1_question_009","a1_question_010","a1_question_011","a1_question_012","eins","zwei","drei","vier","funf","sechs","sieben","acht","neun","zehn","elf","zwoelf","dreizehn","zwanzig","a1_number_200","interjection","pronoun","adverb","numeral","phrase","conjunction","noun","verb","adjective","preposition","article","normalizedType","normalizedVocabulary","sectionType","section","lessonGenerationEngine","DIContainer","services","isInitialized","initializationPromise","Promise","resolve","reject","progressService","learningSession","getService","serviceName","getAppDataState","registerService","getEventBus","diContainerInstance","diContainerApi","getDIContainer","getProgressService","initializeVocabularyRepository","vocabularyDb","loadInitialData","repoItems","updates","findIndex","getVocabulary","getVocabularyByDifficulty","getDifficultyRange","getVocabularyByCategory","getVocabularyByPartOfSpeech","getVocabularyByCriteria","categoryMatch","partOfSpeechMatch","searchVocabulary","lowerQuery","results","getVocabularyCount","getVocabularyStatsByDifficulty","Transaction","operations","rollbackOperations","isCommitted","addOperation","operation","rollback","commit","executedOperations","errors","op","rollbackIndex","rollbackOp","rollbackError","typedRollbackError","isComplete","_TransactionManager","startTransaction","transactionId","activeTransactions","transaction","getTransaction","commitTransaction","rollbackTransaction","TransactionManager","appDataState","_practiceStats","_lastError","_isError","toggleFavorite","fav","isFavorite","recordPracticeResult","originalStats","practiceStats","originalFavorites","originalSearches","updatedStats","newStats","statsType","favoritesType","searchesType","hasStats","hasFavorites","hasSearches","exportData","importData","jsonDataType","jsonDataLength","init","isError","lastError","setTimeout","clearError","appUIState","dataState","_languageMode","_searchQuery","_currentItem","_showAnswer","_practiceMode","_isLoading","_displayDirection","searchQuery","recommendations","toggleLanguageMode","triggerLanguageModePersistence","LocalizationService","then","notifyLanguageChange","toggleDirection","setSearchQuery","setCurrentItem","currentItem","showAnswer","togglePracticeMode","practiceMode","startPracticeSession","toggleShowAnswer","setError","oldSaved","e","initializeAppState","isLoading","displayDirection","practiceRecommendations","all","getAllVocabularyItems","svc"],"ignoreList":[0,7,8,9,10],"sources":["../../../../../../node_modules/.pnpm/tailwind-merge@3.4.0/node_modules/tailwind-merge/dist/bundle-mjs.mjs","../../../../../../src/lib/utils.ts","../../../../../../src/lib/services/errors.ts","../../../../../../src/lib/services/event-bus.ts","../../../../../../src/lib/schemas/unified-vocabulary.ts","../../../../../../src/lib/data/loader.ts","../../../../../../src/lib/data/vocabulary-repository.svelte.ts","../../../../../../node_modules/.pnpm/uuid@13.0.0/node_modules/uuid/dist/stringify.js","../../../../../../node_modules/.pnpm/uuid@13.0.0/node_modules/uuid/dist/rng.js","../../../../../../node_modules/.pnpm/uuid@13.0.0/node_modules/uuid/dist/native.js","../../../../../../node_modules/.pnpm/uuid@13.0.0/node_modules/uuid/dist/v4.js","../../../../../../src/lib/schemas/practiceSession.ts","../../../../../../src/lib/schemas/vocabulary.js","../../../../../../src/lib/schemas/localStorage.js","../../../../../../src/lib/utils/localStorage.ts","../../../../../../src/lib/schemas/progress.js","../../../../../../src/lib/state/session.svelte.ts","../../../../../../src/lib/services/progress.js","../../../../../../src/lib/services/lesson-generation/types.ts","../../../../../../src/lib/services/lesson-generation/lesson-templates.ts","../../../../../../src/lib/services/lesson-generation/cultural-grammar.ts","../../../../../../src/lib/services/lesson-generation/template-language-adapter.ts","../../../../../../src/lib/services/lesson-generation/template-renderer.ts","../../../../../../src/lib/services/lesson-generation/lesson-generator.ts","../../../../../../src/lib/services/di-container.ts","../../../../../../src/lib/data/db.svelte.ts","../../../../../../src/lib/utils/transaction.ts","../../../../../../src/lib/state/app-state.ts","../../../../../../src/lib/state/app-data.svelte.ts","../../../../../../src/lib/state/app-ui.svelte.ts"],"sourcesContent":["/**\n * Concatenates two arrays faster than the array spread operator.\n */\nconst concatArrays = (array1, array2) => {\n  // Pre-allocate for better V8 optimization\n  const combinedArray = new Array(array1.length + array2.length);\n  for (let i = 0; i < array1.length; i++) {\n    combinedArray[i] = array1[i];\n  }\n  for (let i = 0; i < array2.length; i++) {\n    combinedArray[array1.length + i] = array2[i];\n  }\n  return combinedArray;\n};\n\n// Factory function ensures consistent object shapes\nconst createClassValidatorObject = (classGroupId, validator) => ({\n  classGroupId,\n  validator\n});\n// Factory ensures consistent ClassPartObject shape\nconst createClassPartObject = (nextPart = new Map(), validators = null, classGroupId) => ({\n  nextPart,\n  validators,\n  classGroupId\n});\nconst CLASS_PART_SEPARATOR = '-';\nconst EMPTY_CONFLICTS = [];\n// I use two dots here because one dot is used as prefix for class groups in plugins\nconst ARBITRARY_PROPERTY_PREFIX = 'arbitrary..';\nconst createClassGroupUtils = config => {\n  const classMap = createClassMap(config);\n  const {\n    conflictingClassGroups,\n    conflictingClassGroupModifiers\n  } = config;\n  const getClassGroupId = className => {\n    if (className.startsWith('[') && className.endsWith(']')) {\n      return getGroupIdForArbitraryProperty(className);\n    }\n    const classParts = className.split(CLASS_PART_SEPARATOR);\n    // Classes like `-inset-1` produce an empty string as first classPart. We assume that classes for negative values are used correctly and skip it.\n    const startIndex = classParts[0] === '' && classParts.length > 1 ? 1 : 0;\n    return getGroupRecursive(classParts, startIndex, classMap);\n  };\n  const getConflictingClassGroupIds = (classGroupId, hasPostfixModifier) => {\n    if (hasPostfixModifier) {\n      const modifierConflicts = conflictingClassGroupModifiers[classGroupId];\n      const baseConflicts = conflictingClassGroups[classGroupId];\n      if (modifierConflicts) {\n        if (baseConflicts) {\n          // Merge base conflicts with modifier conflicts\n          return concatArrays(baseConflicts, modifierConflicts);\n        }\n        // Only modifier conflicts\n        return modifierConflicts;\n      }\n      // Fall back to without postfix if no modifier conflicts\n      return baseConflicts || EMPTY_CONFLICTS;\n    }\n    return conflictingClassGroups[classGroupId] || EMPTY_CONFLICTS;\n  };\n  return {\n    getClassGroupId,\n    getConflictingClassGroupIds\n  };\n};\nconst getGroupRecursive = (classParts, startIndex, classPartObject) => {\n  const classPathsLength = classParts.length - startIndex;\n  if (classPathsLength === 0) {\n    return classPartObject.classGroupId;\n  }\n  const currentClassPart = classParts[startIndex];\n  const nextClassPartObject = classPartObject.nextPart.get(currentClassPart);\n  if (nextClassPartObject) {\n    const result = getGroupRecursive(classParts, startIndex + 1, nextClassPartObject);\n    if (result) return result;\n  }\n  const validators = classPartObject.validators;\n  if (validators === null) {\n    return undefined;\n  }\n  // Build classRest string efficiently by joining from startIndex onwards\n  const classRest = startIndex === 0 ? classParts.join(CLASS_PART_SEPARATOR) : classParts.slice(startIndex).join(CLASS_PART_SEPARATOR);\n  const validatorsLength = validators.length;\n  for (let i = 0; i < validatorsLength; i++) {\n    const validatorObj = validators[i];\n    if (validatorObj.validator(classRest)) {\n      return validatorObj.classGroupId;\n    }\n  }\n  return undefined;\n};\n/**\n * Get the class group ID for an arbitrary property.\n *\n * @param className - The class name to get the group ID for. Is expected to be string starting with `[` and ending with `]`.\n */\nconst getGroupIdForArbitraryProperty = className => className.slice(1, -1).indexOf(':') === -1 ? undefined : (() => {\n  const content = className.slice(1, -1);\n  const colonIndex = content.indexOf(':');\n  const property = content.slice(0, colonIndex);\n  return property ? ARBITRARY_PROPERTY_PREFIX + property : undefined;\n})();\n/**\n * Exported for testing only\n */\nconst createClassMap = config => {\n  const {\n    theme,\n    classGroups\n  } = config;\n  return processClassGroups(classGroups, theme);\n};\n// Split into separate functions to maintain monomorphic call sites\nconst processClassGroups = (classGroups, theme) => {\n  const classMap = createClassPartObject();\n  for (const classGroupId in classGroups) {\n    const group = classGroups[classGroupId];\n    processClassesRecursively(group, classMap, classGroupId, theme);\n  }\n  return classMap;\n};\nconst processClassesRecursively = (classGroup, classPartObject, classGroupId, theme) => {\n  const len = classGroup.length;\n  for (let i = 0; i < len; i++) {\n    const classDefinition = classGroup[i];\n    processClassDefinition(classDefinition, classPartObject, classGroupId, theme);\n  }\n};\n// Split into separate functions for each type to maintain monomorphic call sites\nconst processClassDefinition = (classDefinition, classPartObject, classGroupId, theme) => {\n  if (typeof classDefinition === 'string') {\n    processStringDefinition(classDefinition, classPartObject, classGroupId);\n    return;\n  }\n  if (typeof classDefinition === 'function') {\n    processFunctionDefinition(classDefinition, classPartObject, classGroupId, theme);\n    return;\n  }\n  processObjectDefinition(classDefinition, classPartObject, classGroupId, theme);\n};\nconst processStringDefinition = (classDefinition, classPartObject, classGroupId) => {\n  const classPartObjectToEdit = classDefinition === '' ? classPartObject : getPart(classPartObject, classDefinition);\n  classPartObjectToEdit.classGroupId = classGroupId;\n};\nconst processFunctionDefinition = (classDefinition, classPartObject, classGroupId, theme) => {\n  if (isThemeGetter(classDefinition)) {\n    processClassesRecursively(classDefinition(theme), classPartObject, classGroupId, theme);\n    return;\n  }\n  if (classPartObject.validators === null) {\n    classPartObject.validators = [];\n  }\n  classPartObject.validators.push(createClassValidatorObject(classGroupId, classDefinition));\n};\nconst processObjectDefinition = (classDefinition, classPartObject, classGroupId, theme) => {\n  const entries = Object.entries(classDefinition);\n  const len = entries.length;\n  for (let i = 0; i < len; i++) {\n    const [key, value] = entries[i];\n    processClassesRecursively(value, getPart(classPartObject, key), classGroupId, theme);\n  }\n};\nconst getPart = (classPartObject, path) => {\n  let current = classPartObject;\n  const parts = path.split(CLASS_PART_SEPARATOR);\n  const len = parts.length;\n  for (let i = 0; i < len; i++) {\n    const part = parts[i];\n    let next = current.nextPart.get(part);\n    if (!next) {\n      next = createClassPartObject();\n      current.nextPart.set(part, next);\n    }\n    current = next;\n  }\n  return current;\n};\n// Type guard maintains monomorphic check\nconst isThemeGetter = func => 'isThemeGetter' in func && func.isThemeGetter === true;\n\n// LRU cache implementation using plain objects for simplicity\nconst createLruCache = maxCacheSize => {\n  if (maxCacheSize < 1) {\n    return {\n      get: () => undefined,\n      set: () => {}\n    };\n  }\n  let cacheSize = 0;\n  let cache = Object.create(null);\n  let previousCache = Object.create(null);\n  const update = (key, value) => {\n    cache[key] = value;\n    cacheSize++;\n    if (cacheSize > maxCacheSize) {\n      cacheSize = 0;\n      previousCache = cache;\n      cache = Object.create(null);\n    }\n  };\n  return {\n    get(key) {\n      let value = cache[key];\n      if (value !== undefined) {\n        return value;\n      }\n      if ((value = previousCache[key]) !== undefined) {\n        update(key, value);\n        return value;\n      }\n    },\n    set(key, value) {\n      if (key in cache) {\n        cache[key] = value;\n      } else {\n        update(key, value);\n      }\n    }\n  };\n};\nconst IMPORTANT_MODIFIER = '!';\nconst MODIFIER_SEPARATOR = ':';\nconst EMPTY_MODIFIERS = [];\n// Pre-allocated result object shape for consistency\nconst createResultObject = (modifiers, hasImportantModifier, baseClassName, maybePostfixModifierPosition, isExternal) => ({\n  modifiers,\n  hasImportantModifier,\n  baseClassName,\n  maybePostfixModifierPosition,\n  isExternal\n});\nconst createParseClassName = config => {\n  const {\n    prefix,\n    experimentalParseClassName\n  } = config;\n  /**\n   * Parse class name into parts.\n   *\n   * Inspired by `splitAtTopLevelOnly` used in Tailwind CSS\n   * @see https://github.com/tailwindlabs/tailwindcss/blob/v3.2.2/src/util/splitAtTopLevelOnly.js\n   */\n  let parseClassName = className => {\n    // Use simple array with push for better performance\n    const modifiers = [];\n    let bracketDepth = 0;\n    let parenDepth = 0;\n    let modifierStart = 0;\n    let postfixModifierPosition;\n    const len = className.length;\n    for (let index = 0; index < len; index++) {\n      const currentCharacter = className[index];\n      if (bracketDepth === 0 && parenDepth === 0) {\n        if (currentCharacter === MODIFIER_SEPARATOR) {\n          modifiers.push(className.slice(modifierStart, index));\n          modifierStart = index + 1;\n          continue;\n        }\n        if (currentCharacter === '/') {\n          postfixModifierPosition = index;\n          continue;\n        }\n      }\n      if (currentCharacter === '[') bracketDepth++;else if (currentCharacter === ']') bracketDepth--;else if (currentCharacter === '(') parenDepth++;else if (currentCharacter === ')') parenDepth--;\n    }\n    const baseClassNameWithImportantModifier = modifiers.length === 0 ? className : className.slice(modifierStart);\n    // Inline important modifier check\n    let baseClassName = baseClassNameWithImportantModifier;\n    let hasImportantModifier = false;\n    if (baseClassNameWithImportantModifier.endsWith(IMPORTANT_MODIFIER)) {\n      baseClassName = baseClassNameWithImportantModifier.slice(0, -1);\n      hasImportantModifier = true;\n    } else if (\n    /**\n     * In Tailwind CSS v3 the important modifier was at the start of the base class name. This is still supported for legacy reasons.\n     * @see https://github.com/dcastil/tailwind-merge/issues/513#issuecomment-2614029864\n     */\n    baseClassNameWithImportantModifier.startsWith(IMPORTANT_MODIFIER)) {\n      baseClassName = baseClassNameWithImportantModifier.slice(1);\n      hasImportantModifier = true;\n    }\n    const maybePostfixModifierPosition = postfixModifierPosition && postfixModifierPosition > modifierStart ? postfixModifierPosition - modifierStart : undefined;\n    return createResultObject(modifiers, hasImportantModifier, baseClassName, maybePostfixModifierPosition);\n  };\n  if (prefix) {\n    const fullPrefix = prefix + MODIFIER_SEPARATOR;\n    const parseClassNameOriginal = parseClassName;\n    parseClassName = className => className.startsWith(fullPrefix) ? parseClassNameOriginal(className.slice(fullPrefix.length)) : createResultObject(EMPTY_MODIFIERS, false, className, undefined, true);\n  }\n  if (experimentalParseClassName) {\n    const parseClassNameOriginal = parseClassName;\n    parseClassName = className => experimentalParseClassName({\n      className,\n      parseClassName: parseClassNameOriginal\n    });\n  }\n  return parseClassName;\n};\n\n/**\n * Sorts modifiers according to following schema:\n * - Predefined modifiers are sorted alphabetically\n * - When an arbitrary variant appears, it must be preserved which modifiers are before and after it\n */\nconst createSortModifiers = config => {\n  // Pre-compute weights for all known modifiers for O(1) comparison\n  const modifierWeights = new Map();\n  // Assign weights to sensitive modifiers (highest priority, but preserve order)\n  config.orderSensitiveModifiers.forEach((mod, index) => {\n    modifierWeights.set(mod, 1000000 + index); // High weights for sensitive mods\n  });\n  return modifiers => {\n    const result = [];\n    let currentSegment = [];\n    // Process modifiers in one pass\n    for (let i = 0; i < modifiers.length; i++) {\n      const modifier = modifiers[i];\n      // Check if modifier is sensitive (starts with '[' or in orderSensitiveModifiers)\n      const isArbitrary = modifier[0] === '[';\n      const isOrderSensitive = modifierWeights.has(modifier);\n      if (isArbitrary || isOrderSensitive) {\n        // Sort and flush current segment alphabetically\n        if (currentSegment.length > 0) {\n          currentSegment.sort();\n          result.push(...currentSegment);\n          currentSegment = [];\n        }\n        result.push(modifier);\n      } else {\n        // Regular modifier - add to current segment for batch sorting\n        currentSegment.push(modifier);\n      }\n    }\n    // Sort and add any remaining segment items\n    if (currentSegment.length > 0) {\n      currentSegment.sort();\n      result.push(...currentSegment);\n    }\n    return result;\n  };\n};\nconst createConfigUtils = config => ({\n  cache: createLruCache(config.cacheSize),\n  parseClassName: createParseClassName(config),\n  sortModifiers: createSortModifiers(config),\n  ...createClassGroupUtils(config)\n});\nconst SPLIT_CLASSES_REGEX = /\\s+/;\nconst mergeClassList = (classList, configUtils) => {\n  const {\n    parseClassName,\n    getClassGroupId,\n    getConflictingClassGroupIds,\n    sortModifiers\n  } = configUtils;\n  /**\n   * Set of classGroupIds in following format:\n   * `{importantModifier}{variantModifiers}{classGroupId}`\n   * @example 'float'\n   * @example 'hover:focus:bg-color'\n   * @example 'md:!pr'\n   */\n  const classGroupsInConflict = [];\n  const classNames = classList.trim().split(SPLIT_CLASSES_REGEX);\n  let result = '';\n  for (let index = classNames.length - 1; index >= 0; index -= 1) {\n    const originalClassName = classNames[index];\n    const {\n      isExternal,\n      modifiers,\n      hasImportantModifier,\n      baseClassName,\n      maybePostfixModifierPosition\n    } = parseClassName(originalClassName);\n    if (isExternal) {\n      result = originalClassName + (result.length > 0 ? ' ' + result : result);\n      continue;\n    }\n    let hasPostfixModifier = !!maybePostfixModifierPosition;\n    let classGroupId = getClassGroupId(hasPostfixModifier ? baseClassName.substring(0, maybePostfixModifierPosition) : baseClassName);\n    if (!classGroupId) {\n      if (!hasPostfixModifier) {\n        // Not a Tailwind class\n        result = originalClassName + (result.length > 0 ? ' ' + result : result);\n        continue;\n      }\n      classGroupId = getClassGroupId(baseClassName);\n      if (!classGroupId) {\n        // Not a Tailwind class\n        result = originalClassName + (result.length > 0 ? ' ' + result : result);\n        continue;\n      }\n      hasPostfixModifier = false;\n    }\n    // Fast path: skip sorting for empty or single modifier\n    const variantModifier = modifiers.length === 0 ? '' : modifiers.length === 1 ? modifiers[0] : sortModifiers(modifiers).join(':');\n    const modifierId = hasImportantModifier ? variantModifier + IMPORTANT_MODIFIER : variantModifier;\n    const classId = modifierId + classGroupId;\n    if (classGroupsInConflict.indexOf(classId) > -1) {\n      // Tailwind class omitted due to conflict\n      continue;\n    }\n    classGroupsInConflict.push(classId);\n    const conflictGroups = getConflictingClassGroupIds(classGroupId, hasPostfixModifier);\n    for (let i = 0; i < conflictGroups.length; ++i) {\n      const group = conflictGroups[i];\n      classGroupsInConflict.push(modifierId + group);\n    }\n    // Tailwind class not in conflict\n    result = originalClassName + (result.length > 0 ? ' ' + result : result);\n  }\n  return result;\n};\n\n/**\n * The code in this file is copied from https://github.com/lukeed/clsx and modified to suit the needs of tailwind-merge better.\n *\n * Specifically:\n * - Runtime code from https://github.com/lukeed/clsx/blob/v1.2.1/src/index.js\n * - TypeScript types from https://github.com/lukeed/clsx/blob/v1.2.1/clsx.d.ts\n *\n * Original code has MIT license: Copyright (c) Luke Edwards <luke.edwards05@gmail.com> (lukeed.com)\n */\nconst twJoin = (...classLists) => {\n  let index = 0;\n  let argument;\n  let resolvedValue;\n  let string = '';\n  while (index < classLists.length) {\n    if (argument = classLists[index++]) {\n      if (resolvedValue = toValue(argument)) {\n        string && (string += ' ');\n        string += resolvedValue;\n      }\n    }\n  }\n  return string;\n};\nconst toValue = mix => {\n  // Fast path for strings\n  if (typeof mix === 'string') {\n    return mix;\n  }\n  let resolvedValue;\n  let string = '';\n  for (let k = 0; k < mix.length; k++) {\n    if (mix[k]) {\n      if (resolvedValue = toValue(mix[k])) {\n        string && (string += ' ');\n        string += resolvedValue;\n      }\n    }\n  }\n  return string;\n};\nconst createTailwindMerge = (createConfigFirst, ...createConfigRest) => {\n  let configUtils;\n  let cacheGet;\n  let cacheSet;\n  let functionToCall;\n  const initTailwindMerge = classList => {\n    const config = createConfigRest.reduce((previousConfig, createConfigCurrent) => createConfigCurrent(previousConfig), createConfigFirst());\n    configUtils = createConfigUtils(config);\n    cacheGet = configUtils.cache.get;\n    cacheSet = configUtils.cache.set;\n    functionToCall = tailwindMerge;\n    return tailwindMerge(classList);\n  };\n  const tailwindMerge = classList => {\n    const cachedResult = cacheGet(classList);\n    if (cachedResult) {\n      return cachedResult;\n    }\n    const result = mergeClassList(classList, configUtils);\n    cacheSet(classList, result);\n    return result;\n  };\n  functionToCall = initTailwindMerge;\n  return (...args) => functionToCall(twJoin(...args));\n};\nconst fallbackThemeArr = [];\nconst fromTheme = key => {\n  const themeGetter = theme => theme[key] || fallbackThemeArr;\n  themeGetter.isThemeGetter = true;\n  return themeGetter;\n};\nconst arbitraryValueRegex = /^\\[(?:(\\w[\\w-]*):)?(.+)\\]$/i;\nconst arbitraryVariableRegex = /^\\((?:(\\w[\\w-]*):)?(.+)\\)$/i;\nconst fractionRegex = /^\\d+\\/\\d+$/;\nconst tshirtUnitRegex = /^(\\d+(\\.\\d+)?)?(xs|sm|md|lg|xl)$/;\nconst lengthUnitRegex = /\\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\\b(calc|min|max|clamp)\\(.+\\)|^0$/;\nconst colorFunctionRegex = /^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\\(.+\\)$/;\n// Shadow always begins with x and y offset separated by underscore optionally prepended by inset\nconst shadowRegex = /^(inset_)?-?((\\d+)?\\.?(\\d+)[a-z]+|0)_-?((\\d+)?\\.?(\\d+)[a-z]+|0)/;\nconst imageRegex = /^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\\(.+\\)$/;\nconst isFraction = value => fractionRegex.test(value);\nconst isNumber = value => !!value && !Number.isNaN(Number(value));\nconst isInteger = value => !!value && Number.isInteger(Number(value));\nconst isPercent = value => value.endsWith('%') && isNumber(value.slice(0, -1));\nconst isTshirtSize = value => tshirtUnitRegex.test(value);\nconst isAny = () => true;\nconst isLengthOnly = value =>\n// `colorFunctionRegex` check is necessary because color functions can have percentages in them which which would be incorrectly classified as lengths.\n// For example, `hsl(0 0% 0%)` would be classified as a length without this check.\n// I could also use lookbehind assertion in `lengthUnitRegex` but that isn't supported widely enough.\nlengthUnitRegex.test(value) && !colorFunctionRegex.test(value);\nconst isNever = () => false;\nconst isShadow = value => shadowRegex.test(value);\nconst isImage = value => imageRegex.test(value);\nconst isAnyNonArbitrary = value => !isArbitraryValue(value) && !isArbitraryVariable(value);\nconst isArbitrarySize = value => getIsArbitraryValue(value, isLabelSize, isNever);\nconst isArbitraryValue = value => arbitraryValueRegex.test(value);\nconst isArbitraryLength = value => getIsArbitraryValue(value, isLabelLength, isLengthOnly);\nconst isArbitraryNumber = value => getIsArbitraryValue(value, isLabelNumber, isNumber);\nconst isArbitraryPosition = value => getIsArbitraryValue(value, isLabelPosition, isNever);\nconst isArbitraryImage = value => getIsArbitraryValue(value, isLabelImage, isImage);\nconst isArbitraryShadow = value => getIsArbitraryValue(value, isLabelShadow, isShadow);\nconst isArbitraryVariable = value => arbitraryVariableRegex.test(value);\nconst isArbitraryVariableLength = value => getIsArbitraryVariable(value, isLabelLength);\nconst isArbitraryVariableFamilyName = value => getIsArbitraryVariable(value, isLabelFamilyName);\nconst isArbitraryVariablePosition = value => getIsArbitraryVariable(value, isLabelPosition);\nconst isArbitraryVariableSize = value => getIsArbitraryVariable(value, isLabelSize);\nconst isArbitraryVariableImage = value => getIsArbitraryVariable(value, isLabelImage);\nconst isArbitraryVariableShadow = value => getIsArbitraryVariable(value, isLabelShadow, true);\n// Helpers\nconst getIsArbitraryValue = (value, testLabel, testValue) => {\n  const result = arbitraryValueRegex.exec(value);\n  if (result) {\n    if (result[1]) {\n      return testLabel(result[1]);\n    }\n    return testValue(result[2]);\n  }\n  return false;\n};\nconst getIsArbitraryVariable = (value, testLabel, shouldMatchNoLabel = false) => {\n  const result = arbitraryVariableRegex.exec(value);\n  if (result) {\n    if (result[1]) {\n      return testLabel(result[1]);\n    }\n    return shouldMatchNoLabel;\n  }\n  return false;\n};\n// Labels\nconst isLabelPosition = label => label === 'position' || label === 'percentage';\nconst isLabelImage = label => label === 'image' || label === 'url';\nconst isLabelSize = label => label === 'length' || label === 'size' || label === 'bg-size';\nconst isLabelLength = label => label === 'length';\nconst isLabelNumber = label => label === 'number';\nconst isLabelFamilyName = label => label === 'family-name';\nconst isLabelShadow = label => label === 'shadow';\nconst validators = /*#__PURE__*/Object.defineProperty({\n  __proto__: null,\n  isAny,\n  isAnyNonArbitrary,\n  isArbitraryImage,\n  isArbitraryLength,\n  isArbitraryNumber,\n  isArbitraryPosition,\n  isArbitraryShadow,\n  isArbitrarySize,\n  isArbitraryValue,\n  isArbitraryVariable,\n  isArbitraryVariableFamilyName,\n  isArbitraryVariableImage,\n  isArbitraryVariableLength,\n  isArbitraryVariablePosition,\n  isArbitraryVariableShadow,\n  isArbitraryVariableSize,\n  isFraction,\n  isInteger,\n  isNumber,\n  isPercent,\n  isTshirtSize\n}, Symbol.toStringTag, {\n  value: 'Module'\n});\nconst getDefaultConfig = () => {\n  /**\n   * Theme getters for theme variable namespaces\n   * @see https://tailwindcss.com/docs/theme#theme-variable-namespaces\n   */\n  /***/\n  const themeColor = fromTheme('color');\n  const themeFont = fromTheme('font');\n  const themeText = fromTheme('text');\n  const themeFontWeight = fromTheme('font-weight');\n  const themeTracking = fromTheme('tracking');\n  const themeLeading = fromTheme('leading');\n  const themeBreakpoint = fromTheme('breakpoint');\n  const themeContainer = fromTheme('container');\n  const themeSpacing = fromTheme('spacing');\n  const themeRadius = fromTheme('radius');\n  const themeShadow = fromTheme('shadow');\n  const themeInsetShadow = fromTheme('inset-shadow');\n  const themeTextShadow = fromTheme('text-shadow');\n  const themeDropShadow = fromTheme('drop-shadow');\n  const themeBlur = fromTheme('blur');\n  const themePerspective = fromTheme('perspective');\n  const themeAspect = fromTheme('aspect');\n  const themeEase = fromTheme('ease');\n  const themeAnimate = fromTheme('animate');\n  /**\n   * Helpers to avoid repeating the same scales\n   *\n   * We use functions that create a new array every time they're called instead of static arrays.\n   * This ensures that users who modify any scale by mutating the array (e.g. with `array.push(element)`) don't accidentally mutate arrays in other parts of the config.\n   */\n  /***/\n  const scaleBreak = () => ['auto', 'avoid', 'all', 'avoid-page', 'page', 'left', 'right', 'column'];\n  const scalePosition = () => ['center', 'top', 'bottom', 'left', 'right', 'top-left',\n  // Deprecated since Tailwind CSS v4.1.0, see https://github.com/tailwindlabs/tailwindcss/pull/17378\n  'left-top', 'top-right',\n  // Deprecated since Tailwind CSS v4.1.0, see https://github.com/tailwindlabs/tailwindcss/pull/17378\n  'right-top', 'bottom-right',\n  // Deprecated since Tailwind CSS v4.1.0, see https://github.com/tailwindlabs/tailwindcss/pull/17378\n  'right-bottom', 'bottom-left',\n  // Deprecated since Tailwind CSS v4.1.0, see https://github.com/tailwindlabs/tailwindcss/pull/17378\n  'left-bottom'];\n  const scalePositionWithArbitrary = () => [...scalePosition(), isArbitraryVariable, isArbitraryValue];\n  const scaleOverflow = () => ['auto', 'hidden', 'clip', 'visible', 'scroll'];\n  const scaleOverscroll = () => ['auto', 'contain', 'none'];\n  const scaleUnambiguousSpacing = () => [isArbitraryVariable, isArbitraryValue, themeSpacing];\n  const scaleInset = () => [isFraction, 'full', 'auto', ...scaleUnambiguousSpacing()];\n  const scaleGridTemplateColsRows = () => [isInteger, 'none', 'subgrid', isArbitraryVariable, isArbitraryValue];\n  const scaleGridColRowStartAndEnd = () => ['auto', {\n    span: ['full', isInteger, isArbitraryVariable, isArbitraryValue]\n  }, isInteger, isArbitraryVariable, isArbitraryValue];\n  const scaleGridColRowStartOrEnd = () => [isInteger, 'auto', isArbitraryVariable, isArbitraryValue];\n  const scaleGridAutoColsRows = () => ['auto', 'min', 'max', 'fr', isArbitraryVariable, isArbitraryValue];\n  const scaleAlignPrimaryAxis = () => ['start', 'end', 'center', 'between', 'around', 'evenly', 'stretch', 'baseline', 'center-safe', 'end-safe'];\n  const scaleAlignSecondaryAxis = () => ['start', 'end', 'center', 'stretch', 'center-safe', 'end-safe'];\n  const scaleMargin = () => ['auto', ...scaleUnambiguousSpacing()];\n  const scaleSizing = () => [isFraction, 'auto', 'full', 'dvw', 'dvh', 'lvw', 'lvh', 'svw', 'svh', 'min', 'max', 'fit', ...scaleUnambiguousSpacing()];\n  const scaleColor = () => [themeColor, isArbitraryVariable, isArbitraryValue];\n  const scaleBgPosition = () => [...scalePosition(), isArbitraryVariablePosition, isArbitraryPosition, {\n    position: [isArbitraryVariable, isArbitraryValue]\n  }];\n  const scaleBgRepeat = () => ['no-repeat', {\n    repeat: ['', 'x', 'y', 'space', 'round']\n  }];\n  const scaleBgSize = () => ['auto', 'cover', 'contain', isArbitraryVariableSize, isArbitrarySize, {\n    size: [isArbitraryVariable, isArbitraryValue]\n  }];\n  const scaleGradientStopPosition = () => [isPercent, isArbitraryVariableLength, isArbitraryLength];\n  const scaleRadius = () => [\n  // Deprecated since Tailwind CSS v4.0.0\n  '', 'none', 'full', themeRadius, isArbitraryVariable, isArbitraryValue];\n  const scaleBorderWidth = () => ['', isNumber, isArbitraryVariableLength, isArbitraryLength];\n  const scaleLineStyle = () => ['solid', 'dashed', 'dotted', 'double'];\n  const scaleBlendMode = () => ['normal', 'multiply', 'screen', 'overlay', 'darken', 'lighten', 'color-dodge', 'color-burn', 'hard-light', 'soft-light', 'difference', 'exclusion', 'hue', 'saturation', 'color', 'luminosity'];\n  const scaleMaskImagePosition = () => [isNumber, isPercent, isArbitraryVariablePosition, isArbitraryPosition];\n  const scaleBlur = () => [\n  // Deprecated since Tailwind CSS v4.0.0\n  '', 'none', themeBlur, isArbitraryVariable, isArbitraryValue];\n  const scaleRotate = () => ['none', isNumber, isArbitraryVariable, isArbitraryValue];\n  const scaleScale = () => ['none', isNumber, isArbitraryVariable, isArbitraryValue];\n  const scaleSkew = () => [isNumber, isArbitraryVariable, isArbitraryValue];\n  const scaleTranslate = () => [isFraction, 'full', ...scaleUnambiguousSpacing()];\n  return {\n    cacheSize: 500,\n    theme: {\n      animate: ['spin', 'ping', 'pulse', 'bounce'],\n      aspect: ['video'],\n      blur: [isTshirtSize],\n      breakpoint: [isTshirtSize],\n      color: [isAny],\n      container: [isTshirtSize],\n      'drop-shadow': [isTshirtSize],\n      ease: ['in', 'out', 'in-out'],\n      font: [isAnyNonArbitrary],\n      'font-weight': ['thin', 'extralight', 'light', 'normal', 'medium', 'semibold', 'bold', 'extrabold', 'black'],\n      'inset-shadow': [isTshirtSize],\n      leading: ['none', 'tight', 'snug', 'normal', 'relaxed', 'loose'],\n      perspective: ['dramatic', 'near', 'normal', 'midrange', 'distant', 'none'],\n      radius: [isTshirtSize],\n      shadow: [isTshirtSize],\n      spacing: ['px', isNumber],\n      text: [isTshirtSize],\n      'text-shadow': [isTshirtSize],\n      tracking: ['tighter', 'tight', 'normal', 'wide', 'wider', 'widest']\n    },\n    classGroups: {\n      // --------------\n      // --- Layout ---\n      // --------------\n      /**\n       * Aspect Ratio\n       * @see https://tailwindcss.com/docs/aspect-ratio\n       */\n      aspect: [{\n        aspect: ['auto', 'square', isFraction, isArbitraryValue, isArbitraryVariable, themeAspect]\n      }],\n      /**\n       * Container\n       * @see https://tailwindcss.com/docs/container\n       * @deprecated since Tailwind CSS v4.0.0\n       */\n      container: ['container'],\n      /**\n       * Columns\n       * @see https://tailwindcss.com/docs/columns\n       */\n      columns: [{\n        columns: [isNumber, isArbitraryValue, isArbitraryVariable, themeContainer]\n      }],\n      /**\n       * Break After\n       * @see https://tailwindcss.com/docs/break-after\n       */\n      'break-after': [{\n        'break-after': scaleBreak()\n      }],\n      /**\n       * Break Before\n       * @see https://tailwindcss.com/docs/break-before\n       */\n      'break-before': [{\n        'break-before': scaleBreak()\n      }],\n      /**\n       * Break Inside\n       * @see https://tailwindcss.com/docs/break-inside\n       */\n      'break-inside': [{\n        'break-inside': ['auto', 'avoid', 'avoid-page', 'avoid-column']\n      }],\n      /**\n       * Box Decoration Break\n       * @see https://tailwindcss.com/docs/box-decoration-break\n       */\n      'box-decoration': [{\n        'box-decoration': ['slice', 'clone']\n      }],\n      /**\n       * Box Sizing\n       * @see https://tailwindcss.com/docs/box-sizing\n       */\n      box: [{\n        box: ['border', 'content']\n      }],\n      /**\n       * Display\n       * @see https://tailwindcss.com/docs/display\n       */\n      display: ['block', 'inline-block', 'inline', 'flex', 'inline-flex', 'table', 'inline-table', 'table-caption', 'table-cell', 'table-column', 'table-column-group', 'table-footer-group', 'table-header-group', 'table-row-group', 'table-row', 'flow-root', 'grid', 'inline-grid', 'contents', 'list-item', 'hidden'],\n      /**\n       * Screen Reader Only\n       * @see https://tailwindcss.com/docs/display#screen-reader-only\n       */\n      sr: ['sr-only', 'not-sr-only'],\n      /**\n       * Floats\n       * @see https://tailwindcss.com/docs/float\n       */\n      float: [{\n        float: ['right', 'left', 'none', 'start', 'end']\n      }],\n      /**\n       * Clear\n       * @see https://tailwindcss.com/docs/clear\n       */\n      clear: [{\n        clear: ['left', 'right', 'both', 'none', 'start', 'end']\n      }],\n      /**\n       * Isolation\n       * @see https://tailwindcss.com/docs/isolation\n       */\n      isolation: ['isolate', 'isolation-auto'],\n      /**\n       * Object Fit\n       * @see https://tailwindcss.com/docs/object-fit\n       */\n      'object-fit': [{\n        object: ['contain', 'cover', 'fill', 'none', 'scale-down']\n      }],\n      /**\n       * Object Position\n       * @see https://tailwindcss.com/docs/object-position\n       */\n      'object-position': [{\n        object: scalePositionWithArbitrary()\n      }],\n      /**\n       * Overflow\n       * @see https://tailwindcss.com/docs/overflow\n       */\n      overflow: [{\n        overflow: scaleOverflow()\n      }],\n      /**\n       * Overflow X\n       * @see https://tailwindcss.com/docs/overflow\n       */\n      'overflow-x': [{\n        'overflow-x': scaleOverflow()\n      }],\n      /**\n       * Overflow Y\n       * @see https://tailwindcss.com/docs/overflow\n       */\n      'overflow-y': [{\n        'overflow-y': scaleOverflow()\n      }],\n      /**\n       * Overscroll Behavior\n       * @see https://tailwindcss.com/docs/overscroll-behavior\n       */\n      overscroll: [{\n        overscroll: scaleOverscroll()\n      }],\n      /**\n       * Overscroll Behavior X\n       * @see https://tailwindcss.com/docs/overscroll-behavior\n       */\n      'overscroll-x': [{\n        'overscroll-x': scaleOverscroll()\n      }],\n      /**\n       * Overscroll Behavior Y\n       * @see https://tailwindcss.com/docs/overscroll-behavior\n       */\n      'overscroll-y': [{\n        'overscroll-y': scaleOverscroll()\n      }],\n      /**\n       * Position\n       * @see https://tailwindcss.com/docs/position\n       */\n      position: ['static', 'fixed', 'absolute', 'relative', 'sticky'],\n      /**\n       * Top / Right / Bottom / Left\n       * @see https://tailwindcss.com/docs/top-right-bottom-left\n       */\n      inset: [{\n        inset: scaleInset()\n      }],\n      /**\n       * Right / Left\n       * @see https://tailwindcss.com/docs/top-right-bottom-left\n       */\n      'inset-x': [{\n        'inset-x': scaleInset()\n      }],\n      /**\n       * Top / Bottom\n       * @see https://tailwindcss.com/docs/top-right-bottom-left\n       */\n      'inset-y': [{\n        'inset-y': scaleInset()\n      }],\n      /**\n       * Start\n       * @see https://tailwindcss.com/docs/top-right-bottom-left\n       */\n      start: [{\n        start: scaleInset()\n      }],\n      /**\n       * End\n       * @see https://tailwindcss.com/docs/top-right-bottom-left\n       */\n      end: [{\n        end: scaleInset()\n      }],\n      /**\n       * Top\n       * @see https://tailwindcss.com/docs/top-right-bottom-left\n       */\n      top: [{\n        top: scaleInset()\n      }],\n      /**\n       * Right\n       * @see https://tailwindcss.com/docs/top-right-bottom-left\n       */\n      right: [{\n        right: scaleInset()\n      }],\n      /**\n       * Bottom\n       * @see https://tailwindcss.com/docs/top-right-bottom-left\n       */\n      bottom: [{\n        bottom: scaleInset()\n      }],\n      /**\n       * Left\n       * @see https://tailwindcss.com/docs/top-right-bottom-left\n       */\n      left: [{\n        left: scaleInset()\n      }],\n      /**\n       * Visibility\n       * @see https://tailwindcss.com/docs/visibility\n       */\n      visibility: ['visible', 'invisible', 'collapse'],\n      /**\n       * Z-Index\n       * @see https://tailwindcss.com/docs/z-index\n       */\n      z: [{\n        z: [isInteger, 'auto', isArbitraryVariable, isArbitraryValue]\n      }],\n      // ------------------------\n      // --- Flexbox and Grid ---\n      // ------------------------\n      /**\n       * Flex Basis\n       * @see https://tailwindcss.com/docs/flex-basis\n       */\n      basis: [{\n        basis: [isFraction, 'full', 'auto', themeContainer, ...scaleUnambiguousSpacing()]\n      }],\n      /**\n       * Flex Direction\n       * @see https://tailwindcss.com/docs/flex-direction\n       */\n      'flex-direction': [{\n        flex: ['row', 'row-reverse', 'col', 'col-reverse']\n      }],\n      /**\n       * Flex Wrap\n       * @see https://tailwindcss.com/docs/flex-wrap\n       */\n      'flex-wrap': [{\n        flex: ['nowrap', 'wrap', 'wrap-reverse']\n      }],\n      /**\n       * Flex\n       * @see https://tailwindcss.com/docs/flex\n       */\n      flex: [{\n        flex: [isNumber, isFraction, 'auto', 'initial', 'none', isArbitraryValue]\n      }],\n      /**\n       * Flex Grow\n       * @see https://tailwindcss.com/docs/flex-grow\n       */\n      grow: [{\n        grow: ['', isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Flex Shrink\n       * @see https://tailwindcss.com/docs/flex-shrink\n       */\n      shrink: [{\n        shrink: ['', isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Order\n       * @see https://tailwindcss.com/docs/order\n       */\n      order: [{\n        order: [isInteger, 'first', 'last', 'none', isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Grid Template Columns\n       * @see https://tailwindcss.com/docs/grid-template-columns\n       */\n      'grid-cols': [{\n        'grid-cols': scaleGridTemplateColsRows()\n      }],\n      /**\n       * Grid Column Start / End\n       * @see https://tailwindcss.com/docs/grid-column\n       */\n      'col-start-end': [{\n        col: scaleGridColRowStartAndEnd()\n      }],\n      /**\n       * Grid Column Start\n       * @see https://tailwindcss.com/docs/grid-column\n       */\n      'col-start': [{\n        'col-start': scaleGridColRowStartOrEnd()\n      }],\n      /**\n       * Grid Column End\n       * @see https://tailwindcss.com/docs/grid-column\n       */\n      'col-end': [{\n        'col-end': scaleGridColRowStartOrEnd()\n      }],\n      /**\n       * Grid Template Rows\n       * @see https://tailwindcss.com/docs/grid-template-rows\n       */\n      'grid-rows': [{\n        'grid-rows': scaleGridTemplateColsRows()\n      }],\n      /**\n       * Grid Row Start / End\n       * @see https://tailwindcss.com/docs/grid-row\n       */\n      'row-start-end': [{\n        row: scaleGridColRowStartAndEnd()\n      }],\n      /**\n       * Grid Row Start\n       * @see https://tailwindcss.com/docs/grid-row\n       */\n      'row-start': [{\n        'row-start': scaleGridColRowStartOrEnd()\n      }],\n      /**\n       * Grid Row End\n       * @see https://tailwindcss.com/docs/grid-row\n       */\n      'row-end': [{\n        'row-end': scaleGridColRowStartOrEnd()\n      }],\n      /**\n       * Grid Auto Flow\n       * @see https://tailwindcss.com/docs/grid-auto-flow\n       */\n      'grid-flow': [{\n        'grid-flow': ['row', 'col', 'dense', 'row-dense', 'col-dense']\n      }],\n      /**\n       * Grid Auto Columns\n       * @see https://tailwindcss.com/docs/grid-auto-columns\n       */\n      'auto-cols': [{\n        'auto-cols': scaleGridAutoColsRows()\n      }],\n      /**\n       * Grid Auto Rows\n       * @see https://tailwindcss.com/docs/grid-auto-rows\n       */\n      'auto-rows': [{\n        'auto-rows': scaleGridAutoColsRows()\n      }],\n      /**\n       * Gap\n       * @see https://tailwindcss.com/docs/gap\n       */\n      gap: [{\n        gap: scaleUnambiguousSpacing()\n      }],\n      /**\n       * Gap X\n       * @see https://tailwindcss.com/docs/gap\n       */\n      'gap-x': [{\n        'gap-x': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Gap Y\n       * @see https://tailwindcss.com/docs/gap\n       */\n      'gap-y': [{\n        'gap-y': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Justify Content\n       * @see https://tailwindcss.com/docs/justify-content\n       */\n      'justify-content': [{\n        justify: [...scaleAlignPrimaryAxis(), 'normal']\n      }],\n      /**\n       * Justify Items\n       * @see https://tailwindcss.com/docs/justify-items\n       */\n      'justify-items': [{\n        'justify-items': [...scaleAlignSecondaryAxis(), 'normal']\n      }],\n      /**\n       * Justify Self\n       * @see https://tailwindcss.com/docs/justify-self\n       */\n      'justify-self': [{\n        'justify-self': ['auto', ...scaleAlignSecondaryAxis()]\n      }],\n      /**\n       * Align Content\n       * @see https://tailwindcss.com/docs/align-content\n       */\n      'align-content': [{\n        content: ['normal', ...scaleAlignPrimaryAxis()]\n      }],\n      /**\n       * Align Items\n       * @see https://tailwindcss.com/docs/align-items\n       */\n      'align-items': [{\n        items: [...scaleAlignSecondaryAxis(), {\n          baseline: ['', 'last']\n        }]\n      }],\n      /**\n       * Align Self\n       * @see https://tailwindcss.com/docs/align-self\n       */\n      'align-self': [{\n        self: ['auto', ...scaleAlignSecondaryAxis(), {\n          baseline: ['', 'last']\n        }]\n      }],\n      /**\n       * Place Content\n       * @see https://tailwindcss.com/docs/place-content\n       */\n      'place-content': [{\n        'place-content': scaleAlignPrimaryAxis()\n      }],\n      /**\n       * Place Items\n       * @see https://tailwindcss.com/docs/place-items\n       */\n      'place-items': [{\n        'place-items': [...scaleAlignSecondaryAxis(), 'baseline']\n      }],\n      /**\n       * Place Self\n       * @see https://tailwindcss.com/docs/place-self\n       */\n      'place-self': [{\n        'place-self': ['auto', ...scaleAlignSecondaryAxis()]\n      }],\n      // Spacing\n      /**\n       * Padding\n       * @see https://tailwindcss.com/docs/padding\n       */\n      p: [{\n        p: scaleUnambiguousSpacing()\n      }],\n      /**\n       * Padding X\n       * @see https://tailwindcss.com/docs/padding\n       */\n      px: [{\n        px: scaleUnambiguousSpacing()\n      }],\n      /**\n       * Padding Y\n       * @see https://tailwindcss.com/docs/padding\n       */\n      py: [{\n        py: scaleUnambiguousSpacing()\n      }],\n      /**\n       * Padding Start\n       * @see https://tailwindcss.com/docs/padding\n       */\n      ps: [{\n        ps: scaleUnambiguousSpacing()\n      }],\n      /**\n       * Padding End\n       * @see https://tailwindcss.com/docs/padding\n       */\n      pe: [{\n        pe: scaleUnambiguousSpacing()\n      }],\n      /**\n       * Padding Top\n       * @see https://tailwindcss.com/docs/padding\n       */\n      pt: [{\n        pt: scaleUnambiguousSpacing()\n      }],\n      /**\n       * Padding Right\n       * @see https://tailwindcss.com/docs/padding\n       */\n      pr: [{\n        pr: scaleUnambiguousSpacing()\n      }],\n      /**\n       * Padding Bottom\n       * @see https://tailwindcss.com/docs/padding\n       */\n      pb: [{\n        pb: scaleUnambiguousSpacing()\n      }],\n      /**\n       * Padding Left\n       * @see https://tailwindcss.com/docs/padding\n       */\n      pl: [{\n        pl: scaleUnambiguousSpacing()\n      }],\n      /**\n       * Margin\n       * @see https://tailwindcss.com/docs/margin\n       */\n      m: [{\n        m: scaleMargin()\n      }],\n      /**\n       * Margin X\n       * @see https://tailwindcss.com/docs/margin\n       */\n      mx: [{\n        mx: scaleMargin()\n      }],\n      /**\n       * Margin Y\n       * @see https://tailwindcss.com/docs/margin\n       */\n      my: [{\n        my: scaleMargin()\n      }],\n      /**\n       * Margin Start\n       * @see https://tailwindcss.com/docs/margin\n       */\n      ms: [{\n        ms: scaleMargin()\n      }],\n      /**\n       * Margin End\n       * @see https://tailwindcss.com/docs/margin\n       */\n      me: [{\n        me: scaleMargin()\n      }],\n      /**\n       * Margin Top\n       * @see https://tailwindcss.com/docs/margin\n       */\n      mt: [{\n        mt: scaleMargin()\n      }],\n      /**\n       * Margin Right\n       * @see https://tailwindcss.com/docs/margin\n       */\n      mr: [{\n        mr: scaleMargin()\n      }],\n      /**\n       * Margin Bottom\n       * @see https://tailwindcss.com/docs/margin\n       */\n      mb: [{\n        mb: scaleMargin()\n      }],\n      /**\n       * Margin Left\n       * @see https://tailwindcss.com/docs/margin\n       */\n      ml: [{\n        ml: scaleMargin()\n      }],\n      /**\n       * Space Between X\n       * @see https://tailwindcss.com/docs/margin#adding-space-between-children\n       */\n      'space-x': [{\n        'space-x': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Space Between X Reverse\n       * @see https://tailwindcss.com/docs/margin#adding-space-between-children\n       */\n      'space-x-reverse': ['space-x-reverse'],\n      /**\n       * Space Between Y\n       * @see https://tailwindcss.com/docs/margin#adding-space-between-children\n       */\n      'space-y': [{\n        'space-y': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Space Between Y Reverse\n       * @see https://tailwindcss.com/docs/margin#adding-space-between-children\n       */\n      'space-y-reverse': ['space-y-reverse'],\n      // --------------\n      // --- Sizing ---\n      // --------------\n      /**\n       * Size\n       * @see https://tailwindcss.com/docs/width#setting-both-width-and-height\n       */\n      size: [{\n        size: scaleSizing()\n      }],\n      /**\n       * Width\n       * @see https://tailwindcss.com/docs/width\n       */\n      w: [{\n        w: [themeContainer, 'screen', ...scaleSizing()]\n      }],\n      /**\n       * Min-Width\n       * @see https://tailwindcss.com/docs/min-width\n       */\n      'min-w': [{\n        'min-w': [themeContainer, 'screen', /** Deprecated. @see https://github.com/tailwindlabs/tailwindcss.com/issues/2027#issuecomment-2620152757 */\n        'none', ...scaleSizing()]\n      }],\n      /**\n       * Max-Width\n       * @see https://tailwindcss.com/docs/max-width\n       */\n      'max-w': [{\n        'max-w': [themeContainer, 'screen', 'none', /** Deprecated since Tailwind CSS v4.0.0. @see https://github.com/tailwindlabs/tailwindcss.com/issues/2027#issuecomment-2620152757 */\n        'prose', /** Deprecated since Tailwind CSS v4.0.0. @see https://github.com/tailwindlabs/tailwindcss.com/issues/2027#issuecomment-2620152757 */\n        {\n          screen: [themeBreakpoint]\n        }, ...scaleSizing()]\n      }],\n      /**\n       * Height\n       * @see https://tailwindcss.com/docs/height\n       */\n      h: [{\n        h: ['screen', 'lh', ...scaleSizing()]\n      }],\n      /**\n       * Min-Height\n       * @see https://tailwindcss.com/docs/min-height\n       */\n      'min-h': [{\n        'min-h': ['screen', 'lh', 'none', ...scaleSizing()]\n      }],\n      /**\n       * Max-Height\n       * @see https://tailwindcss.com/docs/max-height\n       */\n      'max-h': [{\n        'max-h': ['screen', 'lh', ...scaleSizing()]\n      }],\n      // ------------------\n      // --- Typography ---\n      // ------------------\n      /**\n       * Font Size\n       * @see https://tailwindcss.com/docs/font-size\n       */\n      'font-size': [{\n        text: ['base', themeText, isArbitraryVariableLength, isArbitraryLength]\n      }],\n      /**\n       * Font Smoothing\n       * @see https://tailwindcss.com/docs/font-smoothing\n       */\n      'font-smoothing': ['antialiased', 'subpixel-antialiased'],\n      /**\n       * Font Style\n       * @see https://tailwindcss.com/docs/font-style\n       */\n      'font-style': ['italic', 'not-italic'],\n      /**\n       * Font Weight\n       * @see https://tailwindcss.com/docs/font-weight\n       */\n      'font-weight': [{\n        font: [themeFontWeight, isArbitraryVariable, isArbitraryNumber]\n      }],\n      /**\n       * Font Stretch\n       * @see https://tailwindcss.com/docs/font-stretch\n       */\n      'font-stretch': [{\n        'font-stretch': ['ultra-condensed', 'extra-condensed', 'condensed', 'semi-condensed', 'normal', 'semi-expanded', 'expanded', 'extra-expanded', 'ultra-expanded', isPercent, isArbitraryValue]\n      }],\n      /**\n       * Font Family\n       * @see https://tailwindcss.com/docs/font-family\n       */\n      'font-family': [{\n        font: [isArbitraryVariableFamilyName, isArbitraryValue, themeFont]\n      }],\n      /**\n       * Font Variant Numeric\n       * @see https://tailwindcss.com/docs/font-variant-numeric\n       */\n      'fvn-normal': ['normal-nums'],\n      /**\n       * Font Variant Numeric\n       * @see https://tailwindcss.com/docs/font-variant-numeric\n       */\n      'fvn-ordinal': ['ordinal'],\n      /**\n       * Font Variant Numeric\n       * @see https://tailwindcss.com/docs/font-variant-numeric\n       */\n      'fvn-slashed-zero': ['slashed-zero'],\n      /**\n       * Font Variant Numeric\n       * @see https://tailwindcss.com/docs/font-variant-numeric\n       */\n      'fvn-figure': ['lining-nums', 'oldstyle-nums'],\n      /**\n       * Font Variant Numeric\n       * @see https://tailwindcss.com/docs/font-variant-numeric\n       */\n      'fvn-spacing': ['proportional-nums', 'tabular-nums'],\n      /**\n       * Font Variant Numeric\n       * @see https://tailwindcss.com/docs/font-variant-numeric\n       */\n      'fvn-fraction': ['diagonal-fractions', 'stacked-fractions'],\n      /**\n       * Letter Spacing\n       * @see https://tailwindcss.com/docs/letter-spacing\n       */\n      tracking: [{\n        tracking: [themeTracking, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Line Clamp\n       * @see https://tailwindcss.com/docs/line-clamp\n       */\n      'line-clamp': [{\n        'line-clamp': [isNumber, 'none', isArbitraryVariable, isArbitraryNumber]\n      }],\n      /**\n       * Line Height\n       * @see https://tailwindcss.com/docs/line-height\n       */\n      leading: [{\n        leading: [/** Deprecated since Tailwind CSS v4.0.0. @see https://github.com/tailwindlabs/tailwindcss.com/issues/2027#issuecomment-2620152757 */\n        themeLeading, ...scaleUnambiguousSpacing()]\n      }],\n      /**\n       * List Style Image\n       * @see https://tailwindcss.com/docs/list-style-image\n       */\n      'list-image': [{\n        'list-image': ['none', isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * List Style Position\n       * @see https://tailwindcss.com/docs/list-style-position\n       */\n      'list-style-position': [{\n        list: ['inside', 'outside']\n      }],\n      /**\n       * List Style Type\n       * @see https://tailwindcss.com/docs/list-style-type\n       */\n      'list-style-type': [{\n        list: ['disc', 'decimal', 'none', isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Text Alignment\n       * @see https://tailwindcss.com/docs/text-align\n       */\n      'text-alignment': [{\n        text: ['left', 'center', 'right', 'justify', 'start', 'end']\n      }],\n      /**\n       * Placeholder Color\n       * @deprecated since Tailwind CSS v3.0.0\n       * @see https://v3.tailwindcss.com/docs/placeholder-color\n       */\n      'placeholder-color': [{\n        placeholder: scaleColor()\n      }],\n      /**\n       * Text Color\n       * @see https://tailwindcss.com/docs/text-color\n       */\n      'text-color': [{\n        text: scaleColor()\n      }],\n      /**\n       * Text Decoration\n       * @see https://tailwindcss.com/docs/text-decoration\n       */\n      'text-decoration': ['underline', 'overline', 'line-through', 'no-underline'],\n      /**\n       * Text Decoration Style\n       * @see https://tailwindcss.com/docs/text-decoration-style\n       */\n      'text-decoration-style': [{\n        decoration: [...scaleLineStyle(), 'wavy']\n      }],\n      /**\n       * Text Decoration Thickness\n       * @see https://tailwindcss.com/docs/text-decoration-thickness\n       */\n      'text-decoration-thickness': [{\n        decoration: [isNumber, 'from-font', 'auto', isArbitraryVariable, isArbitraryLength]\n      }],\n      /**\n       * Text Decoration Color\n       * @see https://tailwindcss.com/docs/text-decoration-color\n       */\n      'text-decoration-color': [{\n        decoration: scaleColor()\n      }],\n      /**\n       * Text Underline Offset\n       * @see https://tailwindcss.com/docs/text-underline-offset\n       */\n      'underline-offset': [{\n        'underline-offset': [isNumber, 'auto', isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Text Transform\n       * @see https://tailwindcss.com/docs/text-transform\n       */\n      'text-transform': ['uppercase', 'lowercase', 'capitalize', 'normal-case'],\n      /**\n       * Text Overflow\n       * @see https://tailwindcss.com/docs/text-overflow\n       */\n      'text-overflow': ['truncate', 'text-ellipsis', 'text-clip'],\n      /**\n       * Text Wrap\n       * @see https://tailwindcss.com/docs/text-wrap\n       */\n      'text-wrap': [{\n        text: ['wrap', 'nowrap', 'balance', 'pretty']\n      }],\n      /**\n       * Text Indent\n       * @see https://tailwindcss.com/docs/text-indent\n       */\n      indent: [{\n        indent: scaleUnambiguousSpacing()\n      }],\n      /**\n       * Vertical Alignment\n       * @see https://tailwindcss.com/docs/vertical-align\n       */\n      'vertical-align': [{\n        align: ['baseline', 'top', 'middle', 'bottom', 'text-top', 'text-bottom', 'sub', 'super', isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Whitespace\n       * @see https://tailwindcss.com/docs/whitespace\n       */\n      whitespace: [{\n        whitespace: ['normal', 'nowrap', 'pre', 'pre-line', 'pre-wrap', 'break-spaces']\n      }],\n      /**\n       * Word Break\n       * @see https://tailwindcss.com/docs/word-break\n       */\n      break: [{\n        break: ['normal', 'words', 'all', 'keep']\n      }],\n      /**\n       * Overflow Wrap\n       * @see https://tailwindcss.com/docs/overflow-wrap\n       */\n      wrap: [{\n        wrap: ['break-word', 'anywhere', 'normal']\n      }],\n      /**\n       * Hyphens\n       * @see https://tailwindcss.com/docs/hyphens\n       */\n      hyphens: [{\n        hyphens: ['none', 'manual', 'auto']\n      }],\n      /**\n       * Content\n       * @see https://tailwindcss.com/docs/content\n       */\n      content: [{\n        content: ['none', isArbitraryVariable, isArbitraryValue]\n      }],\n      // -------------------\n      // --- Backgrounds ---\n      // -------------------\n      /**\n       * Background Attachment\n       * @see https://tailwindcss.com/docs/background-attachment\n       */\n      'bg-attachment': [{\n        bg: ['fixed', 'local', 'scroll']\n      }],\n      /**\n       * Background Clip\n       * @see https://tailwindcss.com/docs/background-clip\n       */\n      'bg-clip': [{\n        'bg-clip': ['border', 'padding', 'content', 'text']\n      }],\n      /**\n       * Background Origin\n       * @see https://tailwindcss.com/docs/background-origin\n       */\n      'bg-origin': [{\n        'bg-origin': ['border', 'padding', 'content']\n      }],\n      /**\n       * Background Position\n       * @see https://tailwindcss.com/docs/background-position\n       */\n      'bg-position': [{\n        bg: scaleBgPosition()\n      }],\n      /**\n       * Background Repeat\n       * @see https://tailwindcss.com/docs/background-repeat\n       */\n      'bg-repeat': [{\n        bg: scaleBgRepeat()\n      }],\n      /**\n       * Background Size\n       * @see https://tailwindcss.com/docs/background-size\n       */\n      'bg-size': [{\n        bg: scaleBgSize()\n      }],\n      /**\n       * Background Image\n       * @see https://tailwindcss.com/docs/background-image\n       */\n      'bg-image': [{\n        bg: ['none', {\n          linear: [{\n            to: ['t', 'tr', 'r', 'br', 'b', 'bl', 'l', 'tl']\n          }, isInteger, isArbitraryVariable, isArbitraryValue],\n          radial: ['', isArbitraryVariable, isArbitraryValue],\n          conic: [isInteger, isArbitraryVariable, isArbitraryValue]\n        }, isArbitraryVariableImage, isArbitraryImage]\n      }],\n      /**\n       * Background Color\n       * @see https://tailwindcss.com/docs/background-color\n       */\n      'bg-color': [{\n        bg: scaleColor()\n      }],\n      /**\n       * Gradient Color Stops From Position\n       * @see https://tailwindcss.com/docs/gradient-color-stops\n       */\n      'gradient-from-pos': [{\n        from: scaleGradientStopPosition()\n      }],\n      /**\n       * Gradient Color Stops Via Position\n       * @see https://tailwindcss.com/docs/gradient-color-stops\n       */\n      'gradient-via-pos': [{\n        via: scaleGradientStopPosition()\n      }],\n      /**\n       * Gradient Color Stops To Position\n       * @see https://tailwindcss.com/docs/gradient-color-stops\n       */\n      'gradient-to-pos': [{\n        to: scaleGradientStopPosition()\n      }],\n      /**\n       * Gradient Color Stops From\n       * @see https://tailwindcss.com/docs/gradient-color-stops\n       */\n      'gradient-from': [{\n        from: scaleColor()\n      }],\n      /**\n       * Gradient Color Stops Via\n       * @see https://tailwindcss.com/docs/gradient-color-stops\n       */\n      'gradient-via': [{\n        via: scaleColor()\n      }],\n      /**\n       * Gradient Color Stops To\n       * @see https://tailwindcss.com/docs/gradient-color-stops\n       */\n      'gradient-to': [{\n        to: scaleColor()\n      }],\n      // ---------------\n      // --- Borders ---\n      // ---------------\n      /**\n       * Border Radius\n       * @see https://tailwindcss.com/docs/border-radius\n       */\n      rounded: [{\n        rounded: scaleRadius()\n      }],\n      /**\n       * Border Radius Start\n       * @see https://tailwindcss.com/docs/border-radius\n       */\n      'rounded-s': [{\n        'rounded-s': scaleRadius()\n      }],\n      /**\n       * Border Radius End\n       * @see https://tailwindcss.com/docs/border-radius\n       */\n      'rounded-e': [{\n        'rounded-e': scaleRadius()\n      }],\n      /**\n       * Border Radius Top\n       * @see https://tailwindcss.com/docs/border-radius\n       */\n      'rounded-t': [{\n        'rounded-t': scaleRadius()\n      }],\n      /**\n       * Border Radius Right\n       * @see https://tailwindcss.com/docs/border-radius\n       */\n      'rounded-r': [{\n        'rounded-r': scaleRadius()\n      }],\n      /**\n       * Border Radius Bottom\n       * @see https://tailwindcss.com/docs/border-radius\n       */\n      'rounded-b': [{\n        'rounded-b': scaleRadius()\n      }],\n      /**\n       * Border Radius Left\n       * @see https://tailwindcss.com/docs/border-radius\n       */\n      'rounded-l': [{\n        'rounded-l': scaleRadius()\n      }],\n      /**\n       * Border Radius Start Start\n       * @see https://tailwindcss.com/docs/border-radius\n       */\n      'rounded-ss': [{\n        'rounded-ss': scaleRadius()\n      }],\n      /**\n       * Border Radius Start End\n       * @see https://tailwindcss.com/docs/border-radius\n       */\n      'rounded-se': [{\n        'rounded-se': scaleRadius()\n      }],\n      /**\n       * Border Radius End End\n       * @see https://tailwindcss.com/docs/border-radius\n       */\n      'rounded-ee': [{\n        'rounded-ee': scaleRadius()\n      }],\n      /**\n       * Border Radius End Start\n       * @see https://tailwindcss.com/docs/border-radius\n       */\n      'rounded-es': [{\n        'rounded-es': scaleRadius()\n      }],\n      /**\n       * Border Radius Top Left\n       * @see https://tailwindcss.com/docs/border-radius\n       */\n      'rounded-tl': [{\n        'rounded-tl': scaleRadius()\n      }],\n      /**\n       * Border Radius Top Right\n       * @see https://tailwindcss.com/docs/border-radius\n       */\n      'rounded-tr': [{\n        'rounded-tr': scaleRadius()\n      }],\n      /**\n       * Border Radius Bottom Right\n       * @see https://tailwindcss.com/docs/border-radius\n       */\n      'rounded-br': [{\n        'rounded-br': scaleRadius()\n      }],\n      /**\n       * Border Radius Bottom Left\n       * @see https://tailwindcss.com/docs/border-radius\n       */\n      'rounded-bl': [{\n        'rounded-bl': scaleRadius()\n      }],\n      /**\n       * Border Width\n       * @see https://tailwindcss.com/docs/border-width\n       */\n      'border-w': [{\n        border: scaleBorderWidth()\n      }],\n      /**\n       * Border Width X\n       * @see https://tailwindcss.com/docs/border-width\n       */\n      'border-w-x': [{\n        'border-x': scaleBorderWidth()\n      }],\n      /**\n       * Border Width Y\n       * @see https://tailwindcss.com/docs/border-width\n       */\n      'border-w-y': [{\n        'border-y': scaleBorderWidth()\n      }],\n      /**\n       * Border Width Start\n       * @see https://tailwindcss.com/docs/border-width\n       */\n      'border-w-s': [{\n        'border-s': scaleBorderWidth()\n      }],\n      /**\n       * Border Width End\n       * @see https://tailwindcss.com/docs/border-width\n       */\n      'border-w-e': [{\n        'border-e': scaleBorderWidth()\n      }],\n      /**\n       * Border Width Top\n       * @see https://tailwindcss.com/docs/border-width\n       */\n      'border-w-t': [{\n        'border-t': scaleBorderWidth()\n      }],\n      /**\n       * Border Width Right\n       * @see https://tailwindcss.com/docs/border-width\n       */\n      'border-w-r': [{\n        'border-r': scaleBorderWidth()\n      }],\n      /**\n       * Border Width Bottom\n       * @see https://tailwindcss.com/docs/border-width\n       */\n      'border-w-b': [{\n        'border-b': scaleBorderWidth()\n      }],\n      /**\n       * Border Width Left\n       * @see https://tailwindcss.com/docs/border-width\n       */\n      'border-w-l': [{\n        'border-l': scaleBorderWidth()\n      }],\n      /**\n       * Divide Width X\n       * @see https://tailwindcss.com/docs/border-width#between-children\n       */\n      'divide-x': [{\n        'divide-x': scaleBorderWidth()\n      }],\n      /**\n       * Divide Width X Reverse\n       * @see https://tailwindcss.com/docs/border-width#between-children\n       */\n      'divide-x-reverse': ['divide-x-reverse'],\n      /**\n       * Divide Width Y\n       * @see https://tailwindcss.com/docs/border-width#between-children\n       */\n      'divide-y': [{\n        'divide-y': scaleBorderWidth()\n      }],\n      /**\n       * Divide Width Y Reverse\n       * @see https://tailwindcss.com/docs/border-width#between-children\n       */\n      'divide-y-reverse': ['divide-y-reverse'],\n      /**\n       * Border Style\n       * @see https://tailwindcss.com/docs/border-style\n       */\n      'border-style': [{\n        border: [...scaleLineStyle(), 'hidden', 'none']\n      }],\n      /**\n       * Divide Style\n       * @see https://tailwindcss.com/docs/border-style#setting-the-divider-style\n       */\n      'divide-style': [{\n        divide: [...scaleLineStyle(), 'hidden', 'none']\n      }],\n      /**\n       * Border Color\n       * @see https://tailwindcss.com/docs/border-color\n       */\n      'border-color': [{\n        border: scaleColor()\n      }],\n      /**\n       * Border Color X\n       * @see https://tailwindcss.com/docs/border-color\n       */\n      'border-color-x': [{\n        'border-x': scaleColor()\n      }],\n      /**\n       * Border Color Y\n       * @see https://tailwindcss.com/docs/border-color\n       */\n      'border-color-y': [{\n        'border-y': scaleColor()\n      }],\n      /**\n       * Border Color S\n       * @see https://tailwindcss.com/docs/border-color\n       */\n      'border-color-s': [{\n        'border-s': scaleColor()\n      }],\n      /**\n       * Border Color E\n       * @see https://tailwindcss.com/docs/border-color\n       */\n      'border-color-e': [{\n        'border-e': scaleColor()\n      }],\n      /**\n       * Border Color Top\n       * @see https://tailwindcss.com/docs/border-color\n       */\n      'border-color-t': [{\n        'border-t': scaleColor()\n      }],\n      /**\n       * Border Color Right\n       * @see https://tailwindcss.com/docs/border-color\n       */\n      'border-color-r': [{\n        'border-r': scaleColor()\n      }],\n      /**\n       * Border Color Bottom\n       * @see https://tailwindcss.com/docs/border-color\n       */\n      'border-color-b': [{\n        'border-b': scaleColor()\n      }],\n      /**\n       * Border Color Left\n       * @see https://tailwindcss.com/docs/border-color\n       */\n      'border-color-l': [{\n        'border-l': scaleColor()\n      }],\n      /**\n       * Divide Color\n       * @see https://tailwindcss.com/docs/divide-color\n       */\n      'divide-color': [{\n        divide: scaleColor()\n      }],\n      /**\n       * Outline Style\n       * @see https://tailwindcss.com/docs/outline-style\n       */\n      'outline-style': [{\n        outline: [...scaleLineStyle(), 'none', 'hidden']\n      }],\n      /**\n       * Outline Offset\n       * @see https://tailwindcss.com/docs/outline-offset\n       */\n      'outline-offset': [{\n        'outline-offset': [isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Outline Width\n       * @see https://tailwindcss.com/docs/outline-width\n       */\n      'outline-w': [{\n        outline: ['', isNumber, isArbitraryVariableLength, isArbitraryLength]\n      }],\n      /**\n       * Outline Color\n       * @see https://tailwindcss.com/docs/outline-color\n       */\n      'outline-color': [{\n        outline: scaleColor()\n      }],\n      // ---------------\n      // --- Effects ---\n      // ---------------\n      /**\n       * Box Shadow\n       * @see https://tailwindcss.com/docs/box-shadow\n       */\n      shadow: [{\n        shadow: [\n        // Deprecated since Tailwind CSS v4.0.0\n        '', 'none', themeShadow, isArbitraryVariableShadow, isArbitraryShadow]\n      }],\n      /**\n       * Box Shadow Color\n       * @see https://tailwindcss.com/docs/box-shadow#setting-the-shadow-color\n       */\n      'shadow-color': [{\n        shadow: scaleColor()\n      }],\n      /**\n       * Inset Box Shadow\n       * @see https://tailwindcss.com/docs/box-shadow#adding-an-inset-shadow\n       */\n      'inset-shadow': [{\n        'inset-shadow': ['none', themeInsetShadow, isArbitraryVariableShadow, isArbitraryShadow]\n      }],\n      /**\n       * Inset Box Shadow Color\n       * @see https://tailwindcss.com/docs/box-shadow#setting-the-inset-shadow-color\n       */\n      'inset-shadow-color': [{\n        'inset-shadow': scaleColor()\n      }],\n      /**\n       * Ring Width\n       * @see https://tailwindcss.com/docs/box-shadow#adding-a-ring\n       */\n      'ring-w': [{\n        ring: scaleBorderWidth()\n      }],\n      /**\n       * Ring Width Inset\n       * @see https://v3.tailwindcss.com/docs/ring-width#inset-rings\n       * @deprecated since Tailwind CSS v4.0.0\n       * @see https://github.com/tailwindlabs/tailwindcss/blob/v4.0.0/packages/tailwindcss/src/utilities.ts#L4158\n       */\n      'ring-w-inset': ['ring-inset'],\n      /**\n       * Ring Color\n       * @see https://tailwindcss.com/docs/box-shadow#setting-the-ring-color\n       */\n      'ring-color': [{\n        ring: scaleColor()\n      }],\n      /**\n       * Ring Offset Width\n       * @see https://v3.tailwindcss.com/docs/ring-offset-width\n       * @deprecated since Tailwind CSS v4.0.0\n       * @see https://github.com/tailwindlabs/tailwindcss/blob/v4.0.0/packages/tailwindcss/src/utilities.ts#L4158\n       */\n      'ring-offset-w': [{\n        'ring-offset': [isNumber, isArbitraryLength]\n      }],\n      /**\n       * Ring Offset Color\n       * @see https://v3.tailwindcss.com/docs/ring-offset-color\n       * @deprecated since Tailwind CSS v4.0.0\n       * @see https://github.com/tailwindlabs/tailwindcss/blob/v4.0.0/packages/tailwindcss/src/utilities.ts#L4158\n       */\n      'ring-offset-color': [{\n        'ring-offset': scaleColor()\n      }],\n      /**\n       * Inset Ring Width\n       * @see https://tailwindcss.com/docs/box-shadow#adding-an-inset-ring\n       */\n      'inset-ring-w': [{\n        'inset-ring': scaleBorderWidth()\n      }],\n      /**\n       * Inset Ring Color\n       * @see https://tailwindcss.com/docs/box-shadow#setting-the-inset-ring-color\n       */\n      'inset-ring-color': [{\n        'inset-ring': scaleColor()\n      }],\n      /**\n       * Text Shadow\n       * @see https://tailwindcss.com/docs/text-shadow\n       */\n      'text-shadow': [{\n        'text-shadow': ['none', themeTextShadow, isArbitraryVariableShadow, isArbitraryShadow]\n      }],\n      /**\n       * Text Shadow Color\n       * @see https://tailwindcss.com/docs/text-shadow#setting-the-shadow-color\n       */\n      'text-shadow-color': [{\n        'text-shadow': scaleColor()\n      }],\n      /**\n       * Opacity\n       * @see https://tailwindcss.com/docs/opacity\n       */\n      opacity: [{\n        opacity: [isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Mix Blend Mode\n       * @see https://tailwindcss.com/docs/mix-blend-mode\n       */\n      'mix-blend': [{\n        'mix-blend': [...scaleBlendMode(), 'plus-darker', 'plus-lighter']\n      }],\n      /**\n       * Background Blend Mode\n       * @see https://tailwindcss.com/docs/background-blend-mode\n       */\n      'bg-blend': [{\n        'bg-blend': scaleBlendMode()\n      }],\n      /**\n       * Mask Clip\n       * @see https://tailwindcss.com/docs/mask-clip\n       */\n      'mask-clip': [{\n        'mask-clip': ['border', 'padding', 'content', 'fill', 'stroke', 'view']\n      }, 'mask-no-clip'],\n      /**\n       * Mask Composite\n       * @see https://tailwindcss.com/docs/mask-composite\n       */\n      'mask-composite': [{\n        mask: ['add', 'subtract', 'intersect', 'exclude']\n      }],\n      /**\n       * Mask Image\n       * @see https://tailwindcss.com/docs/mask-image\n       */\n      'mask-image-linear-pos': [{\n        'mask-linear': [isNumber]\n      }],\n      'mask-image-linear-from-pos': [{\n        'mask-linear-from': scaleMaskImagePosition()\n      }],\n      'mask-image-linear-to-pos': [{\n        'mask-linear-to': scaleMaskImagePosition()\n      }],\n      'mask-image-linear-from-color': [{\n        'mask-linear-from': scaleColor()\n      }],\n      'mask-image-linear-to-color': [{\n        'mask-linear-to': scaleColor()\n      }],\n      'mask-image-t-from-pos': [{\n        'mask-t-from': scaleMaskImagePosition()\n      }],\n      'mask-image-t-to-pos': [{\n        'mask-t-to': scaleMaskImagePosition()\n      }],\n      'mask-image-t-from-color': [{\n        'mask-t-from': scaleColor()\n      }],\n      'mask-image-t-to-color': [{\n        'mask-t-to': scaleColor()\n      }],\n      'mask-image-r-from-pos': [{\n        'mask-r-from': scaleMaskImagePosition()\n      }],\n      'mask-image-r-to-pos': [{\n        'mask-r-to': scaleMaskImagePosition()\n      }],\n      'mask-image-r-from-color': [{\n        'mask-r-from': scaleColor()\n      }],\n      'mask-image-r-to-color': [{\n        'mask-r-to': scaleColor()\n      }],\n      'mask-image-b-from-pos': [{\n        'mask-b-from': scaleMaskImagePosition()\n      }],\n      'mask-image-b-to-pos': [{\n        'mask-b-to': scaleMaskImagePosition()\n      }],\n      'mask-image-b-from-color': [{\n        'mask-b-from': scaleColor()\n      }],\n      'mask-image-b-to-color': [{\n        'mask-b-to': scaleColor()\n      }],\n      'mask-image-l-from-pos': [{\n        'mask-l-from': scaleMaskImagePosition()\n      }],\n      'mask-image-l-to-pos': [{\n        'mask-l-to': scaleMaskImagePosition()\n      }],\n      'mask-image-l-from-color': [{\n        'mask-l-from': scaleColor()\n      }],\n      'mask-image-l-to-color': [{\n        'mask-l-to': scaleColor()\n      }],\n      'mask-image-x-from-pos': [{\n        'mask-x-from': scaleMaskImagePosition()\n      }],\n      'mask-image-x-to-pos': [{\n        'mask-x-to': scaleMaskImagePosition()\n      }],\n      'mask-image-x-from-color': [{\n        'mask-x-from': scaleColor()\n      }],\n      'mask-image-x-to-color': [{\n        'mask-x-to': scaleColor()\n      }],\n      'mask-image-y-from-pos': [{\n        'mask-y-from': scaleMaskImagePosition()\n      }],\n      'mask-image-y-to-pos': [{\n        'mask-y-to': scaleMaskImagePosition()\n      }],\n      'mask-image-y-from-color': [{\n        'mask-y-from': scaleColor()\n      }],\n      'mask-image-y-to-color': [{\n        'mask-y-to': scaleColor()\n      }],\n      'mask-image-radial': [{\n        'mask-radial': [isArbitraryVariable, isArbitraryValue]\n      }],\n      'mask-image-radial-from-pos': [{\n        'mask-radial-from': scaleMaskImagePosition()\n      }],\n      'mask-image-radial-to-pos': [{\n        'mask-radial-to': scaleMaskImagePosition()\n      }],\n      'mask-image-radial-from-color': [{\n        'mask-radial-from': scaleColor()\n      }],\n      'mask-image-radial-to-color': [{\n        'mask-radial-to': scaleColor()\n      }],\n      'mask-image-radial-shape': [{\n        'mask-radial': ['circle', 'ellipse']\n      }],\n      'mask-image-radial-size': [{\n        'mask-radial': [{\n          closest: ['side', 'corner'],\n          farthest: ['side', 'corner']\n        }]\n      }],\n      'mask-image-radial-pos': [{\n        'mask-radial-at': scalePosition()\n      }],\n      'mask-image-conic-pos': [{\n        'mask-conic': [isNumber]\n      }],\n      'mask-image-conic-from-pos': [{\n        'mask-conic-from': scaleMaskImagePosition()\n      }],\n      'mask-image-conic-to-pos': [{\n        'mask-conic-to': scaleMaskImagePosition()\n      }],\n      'mask-image-conic-from-color': [{\n        'mask-conic-from': scaleColor()\n      }],\n      'mask-image-conic-to-color': [{\n        'mask-conic-to': scaleColor()\n      }],\n      /**\n       * Mask Mode\n       * @see https://tailwindcss.com/docs/mask-mode\n       */\n      'mask-mode': [{\n        mask: ['alpha', 'luminance', 'match']\n      }],\n      /**\n       * Mask Origin\n       * @see https://tailwindcss.com/docs/mask-origin\n       */\n      'mask-origin': [{\n        'mask-origin': ['border', 'padding', 'content', 'fill', 'stroke', 'view']\n      }],\n      /**\n       * Mask Position\n       * @see https://tailwindcss.com/docs/mask-position\n       */\n      'mask-position': [{\n        mask: scaleBgPosition()\n      }],\n      /**\n       * Mask Repeat\n       * @see https://tailwindcss.com/docs/mask-repeat\n       */\n      'mask-repeat': [{\n        mask: scaleBgRepeat()\n      }],\n      /**\n       * Mask Size\n       * @see https://tailwindcss.com/docs/mask-size\n       */\n      'mask-size': [{\n        mask: scaleBgSize()\n      }],\n      /**\n       * Mask Type\n       * @see https://tailwindcss.com/docs/mask-type\n       */\n      'mask-type': [{\n        'mask-type': ['alpha', 'luminance']\n      }],\n      /**\n       * Mask Image\n       * @see https://tailwindcss.com/docs/mask-image\n       */\n      'mask-image': [{\n        mask: ['none', isArbitraryVariable, isArbitraryValue]\n      }],\n      // ---------------\n      // --- Filters ---\n      // ---------------\n      /**\n       * Filter\n       * @see https://tailwindcss.com/docs/filter\n       */\n      filter: [{\n        filter: [\n        // Deprecated since Tailwind CSS v3.0.0\n        '', 'none', isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Blur\n       * @see https://tailwindcss.com/docs/blur\n       */\n      blur: [{\n        blur: scaleBlur()\n      }],\n      /**\n       * Brightness\n       * @see https://tailwindcss.com/docs/brightness\n       */\n      brightness: [{\n        brightness: [isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Contrast\n       * @see https://tailwindcss.com/docs/contrast\n       */\n      contrast: [{\n        contrast: [isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Drop Shadow\n       * @see https://tailwindcss.com/docs/drop-shadow\n       */\n      'drop-shadow': [{\n        'drop-shadow': [\n        // Deprecated since Tailwind CSS v4.0.0\n        '', 'none', themeDropShadow, isArbitraryVariableShadow, isArbitraryShadow]\n      }],\n      /**\n       * Drop Shadow Color\n       * @see https://tailwindcss.com/docs/filter-drop-shadow#setting-the-shadow-color\n       */\n      'drop-shadow-color': [{\n        'drop-shadow': scaleColor()\n      }],\n      /**\n       * Grayscale\n       * @see https://tailwindcss.com/docs/grayscale\n       */\n      grayscale: [{\n        grayscale: ['', isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Hue Rotate\n       * @see https://tailwindcss.com/docs/hue-rotate\n       */\n      'hue-rotate': [{\n        'hue-rotate': [isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Invert\n       * @see https://tailwindcss.com/docs/invert\n       */\n      invert: [{\n        invert: ['', isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Saturate\n       * @see https://tailwindcss.com/docs/saturate\n       */\n      saturate: [{\n        saturate: [isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Sepia\n       * @see https://tailwindcss.com/docs/sepia\n       */\n      sepia: [{\n        sepia: ['', isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Backdrop Filter\n       * @see https://tailwindcss.com/docs/backdrop-filter\n       */\n      'backdrop-filter': [{\n        'backdrop-filter': [\n        // Deprecated since Tailwind CSS v3.0.0\n        '', 'none', isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Backdrop Blur\n       * @see https://tailwindcss.com/docs/backdrop-blur\n       */\n      'backdrop-blur': [{\n        'backdrop-blur': scaleBlur()\n      }],\n      /**\n       * Backdrop Brightness\n       * @see https://tailwindcss.com/docs/backdrop-brightness\n       */\n      'backdrop-brightness': [{\n        'backdrop-brightness': [isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Backdrop Contrast\n       * @see https://tailwindcss.com/docs/backdrop-contrast\n       */\n      'backdrop-contrast': [{\n        'backdrop-contrast': [isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Backdrop Grayscale\n       * @see https://tailwindcss.com/docs/backdrop-grayscale\n       */\n      'backdrop-grayscale': [{\n        'backdrop-grayscale': ['', isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Backdrop Hue Rotate\n       * @see https://tailwindcss.com/docs/backdrop-hue-rotate\n       */\n      'backdrop-hue-rotate': [{\n        'backdrop-hue-rotate': [isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Backdrop Invert\n       * @see https://tailwindcss.com/docs/backdrop-invert\n       */\n      'backdrop-invert': [{\n        'backdrop-invert': ['', isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Backdrop Opacity\n       * @see https://tailwindcss.com/docs/backdrop-opacity\n       */\n      'backdrop-opacity': [{\n        'backdrop-opacity': [isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Backdrop Saturate\n       * @see https://tailwindcss.com/docs/backdrop-saturate\n       */\n      'backdrop-saturate': [{\n        'backdrop-saturate': [isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Backdrop Sepia\n       * @see https://tailwindcss.com/docs/backdrop-sepia\n       */\n      'backdrop-sepia': [{\n        'backdrop-sepia': ['', isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      // --------------\n      // --- Tables ---\n      // --------------\n      /**\n       * Border Collapse\n       * @see https://tailwindcss.com/docs/border-collapse\n       */\n      'border-collapse': [{\n        border: ['collapse', 'separate']\n      }],\n      /**\n       * Border Spacing\n       * @see https://tailwindcss.com/docs/border-spacing\n       */\n      'border-spacing': [{\n        'border-spacing': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Border Spacing X\n       * @see https://tailwindcss.com/docs/border-spacing\n       */\n      'border-spacing-x': [{\n        'border-spacing-x': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Border Spacing Y\n       * @see https://tailwindcss.com/docs/border-spacing\n       */\n      'border-spacing-y': [{\n        'border-spacing-y': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Table Layout\n       * @see https://tailwindcss.com/docs/table-layout\n       */\n      'table-layout': [{\n        table: ['auto', 'fixed']\n      }],\n      /**\n       * Caption Side\n       * @see https://tailwindcss.com/docs/caption-side\n       */\n      caption: [{\n        caption: ['top', 'bottom']\n      }],\n      // ---------------------------------\n      // --- Transitions and Animation ---\n      // ---------------------------------\n      /**\n       * Transition Property\n       * @see https://tailwindcss.com/docs/transition-property\n       */\n      transition: [{\n        transition: ['', 'all', 'colors', 'opacity', 'shadow', 'transform', 'none', isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Transition Behavior\n       * @see https://tailwindcss.com/docs/transition-behavior\n       */\n      'transition-behavior': [{\n        transition: ['normal', 'discrete']\n      }],\n      /**\n       * Transition Duration\n       * @see https://tailwindcss.com/docs/transition-duration\n       */\n      duration: [{\n        duration: [isNumber, 'initial', isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Transition Timing Function\n       * @see https://tailwindcss.com/docs/transition-timing-function\n       */\n      ease: [{\n        ease: ['linear', 'initial', themeEase, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Transition Delay\n       * @see https://tailwindcss.com/docs/transition-delay\n       */\n      delay: [{\n        delay: [isNumber, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Animation\n       * @see https://tailwindcss.com/docs/animation\n       */\n      animate: [{\n        animate: ['none', themeAnimate, isArbitraryVariable, isArbitraryValue]\n      }],\n      // ------------------\n      // --- Transforms ---\n      // ------------------\n      /**\n       * Backface Visibility\n       * @see https://tailwindcss.com/docs/backface-visibility\n       */\n      backface: [{\n        backface: ['hidden', 'visible']\n      }],\n      /**\n       * Perspective\n       * @see https://tailwindcss.com/docs/perspective\n       */\n      perspective: [{\n        perspective: [themePerspective, isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Perspective Origin\n       * @see https://tailwindcss.com/docs/perspective-origin\n       */\n      'perspective-origin': [{\n        'perspective-origin': scalePositionWithArbitrary()\n      }],\n      /**\n       * Rotate\n       * @see https://tailwindcss.com/docs/rotate\n       */\n      rotate: [{\n        rotate: scaleRotate()\n      }],\n      /**\n       * Rotate X\n       * @see https://tailwindcss.com/docs/rotate\n       */\n      'rotate-x': [{\n        'rotate-x': scaleRotate()\n      }],\n      /**\n       * Rotate Y\n       * @see https://tailwindcss.com/docs/rotate\n       */\n      'rotate-y': [{\n        'rotate-y': scaleRotate()\n      }],\n      /**\n       * Rotate Z\n       * @see https://tailwindcss.com/docs/rotate\n       */\n      'rotate-z': [{\n        'rotate-z': scaleRotate()\n      }],\n      /**\n       * Scale\n       * @see https://tailwindcss.com/docs/scale\n       */\n      scale: [{\n        scale: scaleScale()\n      }],\n      /**\n       * Scale X\n       * @see https://tailwindcss.com/docs/scale\n       */\n      'scale-x': [{\n        'scale-x': scaleScale()\n      }],\n      /**\n       * Scale Y\n       * @see https://tailwindcss.com/docs/scale\n       */\n      'scale-y': [{\n        'scale-y': scaleScale()\n      }],\n      /**\n       * Scale Z\n       * @see https://tailwindcss.com/docs/scale\n       */\n      'scale-z': [{\n        'scale-z': scaleScale()\n      }],\n      /**\n       * Scale 3D\n       * @see https://tailwindcss.com/docs/scale\n       */\n      'scale-3d': ['scale-3d'],\n      /**\n       * Skew\n       * @see https://tailwindcss.com/docs/skew\n       */\n      skew: [{\n        skew: scaleSkew()\n      }],\n      /**\n       * Skew X\n       * @see https://tailwindcss.com/docs/skew\n       */\n      'skew-x': [{\n        'skew-x': scaleSkew()\n      }],\n      /**\n       * Skew Y\n       * @see https://tailwindcss.com/docs/skew\n       */\n      'skew-y': [{\n        'skew-y': scaleSkew()\n      }],\n      /**\n       * Transform\n       * @see https://tailwindcss.com/docs/transform\n       */\n      transform: [{\n        transform: [isArbitraryVariable, isArbitraryValue, '', 'none', 'gpu', 'cpu']\n      }],\n      /**\n       * Transform Origin\n       * @see https://tailwindcss.com/docs/transform-origin\n       */\n      'transform-origin': [{\n        origin: scalePositionWithArbitrary()\n      }],\n      /**\n       * Transform Style\n       * @see https://tailwindcss.com/docs/transform-style\n       */\n      'transform-style': [{\n        transform: ['3d', 'flat']\n      }],\n      /**\n       * Translate\n       * @see https://tailwindcss.com/docs/translate\n       */\n      translate: [{\n        translate: scaleTranslate()\n      }],\n      /**\n       * Translate X\n       * @see https://tailwindcss.com/docs/translate\n       */\n      'translate-x': [{\n        'translate-x': scaleTranslate()\n      }],\n      /**\n       * Translate Y\n       * @see https://tailwindcss.com/docs/translate\n       */\n      'translate-y': [{\n        'translate-y': scaleTranslate()\n      }],\n      /**\n       * Translate Z\n       * @see https://tailwindcss.com/docs/translate\n       */\n      'translate-z': [{\n        'translate-z': scaleTranslate()\n      }],\n      /**\n       * Translate None\n       * @see https://tailwindcss.com/docs/translate\n       */\n      'translate-none': ['translate-none'],\n      // ---------------------\n      // --- Interactivity ---\n      // ---------------------\n      /**\n       * Accent Color\n       * @see https://tailwindcss.com/docs/accent-color\n       */\n      accent: [{\n        accent: scaleColor()\n      }],\n      /**\n       * Appearance\n       * @see https://tailwindcss.com/docs/appearance\n       */\n      appearance: [{\n        appearance: ['none', 'auto']\n      }],\n      /**\n       * Caret Color\n       * @see https://tailwindcss.com/docs/just-in-time-mode#caret-color-utilities\n       */\n      'caret-color': [{\n        caret: scaleColor()\n      }],\n      /**\n       * Color Scheme\n       * @see https://tailwindcss.com/docs/color-scheme\n       */\n      'color-scheme': [{\n        scheme: ['normal', 'dark', 'light', 'light-dark', 'only-dark', 'only-light']\n      }],\n      /**\n       * Cursor\n       * @see https://tailwindcss.com/docs/cursor\n       */\n      cursor: [{\n        cursor: ['auto', 'default', 'pointer', 'wait', 'text', 'move', 'help', 'not-allowed', 'none', 'context-menu', 'progress', 'cell', 'crosshair', 'vertical-text', 'alias', 'copy', 'no-drop', 'grab', 'grabbing', 'all-scroll', 'col-resize', 'row-resize', 'n-resize', 'e-resize', 's-resize', 'w-resize', 'ne-resize', 'nw-resize', 'se-resize', 'sw-resize', 'ew-resize', 'ns-resize', 'nesw-resize', 'nwse-resize', 'zoom-in', 'zoom-out', isArbitraryVariable, isArbitraryValue]\n      }],\n      /**\n       * Field Sizing\n       * @see https://tailwindcss.com/docs/field-sizing\n       */\n      'field-sizing': [{\n        'field-sizing': ['fixed', 'content']\n      }],\n      /**\n       * Pointer Events\n       * @see https://tailwindcss.com/docs/pointer-events\n       */\n      'pointer-events': [{\n        'pointer-events': ['auto', 'none']\n      }],\n      /**\n       * Resize\n       * @see https://tailwindcss.com/docs/resize\n       */\n      resize: [{\n        resize: ['none', '', 'y', 'x']\n      }],\n      /**\n       * Scroll Behavior\n       * @see https://tailwindcss.com/docs/scroll-behavior\n       */\n      'scroll-behavior': [{\n        scroll: ['auto', 'smooth']\n      }],\n      /**\n       * Scroll Margin\n       * @see https://tailwindcss.com/docs/scroll-margin\n       */\n      'scroll-m': [{\n        'scroll-m': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Scroll Margin X\n       * @see https://tailwindcss.com/docs/scroll-margin\n       */\n      'scroll-mx': [{\n        'scroll-mx': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Scroll Margin Y\n       * @see https://tailwindcss.com/docs/scroll-margin\n       */\n      'scroll-my': [{\n        'scroll-my': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Scroll Margin Start\n       * @see https://tailwindcss.com/docs/scroll-margin\n       */\n      'scroll-ms': [{\n        'scroll-ms': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Scroll Margin End\n       * @see https://tailwindcss.com/docs/scroll-margin\n       */\n      'scroll-me': [{\n        'scroll-me': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Scroll Margin Top\n       * @see https://tailwindcss.com/docs/scroll-margin\n       */\n      'scroll-mt': [{\n        'scroll-mt': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Scroll Margin Right\n       * @see https://tailwindcss.com/docs/scroll-margin\n       */\n      'scroll-mr': [{\n        'scroll-mr': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Scroll Margin Bottom\n       * @see https://tailwindcss.com/docs/scroll-margin\n       */\n      'scroll-mb': [{\n        'scroll-mb': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Scroll Margin Left\n       * @see https://tailwindcss.com/docs/scroll-margin\n       */\n      'scroll-ml': [{\n        'scroll-ml': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Scroll Padding\n       * @see https://tailwindcss.com/docs/scroll-padding\n       */\n      'scroll-p': [{\n        'scroll-p': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Scroll Padding X\n       * @see https://tailwindcss.com/docs/scroll-padding\n       */\n      'scroll-px': [{\n        'scroll-px': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Scroll Padding Y\n       * @see https://tailwindcss.com/docs/scroll-padding\n       */\n      'scroll-py': [{\n        'scroll-py': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Scroll Padding Start\n       * @see https://tailwindcss.com/docs/scroll-padding\n       */\n      'scroll-ps': [{\n        'scroll-ps': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Scroll Padding End\n       * @see https://tailwindcss.com/docs/scroll-padding\n       */\n      'scroll-pe': [{\n        'scroll-pe': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Scroll Padding Top\n       * @see https://tailwindcss.com/docs/scroll-padding\n       */\n      'scroll-pt': [{\n        'scroll-pt': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Scroll Padding Right\n       * @see https://tailwindcss.com/docs/scroll-padding\n       */\n      'scroll-pr': [{\n        'scroll-pr': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Scroll Padding Bottom\n       * @see https://tailwindcss.com/docs/scroll-padding\n       */\n      'scroll-pb': [{\n        'scroll-pb': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Scroll Padding Left\n       * @see https://tailwindcss.com/docs/scroll-padding\n       */\n      'scroll-pl': [{\n        'scroll-pl': scaleUnambiguousSpacing()\n      }],\n      /**\n       * Scroll Snap Align\n       * @see https://tailwindcss.com/docs/scroll-snap-align\n       */\n      'snap-align': [{\n        snap: ['start', 'end', 'center', 'align-none']\n      }],\n      /**\n       * Scroll Snap Stop\n       * @see https://tailwindcss.com/docs/scroll-snap-stop\n       */\n      'snap-stop': [{\n        snap: ['normal', 'always']\n      }],\n      /**\n       * Scroll Snap Type\n       * @see https://tailwindcss.com/docs/scroll-snap-type\n       */\n      'snap-type': [{\n        snap: ['none', 'x', 'y', 'both']\n      }],\n      /**\n       * Scroll Snap Type Strictness\n       * @see https://tailwindcss.com/docs/scroll-snap-type\n       */\n      'snap-strictness': [{\n        snap: ['mandatory', 'proximity']\n      }],\n      /**\n       * Touch Action\n       * @see https://tailwindcss.com/docs/touch-action\n       */\n      touch: [{\n        touch: ['auto', 'none', 'manipulation']\n      }],\n      /**\n       * Touch Action X\n       * @see https://tailwindcss.com/docs/touch-action\n       */\n      'touch-x': [{\n        'touch-pan': ['x', 'left', 'right']\n      }],\n      /**\n       * Touch Action Y\n       * @see https://tailwindcss.com/docs/touch-action\n       */\n      'touch-y': [{\n        'touch-pan': ['y', 'up', 'down']\n      }],\n      /**\n       * Touch Action Pinch Zoom\n       * @see https://tailwindcss.com/docs/touch-action\n       */\n      'touch-pz': ['touch-pinch-zoom'],\n      /**\n       * User Select\n       * @see https://tailwindcss.com/docs/user-select\n       */\n      select: [{\n        select: ['none', 'text', 'all', 'auto']\n      }],\n      /**\n       * Will Change\n       * @see https://tailwindcss.com/docs/will-change\n       */\n      'will-change': [{\n        'will-change': ['auto', 'scroll', 'contents', 'transform', isArbitraryVariable, isArbitraryValue]\n      }],\n      // -----------\n      // --- SVG ---\n      // -----------\n      /**\n       * Fill\n       * @see https://tailwindcss.com/docs/fill\n       */\n      fill: [{\n        fill: ['none', ...scaleColor()]\n      }],\n      /**\n       * Stroke Width\n       * @see https://tailwindcss.com/docs/stroke-width\n       */\n      'stroke-w': [{\n        stroke: [isNumber, isArbitraryVariableLength, isArbitraryLength, isArbitraryNumber]\n      }],\n      /**\n       * Stroke\n       * @see https://tailwindcss.com/docs/stroke\n       */\n      stroke: [{\n        stroke: ['none', ...scaleColor()]\n      }],\n      // ---------------------\n      // --- Accessibility ---\n      // ---------------------\n      /**\n       * Forced Color Adjust\n       * @see https://tailwindcss.com/docs/forced-color-adjust\n       */\n      'forced-color-adjust': [{\n        'forced-color-adjust': ['auto', 'none']\n      }]\n    },\n    conflictingClassGroups: {\n      overflow: ['overflow-x', 'overflow-y'],\n      overscroll: ['overscroll-x', 'overscroll-y'],\n      inset: ['inset-x', 'inset-y', 'start', 'end', 'top', 'right', 'bottom', 'left'],\n      'inset-x': ['right', 'left'],\n      'inset-y': ['top', 'bottom'],\n      flex: ['basis', 'grow', 'shrink'],\n      gap: ['gap-x', 'gap-y'],\n      p: ['px', 'py', 'ps', 'pe', 'pt', 'pr', 'pb', 'pl'],\n      px: ['pr', 'pl'],\n      py: ['pt', 'pb'],\n      m: ['mx', 'my', 'ms', 'me', 'mt', 'mr', 'mb', 'ml'],\n      mx: ['mr', 'ml'],\n      my: ['mt', 'mb'],\n      size: ['w', 'h'],\n      'font-size': ['leading'],\n      'fvn-normal': ['fvn-ordinal', 'fvn-slashed-zero', 'fvn-figure', 'fvn-spacing', 'fvn-fraction'],\n      'fvn-ordinal': ['fvn-normal'],\n      'fvn-slashed-zero': ['fvn-normal'],\n      'fvn-figure': ['fvn-normal'],\n      'fvn-spacing': ['fvn-normal'],\n      'fvn-fraction': ['fvn-normal'],\n      'line-clamp': ['display', 'overflow'],\n      rounded: ['rounded-s', 'rounded-e', 'rounded-t', 'rounded-r', 'rounded-b', 'rounded-l', 'rounded-ss', 'rounded-se', 'rounded-ee', 'rounded-es', 'rounded-tl', 'rounded-tr', 'rounded-br', 'rounded-bl'],\n      'rounded-s': ['rounded-ss', 'rounded-es'],\n      'rounded-e': ['rounded-se', 'rounded-ee'],\n      'rounded-t': ['rounded-tl', 'rounded-tr'],\n      'rounded-r': ['rounded-tr', 'rounded-br'],\n      'rounded-b': ['rounded-br', 'rounded-bl'],\n      'rounded-l': ['rounded-tl', 'rounded-bl'],\n      'border-spacing': ['border-spacing-x', 'border-spacing-y'],\n      'border-w': ['border-w-x', 'border-w-y', 'border-w-s', 'border-w-e', 'border-w-t', 'border-w-r', 'border-w-b', 'border-w-l'],\n      'border-w-x': ['border-w-r', 'border-w-l'],\n      'border-w-y': ['border-w-t', 'border-w-b'],\n      'border-color': ['border-color-x', 'border-color-y', 'border-color-s', 'border-color-e', 'border-color-t', 'border-color-r', 'border-color-b', 'border-color-l'],\n      'border-color-x': ['border-color-r', 'border-color-l'],\n      'border-color-y': ['border-color-t', 'border-color-b'],\n      translate: ['translate-x', 'translate-y', 'translate-none'],\n      'translate-none': ['translate', 'translate-x', 'translate-y', 'translate-z'],\n      'scroll-m': ['scroll-mx', 'scroll-my', 'scroll-ms', 'scroll-me', 'scroll-mt', 'scroll-mr', 'scroll-mb', 'scroll-ml'],\n      'scroll-mx': ['scroll-mr', 'scroll-ml'],\n      'scroll-my': ['scroll-mt', 'scroll-mb'],\n      'scroll-p': ['scroll-px', 'scroll-py', 'scroll-ps', 'scroll-pe', 'scroll-pt', 'scroll-pr', 'scroll-pb', 'scroll-pl'],\n      'scroll-px': ['scroll-pr', 'scroll-pl'],\n      'scroll-py': ['scroll-pt', 'scroll-pb'],\n      touch: ['touch-x', 'touch-y', 'touch-pz'],\n      'touch-x': ['touch'],\n      'touch-y': ['touch'],\n      'touch-pz': ['touch']\n    },\n    conflictingClassGroupModifiers: {\n      'font-size': ['leading']\n    },\n    orderSensitiveModifiers: ['*', '**', 'after', 'backdrop', 'before', 'details-content', 'file', 'first-letter', 'first-line', 'marker', 'placeholder', 'selection']\n  };\n};\n\n/**\n * @param baseConfig Config where other config will be merged into. This object will be mutated.\n * @param configExtension Partial config to merge into the `baseConfig`.\n */\nconst mergeConfigs = (baseConfig, {\n  cacheSize,\n  prefix,\n  experimentalParseClassName,\n  extend = {},\n  override = {}\n}) => {\n  overrideProperty(baseConfig, 'cacheSize', cacheSize);\n  overrideProperty(baseConfig, 'prefix', prefix);\n  overrideProperty(baseConfig, 'experimentalParseClassName', experimentalParseClassName);\n  overrideConfigProperties(baseConfig.theme, override.theme);\n  overrideConfigProperties(baseConfig.classGroups, override.classGroups);\n  overrideConfigProperties(baseConfig.conflictingClassGroups, override.conflictingClassGroups);\n  overrideConfigProperties(baseConfig.conflictingClassGroupModifiers, override.conflictingClassGroupModifiers);\n  overrideProperty(baseConfig, 'orderSensitiveModifiers', override.orderSensitiveModifiers);\n  mergeConfigProperties(baseConfig.theme, extend.theme);\n  mergeConfigProperties(baseConfig.classGroups, extend.classGroups);\n  mergeConfigProperties(baseConfig.conflictingClassGroups, extend.conflictingClassGroups);\n  mergeConfigProperties(baseConfig.conflictingClassGroupModifiers, extend.conflictingClassGroupModifiers);\n  mergeArrayProperties(baseConfig, extend, 'orderSensitiveModifiers');\n  return baseConfig;\n};\nconst overrideProperty = (baseObject, overrideKey, overrideValue) => {\n  if (overrideValue !== undefined) {\n    baseObject[overrideKey] = overrideValue;\n  }\n};\nconst overrideConfigProperties = (baseObject, overrideObject) => {\n  if (overrideObject) {\n    for (const key in overrideObject) {\n      overrideProperty(baseObject, key, overrideObject[key]);\n    }\n  }\n};\nconst mergeConfigProperties = (baseObject, mergeObject) => {\n  if (mergeObject) {\n    for (const key in mergeObject) {\n      mergeArrayProperties(baseObject, mergeObject, key);\n    }\n  }\n};\nconst mergeArrayProperties = (baseObject, mergeObject, key) => {\n  const mergeValue = mergeObject[key];\n  if (mergeValue !== undefined) {\n    baseObject[key] = baseObject[key] ? baseObject[key].concat(mergeValue) : mergeValue;\n  }\n};\nconst extendTailwindMerge = (configExtension, ...createConfig) => typeof configExtension === 'function' ? createTailwindMerge(getDefaultConfig, configExtension, ...createConfig) : createTailwindMerge(() => mergeConfigs(getDefaultConfig(), configExtension), ...createConfig);\nconst twMerge = /*#__PURE__*/createTailwindMerge(getDefaultConfig);\nexport { createTailwindMerge, extendTailwindMerge, fromTheme, getDefaultConfig, mergeConfigs, twJoin, twMerge, validators };\n//# sourceMappingURL=bundle-mjs.mjs.map\n","import { clsx, type ClassValue } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n\treturn twMerge(clsx(inputs));\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type WithoutChild<T> = T extends { child?: any } ? Omit<T, \"child\"> : T;\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type WithoutChildren<T> = T extends { children?: any } ? Omit<T, \"children\"> : T;\nexport type WithoutChildrenOrChild<T> = WithoutChildren<WithoutChild<T>>;\nexport type WithElementRef<T, U extends HTMLElement = HTMLElement> = T & { ref?: U | null };\n\n/**\n * Debug utility for consistent logging across the application\n */\nexport class Debug {\n    private static enabled: boolean = false;\n    private static readonly PREFIX = '[TandemDebug]';\n\n    /**\n     * Enable debug logging\n     */\n    static enable(): void {\n        Debug.enabled = true;\n        Debug.log('Debug', 'Debug logging enabled');\n    }\n\n    /**\n     * Disable debug logging\n     */\n    static disable(): void {\n        Debug.log('Debug', 'Debug logging disabled');\n        Debug.enabled = false;\n    }\n\n    /**\n     * Log a debug message if debug is enabled\n     * @param context The context of the log message\n     * @param message The message to log\n     * @param data Additional data to log\n     */\n    static log(context: string, message: string, data?: any): void {\n        if (!Debug.enabled) return;\n\n        if (data !== undefined) {\n            console.log(`${Debug.PREFIX} [${context}] ${message}`, data);\n        } else {\n            console.log(`${Debug.PREFIX} [${context}] ${message}`);\n        }\n    }\n\n    /**\n     * Log an error message\n     * @param context The context of the error\n     * @param message The error message\n     * @param error The error object\n     */\n    static error(context: string, message: string, error?: Error): void {\n        if (error) {\n            console.error(`${Debug.PREFIX} [${context}] ${message}`, error);\n        } else {\n            console.error(`${Debug.PREFIX} [${context}] ${message}`);\n        }\n    }\n\n    /**\n     * Log a warning message\n     * @param context The context of the warning\n     * @param message The warning message\n     * @param data Additional data to log\n     */\n    static warn(context: string, message: string, data?: any): void {\n        if (data !== undefined) {\n            console.warn(`${Debug.PREFIX} [${context}] ${message}`, data);\n        } else {\n            console.warn(`${Debug.PREFIX} [${context}] ${message}`);\n        }\n    }\n}","/**\n * Custom error types for the application\n *\n * This module defines custom error classes for different types of errors that can occur\n * in the application, enabling better error handling and propagation.\n */\n\nexport class AppError extends Error {\n    constructor(message: string, public context?: any) {\n        super(message);\n        this.name = 'AppError';\n    }\n}\n\nexport class ProgressError extends AppError {\n    constructor(message: string, context?: any) {\n        super(message, context);\n        this.name = 'ProgressError';\n    }\n}\n\nexport class StateError extends AppError {\n    constructor(message: string, context?: any) {\n        super(message, context);\n        this.name = 'StateError';\n    }\n}\n\nexport class ServiceError extends AppError {\n    constructor(message: string, context?: any) {\n        super(message, context);\n        this.name = 'ServiceError';\n    }\n}\n\nexport class DataError extends AppError {\n    constructor(message: string, context?: any) {\n        super(message, context);\n        this.name = 'DataError';\n    }\n}\n\nexport class ValidationError extends AppError {\n    constructor(message: string, context?: any) {\n        super(message, context);\n        this.name = 'ValidationError';\n    }\n}\n\nexport class StorageError extends AppError {\n    constructor(message: string, context?: any) {\n        super(message, context);\n        this.name = 'StorageError';\n    }\n}\n\n/**\n * Error handler utility for consistent error handling\n */\nexport class ErrorHandler {\n    /**\n     * Handle an error by logging it and emitting an error event\n     * @param error The error to handle\n     * @param context Additional context about the error\n     * @param eventBus Optional event bus for emitting error events\n     */\n    static handleError(error: unknown, context?: string, eventBus?: { emit: (type: string, data: any) => Promise<void> }): void {\n        const err = error instanceof Error ? error : new Error(String(error));\n        // Log the error\n        console.error(`[${err.name}] ${context || 'Error'}:`, err.message, err.stack);\n\n        // Emit error event if event bus is available\n        if (eventBus) {\n            eventBus.emit('error', {\n                error: err,\n                context,\n                timestamp: new Date()\n            }).catch(emitError => {\n                console.error('Failed to emit error event:', emitError);\n            });\n        }\n    }\n}\n","/**\n * Event Bus for application-wide event communication\n *\n * This provides a decoupled way for services to communicate without direct dependencies,\n * breaking circular dependencies and enabling better testability.\n */\n\nimport { Debug } from '../utils';\n\nexport type EventCallback<T = any> = (data: T) => void | Promise<void>;\n\nexport class EventBus {\n    private listeners: Map<string, Set<EventCallback>> = new Map();\n\n    /**\n     * Subscribe to an event type\n     * @param eventType The event type to subscribe to\n     * @param callback The callback to invoke when the event is emitted\n     */\n    subscribe<T = any>(eventType: string, callback: EventCallback<T>): () => void {\n        if (!this.listeners.has(eventType)) {\n            this.listeners.set(eventType, new Set());\n        }\n\n        const listeners = this.listeners.get(eventType)!;\n        listeners.add(callback);\n\n        // Return unsubscribe function\n        return () => {\n            listeners.delete(callback);\n            if (listeners.size === 0) {\n                this.listeners.delete(eventType);\n            }\n        };\n    }\n\n    /**\n     * Emit an event to all subscribers\n     * @param eventType The event type to emit\n     * @param data The data to pass to subscribers\n     */\n    async emit<T = any>(eventType: string, data: T): Promise<void> {\n        const listeners = this.listeners.get(eventType);\n        if (listeners) {\n            // Create a copy to avoid issues if listeners are modified during iteration\n            const listenersCopy = Array.from(listeners);\n            for (const listener of listenersCopy) {\n                try {\n                    await listener(data);\n                } catch (error) {\n                    console.error(`Error in event listener for ${eventType}:`, error);\n                }\n            }\n        }\n    }\n\n    /**\n     * Clear all listeners for a specific event type or all events\n     * @param eventType Optional event type to clear. If not provided, clears all listeners.\n     */\n    clear(eventType?: string): void {\n        if (eventType) {\n            Debug.log('EventBus', 'Clearing listeners for event type', { eventType });\n            this.listeners.delete(eventType);\n        } else {\n            Debug.log('EventBus', 'Clearing all event listeners');\n            this.listeners.clear();\n        }\n    }\n}\n\n// Define event types\nexport const EventTypes = {\n    XP_EARNED: 'xp_earned',\n    LEVEL_UP: 'level_up',\n    PRACTICE_RESULT: 'practice_result',\n    LESSON_COMPLETED: 'lesson_completed',\n    QUIZ_COMPLETED: 'quiz_completed',\n    STATE_CHANGED: 'state_changed',\n    ERROR: 'error'\n} as const;\n\n// Define event data types\nexport interface XPEvent {\n    amount: number;\n    reason: string;\n    timestamp: Date;\n}\n\nexport interface LevelUpEvent {\n    oldLevel: number;\n    newLevel: number;\n    totalXP: number;\n    timestamp: Date;\n}\n\nexport interface PracticeResultEvent {\n    itemId: string;\n    correct: boolean;\n    responseTime?: number;\n    timestamp: Date;\n}\n\nexport interface LessonCompletedEvent {\n    lessonId: string;\n    completionPercentage: number;\n    timestamp: Date;\n}\n\nexport interface QuizCompletedEvent {\n    quizId: string;\n    score: number;\n    totalQuestions: number;\n    correctAnswers: number;\n    timeTaken: number;\n    timestamp: Date;\n}\n\nexport interface ErrorEvent {\n    error: Error;\n    context?: string;\n    timestamp: Date;\n}","/**\n * Unified Vocabulary Schema - Comprehensive schema for German-Bulgarian vocabulary\n * with support for all legacy data formats and enhanced metadata\n */\n\nimport { z } from 'zod';\n\n// ======================\n// Enumerated Types\n// ======================\n\n/**\n * Parts of speech for vocabulary items\n */\nexport const PartOfSpeechSchema = z.enum([\n  'noun',        // Noun (e.g., \"Haus\", \"\")\n  'verb',        // Verb (e.g., \"gehen\", \"\")\n  'adjective',   // Adjective (e.g., \"gro\", \"\")\n  'adverb',      // Adverb (e.g., \"schnell\", \"\")\n  'pronoun',     // Pronoun (e.g., \"ich\", \"\")\n  'preposition', // Preposition (e.g., \"in\", \"\")\n  'conjunction', // Conjunction (e.g., \"und\", \"\")\n  'interjection', // Interjection (e.g., \"ah\", \"\")\n  'article',     // Article (e.g., \"der\", \"the\")\n  'number',      // Number (e.g., \"eins\", \"\")\n  'phrase',      // Common phrase (e.g., \"Wie geht's?\", \" ?\")\n  'expression'   // Idiomatic expression\n]);\n\nexport type PartOfSpeech = z.infer<typeof PartOfSpeechSchema>;\n\n/**\n * Standardized vocabulary categories\n */\nexport const VocabularyCategorySchema = z.enum([\n  'greetings',\n  'numbers',\n  'family',\n  'food',\n  'colors',\n  'animals',\n  'body-parts',\n  'clothing',\n  'home',\n  'nature',\n  'transport',\n  'technology',\n  'time',\n  'weather',\n  'professions',\n  'places',\n  'grammar',\n  'culture',\n  'everyday-phrases'\n]);\n\nexport type VocabularyCategory = z.infer<typeof VocabularyCategorySchema>;\n\n/**\n * CEFR language levels\n */\nexport const LanguageLevelSchema = z.enum([\n  'A1',  // Beginner\n  'A2',  // Elementary\n  'B1',  // Intermediate\n  'B2',  // Upper Intermediate\n  'C1'   // Advanced\n]);\n\nexport type LanguageLevel = z.infer<typeof LanguageLevelSchema>;\n\n/**\n * Verb aspects\n */\nexport const VerbAspectSchema = z.union([\n  z.literal('perfective'),    // Completed action\n  z.literal('imperfective'),  // Ongoing or habitual action\n  z.literal(null)             // Not applicable\n]);\n\nexport type VerbAspect = z.infer<typeof VerbAspectSchema>;\n\n/**\n * Noun genders\n */\nexport const NounGenderSchema = z.enum([\n  'masculine',\n  'feminine',\n  'neuter'\n]);\n\nexport type NounGender = z.infer<typeof NounGenderSchema>;\n\n// ======================\n// Complex Types\n// ======================\n\n/**\n * Transliteration schema for pronunciation guides\n */\nexport const TransliterationSchema = z.object({\n  german: z.string().optional().describe('Latin transcription for German pronunciation'),\n  bulgarian: z.string().optional().describe('Latin transcription for Bulgarian pronunciation')\n});\n\n/**\n * Audio resources schema\n */\nexport const AudioSchema = z.object({\n  german: z.string().url().optional().describe('URL for German pronunciation audio'),\n  bulgarian: z.string().url().optional().describe('URL for Bulgarian pronunciation audio')\n});\n\n/**\n * Grammar details schema\n */\nexport const GrammarSchema = z.object({\n  gender: NounGenderSchema.optional().describe('Noun gender (masculine, feminine, neuter)'),\n  pluralForm: z.string().optional().describe('Plural form of the word'),\n  verbAspect: VerbAspectSchema.optional().describe('Verb aspect (perfective/imperfective)'),\n  verbPartnerId: z.string().optional().describe('ID of the aspectual partner verb'),\n  conjugation: z.record(z.string(), z.union([\n    z.string(),\n    z.record(z.string(), z.string())\n  ])).optional().describe('Verb conjugations by person/tense'),\n  declension: z.record(z.string(), z.object({\n    singular: z.string().optional(),\n    plural: z.string().optional()\n  })).optional().describe('Noun declension by case')\n});\n\n/**\n * Enrichment metadata from external dictionary sources (e.g., Langenscheidt)\n */\nexport const EnrichmentSchema = z.object({\n  enriched: z.boolean().optional().describe('Indicates item has been enriched'),\n  confidence: z.number().min(0).max(1).optional().describe('Confidence score for enrichment match'),\n  sourceURL: z.string().url().optional().describe('Primary dictionary URL for the enrichment'),\n  enrichedAt: z.string().datetime().optional().describe('ISO timestamp of enrichment run'),\n  source: z.string().optional().describe('Source label for enrichment run')\n}).partial();\n\n/**\n * External dictionary definition links (deduplicated by URL)\n */\nexport const DefinitionLinkSchema = z.object({\n  source: z.string().optional().describe('Dictionary source identifier (e.g., langenscheidt, duden)'),\n  url: z.string().url().describe('Absolute URL to external definition'),\n  confidence: z.number().min(0).max(1).optional().describe('Confidence score for this link'),\n  language: z.string().optional().describe('Language pair or locale for the definition')\n});\n\n/**\n * Example schema\n */\nexport const ExampleSchema = z.object({\n  german: z.string().describe('German example sentence'),\n  bulgarian: z.string().describe('Bulgarian example sentence'),\n  context: z.string().optional().describe('Context description for the example'),\n  source: z.enum(['current', 'legacy', 'merged', 'generated']).default('merged').describe('Source of the example')\n});\n\n/**\n * Notes schema with direction-specific content\n */\nexport const NotesSchema = z.object({\n  general: z.string().optional().describe('General notes about the word/phrase'),\n  forBulgarianSpeakers: z.string().optional().describe('Notes for Bulgarian speakers learning German'),\n  forGermanSpeakers: z.string().optional().describe('Notes for German speakers learning Bulgarian'),\n  linguistic: z.string().optional().describe('Linguistic observations'),\n  linguisticForBulgarians: z.string().optional().describe('Linguistic notes for Bulgarian speakers'),\n  linguisticForGermans: z.string().optional().describe('Linguistic notes for German speakers'),\n  source: z.enum(['current', 'legacy', 'merged', 'generated']).default('merged').describe('Source of the notes')\n});\n\n/**\n * Metadata schema for additional information\n */\nexport const VocabularyMetadataSchema = z.object({\n  frequency: z.number().min(1).max(100).optional().describe('Frequency rating (1-100)'),\n  level: LanguageLevelSchema.optional().describe('CEFR language level (A1, A2, B1, B2, C1)'),\n  isCommon: z.boolean().default(false).describe('Whether the word is common'),\n  isVerified: z.boolean().default(false).describe('Whether the item has been verified'),\n  learningPhase: z.number().min(0).max(6).optional().describe('SRS learning phase (0-6)'),\n  xpValue: z.number().min(1).max(100).optional().describe('Experience points value'),\n  components: z.array(z.object({\n    part: z.string(),\n    meaning: z.string()\n  })).optional().describe('Word components for compound words'),\n  notes: z.string().optional().describe('General notes about the item'),\n  mnemonic: z.string().optional().describe('Memory aid or mnemonic device'),\n  etymology: z.string().optional().describe('Word origin and etymology'),\n  culturalNote: z.string().optional().describe('Cultural context or usage notes'),\n  sourceFiles: z.array(z.string()).optional().describe('Source files where this item appeared'),\n  mergeSources: z.array(z.string()).optional().describe('IDs of items merged into this one'),\n  createdBy: z.string().optional().describe('Creator of the item'),\n  lastUpdatedBy: z.string().optional().describe('Last person to update the item'),\n  declension: z.record(\n    z.string(), // case name (e.g., 'Nominative', 'Accusative')\n    z.object({\n      singular: z.string().optional(),\n      plural: z.string().optional()\n    })\n  ).optional().describe('Declension table for nouns: case -> {singular, plural}'),\n  links: z.array(z.object({\n    label: z.string().describe('Link label (e.g., \"DWDS\", \"Duden\")'),\n    url: z.string().url().describe('Absolute URL to external dictionary')\n  })).optional().describe('External dictionary links')\n});\n\n// ======================\n// Main Schema\n// ======================\n\n/**\n * Unified Vocabulary Item Schema\n */\nexport const UnifiedVocabularyItemSchema = z.object({\n  id: z.string().describe('Unique identifier for the vocabulary item'),\n  german: z.string().min(1).max(200).describe('German word or phrase'),\n  bulgarian: z.string().min(1).max(200).describe('Bulgarian word or phrase'),\n  partOfSpeech: PartOfSpeechSchema.describe('Part of speech classification'),\n  difficulty: z.number().min(1).max(5).describe('Difficulty level (1-5, 1=easiest)'),\n  cefrLevel: LanguageLevelSchema.optional().describe('CEFR proficiency level (A1/A2/B1/B2/C1)'),\n  categories: z.array(VocabularyCategorySchema).min(1).describe('Categories the item belongs to'),\n  transliteration: TransliterationSchema.optional().describe('Pronunciation guides in Latin script'),\n  emoji: z.string().emoji().optional().describe('Emoji representation of the word'),\n  literalBreakdown: z.array(z.object({\n    segment: z.string(),\n    literal: z.string(),\n    grammarTag: z.string()\n  })).optional().describe('Breakdown of compound words/grammar for learning'),\n  audio: AudioSchema.optional().describe('Audio resources for pronunciation'),\n  audioUrl: z.string().url().optional().describe('Direct URL to audio file (Forvo/MP3)'),\n  grammar: GrammarSchema.optional().describe('Grammar details and properties'),\n  examples: z.array(ExampleSchema).default([]).describe('Usage examples'),\n  notes: NotesSchema.optional().describe('Comprehensive notes about the item'),\n  etymology: z.string().optional().describe('Word origin and etymology'),\n  culturalNotes: z.string().optional().describe('Cultural context notes'),\n  mnemonic: z.object({\n    text: z.string().describe(\"Mnemonic or Esels-Brcke\"),\n    author: z.string().optional(),\n    upvotes: z.number().int().default(0),\n    confidence: z.number().min(0).max(1).optional(),\n    createdAt: z.string().datetime().optional()\n  }).optional().describe('Memory aid'),\n  mnemonics: z.array(z.string()).optional().describe('Legacy: Memory aids and techniques'),\n  synonyms: z.array(z.string()).optional().describe('Synonyms for this word/phrase'),\n  antonyms: z.array(z.string()).optional().describe('Antonyms for this word/phrase'),\n  relatedWords: z.array(z.string()).optional().describe('Related words or phrases'),\n  type: z.enum(['word', 'rule', 'phrase']).optional().default('word').describe('Type of vocabulary entry'),\n  tags: z.array(z.string()).optional().describe('Custom tags for filtering and organization'),\n  level: LanguageLevelSchema.optional().describe('CEFR language level (direct accessor, mirrors cefrLevel)'),\n  xp_value: z.number().min(1).max(100).optional().describe('Experience points value (direct accessor, mirrors metadata.xpValue)'),\n  global_stats: z.object({\n    correct_count: z.number().min(0).default(0),\n    incorrect_count: z.number().min(0).default(0),\n    success_rate: z.number().min(0).max(100).default(0)\n  }).optional().describe('Global practice statistics for this item'),\n  metadata: VocabularyMetadataSchema.optional().describe('Additional metadata'),\n  enrichment: EnrichmentSchema.optional().describe('External enrichment metadata'),\n  definitions: z.array(DefinitionLinkSchema).optional().describe('Links to external dictionary definitions'),\n  createdAt: z.union([\n    z.date(),\n    z.string().datetime().transform(str => new Date(str))\n  ]).describe('Creation timestamp'),\n  updatedAt: z.union([\n    z.date(),\n    z.string().datetime().transform(str => new Date(str))\n  ]).describe('Last update timestamp'),\n  version: z.number().default(1).describe('Schema version number')\n});\n\n/**\n * Unified Vocabulary Collection Schema\n */\nexport const UnifiedVocabularyCollectionSchema = z.object({\n  id: z.string().uuid().describe('Unique identifier for the collection'),\n  name: z.string().min(3).max(100).describe('Name of the vocabulary collection'),\n  description: z.string().min(10).max(1000).describe('Description of the collection'),\n  languagePair: z.enum(['de-bg', 'bg-de']).describe('Language direction'),\n  difficultyRange: z.tuple([z.number().min(1), z.number().max(5)]).describe('Min and max difficulty levels'),\n  categories: z.array(VocabularyCategorySchema).describe('All categories in the collection'),\n  itemCount: z.number().min(0).describe('Total number of items in the collection'),\n  createdAt: z.union([\n    z.date(),\n    z.string().datetime().transform(str => new Date(str))\n  ]).describe('Creation timestamp'),\n  updatedAt: z.union([\n    z.date(),\n    z.string().datetime().transform(str => new Date(str))\n  ]).describe('Last update timestamp'),\n  version: z.number().default(1).describe('Schema version number'),\n  items: z.array(UnifiedVocabularyItemSchema).describe('Array of vocabulary items'),\n  statistics: z.object({\n    byPartOfSpeech: z.record(z.string(), z.number()).optional().describe('Count by part of speech'),\n    byDifficulty: z.record(z.string(), z.number()).optional().describe('Count by difficulty level'),\n    byCategory: z.record(z.string(), z.number()).optional().describe('Count by category'),\n    byLevel: z.record(z.string(), z.number()).optional().describe('Count by CEFR level')\n  }).optional().describe('Collection statistics')\n});\n\n// ======================\n// Utility Functions\n// ======================\n\n/**\n * Create a fallback unified vocabulary item when validation fails\n */\nexport const _createFallbackUnifiedItem = (input: unknown): z.infer<typeof UnifiedVocabularyItemSchema> => {\n  const now = new Date();\n\n  return {\n    id: `fallback-${crypto.randomUUID()}`,\n    german: typeof input === 'object' && input && 'german' in input && typeof input.german === 'string'\n      ? input.german\n      : 'unknown',\n    bulgarian: typeof input === 'object' && input && 'bulgarian' in input && typeof input.bulgarian === 'string'\n      ? input.bulgarian\n      : 'unknown',\n    partOfSpeech: 'noun',\n    difficulty: 1,\n    categories: ['greetings'],\n    examples: [],\n    type: 'word',\n    tags: [],\n    createdAt: now,\n    updatedAt: now,\n    version: 1\n  };\n};\n\n/**\n * Resilient schema with fallback for failed validations\n */\nexport const ResilientUnifiedVocabularyItemSchema = UnifiedVocabularyItemSchema.catch((ctx) => {\n  // Validation failed for unified vocabulary item\n  return _createFallbackUnifiedItem(ctx.input);\n});\n\n/**\n * Resilient collection schema with fallback items\n */\nexport const ResilientUnifiedVocabularyCollectionSchema = UnifiedVocabularyCollectionSchema.extend({\n  items: z.array(ResilientUnifiedVocabularyItemSchema)\n});\n\n/**\n * Simplified collection schema that matches the actual JSON file structure\n * Used for loading from static/data/unified-vocabulary.linguistic-corrected.json\n */\nexport const SimplifiedVocabularyCollectionSchema = z.object({\n  version: z.union([\n    z.string().transform(v => parseInt(v, 10)),\n    z.number()\n  ]).describe('Schema version (string or number)'),\n  lastUpdated: z.union([\n    z.string().datetime().transform(str => new Date(str)),\n    z.date()\n  ]).describe('Last update timestamp'),\n  totalItems: z.number().min(0).describe('Total number of items'),\n  language: z.string().describe('Language pair description'),\n  direction: z.enum(['DE_BG', 'BG_DE']).describe('Learning direction'),\n  items: z.array(ResilientUnifiedVocabularyItemSchema).describe('Array of vocabulary items')\n});\n\n// ======================\n// Type Exports\n// ======================\n\nexport type UnifiedVocabularyItem = z.infer<typeof UnifiedVocabularyItemSchema>;\nexport type UnifiedVocabularyCollection = z.infer<typeof UnifiedVocabularyCollectionSchema>;\nexport type Transliteration = z.infer<typeof TransliterationSchema>;\nexport type Audio = z.infer<typeof AudioSchema>;\nexport type Grammar = z.infer<typeof GrammarSchema>;\nexport type Example = z.infer<typeof ExampleSchema>;\nexport type Notes = z.infer<typeof NotesSchema>;\nexport type VocabularyMetadata = z.infer<typeof VocabularyMetadataSchema>;\n\n// ======================\n// Helper Functions\n// ======================\n\n/**\n * Get difficulty label from numeric value\n */\nexport function getDifficultyLabel(difficulty: number): string {\n  const labels = {\n    1: 'Beginner (A1)',\n    2: 'Elementary (A2)',\n    3: 'Intermediate (B1)',\n    4: 'Upper Intermediate (B2)',\n    5: 'Advanced (C1/C2)'\n  };\n  return labels[difficulty as keyof typeof labels] || 'Unknown';\n}\n\n/**\n * Get part of speech label\n */\nexport function _getPartOfSpeechLabel(partOfSpeech: PartOfSpeech): string {\n  const labels: Record<PartOfSpeech, string> = {\n    noun: 'Noun',\n    verb: 'Verb',\n    adjective: 'Adjective',\n    adverb: 'Adverb',\n    pronoun: 'Pronoun',\n    preposition: 'Preposition',\n    conjunction: 'Conjunction',\n    interjection: 'Interjection',\n    article: 'Article',\n    number: 'Number',\n    phrase: 'Phrase',\n    expression: 'Expression'\n  };\n  return labels[partOfSpeech];\n}\n\n/**\n * Get category label\n */\nexport function _getCategoryLabel(category: VocabularyCategory): string {\n  const labels: Record<VocabularyCategory, string> = {\n    greetings: 'Greetings',\n    numbers: 'Numbers',\n    family: 'Family',\n    food: 'Food',\n    colors: 'Colors',\n    animals: 'Animals',\n    'body-parts': 'Body Parts',\n    clothing: 'Clothing',\n    home: 'Home',\n    nature: 'Nature',\n    transport: 'Transport',\n    technology: 'Technology',\n    time: 'Time',\n    weather: 'Weather',\n    professions: 'Professions',\n    places: 'Places',\n    grammar: 'Grammar',\n    culture: 'Culture',\n    'everyday-phrases': 'Everyday Phrases'\n  };\n  return labels[category];\n}\n\n/**\n * Convert legacy difficulty to unified scale\n */\nexport function convertLegacyDifficulty(legacyDifficulty: number | string): number {\n  if (typeof legacyDifficulty === 'number') {\n    // Legacy 1-5 scale (1=easiest)\n    return Math.min(Math.max(legacyDifficulty, 1), 5);\n  }\n\n  // Legacy string scale (A1, A2, etc.)\n  const levelMap: Record<string, number> = {\n    'A1': 1,\n    'A2': 2,\n    'B1': 3,\n    'B2': 4,\n    'C1': 5\n  };\n\n  return levelMap[legacyDifficulty.toUpperCase()] || 1;\n}\n\n/**\n * Convert legacy category to standardized category\n */\nexport function convertLegacyCategory(legacyCategory: string): VocabularyCategory {\n  const categoryMap: Record<string, VocabularyCategory> = {\n    // English categories\n    'Food': 'food',\n    'Household': 'home',\n    'Verbs': 'grammar',\n    'Adjectives': 'grammar',\n    'Greetings': 'greetings',\n    'Body': 'body-parts',\n\n    // German categories\n    'Zahlen': 'numbers',\n    'Familie': 'family',\n    'Farben': 'colors',\n    'Begrung': 'greetings',\n    'Ausdruck': 'everyday-phrases',\n    'Lebensmittel': 'food',\n    'Transport': 'transport',\n    'Gesundheit': 'body-parts',\n    'Natur': 'nature',\n    'Einkauf': 'places',\n    'Tag': 'time',\n    'Zeit': 'time',\n\n    // Bulgarian categories\n    '': 'food',\n    '': 'home',\n    '': 'grammar',\n    '': 'grammar',\n    '': 'greetings'\n  };\n\n  return categoryMap[legacyCategory] || 'greetings';\n}\n\n/**\n * Type guards for different example formats\n */\nfunction isLegacyExampleFormat1(example: object): example is { sentence: unknown, translation: unknown, context?: unknown } {\n  return 'sentence' in example && 'translation' in example;\n}\n\nfunction isLegacyExampleFormat2(example: object): example is { bg: unknown, de: unknown, context?: unknown } {\n  return 'bg' in example && 'de' in example;\n}\n\nfunction isCurrentExampleFormat(example: object): example is { german: unknown, bulgarian: unknown, context?: unknown } {\n  return 'german' in example && 'bulgarian' in example;\n}\n\n/**\n * Normalize example format from legacy to unified\n */\nexport function normalizeExample(example: unknown): Example {\n  if (typeof example === 'object' && example) {\n    // Legacy format 1: { sentence: string, translation: string, context?: string }\n    if (isLegacyExampleFormat1(example)) {\n      return {\n        german: typeof example.translation === 'string' ? example.translation : 'Beispiel',\n        bulgarian: typeof example.sentence === 'string' ? example.sentence : '',\n        context: typeof example.context === 'string' ? example.context : undefined,\n        source: 'legacy'\n      };\n    }\n    // Legacy format 2: { bg: string, de: string, context?: string }\n    else if (isLegacyExampleFormat2(example)) {\n      return {\n        german: typeof example.de === 'string' ? example.de : 'Beispiel',\n        bulgarian: typeof example.bg === 'string' ? example.bg : '',\n        context: typeof example.context === 'string' ? example.context : undefined,\n        source: 'legacy'\n      };\n    }\n    // Current format: { german: string, bulgarian: string, context?: string }\n    else if (isCurrentExampleFormat(example)) {\n      return {\n        german: typeof example.german === 'string' ? example.german : 'Beispiel',\n        bulgarian: typeof example.bulgarian === 'string' ? example.bulgarian : '',\n        context: typeof example.context === 'string' ? example.context : undefined,\n        source: 'current'\n      };\n    }\n  }\n\n  // Fallback for invalid examples\n  return {\n    german: 'Beispiel',\n    bulgarian: '',\n    source: 'generated'\n  };\n}\n\n/**\n * Merge multiple examples arrays\n */\nexport function mergeExamples(exampleArrays: Example[][]): Example[] {\n  const merged = exampleArrays.flat();\n\n  // Deduplicate examples\n  const uniqueExamples = new Map<string, Example>();\n  merged.forEach(example => {\n    const key = `${example.german}|${example.bulgarian}|${example.context || ''}`;\n    if (!uniqueExamples.has(key)) {\n      uniqueExamples.set(key, example);\n    }\n  });\n\n  return Array.from(uniqueExamples.values());\n}\n\n/**\n * Create a merged ID from multiple source IDs\n */\nexport function createMergedId(ids: string[]): string {\n  if (ids.length === 0) return `fallback-${crypto.randomUUID()}`;\n  if (ids.length === 1) return ids[0] ?? `fallback-${crypto.randomUUID()}`;\n\n  // For multiple IDs, create a composite ID\n  return `merged-${ids.join('-')}`;\n}\n","/**\n * Vocabulary Data Loader\n *\n * Handles loading, caching, and validation of vocabulary data\n * Supports both server-side and client-side loading patterns\n */\n\nimport { base } from '$app/paths';\nimport { Debug } from '../utils';\nimport { DataError, ErrorHandler } from '../services/errors';\nimport { EventBus } from '../services/event-bus';\n\n// DataLoader is unused\n\nimport { UnifiedVocabularyItemSchema, UnifiedVocabularyCollectionSchema, ResilientUnifiedVocabularyCollectionSchema, SimplifiedVocabularyCollectionSchema, VocabularyCategorySchema } from '../schemas/unified-vocabulary';\nimport { z } from 'zod';\n\n/**\n * Vocabulary search parameters\n */\nexport interface VocabularySearchParams {\n  query?: string;\n  partOfSpeech?: string;\n  difficulty?: number;\n  categories?: string[];\n  limit?: number;\n  offset?: number;\n}\n\n/**\n * Update practice statistics for a vocabulary item\n * @param itemId The ID of the vocabulary item\n * @param correct Whether the answer was correct\n * @param responseTime Response time in seconds (optional)\n * @param eventBus Optional event bus for error handling\n */\nexport async function updateStats(itemId: string, correct: boolean, responseTime?: number, eventBus?: EventBus): Promise<void> {\n  try {\n    Debug.log('loader', 'Updating stats for vocabulary item', { itemId, correct, responseTime });\n\n    // In a real implementation, this would update server-side statistics\n    // For now, we'll just log it and update the local cache if available\n\n    // Check if we have the item in memory (client-side only)\n    if (typeof window !== 'undefined') {\n      const collection = await loadVocabulary();\n      const itemIndex = collection.items.findIndex(item => item.id === itemId);\n\n      if (itemIndex !== -1) {\n        // Update the cache with the modified item\n        cacheVocabulary(collection);\n        Debug.log('loader', 'Updated stats for vocabulary item in cache', { itemId });\n      }\n    }\n\n  } catch (error: unknown) {\n    const typedError = error instanceof Error ? error : new Error(String(error));\n    ErrorHandler.handleError(typedError, 'Failed to update vocabulary item statistics', eventBus);\n    throw new DataError('Failed to update vocabulary item statistics', { itemId, error: typedError });\n  }\n}\n\n// Cache configuration\nconst CACHE_KEY = 'vocabulary-cache';\nconst CACHE_EXPIRY_HOURS = 24;\n\n/**\n * Load vocabulary data from various sources with fallback mechanism\n * @param eventBus Optional event bus for error handling\n * @throws DataError if all loading methods fail\n */\nexport async function loadVocabulary(eventBus?: EventBus): Promise<z.infer<typeof UnifiedVocabularyCollectionSchema>> {\n  try {\n    // Try to load from static endpoint first (fastest)\n    return await loadFromStaticEndpoint(eventBus);\n  } catch (error: unknown) {\n    const typedError = error instanceof Error ? error : new Error(String(error));\n    ErrorHandler.handleError(typedError, 'Failed to load vocabulary from static endpoint', eventBus);\n    // Failed to load from static endpoint, trying cache\n    try {\n      // Fallback to cache\n      return await loadFromCache(eventBus);\n    } catch (cacheError: unknown) {\n      const typedCacheError = cacheError instanceof Error ? cacheError : new Error(String(cacheError));\n      ErrorHandler.handleError(typedCacheError, 'Failed to load vocabulary from cache', eventBus);\n      // Failed to load from cache, trying bundled data\n      try {\n        // Final fallback to bundled data\n        return await loadBundledData(eventBus);\n      } catch (bundledError: unknown) {\n        const typedBundledError = bundledError instanceof Error ? bundledError : new Error(String(bundledError));\n        ErrorHandler.handleError(typedBundledError, 'Failed to load vocabulary from bundled data', eventBus);\n        // All loading methods failed\n        throw new DataError('Failed to load vocabulary data from all sources', {\n          error: error as Error,\n          cacheError: cacheError as Error,\n          bundledError: bundledError as Error\n        });\n      }\n    }\n  }\n}\n\n/**\n * Load vocabulary from static endpoint\n * @param eventBus Optional event bus for error handling\n * @throws DataError if loading fails\n */\nasync function loadFromStaticEndpoint(eventBus?: EventBus): Promise<z.infer<typeof UnifiedVocabularyCollectionSchema>> {\n  try {\n    // In Node.js environment (tests, scripts), load directly from the source file\n    // In browser environment, fetch from static endpoint\n    if (typeof process !== 'undefined' && process.versions && process.versions.node) {\n      // Node.js environment - read file directly\n      // @vite-ignore\n      const fs = await import('fs/promises');\n      // @vite-ignore\n      const path = await import('path');\n      // @vite-ignore\n      const { fileURLToPath } = await import('url');\n      // @vite-ignore\n      const { dirname } = await import('path');\n\n      const __filename = fileURLToPath(import.meta.url);\n      const __dirname = dirname(__filename);\n      const filePath = path.join(__dirname, 'unified-vocabulary.json');\n\n      const data = await fs.readFile(filePath, 'utf-8');\n      const jsonData = JSON.parse(data);\n      \n      // Parse with simplified schema that matches actual JSON structure\n      const parsed = SimplifiedVocabularyCollectionSchema.parse(jsonData);\n      \n      // Transform to expected UnifiedVocabularyCollectionSchema format\n      return {\n        id: crypto.randomUUID(),\n        name: `${parsed.language} Vocabulary`,\n        description: `Vocabulary collection with ${parsed.totalItems} items`,\n        languagePair: parsed.direction === 'DE_BG' ? 'de-bg' : 'bg-de',\n        difficultyRange: [1, 5] as [number, number],\n        categories: [...new Set(parsed.items.flatMap(item => item.categories))],\n        itemCount: parsed.totalItems,\n        createdAt: parsed.lastUpdated,\n        updatedAt: parsed.lastUpdated,\n        version: parsed.version,\n        items: parsed.items\n      } as z.infer<typeof UnifiedVocabularyCollectionSchema>;\n    } else {\n      // Browser environment - fetch from static endpoint\n      // Use the linguistically-corrected version for best quality\n      const response = await fetch(`${base}/data/unified-vocabulary.linguistic-corrected.json`);\n\n      if (!response.ok) {\n        throw new DataError(`HTTP error! status: ${response.status}`, { status: response.status });\n      }\n\n      const data = await response.json();\n      \n      // Handle both array and object formats\n      let items: any[] = [];\n      if (Array.isArray(data)) {\n        // Raw array of vocabulary items\n        items = data;\n      } else if (data.items && Array.isArray(data.items)) {\n        // Object with items property\n        items = data.items;\n      } else {\n        throw new DataError('Invalid vocabulary data format: expected array or object with items property');\n      }\n\n      // Filter and transform items without strict validation to avoid schema errors\n      const validatedItems = items\n        .filter(item => item && typeof item === 'object' && item.german && item.bulgarian)\n        .map(item => ({\n          id: item.id || `wv_${Math.random().toString(36).substr(2, 9)}`,\n          german: String(item.german || ''),\n          bulgarian: String(item.bulgarian || ''),\n          partOfSpeech: item.partOfSpeech || 'noun',\n          difficulty: Math.min(5, Math.max(1, parseInt(item.difficulty) || 1)),\n          categories: Array.isArray(item.categories) ? item.categories : item.categories ? [item.categories] : [],\n          examples: Array.isArray(item.examples) ? item.examples : item.examples ? [item.examples] : [],\n          createdAt: item.createdAt ? new Date(item.createdAt) : new Date(),\n          updatedAt: item.updatedAt ? new Date(item.updatedAt) : new Date(),\n          version: item.version || 1\n        }));\n      \n      // Return in expected UnifiedVocabularyCollectionSchema format\n      return {\n        id: crypto.randomUUID(),\n        name: 'German-Bulgarian Vocabulary',\n        description: `Vocabulary collection with ${validatedItems.length} items`,\n        languagePair: 'de-bg',\n        difficultyRange: [1, 5] as [number, number],\n        categories: [...new Set(validatedItems.flatMap(item => item.categories || []))],\n        itemCount: validatedItems.length,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n        version: 1,\n        items: validatedItems as any\n      } as z.infer<typeof UnifiedVocabularyCollectionSchema>;\n    }\n  } catch (error: unknown) {\n    const typedError = error instanceof Error ? error : new Error(String(error));\n    ErrorHandler.handleError(typedError, 'Failed to load vocabulary from static endpoint', eventBus);\n    throw new DataError('Failed to load vocabulary from static endpoint', { error: typedError });\n  }\n}\n\n/**\n * Load vocabulary from localStorage cache\n * @param eventBus Optional event bus for error handling\n * @throws DataError if loading fails\n */\nasync function loadFromCache(eventBus?: EventBus): Promise<z.infer<typeof UnifiedVocabularyCollectionSchema>> {\n  try {\n    // In Node.js environment, skip cache\n    if (typeof process !== 'undefined' && process.versions && process.versions.node) {\n      throw new Error('Cache not available in Node.js environment');\n    }\n\n    if (typeof localStorage === 'undefined') {\n      throw new DataError('localStorage not available');\n    }\n\n    const cachedData = localStorage.getItem(CACHE_KEY);\n    if (!cachedData) {\n      throw new DataError('No cached vocabulary data found');\n    }\n\n    const { data, timestamp } = JSON.parse(cachedData);\n\n    // Check if cache is expired\n    const now = new Date();\n    const cacheDate = new Date(timestamp);\n    const hoursDiff = (now.getTime() - cacheDate.getTime()) / (1000 * 60 * 60);\n\n    if (hoursDiff > CACHE_EXPIRY_HOURS) {\n      throw new DataError('Cache expired', { hoursDiff, cacheExpiryHours: CACHE_EXPIRY_HOURS });\n    }\n\n    return ResilientUnifiedVocabularyCollectionSchema.parse(data);\n  } catch (error: unknown) {\n    const typedError = error instanceof Error ? error : new Error(String(error));\n    ErrorHandler.handleError(typedError, 'Failed to load vocabulary from cache', eventBus);\n    throw new DataError('Failed to load vocabulary from cache', { error: typedError });\n  }\n}\n\n/**\n * Load bundled vocabulary data (fallback)\n * Handles both browser and Node.js environments\n * @param eventBus Optional event bus for error handling\n * @throws DataError if loading fails\n */\nasync function loadBundledData(eventBus?: EventBus): Promise<z.infer<typeof UnifiedVocabularyCollectionSchema>> {\n  try {\n    // In Node.js environment, load directly from the source file\n    if (typeof process !== 'undefined' && process.versions && process.versions.node) {\n      // @vite-ignore\n      const fs = await import('fs/promises');\n      // @vite-ignore\n      const path = await import('path');\n      // @vite-ignore\n      const { fileURLToPath } = await import('url');\n      // @vite-ignore\n      const { dirname } = await import('path');\n\n      const __filename = fileURLToPath(import.meta.url);\n      const __dirname = dirname(__filename);\n      const filePath = path.join(__dirname, 'unified-vocabulary.json');\n\n      const data = await fs.readFile(filePath, 'utf-8');\n      const jsonData = JSON.parse(data);\n      return ResilientUnifiedVocabularyCollectionSchema.parse(jsonData);\n    }\n\n    // Browser environment - use fetch API\n    let jsonData: unknown = null;\n    try {\n      // Use the linguistically-corrected version for best quality\n      const response = await fetch(`${base}/data/unified-vocabulary.linguistic-corrected.json`);\n      if (!response.ok) {\n        throw new DataError(`HTTP error! status: ${response.status}`, { status: response.status });\n      }\n      jsonData = await response.json();\n    } catch (_fetchError) {\n      jsonData = null;\n    }\n\n    if (jsonData) {\n      try {\n        return ResilientUnifiedVocabularyCollectionSchema.parse(jsonData);\n      } catch (_parseError) {\n        // Continue to fallback collection below\n      }\n    }\n\n    // Final fallback to an empty but well-formed collection\n    const fallbackCollection = {\n      id: crypto.randomUUID(),\n      name: 'German-Bulgarian Vocabulary Collection (Fallback)',\n      description: 'Fallback vocabulary collection when bundled data is unavailable',\n      items: [],\n      languagePair: 'de-bg' as const,\n      difficultyRange: [1, 5] as [number, number],\n      categories: [],\n      itemCount: 0,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      version: 1\n    };\n\n    return ResilientUnifiedVocabularyCollectionSchema.parse(fallbackCollection);\n  } catch (error: unknown) {\n    const typedError = error instanceof Error ? error : new Error(String(error));\n    ErrorHandler.handleError(typedError, 'Failed to load bundled vocabulary data', eventBus);\n    throw new DataError('Failed to load bundled vocabulary data', { error: typedError });\n  }\n}\n\n/**\n * Cache vocabulary data in localStorage\n */\nexport function cacheVocabulary(data: z.infer<typeof UnifiedVocabularyCollectionSchema>): void {\n  if (typeof localStorage === 'undefined') {\n    return;\n  }\n\n  const cacheData = {\n    data,\n    timestamp: new Date().toISOString()\n  };\n\n  localStorage.setItem(CACHE_KEY, JSON.stringify(cacheData));\n}\n\n/**\n * Load vocabulary by search parameters\n * @param params Search parameters\n * @param eventBus Optional event bus for error handling\n */\nexport async function loadVocabularyBySearch(\n  params: VocabularySearchParams,\n  eventBus?: EventBus\n): Promise<{ items: z.infer<typeof UnifiedVocabularyItemSchema>[]; total: number; hasMore: boolean }> {\n  try {\n    const collection = await loadVocabulary(eventBus);\n    let items = [...collection.items];\n\n    // Apply filters\n    if (params.query) {\n      const query = params.query.toLowerCase();\n      items = items.filter(item =>\n        item.german.toLowerCase().includes(query) ||\n        item.bulgarian.toLowerCase().includes(query) ||\n        ((item.examples && item.examples.some((example: { german?: string; bulgarian?: string }) =>\n          (example.german && example.german.toLowerCase().includes(query)) ||\n          (example.bulgarian && example.bulgarian.toLowerCase().includes(query)))) ?? false)\n      );\n    }\n\n    if (params.partOfSpeech) {\n      items = items.filter(item => item.partOfSpeech === params.partOfSpeech);\n    }\n\n    if (params.difficulty) {\n      items = items.filter(item => item.difficulty === params.difficulty);\n    }\n\n    if (params.categories && params.categories.length > 0) {\n      items = items.filter(item =>\n        item.categories.some(category => params.categories?.includes(category))\n      );\n    }\n\n    // Get total count before pagination\n    const total = items.length;\n\n    // Apply pagination\n    const limit = params.limit || 20;\n    const offset = params.offset || 0;\n\n    items = items.slice(offset, offset + limit);\n\n    return {\n      items,\n      total,\n      hasMore: offset + limit < total\n    };\n  } catch (error: unknown) {\n    const typedError = error instanceof Error ? error : new Error(String(error));\n    ErrorHandler.handleError(typedError, 'Failed to search vocabulary', eventBus);\n    throw new DataError('Failed to search vocabulary', { params, error: typedError });\n  }\n}\n\n/**\n * Load vocabulary by ID\n * @param id The ID of the vocabulary item\n * @param eventBus Optional event bus for error handling\n * @throws DataError if loading fails\n */\nexport async function loadVocabularyById(id: string, eventBus?: EventBus): Promise<z.infer<typeof UnifiedVocabularyItemSchema> | null> {\n  try {\n    const collection = await loadVocabulary(eventBus);\n    return collection.items.find(item => item.id === id) || null;\n  } catch (error: unknown) {\n    const typedError = error instanceof Error ? error : new Error(String(error));\n    ErrorHandler.handleError(typedError, 'Failed to load vocabulary by ID', eventBus);\n    throw new DataError('Failed to load vocabulary by ID', { id, error: typedError });\n  }\n}\n\n/**\n * Load vocabulary by category\n * @param category The category to filter by\n * @param options Filtering options\n * @param eventBus Optional event bus for error handling\n * @throws DataError if loading fails\n */\nexport async function loadVocabularyByCategory(\n  category: z.infer<typeof VocabularyCategorySchema>,\n  options: { limit?: number; difficulty?: number } = {},\n  eventBus?: EventBus\n): Promise<z.infer<typeof UnifiedVocabularyItemSchema>[]> {\n  try {\n    const collection = await loadVocabulary(eventBus);\n\n    let items = collection.items.filter(item =>\n      item.categories.includes(category)\n    );\n\n    if (options.difficulty) {\n      items = items.filter(item => item.difficulty === options.difficulty);\n    }\n\n    if (options.limit) {\n      items = items.slice(0, options.limit);\n    }\n\n    return items;\n  } catch (error: unknown) {\n    const typedError = error instanceof Error ? error : new Error(String(error));\n    ErrorHandler.handleError(typedError, 'Failed to load vocabulary by category', eventBus);\n    throw new DataError('Failed to load vocabulary by category', { category, options, error: typedError });\n  }\n}\n\n/**\n * Load vocabulary by difficulty level\n * @param difficulty The difficulty level to filter by\n * @param options Filtering options\n * @param eventBus Optional event bus for error handling\n * @throws DataError if loading fails\n */\nexport async function loadVocabularyByDifficulty(\n  difficulty: number,\n  options: { limit?: number; category?: string } = {},\n  eventBus?: EventBus\n): Promise<z.infer<typeof UnifiedVocabularyItemSchema>[]> {\n  try {\n    const collection = await loadVocabulary(eventBus);\n\n    let items = collection.items.filter(item =>\n      item.difficulty === difficulty\n    );\n\n    if (options.category) {\n      const category = options.category as z.infer<typeof VocabularyCategorySchema>;\n      items = items.filter(item => item.categories.includes(category));\n    }\n\n    if (options.limit) {\n      items = items.slice(0, options.limit);\n    }\n\n    return items;\n  } catch (error: unknown) {\n    const typedError = error instanceof Error ? error : new Error(String(error));\n    ErrorHandler.handleError(typedError, 'Failed to load vocabulary by difficulty', eventBus);\n    throw new DataError('Failed to load vocabulary by difficulty', { difficulty, options, error: typedError });\n  }\n}\n\n/**\n * Get random vocabulary items\n * @param count Number of items to return\n * @param options Filtering options\n * @param eventBus Optional event bus for error handling\n * @throws DataError if loading fails\n */\nexport async function getRandomVocabulary(\n  count: number = 5,\n  options: { difficulty?: number; category?: string } = {},\n  eventBus?: EventBus\n): Promise<z.infer<typeof UnifiedVocabularyItemSchema>[]> {\n  try {\n    const collection = await loadVocabulary(eventBus);\n\n    let items = [...collection.items];\n\n    if (options.difficulty) {\n      items = items.filter((item: z.infer<typeof UnifiedVocabularyItemSchema>) => item.difficulty === options.difficulty);\n    }\n\n    if (options.category) {\n      const category = options.category as z.infer<typeof VocabularyCategorySchema>;\n      items = items.filter((item: z.infer<typeof UnifiedVocabularyItemSchema>) => item.categories.includes(category));\n    }\n\n    // Shuffle and select random items\n    const shuffled = items.sort(() => 0.5 - Math.random());\n    return shuffled.slice(0, Math.min(count, shuffled.length));\n  } catch (error: unknown) {\n    const typedError = error instanceof Error ? error : new Error(String(error));\n    ErrorHandler.handleError(typedError, 'Failed to get random vocabulary items', eventBus);\n    throw new DataError('Failed to get random vocabulary items', { count, options, error: typedError });\n  }\n}\n\n/**\n * Initialize vocabulary data (should be called during app startup)\n * @param eventBus Optional event bus for error handling\n * @throws DataError if initialization fails\n */\nexport async function initializeVocabulary(eventBus?: EventBus): Promise<void> {\n  try {\n    // Load and cache vocabulary data\n    const vocabulary = await loadVocabulary(eventBus);\n    cacheVocabulary(vocabulary);\n  } catch (error: unknown) {\n    const typedError = error instanceof Error ? error : new Error(String(error));\n    ErrorHandler.handleError(typedError, 'Failed to initialize vocabulary data', eventBus);\n    throw new DataError('Failed to initialize vocabulary data', { error: typedError });\n  }\n}","import { browser } from '$app/environment';\nimport { EventBus } from '$lib/services/event-bus';\nimport { ErrorHandler } from '$lib/services/errors';\nimport { Debug } from '$lib/utils';\nimport { loadVocabulary } from './loader';\nimport type { UnifiedVocabularyItem } from '$lib/schemas/unified-vocabulary';\n\n/**\n * VocabularyRepository\n * Single in-memory source of truth for vocabulary items.\n * SSR-safe: does not fetch/load on server, only on client.\n */\nclass VocabularyRepository {\n  /** In-memory items collection */\n  items = $state<UnifiedVocabularyItem[]>([]);\n  /** Loaded flag */\n  loaded = $state<boolean>(false);\n  eventBus: EventBus | undefined;\n\n  constructor(eventBus?: EventBus) {\n    this.eventBus = eventBus;\n  }\n\n  /** Load collection from built artifact (client-only) */\n  async load(): Promise<void> {\n    if (!browser) {\n      // SSR: skip loading to avoid fetch/file reads\n      return;\n    }\n    if (this.loaded && this.items.length > 0) return;\n    try {\n      Debug.log('VocabularyRepository', 'Loading vocabulary collection');\n      const collection = await loadVocabulary(this.eventBus);\n      this.items = collection.items;\n      this.loaded = true;\n      Debug.log('VocabularyRepository', 'Loaded items', { count: this.items.length });\n    } catch (error) {\n      ErrorHandler.handleError(error, 'VocabularyRepository.load');\n      this.items = [];\n      this.loaded = false;\n    }\n  }\n\n  /** Invalidate and clear current cache */\n  invalidate(): void {\n    this.items = [];\n    this.loaded = false;\n    Debug.log('VocabularyRepository', 'Cache invalidated');\n  }\n\n  /** Get all items */\n  getAll(): UnifiedVocabularyItem[] {\n    return this.items;\n  }\n\n  /** Get item by id */\n  getById(id: string): UnifiedVocabularyItem | undefined {\n    return this.items.find(i => i.id === id);\n  }\n\n  /** Basic search by query (german, bulgarian, tags) */\n  basicSearch(query: string): UnifiedVocabularyItem[] {\n    const q = (query || '').toLowerCase();\n    if (!q) return [];\n    return this.items.filter(item =>\n      item.german.toLowerCase().includes(q) ||\n      item.bulgarian.toLowerCase().includes(q) ||\n      (item.tags ?? []).some(tag => tag.toLowerCase().includes(q))\n    );\n  }\n}\n\n// Singleton repository\nexport const vocabularyRepository = new VocabularyRepository();\n","import validate from './validate.js';\nconst byteToHex = [];\nfor (let i = 0; i < 256; ++i) {\n    byteToHex.push((i + 0x100).toString(16).slice(1));\n}\nexport function unsafeStringify(arr, offset = 0) {\n    return (byteToHex[arr[offset + 0]] +\n        byteToHex[arr[offset + 1]] +\n        byteToHex[arr[offset + 2]] +\n        byteToHex[arr[offset + 3]] +\n        '-' +\n        byteToHex[arr[offset + 4]] +\n        byteToHex[arr[offset + 5]] +\n        '-' +\n        byteToHex[arr[offset + 6]] +\n        byteToHex[arr[offset + 7]] +\n        '-' +\n        byteToHex[arr[offset + 8]] +\n        byteToHex[arr[offset + 9]] +\n        '-' +\n        byteToHex[arr[offset + 10]] +\n        byteToHex[arr[offset + 11]] +\n        byteToHex[arr[offset + 12]] +\n        byteToHex[arr[offset + 13]] +\n        byteToHex[arr[offset + 14]] +\n        byteToHex[arr[offset + 15]]).toLowerCase();\n}\nfunction stringify(arr, offset = 0) {\n    const uuid = unsafeStringify(arr, offset);\n    if (!validate(uuid)) {\n        throw TypeError('Stringified UUID is invalid');\n    }\n    return uuid;\n}\nexport default stringify;\n","let getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n    if (!getRandomValues) {\n        if (typeof crypto === 'undefined' || !crypto.getRandomValues) {\n            throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n        }\n        getRandomValues = crypto.getRandomValues.bind(crypto);\n    }\n    return getRandomValues(rnds8);\n}\n","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default { randomUUID };\n","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\nfunction _v4(options, buf, offset) {\n    options = options || {};\n    const rnds = options.random ?? options.rng?.() ?? rng();\n    if (rnds.length < 16) {\n        throw new Error('Random bytes length must be >= 16');\n    }\n    rnds[6] = (rnds[6] & 0x0f) | 0x40;\n    rnds[8] = (rnds[8] & 0x3f) | 0x80;\n    if (buf) {\n        offset = offset || 0;\n        if (offset < 0 || offset + 16 > buf.length) {\n            throw new RangeError(`UUID byte range ${offset}:${offset + 15} is out of buffer bounds`);\n        }\n        for (let i = 0; i < 16; ++i) {\n            buf[offset + i] = rnds[i];\n        }\n        return buf;\n    }\n    return unsafeStringify(rnds);\n}\nfunction v4(options, buf, offset) {\n    if (native.randomUUID && !buf && !options) {\n        return native.randomUUID();\n    }\n    return _v4(options, buf, offset);\n}\nexport default v4;\n","/**\n * Practice Session Schema - Defines the structure and validation rules for practice sessions\n * Separated to avoid circular dependencies between vocabulary and localStorage schemas\n */\n\nimport { z } from 'zod';\n\n// Schema for practice sessions\nexport const PracticeSessionSchema = z.object({\n  id: z.string().uuid(),\n  currentItemId: z.string().uuid(),\n  startTime: z.string().datetime(),\n  endTime: z.string().datetime().optional(),\n  score: z.number().min(0).max(100).default(0),\n  itemsPracticed: z.number().min(0).default(0),\n  correctAnswers: z.number().min(0).default(0),\n  incorrectAnswers: z.number().min(0).default(0),\n  sessionType: z.enum(['vocabulary', 'grammar', 'listening', 'speaking']),\n  completed: z.boolean().default(false)\n});\n\n// TypeScript type derived from Zod schema\nexport type PracticeSession = z.infer<typeof PracticeSessionSchema>;","/**\n * Vocabulary Schema - Defines the structure and validation rules for vocabulary items\n * Used for runtime validation, type safety, and data integrity\n */\nimport { z } from 'zod';\n// Base schema for vocabulary parts of speech\nexport const PartOfSpeechSchema = z.enum([\n    'noun', // Noun (e.g., \"Haus\", \"\")\n    'verb', // Verb (e.g., \"gehen\", \"\")\n    'adjective', // Adjective (e.g., \"gro\", \"\")\n    'adverb', // Adverb (e.g., \"schnell\", \"\")\n    'pronoun', // Pronoun (e.g., \"ich\", \"\")\n    'preposition', // Preposition (e.g., \"in\", \"\")\n    'conjunction', // Conjunction (e.g., \"und\", \"\")\n    'interjection', // Interjection (e.g., \"ah\", \"\")\n    'article', // Article (e.g., \"der\", \"the\")\n    'number', // Number (e.g., \"eins\", \"\")\n    'phrase' // Common phrase (e.g., \"Wie geht's?\", \" ?\")\n]);\n// Schema for vocabulary categories (used for grouping)\nexport const VocabularyCategorySchema = z.enum([\n    'greetings',\n    'numbers',\n    'family',\n    'food',\n    'colors',\n    'animals',\n    'body',\n    'clothing',\n    'house',\n    'nature',\n    'transport',\n    'technology',\n    'time',\n    'weather',\n    'professions',\n    'places',\n    'grammar',\n    'culture',\n    'common_phrases',\n    'uncategorized' // Fallback for migration\n]);\n// Schema for vocabulary difficulty levels\nexport const DifficultyLevelSchema = z.enum([\n    'beginner', // A1 level\n    'elementary', // A2 level\n    'intermediate', // B1 level\n    'upper_intermediate', // B2 level\n    'advanced' // C1/C2 level\n]);\n// Schema for vocabulary metadata\nexport const VocabularyMetadataSchema = z.object({\n    gender: z.enum(['masculine', 'feminine', 'neuter']).optional(), // For nouns\n    pluralForm: z.string().optional(), // Plural form for nouns\n    conjugation: z.record(z.string(), z.string()).optional(), // Verb conjugations\n    examples: z.array(z.object({\n        german: z.string(),\n        bulgarian: z.string(),\n        context: z.string().optional()\n    })).optional(),\n    synonyms: z.array(z.string()).optional(),\n    antonyms: z.array(z.string()).optional(),\n    relatedWords: z.array(z.string()).optional(),\n    notes: z.string().optional(),\n    mnemonic: z.string().optional(),\n    culturalNote: z.string().optional(),\n    etymology: z.string().optional()\n});\n/**\n * Schema for legacy ID formats (numeric, string, UUID)\n * Supports: UUIDs, numeric IDs, string IDs, and auto-generation\n */\nexport const LegacyIdSchema = z.union([\n    z.string().uuid(),\n    z.string().min(1).max(100),\n    z.number().positive()\n]).transform((val) => {\n    if (typeof val === 'number')\n        return `legacy-${val}`;\n    return val;\n});\n// Fallback category for migration\nexport const VocabularyCategorySchemaWithFallback = VocabularyCategorySchema.or(z.literal('uncategorized'));\n// Main Vocabulary Item Schema with resilient validation\nconst BaseVocabularyItemSchema = z.object({\n    id: LegacyIdSchema,\n    german: z.string().min(1).max(100),\n    bulgarian: z.string().min(1).max(100),\n    partOfSpeech: PartOfSpeechSchema.default('noun'),\n    difficulty: z.number().min(1).max(5).default(1).describe('1-5 scale where 1 is easiest'),\n    categories: z.array(VocabularyCategorySchemaWithFallback).min(1).default(['uncategorized']),\n    transliteration: z.string().optional(), // Latin characters for pronunciation\n    emoji: z.string().optional(), // Visual representation\n    literalBreakdown: z.array(z.object({\n        segment: z.string(),\n        literal: z.string(),\n        grammarTag: z.string()\n    })).optional(),\n    metadata: VocabularyMetadataSchema.optional(),\n    createdAt: z.union([\n        z.date(),\n        z.string().datetime().transform(str => new Date(str))\n    ]).default(new Date()).transform(val => val instanceof Date ? val : new Date(val)),\n    updatedAt: z.union([\n        z.date(),\n        z.string().datetime().transform(str => new Date(str))\n    ]).default(new Date()).transform(val => val instanceof Date ? val : new Date(val)),\n    isCommon: z.boolean().default(false),\n    isVerified: z.boolean().default(false),\n    learningPhase: z.number().min(0).max(6).optional().default(0) // 0: Not Started, 1-6: SRS Phases\n});\n/**\n * Fallback vocabulary item for failed validations\n * Creates a valid item with fallback values when validation fails\n */\nexport const createFallbackItem = (input) => {\n    return {\n        id: `fallback-${crypto.randomUUID()}`,\n        german: typeof input === 'object' && input && 'german' in input && typeof input.german === 'string' ? input.german : 'unknown',\n        bulgarian: typeof input === 'object' && input && 'bulgarian' in input && typeof input.bulgarian === 'string' ? input.bulgarian : 'unknown',\n        partOfSpeech: 'noun',\n        difficulty: 1,\n        categories: ['uncategorized'],\n        metadata: {},\n        createdAt: new Date(),\n        updatedAt: new Date(),\n        isCommon: false,\n        isVerified: false,\n        learningPhase: 0\n    };\n};\nexport const VocabularyItemSchema = BaseVocabularyItemSchema.catch((ctx) => {\n    // Safe error logging without circular reference issues\n    const _safeInput = typeof ctx.input === 'object' && ctx.input\n        ? { ...ctx.input, metadata: ctx.input.metadata ? '[metadata]' : undefined }\n        : ctx.input;\n    // Validation failed for item\n    return createFallbackItem(ctx.input);\n});\n// Schema for vocabulary collections\nexport const VocabularyCollectionSchema = z.object({\n    id: z.string().uuid(),\n    name: z.string().min(3).max(100),\n    description: z.string().min(10).max(500),\n    items: z.array(VocabularyItemSchema),\n    languagePair: z.enum(['de-bg', 'bg-de']),\n    difficultyRange: z.tuple([z.number().min(1), z.number().max(5)]),\n    categories: z.array(VocabularyCategorySchema),\n    createdAt: z.union([\n        z.date(),\n        z.string().datetime().transform(str => new Date(str))\n    ]).default(new Date()).transform(val => val instanceof Date ? val : new Date(val)),\n    updatedAt: z.union([\n        z.date(),\n        z.string().datetime().transform(str => new Date(str))\n    ]).default(new Date()).transform(val => val instanceof Date ? val : new Date(val))\n});\n// Schema for vocabulary search parameters\nexport const VocabularySearchParamsSchema = z.object({\n    query: z.string().optional(),\n    partOfSpeech: PartOfSpeechSchema.optional(),\n    difficulty: z.number().min(1).max(5).optional(),\n    categories: z.array(VocabularyCategorySchema).optional(),\n    learningPhase: z.number().min(0).max(6).optional(),\n    limit: z.number().min(1).max(100).default(20),\n    offset: z.number().min(0).default(0),\n    sortBy: z.enum(['german', 'bulgarian', 'difficulty', 'createdAt']).default('german'),\n    sortOrder: z.enum(['asc', 'desc']).default('asc')\n});\n// Schema for vocabulary progress tracking\nexport const VocabularyProgressSchema = z.object({\n    userId: z.string().uuid(),\n    vocabularyId: z.string().uuid(),\n    learned: z.boolean().default(false),\n    proficiency: z.number().min(0).max(100).default(0),\n    lastReviewed: z.date().optional(),\n    reviewCount: z.number().min(0).default(0),\n    nextReviewDate: z.date().optional()\n});\n// Schema for practice sessions\nexport const PracticeSessionSchema = z.object({\n    id: z.string().uuid(),\n    currentItemId: z.string().uuid(),\n    startTime: z.string().datetime(),\n    endTime: z.string().datetime().optional(),\n    score: z.number().min(0).max(100).default(0),\n    itemsPracticed: z.number().min(0).default(0),\n    correctAnswers: z.number().min(0).default(0),\n    incorrectAnswers: z.number().min(0).default(0),\n    sessionType: z.enum(['vocabulary', 'grammar', 'listening', 'speaking']),\n    completed: z.boolean().default(false)\n});\n// Utility functions\nexport function getDifficultyLabel(difficulty) {\n    const labels = {\n        1: 'Beginner (A1)',\n        2: 'Elementary (A2)',\n        3: 'Intermediate (B1)',\n        4: 'Upper Intermediate (B2)',\n        5: 'Advanced (C1/C2)'\n    };\n    return labels[difficulty] || 'Unknown';\n}\nexport function getPartOfSpeechLabel(partOfSpeech) {\n    const labels = {\n        noun: 'Noun',\n        verb: 'Verb',\n        adjective: 'Adjective',\n        adverb: 'Adverb',\n        pronoun: 'Pronoun',\n        preposition: 'Preposition',\n        conjunction: 'Conjunction',\n        interjection: 'Interjection',\n        article: 'Article',\n        number: 'Number',\n        phrase: 'Phrase'\n    };\n    return labels[partOfSpeech];\n}\n//# sourceMappingURL=vocabulary.js.map","import { z } from 'zod';\nimport { PracticeSessionSchema } from './vocabulary';\n/**\n * Schema for individual practice stat entry\n */\nexport const PracticeStatSchema = z.object({\n    id: z.string(),\n    correct: z.number().int().nonnegative(),\n    incorrect: z.number().int().nonnegative(),\n    lastPracticed: z.string().datetime()\n});\n/**\n * Schema for user progress storage\n */\nexport const UserProgressStorageSchema = z.object({\n    stats: z.array(PracticeStatSchema),\n    favorites: z.array(z.string()),\n    recentSearches: z.array(z.string()),\n    lastUpdated: z.string().datetime()\n});\n/**\n * Schema for exported user data\n */\nexport const ExportedUserDataSchema = z.object({\n    progress: UserProgressStorageSchema.optional(),\n    session: PracticeSessionSchema.optional(),\n    exportedAt: z.string().datetime()\n});\n/**\n * Validation functions\n */\nexport function validatePracticeStat(data) {\n    return PracticeStatSchema.parse(data);\n}\nexport function validateUserProgressStorage(data) {\n    return UserProgressStorageSchema.parse(data);\n}\nexport function safeValidateUserProgressStorage(data) {\n    const result = UserProgressStorageSchema.safeParse(data);\n    return result.success\n        ? { success: true, data: result.data }\n        : { success: false, error: result.error };\n}\nexport function validateExportedUserData(data) {\n    return ExportedUserDataSchema.parse(data);\n}\nexport function safeValidateExportedUserData(data) {\n    const result = ExportedUserDataSchema.safeParse(data);\n    return result.success\n        ? { success: true, data: result.data }\n        : { success: false, error: result.error };\n}\n/**\n * Type guard for PracticeStat\n */\nexport function isPracticeStat(data) {\n    return PracticeStatSchema.safeParse(data).success;\n}\n/**\n * Type guard for UserProgressStorage\n */\nexport function isUserProgressStorage(data) {\n    return UserProgressStorageSchema.safeParse(data).success;\n}\n//# sourceMappingURL=localStorage.js.map","// LocalStorage utilities for the Bulgarian-German Learning App\nimport type { PracticeSession } from '$lib/types/vocabulary';\nimport { PracticeSessionSchema } from '$lib/schemas/practiceSession.js';\nimport {\n  UserProgressStorageSchema,\n  safeValidateUserProgressStorage,\n  isPracticeStat\n} from '$lib/schemas/localStorage.js';\nimport { StorageError, ErrorHandler } from '../services/errors';\nimport { EventBus } from '../services/event-bus';\n\n/**\n * LocalStorage utility class for managing user progress\n */\nexport class LocalStorageManager {\n  private static readonly PREFIX = 'tandem_';\n  private static readonly USER_PROGRESS_KEY = `${LocalStorageManager.PREFIX}user_progress`;\n  private static readonly SESSION_KEY = `${LocalStorageManager.PREFIX}active_session`;\n\n  /**\n   * Save user progress to localStorage\n   * @param progress Object containing user progress data\n   * @param eventBus Optional event bus for error handling\n   * @throws StorageError if saving fails\n   */\n  public static saveUserProgress(progress: {\n    stats: Map<string, { correct: number; incorrect: number; lastPracticed: string }>;\n    favorites: string[];\n    recentSearches: string[];\n  }, eventBus?: EventBus): void {\n    try {\n        const serializedStats = Array.from(progress.stats.entries()).map(([id, data]) => ({\n            id,\n            correct: data.correct,\n            incorrect: data.incorrect,\n            lastPracticed: data.lastPracticed\n        }));\n\n        const dataToSave = {\n            stats: serializedStats,\n            favorites: progress.favorites,\n            recentSearches: progress.recentSearches,\n            lastUpdated: new Date().toISOString()\n        };\n\n        // Validate before saving\n        const validationResult = UserProgressStorageSchema.safeParse(dataToSave);\n        if (!validationResult.success) {\n            throw new StorageError('Invalid user progress data', { validationResult });\n        }\n\n        localStorage.setItem(\n            LocalStorageManager.USER_PROGRESS_KEY,\n            JSON.stringify(dataToSave)\n        );\n    } catch (error) {\n        const err = error instanceof Error ? error : new Error(String(error));\n        ErrorHandler.handleError(err, 'Failed to save user progress', eventBus);\n        throw new StorageError('Failed to save user progress', { error: err });\n    }\n  }\n\n  /**\n   * Load user progress from localStorage\n   * @param eventBus Optional event bus for error handling\n   * @returns Object containing user progress data or null if not found\n   * @throws StorageError if loading fails\n   */\n  public static loadUserProgress(eventBus?: EventBus): {\n    stats: Map<string, { correct: number; incorrect: number; lastPracticed: string }>;\n    favorites: string[];\n    recentSearches: string[];\n    lastUpdated: string;\n  } | null {\n    try {\n        const data = localStorage.getItem(LocalStorageManager.USER_PROGRESS_KEY);\n        if (!data) return null;\n\n        const parsedData = JSON.parse(data);\n\n        // Validate parsed data with Zod\n        const validationResult = safeValidateUserProgressStorage(parsedData);\n        if (!validationResult.success) {\n            throw new StorageError('Invalid user progress data format', { validationResult });\n        }\n\n        // Convert stats array back to Map with type safety\n        const statsMap = new Map<string, { correct: number; incorrect: number; lastPracticed: string }>();\n        validationResult.data.stats.forEach((item) => {\n            if (isPracticeStat(item)) {\n                statsMap.set(item.id, {\n                    correct: item.correct,\n                    incorrect: item.incorrect,\n                    lastPracticed: item.lastPracticed\n                });\n            }\n        });\n\n        return {\n            stats: statsMap,\n            favorites: validationResult.data.favorites || [],\n            recentSearches: validationResult.data.recentSearches || [],\n            lastUpdated: validationResult.data.lastUpdated\n        };\n    } catch (error) {\n        const err = error instanceof Error ? error : new Error(String(error));\n        ErrorHandler.handleError(err, 'Failed to load user progress', eventBus);\n        throw new StorageError('Failed to load user progress', { error: err });\n    }\n  }\n\n  /**\n   * Save active practice session to localStorage\n   * @param session Practice session data to save\n   * @param eventBus Optional event bus for error handling\n   * @throws StorageError if saving fails\n   */\n  public static savePracticeSession(session: PracticeSession, eventBus?: EventBus): void {\n    try {\n        // Validate practice session before saving\n        const result = PracticeSessionSchema.safeParse(session);\n        if (!result.success) {\n            throw new StorageError('Invalid practice session data', { result });\n        }\n\n        localStorage.setItem(\n            LocalStorageManager.SESSION_KEY,\n            JSON.stringify(session)\n        );\n    } catch (error) {\n        const err = error instanceof Error ? error : new Error(String(error));\n        ErrorHandler.handleError(err, 'Failed to save practice session', eventBus);\n        throw new StorageError('Failed to save practice session', { error: err });\n    }\n  }\n\n  /**\n   * Load active practice session from localStorage\n   * @param eventBus Optional event bus for error handling\n   * @returns Practice session data or null if not found\n   * @throws StorageError if loading fails\n   */\n  public static loadPracticeSession(eventBus?: EventBus): PracticeSession | null {\n    try {\n        const data = localStorage.getItem(LocalStorageManager.SESSION_KEY);\n        if (!data) return null;\n\n        const parsedData = JSON.parse(data);\n        const result = PracticeSessionSchema.safeParse(parsedData);\n        if (!result.success) {\n            throw new StorageError('Invalid practice session data format', { result });\n        }\n\n        return result.data;\n    } catch (error) {\n        const err = error instanceof Error ? error : new Error(String(error));\n        ErrorHandler.handleError(err, 'Failed to load practice session', eventBus);\n        throw new StorageError('Failed to load practice session', { error: err });\n    }\n  }\n\n  /**\n   * Clear active practice session from localStorage\n   * @param eventBus Optional event bus for error handling\n   * @throws StorageError if clearing fails\n   */\n  public static clearPracticeSession(eventBus?: EventBus): void {\n    try {\n        localStorage.removeItem(LocalStorageManager.SESSION_KEY);\n    } catch (error) {\n        const err = error instanceof Error ? error : new Error(String(error));\n        ErrorHandler.handleError(err, 'Failed to clear practice session', eventBus);\n        throw new StorageError('Failed to clear practice session', { error: err });\n    }\n  }\n\n  /**\n   * Export user data as JSON string\n   * @param eventBus Optional event bus for error handling\n   * @returns JSON string containing all user data\n   * @throws StorageError if exporting fails\n   */\n  public static exportUserData(eventBus?: EventBus): string {\n    try {\n        const progress = this.loadUserProgress(eventBus);\n        const session = this.loadPracticeSession(eventBus);\n\n        return JSON.stringify({\n            progress,\n            session,\n            exportedAt: new Date().toISOString()\n        }, null, 2);\n    } catch (error) {\n        const err = error instanceof Error ? error : new Error(String(error));\n        ErrorHandler.handleError(err, 'Failed to export user data', eventBus);\n        throw new StorageError('Failed to export user data', { error: err });\n    }\n  }\n\n  /**\n   * Import user data from JSON string\n   * @param jsonData JSON string containing user data\n   * @param eventBus Optional event bus for error handling\n   * @throws StorageError if importing fails\n   */\n  public static importUserData(jsonData: string, eventBus?: EventBus): void {\n    try {\n        const data = JSON.parse(jsonData);\n\n        if (data.progress) {\n            this.saveUserProgress({\n                stats: data.progress.stats,\n                favorites: data.progress.favorites,\n                recentSearches: data.progress.recentSearches\n            }, eventBus);\n        }\n\n        if (data.session) {\n            this.savePracticeSession(data.session, eventBus);\n        }\n    } catch (error) {\n        const err = error instanceof Error ? error : new Error(String(error));\n        ErrorHandler.handleError(err, 'Failed to import user data', eventBus);\n        throw new StorageError('Failed to import user data', { error: err });\n    }\n  }\n\n  /**\n   * Clear all tandem-related data from localStorage\n   * @param eventBus Optional event bus for error handling\n   * @throws StorageError if clearing fails\n   */\n  public static clearAllData(eventBus?: EventBus): void {\n    try {\n        Object.keys(localStorage)\n            .filter(key => key.startsWith(LocalStorageManager.PREFIX))\n            .forEach(key => localStorage.removeItem(key));\n    } catch (error) {\n        const err = error instanceof Error ? error : new Error(String(error));\n        ErrorHandler.handleError(err, 'Failed to clear all user data', eventBus);\n        throw new StorageError('Failed to clear all user data', { error: err });\n    }\n  }\n}\n\n// Export singleton instance\nexport const localStorageManager = new LocalStorageManager();","/**\n * Progress Tracking Schema\n *\n * This module defines the Zod schemas for tracking user progress in the language learning application.\n * It includes schemas for vocabulary mastery, lesson completion, quiz performance, and overall progress.\n */\nimport { z } from 'zod';\n// Vocabulary Mastery Schema\nexport const VocabularyMasterySchema = z.object({\n    id: z.string().uuid(),\n    itemId: z.string().uuid(),\n    correctCount: z.number().int().min(0).default(0),\n    incorrectCount: z.number().int().min(0).default(0),\n    totalAttempts: z.number().int().min(0).default(0),\n    lastPracticed: z.string().datetime().nullable().default(null),\n    masteryLevel: z.number().min(0).max(100).default(0),\n    isMastered: z.boolean().default(false),\n    createdAt: z.string().datetime().default(new Date().toISOString()),\n    updatedAt: z.string().datetime().default(new Date().toISOString())\n});\n// Lesson Progress Schema\nexport const LessonProgressSchema = z.object({\n    id: z.string().uuid(),\n    lessonId: z.string().uuid(),\n    userId: z.string().uuid().optional(), // For future multi-user support\n    status: z.enum(['not_started', 'in_progress', 'completed', 'mastered']).default('not_started'),\n    completionPercentage: z.number().min(0).max(100).default(0),\n    lastAccessed: z.string().datetime().nullable().default(null),\n    completedAt: z.string().datetime().nullable().default(null),\n    createdAt: z.string().datetime().default(new Date().toISOString()),\n    updatedAt: z.string().datetime().default(new Date().toISOString())\n});\n// Quiz Performance Schema\nexport const QuizPerformanceSchema = z.object({\n    id: z.string().uuid(),\n    quizId: z.string().uuid(),\n    sessionId: z.string().uuid(),\n    score: z.number().min(0).max(100).default(0),\n    totalQuestions: z.number().int().min(1).default(1),\n    correctAnswers: z.number().int().min(0).default(0),\n    incorrectAnswers: z.number().int().min(0).default(0),\n    timeTaken: z.number().int().min(0).default(0), // in seconds\n    completedAt: z.string().datetime().default(new Date().toISOString()),\n    createdAt: z.string().datetime().default(new Date().toISOString())\n});\n// Question Performance Schema\nexport const QuestionPerformanceSchema = z.object({\n    id: z.string().uuid(),\n    quizPerformanceId: z.string().uuid(),\n    questionId: z.string().uuid(),\n    questionType: z.string().min(1),\n    wasCorrect: z.boolean().default(false),\n    userAnswer: z.string().nullable().default(null),\n    correctAnswer: z.string().min(1),\n    timeTaken: z.number().int().min(0).default(0), // in seconds\n    createdAt: z.string().datetime().default(new Date().toISOString())\n});\n// Daily Progress Schema\nexport const DailyProgressSchema = z.object({\n    id: z.string().uuid(),\n    date: z.string().datetime().default(new Date().toISOString()),\n    xpEarned: z.number().int().min(0).default(0),\n    wordsPracticed: z.number().int().min(0).default(0),\n    lessonsCompleted: z.number().int().min(0).default(0),\n    quizzesTaken: z.number().int().min(0).default(0),\n    timeSpent: z.number().int().min(0).default(0), // in seconds\n    createdAt: z.string().datetime().default(new Date().toISOString()),\n    updatedAt: z.string().datetime().default(new Date().toISOString())\n});\n// Overall Progress Schema\nexport const OverallProgressSchema = z.object({\n    id: z.string().uuid(),\n    userId: z.string().uuid().optional(), // For future multi-user support\n    totalXP: z.number().int().min(0).default(0),\n    totalWordsPracticed: z.number().int().min(0).default(0),\n    totalLessonsCompleted: z.number().int().min(0).default(0),\n    totalQuizzesTaken: z.number().int().min(0).default(0),\n    totalTimeSpent: z.number().int().min(0).default(0), // in seconds\n    currentLevel: z.number().int().min(1).default(1),\n    currentStreak: z.number().int().min(0).default(0),\n    longestStreak: z.number().int().min(0).default(0),\n    lastActiveDate: z.string().datetime().nullable().default(null),\n    createdAt: z.string().datetime().default(new Date().toISOString()),\n    updatedAt: z.string().datetime().default(new Date().toISOString())\n});\n// Progress Data Schema (for localStorage)\nexport const ProgressDataSchema = z.object({\n    vocabularyMastery: z.record(z.string().uuid(), VocabularyMasterySchema),\n    lessonProgress: z.record(z.string().uuid(), LessonProgressSchema),\n    quizPerformance: z.record(z.string().uuid(), QuizPerformanceSchema),\n    questionPerformance: z.record(z.string().uuid(), QuestionPerformanceSchema),\n    dailyProgress: z.record(z.string(), DailyProgressSchema), // date as key\n    overallProgress: OverallProgressSchema\n});\n// Utility functions for progress calculation\nexport const calculateMasteryLevel = (correct, incorrect) => {\n    const total = correct + incorrect;\n    if (total === 0)\n        return 0;\n    // Simple mastery calculation: 80% correct = mastered\n    const mastery = (correct / total) * 100;\n    return Math.min(100, Math.max(0, Math.round(mastery)));\n};\nexport const isItemMastered = (masteryLevel) => {\n    return masteryLevel >= 80;\n};\nexport const calculateLevel = (totalXP) => {\n    // Level 1: 0-200 XP\n    // Level 2: 201-500 XP\n    // Level 3: 501-900 XP\n    // Level 4: 901-1400 XP\n    // Level 5: 1401-2000 XP\n    // And so on...\n    if (totalXP < 200)\n        return 1;\n    if (totalXP < 500)\n        return 2;\n    if (totalXP < 900)\n        return 3;\n    if (totalXP < 1400)\n        return 4;\n    if (totalXP < 2000)\n        return 5;\n    // For higher levels, use a formula\n    const level = Math.floor(Math.sqrt(totalXP / 100)) + 1;\n    return Math.max(1, level);\n};\nexport const calculateXPForLevel = (level) => {\n    if (level === 1)\n        return 0;\n    if (level === 2)\n        return 200;\n    if (level === 3)\n        return 500;\n    if (level === 4)\n        return 900;\n    if (level === 5)\n        return 1400;\n    // For higher levels, use the inverse of the level calculation\n    return Math.pow(level - 1, 2) * 100;\n};\n//# sourceMappingURL=progress.js.map","import { browser } from '$app/environment';\nimport { Debug } from '$lib/utils';\nimport { EventBus, EventTypes, type XPEvent, type LevelUpEvent } from '../services/event-bus';\nimport { StateError, StorageError, ErrorHandler } from '../services/errors';\nimport { calculateLevel, calculateXPForLevel } from '../schemas/progress';\n\nconst DAILY_XP_TARGET = 50;\nconst XP_PER_WORD = 10;\n\nexport class LearningSession {\n    // Session State with proper typing\n    isActive = $state<boolean>(false);\n    currentStreak = $state<number>(0);\n    sessionXP = $state<number>(0);\n    dailyXP = $state<number>(0);\n    lastPracticeDate = $state<string | null>(null);\n    totalXP = $state<number>(0); // Track total XP from events\n\n    // Gamification\n    dailyTarget = DAILY_XP_TARGET;\n\n    // Event handling\n    private eventBus: EventBus;\n    private xpEventUnsubscribe: (() => void) | null = null;\n    private levelUpEventUnsubscribe: (() => void) | null = null;\n\n    // Level System (Derived) with memoization\n    level = $derived.by(() => calculateLevel(this.totalXP));\n    nextLevelXP = $derived.by(() => calculateXPForLevel(this.level + 1));\n    currentLevelStartXP = $derived.by(() => calculateXPForLevel(this.level));\n\n    levelProgress = $derived.by(() => {\n        const xpInLevel = this.totalXP - this.currentLevelStartXP;\n        const levelSpan = this.nextLevelXP - this.currentLevelStartXP;\n\n        // Ensure we don't divide by zero and return a valid percentage\n        if (levelSpan <= 0) return 0;\n        return Math.min(100, Math.max(0, (xpInLevel / levelSpan) * 100));\n    });\n\n    progressPercentage = $derived.by(() => {\n        // Ensure we don't divide by zero\n        if (this.dailyTarget <= 0) return 0;\n        return Math.min(100, (this.dailyXP / this.dailyTarget) * 100);\n    });\n    isDailyGoalReached = $derived(this.dailyXP >= this.dailyTarget);\n\n    constructor(eventBus: EventBus) {\n        this.eventBus = eventBus;\n\n        if (browser) {\n            this.loadState();\n        }\n\n        // Subscribe to XP events with proper typing\n        this.xpEventUnsubscribe = eventBus.subscribe(EventTypes.XP_EARNED, (event: XPEvent) => {\n            this.handleXPEarned(event);\n        });\n\n        // Subscribe to level up events\n        this.levelUpEventUnsubscribe = eventBus.subscribe(EventTypes.LEVEL_UP, (event: LevelUpEvent) => {\n            this.handleLevelUp(event);\n        });\n\n        // Initialize derived values - no effect needed for derived values\n        // Derived values are automatically calculated when accessed\n        this.level;\n        this.nextLevelXP;\n        this.currentLevelStartXP;\n        this.levelProgress;\n        this.progressPercentage;\n        this.isDailyGoalReached;\n    }\n\n    startSession() {\n        this.isActive = true;\n        this.sessionXP = 0;\n        this.checkStreak();\n    }\n\n    endSession() {\n        this.isActive = false;\n        this.saveState();\n    }\n\n    /**\n     * Award XP for the current session\n     * @param amount Amount of XP to award (default: XP_PER_WORD)\n     * @returns boolean indicating if a level up occurred\n     * @throws StateError if the amount is invalid\n     */\n    awardXP(amount: number = XP_PER_WORD): boolean {\n        // Validate input\n        if (typeof amount !== 'number' || amount <= 0 || !Number.isFinite(amount)) {\n            throw new StateError('Invalid XP amount', { amount });\n        }\n\n        this.sessionXP += amount;\n        this.dailyXP += amount;\n\n        // Emit XP earned event\n        this.eventBus.emit(EventTypes.XP_EARNED, {\n            amount,\n            reason: 'Session activity',\n            timestamp: new Date()\n        } as XPEvent);\n\n        this.saveState();\n        return false;\n    }\n\n    /**\n     * Handle XP earned event from ProgressService\n     * @param event XP event containing amount and metadata\n     */\n    private handleXPEarned(event: XPEvent) {\n        // Update our total XP tracking\n        this.totalXP += event.amount;\n\n        // Reset daily XP if it's a new day\n        this.checkStreak();\n\n        this.saveState();\n    }\n\n    /**\n     * Handle level up event from ProgressService\n     * @param event Level up event containing level information\n     */\n    private handleLevelUp(event: LevelUpEvent) {\n        // Level up is handled by ProgressService, we just need to update our state\n        this.totalXP = event.totalXP;\n        Debug.log('LearningSession', `Level up detected: ${event.oldLevel} -> ${event.newLevel}`);\n    }\n\n    /**\n     * Get the current total XP\n     * @returns Total XP\n     */\n    getTotalXP(): number {\n        return this.totalXP;\n    }\n\n    /**\n     * Check and update streak information\n     * @throws StateError if date operations fail\n     */\n    private checkStreak(): void {\n        try {\n            const today = new Date().toISOString().split('T')[0];\n\n            if (!today) {\n                throw new Error('Failed to get current date');\n            }\n\n            if (this.lastPracticeDate === today) return; // Already practiced today\n\n            const yesterday = new Date();\n            yesterday.setDate(yesterday.getDate() - 1);\n            const yesterdayStr = yesterday.toISOString().split('T')[0];\n\n            if (!yesterdayStr) {\n                throw new Error('Failed to get yesterday date');\n            }\n\n            if (this.lastPracticeDate === yesterdayStr) {\n                // Continued streak\n                this.currentStreak++;\n            } else if (this.lastPracticeDate && this.lastPracticeDate < yesterdayStr) {\n                // Streak broken\n                this.currentStreak = 1;\n            } else {\n                // First time or fresh start\n                if (this.currentStreak === 0) this.currentStreak = 1;\n            }\n\n            // Reset daily XP if it's a new day\n            if (this.lastPracticeDate !== today) {\n                this.dailyXP = 0;\n            }\n\n            this.lastPracticeDate = today;\n            this.saveState();\n        } catch (error) {\n            ErrorHandler.handleError(error, 'Failed to check streak');\n            throw new StateError('Failed to check streak', { error });\n        }\n    }\n\n    // Persistence\n    /**\n     * Load the session state from localStorage\n     * @throws StorageError if loading fails\n     */\n    private loadState(): void {\n        if (!browser) return;\n\n        let saved: string | null = null;\n        try {\n            saved = localStorage.getItem('learning-session');\n            if (saved) {\n                const parsed = JSON.parse(saved);\n\n                // Validate and set state with proper typing\n                this.currentStreak = typeof parsed.currentStreak === 'number' ? parsed.currentStreak : 0;\n                this.lastPracticeDate = typeof parsed.lastPracticeDate === 'string' ? parsed.lastPracticeDate : null;\n                this.dailyXP = typeof parsed.dailyXP === 'number' ? parsed.dailyXP : 0;\n                this.totalXP = typeof parsed.totalXP === 'number' ? parsed.totalXP : 0;\n\n                // Reset daily XP if it's a new day\n                const today = new Date().toISOString().split('T')[0];\n                if (parsed.lastPracticeDate !== today) {\n                    this.dailyXP = 0;\n                }\n            }\n        } catch (error) {\n            ErrorHandler.handleError(error, 'Failed to load learning session state');\n            // Re-throw to allow application to handle initialization failure\n            throw new StorageError('Failed to load learning session state', {\n                error,\n                hasSavedData: saved !== null\n            });\n        }\n    }\n\n    /**\n     * Save the current session state to localStorage\n     * @throws StorageError if saving fails\n     */\n    private saveState(): void {\n        if (!browser) return;\n        try {\n            // Validate state before saving\n            if (typeof this.currentStreak !== 'number' || typeof this.dailyXP !== 'number' || typeof this.totalXP !== 'number') {\n                throw new Error('Invalid session state: numbers expected');\n            }\n\n            localStorage.setItem('learning-session', JSON.stringify({\n                currentStreak: this.currentStreak,\n                dailyXP: this.dailyXP,\n                lastPracticeDate: this.lastPracticeDate,\n                totalXP: this.totalXP\n            }));\n        } catch (error) {\n            ErrorHandler.handleError(error, 'Failed to save learning session state');\n            throw new StorageError('Failed to save learning session state', {\n                error,\n                currentStreakType: typeof this.currentStreak,\n                dailyXPType: typeof this.dailyXP,\n                lastPracticeDateType: typeof this.lastPracticeDate,\n                totalXPType: typeof this.totalXP\n            });\n        }\n    }\n\n    destroy(): void {\n        Debug.log('LearningSession', 'Destroying LearningSession, cleaning up resources');\n        if (this.xpEventUnsubscribe) {\n            this.xpEventUnsubscribe();\n            this.xpEventUnsubscribe = null;\n        }\n        if (this.levelUpEventUnsubscribe) {\n            this.levelUpEventUnsubscribe();\n            this.levelUpEventUnsubscribe = null;\n        }\n    }\n}\n// Create singleton instance - will be initialized by DI container\nlet learningSessionInstance: LearningSession | null = null;\n\n// Export a getter and setter to avoid direct import reassignment issues\nexport function getLearningSession(): LearningSession | null {\n    return learningSessionInstance;\n}\n\nexport function setLearningSession(session: LearningSession): void {\n    learningSessionInstance = session;\n}\n\nexport { learningSessionInstance as learningSession };\n\n// Add cleanup for application shutdown\nexport function setupSessionCleanup() {\n    if (browser) {\n        window.addEventListener('beforeunload', () => {\n            const session = getLearningSession();\n            if (session) {\n                session.destroy();\n            }\n        });\n    }\n}\n\n// Initialize cleanup\nsetupSessionCleanup();","/**\n * Progress Tracking Service\n *\n * This service provides comprehensive progress tracking functionality for the language learning application.\n * It handles vocabulary mastery, lesson completion, quiz performance, and overall user progress.\n */\nimport { browser } from '$app/environment';\nimport { v4 as uuidv4 } from 'uuid';\nimport { LocalStorageManager } from '$lib/utils/localStorage';\nimport { VocabularyMasterySchema, LessonProgressSchema, QuizPerformanceSchema, QuestionPerformanceSchema, DailyProgressSchema, ProgressDataSchema, calculateMasteryLevel, isItemMastered, calculateLevel, calculateXPForLevel } from '$lib/schemas/progress';\nimport { learningSession } from '$lib/state/session.svelte';\nexport class ProgressService {\n    constructor() {\n        this.progressData = this.getDefaultProgressData();\n        if (browser) {\n            this.loadProgress();\n        }\n    }\n    static getInstance() {\n        if (!ProgressService.instance) {\n            ProgressService.instance = new ProgressService();\n        }\n        return ProgressService.instance;\n    }\n    getDefaultProgressData() {\n        return {\n            vocabularyMastery: {},\n            lessonProgress: {},\n            quizPerformance: {},\n            questionPerformance: {},\n            dailyProgress: {},\n            overallProgress: {\n                id: uuidv4(),\n                totalXP: 0,\n                totalWordsPracticed: 0,\n                totalLessonsCompleted: 0,\n                totalQuizzesTaken: 0,\n                totalTimeSpent: 0,\n                currentLevel: 1,\n                currentStreak: 0,\n                longestStreak: 0,\n                lastActiveDate: null,\n                createdAt: new Date().toISOString(),\n                updatedAt: new Date().toISOString()\n            }\n        };\n    }\n    //#region Vocabulary Mastery Tracking\n    /**\n     * Record a vocabulary practice result\n     * @param itemId The ID of the vocabulary item\n     * @param correct Whether the answer was correct\n     * @param responseTime Response time in seconds (optional)\n     */\n    recordVocabularyPractice(itemId, correct, _responseTime) {\n        const now = new Date().toISOString();\n        // Get or create mastery record\n        let mastery = this.progressData.vocabularyMastery[itemId] || {\n            id: uuidv4(),\n            itemId,\n            correctCount: 0,\n            incorrectCount: 0,\n            totalAttempts: 0,\n            lastPracticed: null,\n            masteryLevel: 0,\n            isMastered: false,\n            createdAt: now,\n            updatedAt: now\n        };\n        // Update mastery stats\n        if (correct) {\n            mastery.correctCount++;\n        }\n        else {\n            mastery.incorrectCount++;\n        }\n        mastery.totalAttempts++;\n        mastery.lastPracticed = now;\n        mastery.updatedAt = now;\n        // Calculate mastery level\n        mastery.masteryLevel = calculateMasteryLevel(mastery.correctCount, mastery.incorrectCount);\n        mastery.isMastered = isItemMastered(mastery.masteryLevel);\n        // Update the record\n        this.progressData.vocabularyMastery[itemId] = VocabularyMasterySchema.parse(mastery);\n        // Update overall progress\n        this.updateOverallProgress({\n            xpEarned: ProgressService.XP_VALUES.VOCABULARY_PRACTICE,\n            wordsPracticed: 1,\n            timeSpent: responseTime || 0\n        });\n        // Award bonus XP for mastering an item\n        if (mastery.isMastered && mastery.totalAttempts === 1) {\n            this.awardXP(ProgressService.XP_VALUES.VOCABULARY_MASTERED, 'Vocabulary mastered');\n        }\n        this.saveProgress();\n    }\n    /**\n     * Get mastery data for a specific vocabulary item\n     * @param itemId The ID of the vocabulary item\n     * @returns VocabularyMastery or null if not found\n     */\n    getVocabularyMastery(itemId) {\n        return this.progressData.vocabularyMastery[itemId] || null;\n    }\n    /**\n     * Get all vocabulary mastery data\n     * @returns Record of vocabulary mastery data\n     */\n    getAllVocabularyMastery() {\n        return this.progressData.vocabularyMastery;\n    }\n    /**\n     * Get vocabulary items that need practice\n     * @param limit Maximum number of items to return\n     * @returns Array of vocabulary items that need practice\n     */\n    getVocabularyNeedingPractice(limit = 10) {\n        return Object.values(this.progressData.vocabularyMastery)\n            .filter(item => {\n            // Items that haven't been mastered yet\n            if (item.isMastered)\n                return false;\n            // Items with low mastery level or few attempts\n            const totalAttempts = item.correctCount + item.incorrectCount;\n            const successRate = totalAttempts > 0 ? item.correctCount / totalAttempts : 0;\n            return successRate < 0.8 || totalAttempts < 3;\n        })\n            .sort((a, b) => {\n            // Sort by mastery level (lowest first) and then by last practiced (oldest first)\n            if (a.masteryLevel !== b.masteryLevel) {\n                return a.masteryLevel - b.masteryLevel;\n            }\n            return new Date(a.lastPracticed || 0).getTime() - new Date(b.lastPracticed || 0).getTime();\n        })\n            .slice(0, limit);\n    }\n    //#endregion\n    //#region Lesson Progress Tracking\n    /**\n     * Record lesson progress\n     * @param lessonId The ID of the lesson\n     * @param completionPercentage The percentage of completion (0-100)\n     */\n    recordLessonProgress(lessonId, completionPercentage) {\n        const now = new Date().toISOString();\n        const _today = now.split('T')[0];\n        // Get or create lesson progress record\n        let lessonProgress = this.progressData.lessonProgress[lessonId] || {\n            id: uuidv4(),\n            lessonId,\n            status: 'not_started',\n            completionPercentage: 0,\n            lastAccessed: null,\n            completedAt: null,\n            createdAt: now,\n            updatedAt: now\n        };\n        // Update lesson progress\n        lessonProgress.completionPercentage = Math.min(100, Math.max(0, completionPercentage));\n        lessonProgress.lastAccessed = now;\n        lessonProgress.updatedAt = now;\n        // Update status based on completion percentage\n        if (lessonProgress.completionPercentage >= 100) {\n            lessonProgress.status = 'completed';\n            lessonProgress.completedAt = now;\n        }\n        else if (lessonProgress.completionPercentage > 0) {\n            lessonProgress.status = 'in_progress';\n        }\n        // Update the record\n        this.progressData.lessonProgress[lessonId] = LessonProgressSchema.parse(lessonProgress);\n        // If lesson is completed, update overall progress\n        if (lessonProgress.status === 'completed' && lessonProgress.completionPercentage === 100) {\n            this.updateOverallProgress({\n                xpEarned: ProgressService.XP_VALUES.LESSON_COMPLETED,\n                lessonsCompleted: 1,\n                timeSpent: 0 // Time spent on lessons is tracked separately\n            });\n        }\n        this.saveProgress();\n    }\n    /**\n     * Get progress for a specific lesson\n     * @param lessonId The ID of the lesson\n     * @returns LessonProgress or null if not found\n     */\n    getLessonProgress(lessonId) {\n        return this.progressData.lessonProgress[lessonId] || null;\n    }\n    /**\n     * Get all lesson progress data\n     * @returns Record of lesson progress data\n     */\n    getAllLessonProgress() {\n        return this.progressData.lessonProgress;\n    }\n    //#endregion\n    //#region Quiz Performance Tracking\n    /**\n     * Record quiz performance\n     * @param quizId The ID of the quiz\n     * @param score The score achieved (0-100)\n     * @param totalQuestions Total number of questions\n     * @param correctAnswers Number of correct answers\n     * @param timeTaken Time taken in seconds\n     * @param sessionId The session ID for this quiz attempt\n     */\n    recordQuizPerformance(quizId, score, totalQuestions, correctAnswers, timeTaken, sessionId) {\n        const now = new Date().toISOString();\n        // Create quiz performance record\n        const quizPerformance = {\n            id: uuidv4(),\n            quizId,\n            sessionId,\n            score: Math.min(100, Math.max(0, score)),\n            totalQuestions,\n            correctAnswers,\n            incorrectAnswers: totalQuestions - correctAnswers,\n            timeTaken,\n            completedAt: now,\n            createdAt: now\n        };\n        // Add to progress data\n        this.progressData.quizPerformance[quizPerformance.id] = QuizPerformanceSchema.parse(quizPerformance);\n        // Update overall progress\n        this.updateOverallProgress({\n            xpEarned: ProgressService.XP_VALUES.QUIZ_COMPLETED,\n            quizzesTaken: 1,\n            timeSpent: timeTaken\n        });\n        this.saveProgress();\n    }\n    /**\n     * Record question performance\n     * @param quizPerformanceId The ID of the quiz performance record\n     * @param questionId The ID of the question\n     * @param questionType The type of the question\n     * @param wasCorrect Whether the answer was correct\n     * @param userAnswer The user's answer\n     * @param correctAnswer The correct answer\n     * @param timeTaken Time taken in seconds\n     */\n    recordQuestionPerformance(quizPerformanceId, questionId, questionType, wasCorrect, userAnswer, correctAnswer, timeTaken) {\n        const now = new Date().toISOString();\n        // Create question performance record\n        const questionPerformance = {\n            id: uuidv4(),\n            quizPerformanceId,\n            questionId,\n            questionType,\n            wasCorrect,\n            userAnswer,\n            correctAnswer,\n            timeTaken,\n            createdAt: now\n        };\n        // Add to progress data\n        this.progressData.questionPerformance[questionPerformance.id] =\n            QuestionPerformanceSchema.parse(questionPerformance);\n        // If the question was part of vocabulary practice, update vocabulary mastery\n        if (questionType.includes('vocabulary') && questionId) {\n            this.recordVocabularyPractice(questionId, wasCorrect, timeTaken);\n        }\n        this.saveProgress();\n    }\n    /**\n     * Get quiz performance by ID\n     * @param quizPerformanceId The ID of the quiz performance record\n     * @returns QuizPerformance or null if not found\n     */\n    getQuizPerformance(quizPerformanceId) {\n        return this.progressData.quizPerformance[quizPerformanceId] || null;\n    }\n    /**\n     * Get all quiz performance records\n     * @returns Record of quiz performance data\n     */\n    getAllQuizPerformance() {\n        return this.progressData.quizPerformance;\n    }\n    /**\n     * Get quiz performance records for a specific quiz\n     * @param quizId The ID of the quiz\n     * @returns Array of quiz performance records\n     */\n    getQuizPerformanceByQuizId(quizId) {\n        return Object.values(this.progressData.quizPerformance)\n            .filter(performance => performance.quizId === quizId)\n            .sort((a, b) => new Date(b.completedAt).getTime() - new Date(a.completedAt).getTime());\n    }\n    //#endregion\n    //#region Daily Progress Tracking\n    /**\n     * Record daily progress\n     * @param date The date in YYYY-MM-DD format\n     * @param xpEarned XP earned on this date\n     * @param wordsPracticed Number of words practiced\n     * @param lessonsCompleted Number of lessons completed\n     * @param quizzesTaken Number of quizzes taken\n     * @param timeSpent Time spent in seconds\n     */\n    recordDailyProgress(date, xpEarned, wordsPracticed, lessonsCompleted, quizzesTaken, timeSpent) {\n        const now = new Date().toISOString();\n        // Get or create daily progress record\n        let dailyProgress = this.progressData.dailyProgress[date] || {\n            id: uuidv4(),\n            date: new Date(date).toISOString(),\n            xpEarned: 0,\n            wordsPracticed: 0,\n            lessonsCompleted: 0,\n            quizzesTaken: 0,\n            timeSpent: 0,\n            createdAt: now,\n            updatedAt: now\n        };\n        // Update daily progress\n        dailyProgress.xpEarned += xpEarned;\n        dailyProgress.wordsPracticed += wordsPracticed;\n        dailyProgress.lessonsCompleted += lessonsCompleted;\n        dailyProgress.quizzesTaken += quizzesTaken;\n        dailyProgress.timeSpent += timeSpent;\n        dailyProgress.updatedAt = now;\n        // Update the record\n        this.progressData.dailyProgress[date] = DailyProgressSchema.parse(dailyProgress);\n        this.saveProgress();\n    }\n    /**\n     * Get daily progress for a specific date\n     * @param date The date in YYYY-MM-DD format\n     * @returns DailyProgress or null if not found\n     */\n    getDailyProgress(date) {\n        return this.progressData.dailyProgress[date] || null;\n    }\n    /**\n     * Get all daily progress records\n     * @returns Record of daily progress data\n     */\n    getAllDailyProgress() {\n        return this.progressData.dailyProgress;\n    }\n    /**\n     * Get daily progress for the last N days\n     * @param days Number of days to retrieve\n     * @returns Array of daily progress records\n     */\n    getRecentDailyProgress(days = 7) {\n        const today = new Date();\n        const result = [];\n        for (let i = 0; i < days; i++) {\n            const date = new Date(today);\n            date.setDate(today.getDate() - i);\n            const dateStr = date.toISOString().split('T')[0];\n            const progress = this.progressData.dailyProgress[dateStr];\n            if (progress) {\n                result.push(progress);\n            }\n        }\n        return result.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\n    }\n    //#endregion\n    //#region Overall Progress Tracking\n    /**\n     * Update overall progress with new activity\n     * @param params Object containing progress updates\n     */\n    updateOverallProgress(params) {\n        const now = new Date().toISOString();\n        const today = now.split('T')[0];\n        // Update overall progress\n        this.progressData.overallProgress.totalXP += params.xpEarned;\n        this.progressData.overallProgress.totalWordsPracticed += params.wordsPracticed || 0;\n        this.progressData.overallProgress.totalLessonsCompleted += params.lessonsCompleted || 0;\n        this.progressData.overallProgress.totalQuizzesTaken += params.quizzesTaken || 0;\n        this.progressData.overallProgress.totalTimeSpent += params.timeSpent;\n        this.progressData.overallProgress.lastActiveDate = now;\n        this.progressData.overallProgress.updatedAt = now;\n        // Update level based on total XP\n        const newLevel = calculateLevel(this.progressData.overallProgress.totalXP);\n        if (newLevel > this.progressData.overallProgress.currentLevel) {\n            this.progressData.overallProgress.currentLevel = newLevel;\n            // Level up event is handled by the UI\n        }\n        // Update streak information\n        this.updateStreak(today);\n        // Record daily progress\n        this.recordDailyProgress(today, params.xpEarned, params.wordsPracticed || 0, params.lessonsCompleted || 0, params.quizzesTaken || 0, params.timeSpent);\n        // Update learning session\n        learningSession.awardXP(params.xpEarned);\n        this.saveProgress();\n    }\n    /**\n     * Update streak information\n     * @param today Today's date in YYYY-MM-DD format\n     */\n    updateStreak(today) {\n        const yesterday = new Date();\n        yesterday.setDate(yesterday.getDate() - 1);\n        const yesterdayStr = yesterday.toISOString().split('T')[0];\n        // If this is the first activity, initialize streak\n        if (!this.progressData.overallProgress.lastActiveDate) {\n            this.progressData.overallProgress.currentStreak = 1;\n            this.progressData.overallProgress.longestStreak = 1;\n            return;\n        }\n        // Check if the last activity was yesterday\n        if (this.progressData.overallProgress.lastActiveDate === yesterdayStr) {\n            // Continue the streak\n            this.progressData.overallProgress.currentStreak++;\n        }\n        else if (this.progressData.overallProgress.lastActiveDate !== today) {\n            // Streak is broken\n            this.progressData.overallProgress.currentStreak = 1;\n        }\n        // Update longest streak if needed\n        if (this.progressData.overallProgress.currentStreak > this.progressData.overallProgress.longestStreak) {\n            this.progressData.overallProgress.longestStreak = this.progressData.overallProgress.currentStreak;\n        }\n    }\n    /**\n     * Get overall progress\n     * @returns OverallProgress\n     */\n    getOverallProgress() {\n        return this.progressData.overallProgress;\n    }\n    /**\n     * Get current level information\n     * @returns Object containing level information\n     */\n    getLevelInfo() {\n        const level = this.progressData.overallProgress.currentLevel;\n        const currentXP = this.progressData.overallProgress.totalXP;\n        const nextLevelXP = calculateXPForLevel(level + 1);\n        const currentLevelXP = calculateXPForLevel(level);\n        const xpInLevel = currentXP - currentLevelXP;\n        const levelSpan = nextLevelXP - currentLevelXP;\n        const progressPercentage = Math.min(100, Math.max(0, (xpInLevel / levelSpan) * 100));\n        return {\n            level,\n            currentXP,\n            nextLevelXP,\n            progressPercentage\n        };\n    }\n    /**\n     * Award XP for an achievement\n     * @param amount Amount of XP to award\n     * @param reason Reason for awarding XP\n     */\n    awardXP(amount, _reason) {\n        this.updateOverallProgress({\n            xpEarned: amount,\n            timeSpent: 0\n        });\n    }\n    //#endregion\n    //#region Progress Data Management\n    /**\n     * Load progress data from localStorage\n     */\n    loadProgress() {\n        try {\n            const savedData = LocalStorageManager.loadUserProgress();\n            if (savedData) {\n                // Validate and parse the saved data\n                const parsedData = ProgressDataSchema.safeParse(savedData);\n                if (parsedData.success) {\n                    this.progressData = parsedData.data;\n                }\n                else {\n                    // Invalid progress data, using default\n                    this.progressData = this.getDefaultProgressData();\n                }\n            }\n        }\n        catch (_error) {\n            // Error loading progress data\n            this.progressData = this.getDefaultProgressData();\n        }\n    }\n    /**\n     * Save progress data to localStorage\n     */\n    saveProgress() {\n        if (!browser)\n            return;\n        try {\n            LocalStorageManager.saveUserProgress(this.progressData);\n        }\n        catch (_error) {\n            // Error saving progress data\n        }\n    }\n    /**\n     * Export progress data as JSON\n     * @returns JSON string of progress data\n     */\n    exportProgress() {\n        return JSON.stringify(this.progressData, null, 2);\n    }\n    /**\n     * Import progress data from JSON\n     * @param jsonData JSON string of progress data\n     * @throws Error if import fails\n     */\n    importProgress(jsonData) {\n        try {\n            const parsedData = JSON.parse(jsonData);\n            const validatedData = ProgressDataSchema.parse(parsedData);\n            this.progressData = validatedData;\n            this.saveProgress();\n        }\n        catch (_error) {\n            // Error importing progress data\n            throw new Error('Failed to import progress data');\n        }\n    }\n    /**\n     * Reset all progress data\n     */\n    resetProgress() {\n        this.progressData = this.getDefaultProgressData();\n        this.saveProgress();\n    }\n    //#endregion\n    //#region Utility Methods\n    /**\n     * Get progress summary for dashboard display\n     * @returns Object containing key progress metrics\n     */\n    getProgressSummary() {\n        const levelInfo = this.getLevelInfo();\n        const overallProgress = this.getOverallProgress();\n        const today = new Date().toISOString().split('T')[0];\n        const dailyProgress = this.getDailyProgress(today) || { xpEarned: 0 };\n        return {\n            totalXP: overallProgress.totalXP,\n            currentLevel: levelInfo.level,\n            levelProgress: levelInfo.progressPercentage,\n            wordsPracticed: overallProgress.totalWordsPracticed,\n            lessonsCompleted: overallProgress.totalLessonsCompleted,\n            quizzesTaken: overallProgress.totalQuizzesTaken,\n            currentStreak: overallProgress.currentStreak,\n            longestStreak: overallProgress.longestStreak,\n            dailyGoalProgress: Math.min(100, (dailyProgress.xpEarned / learningSession.dailyTarget) * 100)\n        };\n    }\n    /**\n     * Get vocabulary mastery statistics\n     * @returns Object containing vocabulary mastery statistics\n     */\n    getVocabularyMasteryStats() {\n        const allItems = Object.values(this.progressData.vocabularyMastery);\n        const masteredItems = allItems.filter(item => item.isMastered).length;\n        const totalItems = allItems.length;\n        const averageMasteryLevel = totalItems > 0\n            ? allItems.reduce((sum, item) => sum + item.masteryLevel, 0) / totalItems\n            : 0;\n        const masteryPercentage = totalItems > 0\n            ? (masteredItems / totalItems) * 100\n            : 0;\n        return {\n            totalItems,\n            masteredItems,\n            masteryPercentage,\n            averageMasteryLevel\n        };\n    }\n    /**\n     * Get lesson completion statistics\n     * @returns Object containing lesson completion statistics\n     */\n    getLessonCompletionStats() {\n        const allLessons = Object.values(this.progressData.lessonProgress);\n        const completedLessons = allLessons.filter(lesson => lesson.status === 'completed').length;\n        const totalLessons = allLessons.length;\n        const completionPercentage = totalLessons > 0\n            ? (completedLessons / totalLessons) * 100\n            : 0;\n        return {\n            totalLessons,\n            completedLessons,\n            completionPercentage\n        };\n    }\n}\n// XP values for different actions\nProgressService.XP_VALUES = {\n    VOCABULARY_PRACTICE: 10,\n    VOCABULARY_MASTERED: 50,\n    LESSON_COMPLETED: 100,\n    QUIZ_COMPLETED: 150,\n    DAILY_GOAL: 200\n};\nexport const progressService = ProgressService.getInstance();\n//# sourceMappingURL=progress.js.map","/**\n * Type definitions for the Dynamic Lesson Generation system\n *\n * This file contains all TypeScript interfaces and types used in the lesson generation\n * system, ensuring type safety and clear contracts between components.\n */\n\nimport type { VocabularyItem, PartOfSpeech, VocabularyCategory } from '$lib/types/vocabulary';\nimport type { Lesson as _Lesson, LessonDifficulty as _LessonDifficulty, LessonType as _LessonType } from '$lib/schemas/lesson';\n\nexport type { VocabularyItem, PartOfSpeech, VocabularyCategory };\n\n\n/**\n * Lesson difficulty levels\n */\nexport type LessonDifficulty = 'A1' | 'A2' | 'B1' | 'B2' | 'C1';\n\n/**\n * Lesson types\n */\nexport type LessonType = 'vocabulary' | 'grammar' | 'mixed' | 'culture' | 'contextual' | 'conversation' | 'reading' | 'listening' | 'writing';\n\n/**\n * Template variable types\n */\nexport type TemplateVariableType = 'string' | 'number' | 'boolean' | 'array' | 'object';\n\n/**\n * Template variable definition\n */\nexport interface TemplateVariable {\n  name: string;\n  type: TemplateVariableType;\n  description: string;\n  required: boolean;\n  defaultValue?: string | number | boolean | object | unknown[];\n}\n\n/**\n * Lesson template structure\n */\nexport interface LessonTemplate {\n  id: string;\n  name: string;\n  description: string;\n  type: LessonType;\n  difficultyRange: [LessonDifficulty, LessonDifficulty];\n  template: string;\n  variables: TemplateVariable[];\n  exampleData?: Record<string, string | number | boolean | object | unknown[]>;\n}\n\n/**\n * Grammar query criteria\n */\nexport interface GrammarQueryCriteria {\n  difficulty?: LessonDifficulty;\n  partOfSpeech?: PartOfSpeech;\n  limit?: number;\n  conceptType?: string;\n}\n\n/**\n * Cultural grammar concept structure\n */\nexport interface CulturalGrammarConcept {\n  id: string;\n  name: {\n    bulgarian: string;\n    german: string;\n  };\n  description: {\n    bulgarian: string;\n    german: string;\n  };\n  difficulty: LessonDifficulty;\n  partOfSpeech: PartOfSpeech[];\n  culturalContext: {\n    bulgarianPerspective: string;\n    germanPerspective: string;\n    crossLinguisticExplanation: {\n      bgToDe: string;\n      deToBg: string;\n    };\n  };\n  examples: Array<{\n    bulgarian: string;\n    german: string;\n    explanationBgToDe: string;\n    explanationDeToBg: string;\n  }>;\n  commonMistakes: {\n    bgToDe: string[];\n    deToBg: string[];\n  };\n  relatedConcepts: string[];\n  metadata: Record<string, string | number | boolean | object | unknown[]>;\n}\n\n/**\n * Lesson generation parameters\n */\nexport interface LessonGenerationParams {\n  type: LessonType;\n  difficulty: LessonDifficulty;\n  criteria: {\n    categories?: VocabularyCategory[];\n    partOfSpeech?: PartOfSpeech;\n    difficulty?: LessonDifficulty;\n    limit?: number;\n    conceptType?: string;\n  };\n  userId: string;\n  metadata?: Record<string, string | number | boolean | object | unknown[]>;\n}\n\n/**\n * Generated lesson content section\n */\nexport interface GeneratedLessonSection {\n  id: string;\n  title: string;\n  content: string;\n  type: 'introduction' | 'vocabulary' | 'grammar' | 'exercise' | 'summary' | 'cultural';\n  metadata?: Record<string, string | number | boolean | object | unknown[]>;\n}\n\n/**\n * Generated lesson structure\n */\nexport interface GeneratedLesson {\n  id: string;\n  type: LessonType;\n  difficulty: LessonDifficulty;\n  title: string;\n  sections: GeneratedLessonSection[];\n  vocabulary: VocabularyItem[];\n  grammarConcepts: CulturalGrammarConcept[];\n  learningObjectives: string[];\n  metadata: Record<string, string | number | boolean | object | unknown[]>;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\n/**\n * User learning profile for adaptive learning\n */\nexport interface UserLearningProfile {\n  userId: string;\n  proficiency: Record<LessonDifficulty, number>;\n  learningHistory: Record<string, {\n    lastReviewed: Date | null;\n    reviewCount: number;\n    proficiency: number;\n    learningPhase: number;\n  }>;\n  preferences: {\n    lessonTypes: LessonType[];\n    difficultyPreferences: Record<LessonType, LessonDifficulty>;\n    learningGoals: string[];\n  };\n  metadata: Record<string, string | number | boolean | object | unknown[]>;\n}\n\n/**\n * Template rendering context\n */\nexport interface TemplateRenderingContext {\n  [key: string]: string | number | boolean | object | unknown[] | undefined;\n  sectionTitle?: string;\n  count?: number;\n  theme?: string;\n  difficulty?: LessonDifficulty;\n  vocabulary?: VocabularyItem[];\n  grammarConcept?: CulturalGrammarConcept;\n  learningTip?: string;\n  learningObjectives?: string[];\n}\n\n/**\n * Lesson generation algorithm options\n */\nexport interface LessonGenerationOptions {\n  useSpacedRepetition?: boolean;\n  difficultyAdjustment?: boolean;\n  culturalContext?: boolean;\n  personalizationLevel?: 'low' | 'medium' | 'high';\n  maxItems?: number;\n}\n\n/**\n * Enhanced lesson criteria (extends legacy format)\n */\nexport interface EnhancedLessonCriteria {\n  userId?: string;\n  type?: LessonType;\n  difficulty?: LessonDifficulty;\n  categories?: VocabularyCategory[];\n  partOfSpeech?: PartOfSpeech;\n  limit?: number;\n  conceptType?: string;\n  metadata?: Record<string, string | number | boolean | object | unknown[]>;\n}\n\n/**\n * Template repository interface\n */\nexport interface ILessonTemplateRepository {\n  getTemplate(type: LessonType, difficulty: LessonDifficulty): Promise<LessonTemplate>;\n  getTemplateById(templateId: string): Promise<LessonTemplate | undefined>;\n  getAllTemplates(): Promise<LessonTemplate[]>;\n  validateTemplate(template: LessonTemplate): boolean;\n}\n\n/**\n * Cultural grammar service interface\n */\nexport interface ICulturalGrammarService {\n  query(criteria: GrammarQueryCriteria): Promise<CulturalGrammarConcept[]>;\n  getAllConcepts(): Promise<CulturalGrammarConcept[]>;\n  conceptAppliesToPartOfSpeech(concept: CulturalGrammarConcept, partOfSpeech: PartOfSpeech): boolean;\n}\n\n/**\n * Template renderer interface\n */\nexport interface ITemplateRenderer {\n  render(template: LessonTemplate, data: TemplateRenderingContext): string;\n  validateTemplate(template: LessonTemplate): boolean;\n  validateData(template: LessonTemplate, data: TemplateRenderingContext): boolean;\n}\n\n/**\n * Lesson generation engine interface\n */\nexport interface ILessonGenerationEngine {\n  generateLesson(params: LessonGenerationParams, options?: LessonGenerationOptions): Promise<GeneratedLesson>;\n  generateThematicLesson(params: LessonGenerationParams, options?: LessonGenerationOptions): Promise<GeneratedLesson>;\n  generateGrammarLesson(params: LessonGenerationParams, options?: LessonGenerationOptions): Promise<GeneratedLesson>;\n  generateContextualLesson(params: LessonGenerationParams, options?: LessonGenerationOptions): Promise<GeneratedLesson>;\n  generateAdaptiveLesson(params: LessonGenerationParams, options?: LessonGenerationOptions): Promise<GeneratedLesson>;\n}\n\n/**\n * Utility type for template variable validation\n */\nexport type TemplateVariableValidator = (value: string | number | boolean | object | unknown[], variable: TemplateVariable) => boolean;\n\n/**\n * Error types for lesson generation\n */\nexport class LessonGenerationError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = 'LessonGenerationError';\n  }\n}\n\nexport class TemplateRenderingError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = 'TemplateRenderingError';\n  }\n}\n\nexport class DataValidationError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = 'DataValidationError';\n  }\n}\n\n/**\n * Utility functions for type validation\n */\nexport const isLessonDifficulty = (value: string): value is LessonDifficulty => {\n  return ['A1', 'A2', 'B1', 'B2', 'C1'].includes(value);\n};\n\nexport const isLessonType = (value: string): value is LessonType => {\n  return ['vocabulary', 'grammar', 'mixed', 'cultural', 'contextual'].includes(value);\n};\n\nexport const isPartOfSpeech = (value: string): value is PartOfSpeech => {\n  return ['noun', 'verb', 'adjective', 'adverb', 'preposition', 'conjunction', 'pronoun', 'interjection', 'article', 'numeral'].includes(value);\n};\n\nexport const isVocabularyCategory = (value: string): value is VocabularyCategory => {\n  return [\n    'home', 'family', 'food', 'travel', 'work', 'education', 'nature', 'animals',\n    'body', 'health', 'clothing', 'colors', 'numbers', 'time', 'weather', 'emotions',\n    'sports', 'hobbies', 'technology', 'transportation', 'culture', 'society',\n    'business', 'science', 'art', 'literature', 'history', 'geography', 'uncategorized'\n  ].includes(value);\n};","/**\n * LessonTemplateRepository - Service for managing and retrieving lesson templates\n *\n * This service handles the loading, validation, and selection of lesson templates\n * for dynamic lesson generation.\n */\n\nimport type {\n  LessonTemplate,\n  LessonType,\n  LessonDifficulty,\n  ILessonTemplateRepository\n} from './types';\nimport { LessonGenerationError, DataValidationError } from './types';\n\n/**\n * LessonTemplateRepository class\n *\n * Implements the ILessonTemplateRepository interface to provide template management\n * functionality for the dynamic lesson generation system.\n */\nexport class LessonTemplateRepository implements ILessonTemplateRepository {\n  private templates: LessonTemplate[] = [];\n  private _initialized = false;\n  private templateCache: Map<string, LessonTemplate> = new Map();\n  public _testTemplates?: LessonTemplate[];\n\n  /**\n   * Get the initialization status\n   */\n  get initialized(): boolean {\n    return this._initialized;\n  }\n\n  /**\n   * Initialize the template repository by loading templates\n   */\n  async initialize(): Promise<void> {\n    if (this._initialized) return;\n\n    try {\n      this.templates = await this.loadTemplates();\n      this._initialized = true;\n      this.cacheTemplates();\n    } catch (_error) {\n      throw new LessonGenerationError('Failed to initialize template repository');\n    }\n  }\n\n  /**\n   * Get a template by type and difficulty\n   * @param type - Lesson type\n   * @param difficulty - Lesson difficulty\n   * @returns Promise resolving to a lesson template\n   */\n  async getTemplate(type: LessonType, difficulty: LessonDifficulty): Promise<LessonTemplate> {\n    if (!this._initialized) {\n      await this.initialize();\n    }\n\n    // Check cache first\n    const cacheKey = `${type}-${difficulty}`;\n    if (this.templateCache.has(cacheKey)) {\n      return this.templateCache.get(cacheKey)!;\n    }\n\n    const matchingTemplates = this.templates.filter(template =>\n      template.type === type &&\n      this.isDifficultyInRange(difficulty, template.difficultyRange)\n    );\n\n    if (matchingTemplates.length === 0) {\n      throw new LessonGenerationError(\n        `No template found for type ${type} and difficulty ${difficulty}`\n      );\n    }\n\n    // Return random template from matching ones for variety\n    const selectedTemplate = matchingTemplates[\n      Math.floor(Math.random() * matchingTemplates.length)\n    ];\n\n    if (!selectedTemplate) {\n      throw new LessonGenerationError(`Failed to select a template for type ${type}`);\n    }\n\n    // Cache the selected template\n    this.templateCache.set(cacheKey, selectedTemplate);\n\n    return selectedTemplate;\n  }\n\n  /**\n   * Get a template by specific ID\n   * @param templateId - The unique identifier of the template\n   * @returns Promise resolving to the requested lesson template\n   */\n  async getTemplateById(templateId: string): Promise<LessonTemplate | undefined> {\n    if (!this._initialized) {\n      await this.initialize();\n    }\n\n    return this.templates.find(t => t.id === templateId);\n  }\n\n  /**\n   * Get all templates\n   * @returns Promise resolving to all lesson templates\n   */\n  async getAllTemplates(): Promise<LessonTemplate[]> {\n    if (!this.initialized) {\n      await this.initialize();\n    }\n    return [...this.templates];\n  }\n\n  /**\n   * Validate a template structure\n   * @param template - Template to validate\n   * @returns True if template is valid\n   * @throws DataValidationError if template is invalid\n   */\n  validateTemplate(template: LessonTemplate): boolean {\n    // Check required fields\n    if (!template.id || typeof template.id !== 'string') {\n      throw new DataValidationError('Template id is required and must be a string');\n    }\n\n    if (!template.name || typeof template.name !== 'string') {\n      throw new DataValidationError('Template name is required and must be a string');\n    }\n\n    if (!template.description || typeof template.description !== 'string') {\n      throw new DataValidationError('Template description is required and must be a string');\n    }\n\n    if (!template.type || !['vocabulary', 'grammar', 'mixed', 'cultural', 'contextual'].includes(template.type)) {\n      throw new DataValidationError('Template type is required and must be a valid LessonType');\n    }\n\n    if (!template.difficultyRange || !Array.isArray(template.difficultyRange) ||\n        template.difficultyRange.length !== 2) {\n      throw new DataValidationError('Template difficultyRange is required and must be an array of two elements');\n    }\n\n    if (!this.isValidDifficultyRange(template.difficultyRange)) {\n      throw new DataValidationError('Template difficultyRange must contain valid difficulty levels in ascending order');\n    }\n\n    if (!template.template || typeof template.template !== 'string') {\n      throw new DataValidationError('Template content is required and must be a string');\n    }\n\n    if (!template.variables || !Array.isArray(template.variables)) {\n      throw new DataValidationError('Template variables is required and must be an array');\n    }\n\n    // Validate variables\n    for (const variable of template.variables) {\n      if (!variable.name || typeof variable.name !== 'string') {\n        throw new DataValidationError(`Variable name is required and must be a string: ${JSON.stringify(variable)}`);\n      }\n\n      if (!variable.type || !['string', 'number', 'boolean', 'array', 'object'].includes(variable.type)) {\n        throw new DataValidationError(`Variable type is required and must be a valid TemplateVariableType: ${variable.name}`);\n      }\n\n      if (typeof variable.required !== 'boolean') {\n        throw new DataValidationError(`Variable required must be a boolean: ${variable.name}`);\n      }\n\n      if (variable.defaultValue !== undefined && !this.isValidDefaultValue(variable.defaultValue, variable.type)) {\n        throw new DataValidationError(`Variable defaultValue must match the specified type: ${variable.name}`);\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Load templates from the file system\n   * @returns Promise resolving to an array of lesson templates\n   */\n  private async loadTemplates(): Promise<LessonTemplate[]> {\n    try {\n      // In test environment, we might not have access to import.meta.glob\n      // so we'll use a fallback approach\n      if (import.meta.env?.MODE === 'test') {\n        // For testing, we'll check if we have any mock templates\n        if (this._testTemplates) {\n          return this._testTemplates;\n        }\n        return [this.createFallbackTemplate()];\n      }\n\n      // Import all template files dynamically\n      const templateModules = import.meta.glob('$lib/data/templates/**/*.json');\n\n      const templates: LessonTemplate[] = [];\n\n      for (const [_path, importFn] of Object.entries(templateModules)) {\n        try {\n          const module = await importFn() as { default: LessonTemplate };\n          const template = module.default;\n\n          if (this.validateTemplate(template)) {\n            templates.push(template);\n          } else {\n            // Skipping invalid template from ${path}\n          }\n        } catch (_error) {\n        }\n      }\n\n      if (templates.length === 0) {\n        // No valid templates found. Using fallback template.\n        return [this.createFallbackTemplate()];\n      }\n\n      return templates;\n    } catch (_error) {\n      return [this.createFallbackTemplate()];\n    }\n  }\n\n  /**\n   * Cache templates for faster access\n   */\n  private cacheTemplates(): void {\n    this.templateCache.clear();\n\n    for (const template of this.templates) {\n      // Cache by type-difficulty combinations\n      for (const difficulty of this.getDifficultiesInRange(template.difficultyRange)) {\n        const cacheKey = `${template.type}-${difficulty}`;\n        this.templateCache.set(cacheKey, template);\n      }\n    }\n  }\n\n  /**\n   * Check if a difficulty is within a range\n   * @param difficulty - Difficulty to check\n   * @param range - Difficulty range\n   * @returns True if difficulty is in range\n   */\n  private isDifficultyInRange(difficulty: LessonDifficulty, range: [LessonDifficulty, LessonDifficulty]): boolean {\n    const difficultyOrder: LessonDifficulty[] = ['A1', 'A2', 'B1', 'B2', 'C1'];\n    const minIndex = difficultyOrder.indexOf(range[0]);\n    const maxIndex = difficultyOrder.indexOf(range[1]);\n    const difficultyIndex = difficultyOrder.indexOf(difficulty);\n\n    return difficultyIndex >= minIndex && difficultyIndex <= maxIndex;\n  }\n\n  /**\n   * Get all difficulties in a range\n   * @param range - Difficulty range\n   * @returns Array of difficulties in range\n   */\n  private getDifficultiesInRange(range: [LessonDifficulty, LessonDifficulty]): LessonDifficulty[] {\n    const difficultyOrder: LessonDifficulty[] = ['A1', 'A2', 'B1', 'B2', 'C1'];\n    const minIndex = difficultyOrder.indexOf(range[0]);\n    const maxIndex = difficultyOrder.indexOf(range[1]);\n\n    return difficultyOrder.slice(minIndex, maxIndex + 1);\n  }\n\n  /**\n   * Check if a default value matches the variable type\n   * @param value - Value to check\n   * @param type - Expected type\n   * @returns True if value matches type\n   */\n  private isValidDefaultValue(value: string | number | boolean | object | unknown[], type: string): boolean {\n    switch (type) {\n      case 'string':\n        return typeof value === 'string';\n      case 'number':\n        return typeof value === 'number';\n      case 'boolean':\n        return typeof value === 'boolean';\n      case 'array':\n        return Array.isArray(value);\n      case 'object':\n        return typeof value === 'object' && value !== null && !Array.isArray(value);\n      default:\n        return false;\n    }\n  }\n\n  /**\n   * Check if a difficulty range is valid\n   * @param range - Difficulty range to validate\n   * @returns True if range is valid\n   */\n  private isValidDifficultyRange(range: [LessonDifficulty, LessonDifficulty]): boolean {\n    const difficultyOrder: LessonDifficulty[] = ['A1', 'A2', 'B1', 'B2', 'C1'];\n\n    const minIndex = difficultyOrder.indexOf(range[0]);\n    const maxIndex = difficultyOrder.indexOf(range[1]);\n\n    return minIndex !== -1 && maxIndex !== -1 && minIndex <= maxIndex;\n  }\n\n  /**\n   * Create a fallback template for error recovery\n   * @returns Fallback lesson template\n   */\n  private createFallbackTemplate(): LessonTemplate {\n    return {\n      id: 'fallback_template',\n      name: 'Fallback Template',\n      description: 'Fallback template used when no other templates are available',\n      type: 'vocabulary',\n      difficultyRange: ['A1', 'C1'],\n      template: '# {{sectionTitle}}\\n\\nThis lesson contains {{count}} vocabulary items.\\n\\n{{#each vocabulary}}\\n- {{german}} / {{bulgarian}}\\n{{/each}}',\n      variables: [\n        { name: 'sectionTitle', type: 'string', required: true, description: 'Title for the section' },\n        { name: 'count', type: 'number', required: true, description: 'Number of vocabulary items' },\n        { name: 'vocabulary', type: 'array', required: true, description: 'Array of vocabulary items' }\n      ]\n    };\n  }\n}\n\n/**\n * Singleton instance of LessonTemplateRepository\n */\nexport const lessonTemplateRepository = new LessonTemplateRepository();","/**\n * CulturalGrammarService - Service for managing and querying cultural grammar concepts\n *\n * This service provides access to grammar concepts that include cultural context and\n * cross-linguistic explanations between Bulgarian and German.\n */\n\nimport type {\n  CulturalGrammarConcept,\n  GrammarQueryCriteria,\n  // LessonDifficulty is unused\n  PartOfSpeech,\n  ICulturalGrammarService\n} from './types';\nimport { LessonGenerationError, DataValidationError } from './types';\n\n/**\n * CulturalGrammarService class\n *\n * Implements the ICulturalGrammarService interface to provide grammar concept\n * management functionality for the dynamic lesson generation system.\n */\nexport class CulturalGrammarService implements ICulturalGrammarService {\n  private grammarConcepts: CulturalGrammarConcept[] = [];\n  private _initialized = false;\n\n  /**\n   * Get the initialization status\n   */\n  get initialized(): boolean {\n    return this._initialized;\n  }\n\n  /**\n   * Initialize the service by loading grammar concepts\n   */\n  async initialize(): Promise<void> {\n    if (this._initialized) return;\n\n    try {\n      this.grammarConcepts = await this.loadGrammarData();\n      this._initialized = true;\n    } catch (_error) {\n      // Failed to initialize CulturalGrammarService\n      throw new LessonGenerationError('Failed to initialize grammar service');\n    }\n  }\n\n  /**\n   * Query grammar concepts based on criteria\n   * @param criteria - Query criteria\n   * @returns Promise resolving to an array of grammar concepts\n   */\n  async query(criteria: GrammarQueryCriteria): Promise<CulturalGrammarConcept[]> {\n    if (!this._initialized) {\n      await this.initialize();\n    }\n\n    return this.grammarConcepts.filter(concept => {\n      const difficultyMatch = criteria.difficulty ?\n        concept.difficulty === criteria.difficulty : true;\n\n      const posMatch = criteria.partOfSpeech ?\n        this.conceptAppliesToPartOfSpeech(concept, criteria.partOfSpeech) : true;\n\n      const conceptTypeMatch = criteria.conceptType ?\n        concept.id.includes(criteria.conceptType) || concept.relatedConcepts.includes(criteria.conceptType) : true;\n\n      return difficultyMatch && posMatch && conceptTypeMatch;\n    }).slice(0, criteria.limit || 1);\n  }\n\n  /**\n   * Get all grammar concepts\n   * @returns Promise resolving to all grammar concepts\n   */\n  async getAllConcepts(): Promise<CulturalGrammarConcept[]> {\n    if (!this._initialized) {\n      await this.initialize();\n    }\n    return [...this.grammarConcepts];\n  }\n\n  /**\n   * Check if a grammar concept applies to a specific part of speech\n   * @param concept - Grammar concept to check\n   * @param partOfSpeech - Part of speech to check\n   * @returns True if the concept applies to the part of speech\n   */\n  conceptAppliesToPartOfSpeech(concept: CulturalGrammarConcept, partOfSpeech: PartOfSpeech): boolean {\n    return concept.partOfSpeech.includes(partOfSpeech);\n  }\n\n  /**\n   * Load grammar data from the file system\n   * @returns Promise resolving to an array of grammar concepts\n   */\n  private async loadGrammarData(): Promise<CulturalGrammarConcept[]> {\n    try {\n      // In test environment, use fallback data\n      if (import.meta.env?.MODE === 'test') {\n        return this.getFallbackGrammarData();\n      }\n\n      // Load grammar data from JSON file\n      const data = await import('$lib/data/cultural-grammar.json');\n      const concepts = data.default.concepts || data.default;\n\n      if (!Array.isArray(concepts)) {\n        // Grammar data is not an array. Using fallback data.\n        return this.getFallbackGrammarData();\n      }\n\n      // Validate all concepts\n      const validConcepts = concepts.filter(concept => this.validateConcept(concept));\n\n      if (validConcepts.length === 0) {\n        // No valid grammar concepts found. Using fallback data.\n        return this.getFallbackGrammarData();\n      }\n\n      return validConcepts;\n    } catch (_error) {\n      // Error loading grammar data\n      return this.getFallbackGrammarData();\n    }\n  }\n\n  /**\n   * Validate a grammar concept structure\n   * @param concept - Concept to validate\n   * @returns True if concept is valid\n   * @throws DataValidationError if concept is invalid\n   */\n  private validateConcept(concept: any): concept is CulturalGrammarConcept {\n    // Check required fields\n    if (!concept.id || typeof concept.id !== 'string') {\n      throw new DataValidationError('Concept id is required and must be a string');\n    }\n\n    if (!concept.name || typeof concept.name !== 'object' ||\n        !concept.name.bulgarian || !concept.name.german) {\n      throw new DataValidationError('Concept name is required and must have bulgarian and german properties');\n    }\n\n    if (!concept.description || typeof concept.description !== 'object' ||\n        !concept.description.bulgarian || !concept.description.german) {\n      throw new DataValidationError('Concept description is required and must have bulgarian and german properties');\n    }\n\n    if (!concept.difficulty || !['A1', 'A2', 'B1', 'B2', 'C1'].includes(concept.difficulty)) {\n      throw new DataValidationError('Concept difficulty is required and must be a valid LessonDifficulty');\n    }\n\n    if (!concept.partOfSpeech || !Array.isArray(concept.partOfSpeech) ||\n        concept.partOfSpeech.length === 0) {\n      throw new DataValidationError('Concept partOfSpeech is required and must be a non-empty array');\n    }\n\n    if (!concept.culturalContext || typeof concept.culturalContext !== 'object') {\n      throw new DataValidationError('Concept culturalContext is required and must be an object');\n    }\n\n    if (!concept.examples || !Array.isArray(concept.examples) ||\n        concept.examples.length === 0) {\n      throw new DataValidationError('Concept examples is required and must be a non-empty array');\n    }\n\n    if (!concept.commonMistakes || typeof concept.commonMistakes !== 'object') {\n      throw new DataValidationError('Concept commonMistakes is required and must be an object');\n    }\n\n    if (!concept.relatedConcepts || !Array.isArray(concept.relatedConcepts)) {\n      throw new DataValidationError('Concept relatedConcepts is required and must be an array');\n    }\n\n    // Validate part of speech values\n    for (const pos of concept.partOfSpeech) {\n      if (!['noun', 'verb', 'adjective', 'adverb', 'preposition', 'conjunction', 'pronoun', 'interjection', 'article', 'numeral'].includes(pos)) {\n        throw new DataValidationError(`Invalid part of speech: ${pos}`);\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Get fallback grammar data for error recovery\n   * @returns Array of fallback grammar concepts\n   */\n  private getFallbackGrammarData(): CulturalGrammarConcept[] {\n    return [\n      {\n        id: 'fallback-article-usage',\n        name: {\n          bulgarian: '  ',\n          german: 'Artikelgebrauch'\n        },\n        description: {\n          bulgarian: '      ',\n          german: 'Grundlegender Artikelgebrauch im Deutschen'\n        },\n        difficulty: 'A1',\n        partOfSpeech: ['noun'],\n        culturalContext: {\n          bulgarianPerspective: '   ,       .',\n          germanPerspective: 'Im Deutschen sind Artikel obligatorisch, was fr bulgarische Lernende ungewohnt ist.',\n          crossLinguisticExplanation: {\n            bgToDe: '   .      der, die, das  .',\n            deToBg: 'Im Bulgarischen gibt es keine Artikel. Substantive werden ohne Artikel verwendet.'\n          }\n        },\n        examples: [\n          {\n            bulgarian: '   .',\n            german: 'Das Buch ist auf dem Tisch.',\n            explanationBgToDe: '   .     der/die/das.',\n            explanationDeToBg: 'Im Deutschen gibt es Artikel (das, dem), im Bulgarischen nicht.'\n          }\n        ],\n        commonMistakes: {\n          bgToDe: ['  ', ' '],\n          deToBg: ['   ']\n        },\n        relatedConcepts: ['noun-gender'],\n        metadata: {}\n      }\n    ];\n  }\n}\n\n/**\n * Singleton instance of CulturalGrammarService\n */\nexport const culturalGrammarService = new CulturalGrammarService();","/**\n * Template Language Adapter\n *\n * This utility provides language-specific rendering for lesson templates,\n * allowing content to adapt based on the current language direction.\n */\n\nimport { appState } from '../../state/app-state';\n\n/**\n * Get the source language text based on current direction\n * @param item The vocabulary item\n * @returns The text in the source language\n */\nexport function getSourceText(item: { german: string; bulgarian: string }): string {\n    return appState.languageMode === 'DE_BG' ? item.german : item.bulgarian;\n}\n\n/**\n * Get the target language text based on current direction\n * @param item The vocabulary item\n * @returns The text in the target language\n */\nexport function getTargetText(item: { german: string; bulgarian: string }): string {\n    return appState.languageMode === 'DE_BG' ? item.bulgarian : item.german;\n}\n\n/**\n * Get the source language code based on current direction\n * @returns The source language code ('de' or 'bg')\n */\nexport function getSourceLanguage(): string {\n    return appState.languageMode === 'DE_BG' ? 'de' : 'bg';\n}\n\n/**\n * Get the target language code based on current direction\n * @returns The target language code ('de' or 'bg')\n */\nexport function getTargetLanguage(): string {\n    return appState.languageMode === 'DE_BG' ? 'bg' : 'de';\n}\n\n/**\n * Get the source language name based on current direction\n * @returns The source language name ('German' or 'Bulgarian')\n */\nexport function getSourceLanguageName(): string {\n    return appState.languageMode === 'DE_BG' ? 'German' : 'Bulgarian';\n}\n\n/**\n * Get the target language name based on current direction\n * @returns The target language name ('German' or 'Bulgarian')\n */\nexport function getTargetLanguageName(): string {\n    return appState.languageMode === 'DE_BG' ? 'Bulgarian' : 'German';\n}\n\n/**\n * Get the direction arrow based on current direction\n * @returns The direction arrow ('' or '')\n */\nexport function getDirectionArrow(): string {\n    return appState.languageMode === 'DE_BG' ? '' : '';\n}\n\n/**\n * Get the direction text based on current direction\n * @returns The direction text ('DEBG' or 'BGDE')\n */\nexport function getDirectionText(): string {\n    return appState.languageMode === 'DE_BG' ? 'DEBG' : 'BGDE';\n}\n\n/**\n * Get the opposite direction text\n * @returns The opposite direction text ('DEBG' or 'BGDE')\n */\nexport function getOppositeDirectionText(): string {\n    return appState.languageMode === 'DE_BG' ? 'BGDE' : 'DEBG';\n}\n\n/**\n * Get the language-specific property from an object\n * @param obj The object with language properties\n * @param property The base property name\n * @returns The value for the current source language\n */\nexport function getLanguageProperty(obj: any, property: string): string {\n    if (!obj) return '';\n\n    const sourceLang = getSourceLanguage();\n\n    // Try direct property first (e.g., description.de)\n    if (obj[`${property}.${sourceLang}`]) {\n        return obj[`${property}.${sourceLang}`];\n    }\n\n    // Try nested property (e.g., description.german)\n    if (obj[property] && obj[property][sourceLang]) {\n        return obj[property][sourceLang];\n    }\n\n    // Try simple property (e.g., description)\n    if (obj[property]) {\n        return obj[property];\n    }\n\n    return '';\n}\n\n/**\n * Get the opposite language property from an object\n * @param obj The object with language properties\n * @param property The base property name\n * @returns The value for the current target language\n */\nexport function getOppositeLanguageProperty(obj: any, property: string): string {\n    if (!obj) return '';\n\n    const targetLang = getTargetLanguage();\n\n    // Try direct property first (e.g., description.bg)\n    if (obj[`${property}.${targetLang}`]) {\n        return obj[`${property}.${targetLang}`];\n    }\n\n    // Try nested property (e.g., description.bulgarian)\n    if (obj[property] && obj[property][targetLang]) {\n        return obj[property][targetLang];\n    }\n\n    return '';\n}\n\n/**\n * Format a bilingual example\n * @param example The example object with german and bulgarian text\n * @returns Formatted example string\n */\nexport function formatBilingualExample(example: { german: string; bulgarian: string }): string {\n    if (!example) return '';\n\n    const sourceText = getSourceText(example);\n    const targetText = getTargetText(example);\n\n    return `- ${sourceText}\\n- ${targetText}`;\n}\n\n/**\n * Get the appropriate template for the current language direction\n * @param templateDE The German template\n * @param templateBG The Bulgarian template\n * @returns The appropriate template based on current direction\n */\nexport function getDirectionalTemplate(templateDE: string, templateBG: string): string {\n    return appState.languageMode === 'DE_BG' ? templateDE : templateBG;\n}","/**\n * TemplateRenderer - Service for rendering lesson templates with data\n *\n * This service provides template rendering functionality with support for variables,\n * conditionals, loops, and language-specific rendering for dynamic lesson generation.\n */\n\nimport type {\n  LessonTemplate,\n  TemplateRenderingContext,\n  ITemplateRenderer\n} from './types';\nimport { TemplateRenderingError, DataValidationError } from './types';\nimport {\n  getSourceText,\n  getTargetText,\n  getSourceLanguage,\n  getTargetLanguage,\n  getSourceLanguageName,\n  getTargetLanguageName,\n  getDirectionArrow,\n  getDirectionText,\n  getOppositeDirectionText,\n  getLanguageProperty,\n  getOppositeLanguageProperty,\n  formatBilingualExample,\n  getDirectionalTemplate\n} from './template-language-adapter';\n\n/**\n * TemplateRenderer class\n *\n * Implements the ITemplateRenderer interface to provide template rendering\n * functionality for the dynamic lesson generation system.\n */\nexport class TemplateRenderer implements ITemplateRenderer {\n  /**\n   * Render a template with the provided data\n   * @param template - Lesson template to render\n   * @param data - Data to render into the template\n   * @returns Rendered content as a string\n   */\n  render(template: LessonTemplate, data: TemplateRenderingContext): string {\n    this.validateData(template, data);\n\n    try {\n      return this.renderTemplate(template.template, data);\n    } catch (error) {\n      if (error instanceof TemplateRenderingError) {\n        throw error;\n      }\n      throw new TemplateRenderingError(`Template rendering failed: ${error instanceof Error ? error.message : String(error)}`);\n    }\n  }\n\n  /**\n   * Validate template data against template variables\n   * @param template - Lesson template\n   * @param data - Data to validate\n   * @returns True if data is valid\n   * @throws DataValidationError if data is invalid\n   */\n  validateData(template: LessonTemplate, data: TemplateRenderingContext): boolean {\n    for (const variable of template.variables) {\n      const value = data[variable.name];\n      if (variable.required && value === undefined) {\n        throw new DataValidationError(`Required variable '${variable.name}' is missing`);\n      }\n\n      if (value !== undefined && !this.isValidValue(value, variable.type)) {\n        throw new DataValidationError(`Variable '${variable.name}' must be of type ${variable.type}`);\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Validate a template structure\n   * @param template - Template to validate\n   * @returns True if template is valid\n   */\n  validateTemplate(template: LessonTemplate): boolean {\n    if (!template.template || typeof template.template !== 'string') {\n      throw new DataValidationError('Template content is required and must be a string');\n    }\n\n    if (!template.variables || !Array.isArray(template.variables)) {\n      throw new DataValidationError('Template variables is required and must be an array');\n    }\n\n    return true;\n  }\n\n  /**\n   * Render a template string with the given data\n   * @param templateString - Template string to render\n   * @param data - Data for rendering\n   * @returns Rendered content\n   */\n  private renderTemplate(templateString: string, data: TemplateRenderingContext): string {\n    let content = templateString;\n    let previousContent: string;\n    let passCount = 0;\n    const maxPasses = 20; // Increased to support deeper nesting\n\n    do {\n      previousContent = content;\n\n      // Process loops (they may contain conditionals and variables)\n      content = this.processLoops(content, data);\n\n      // Process conditionals (they may contain variables)\n      content = this.processConditionals(content, data);\n\n      // Process variables\n      content = this.processVariables(content, data);\n\n      passCount++;\n\n      // Stop if we've done too many passes\n      if (passCount >= maxPasses) {\n        // Maximum template processing passes reached - this is expected for complex templates\n        break;\n      }\n\n    } while (content !== previousContent);\n\n    return content;\n  }\n\n  /**\n   * Resolve a variable value from data, supporting dotted notation\n   * @param path - Variable path (e.g. \"user.name\")\n   * @param data - Data context\n   * @returns The resolved value or undefined\n   */\n  private resolveValue(path: string, data: TemplateRenderingContext): string | number | boolean | object | unknown[] | undefined {\n    if (data[path] !== undefined) return data[path];\n\n    if (!path.includes('.')) return undefined;\n\n    return path.split('.').reduce((obj: any, key) => {\n      return (obj && typeof obj === 'object') ? obj[key] : undefined;\n    }, data);\n  }\n\n  /**\n   * Process variables in template content\n   * @param content - Template content\n   * @param data - Data for rendering\n   * @returns Content with variables replaced\n   */\n  private processVariables(content: string, data: TemplateRenderingContext): string {\n    // Add language adapter functions to the data context\n    const extendedData: TemplateRenderingContext = {\n      ...data,\n      getSourceText,\n      getTargetText,\n      getSourceLanguage,\n      getTargetLanguage,\n      getSourceLanguageName,\n      getTargetLanguageName,\n      getDirectionArrow,\n      getDirectionText,\n      getOppositeDirectionText,\n      getLanguageProperty,\n      getOppositeLanguageProperty,\n      formatBilingualExample,\n      getDirectionalTemplate\n    };\n\n    // Updated regex to support dotted paths\n    return content.replace(/\\{\\{\\s*([a-zA-Z_][a-zA-Z0-9_.]*)\\s*\\}\\}/g, (_match, variableName) => {\n      // Skip special template variables\n      if (variableName.startsWith('@') || variableName === 'this' || variableName === 'else') {\n        return _match;\n      }\n\n      const value = this.resolveValue(variableName, extendedData);\n\n      if (value === undefined) {\n        // If it's a dotted path that failed, it might be optional, but strict mode says throw.\n        // However, for single level variables, we must throw.\n        // Let's stick to the requirement: throw if undefined.\n        throw new TemplateRenderingError(`Variable '${variableName}' is not defined`);\n      }\n\n      if (typeof value === 'object' && value !== null && typeof value !== 'function') {\n        throw new TemplateRenderingError(`Variable '${variableName}' is an object and cannot be rendered directly`);\n      }\n\n      // Handle function calls\n      if (typeof value === 'function') {\n        try {\n          return String(value());\n        } catch (error) {\n          throw new TemplateRenderingError(`Function '${variableName}' failed: ${error instanceof Error ? error.message : String(error)}`);\n        }\n      }\n\n      return String(value);\n    });\n  }\n\n  /**\n   * Process conditional blocks in template content\n   * @param content - Template content\n   * @param data - Data for rendering\n   * @returns Content with conditionals processed\n   */\n  private processConditionals(content: string, data: TemplateRenderingContext): string {\n    // Process {{#unless variable}}...{{/unless}} blocks\n    // Updated regex to support dotted paths ([@a-zA-Z_][a-zA-Z0-9_.]*)\n    content = content.replace(/\\{\\{\\s*#unless\\s+([@a-zA-Z_][a-zA-Z0-9_.]*)\\s*\\}\\}((?:(?!\\{\\{\\s*#unless)[\\s\\S])*?)\\{\\{\\s*\\/unless\\s*\\}\\}/g, (_match, variableName, blockContent) => {\n      const value = this.resolveValue(variableName, data);\n      const condition = Boolean(value) && value !== 'false' && value !== '0';\n      return condition ? '' : this.renderTemplate(blockContent, data);\n    });\n\n    // Process {{#if variable}}...{{/if}} blocks (handling optional {{else}})\n    // Updated regex to support dotted paths\n    content = content.replace(/\\{\\{\\s*#if\\s+([@a-zA-Z_][a-zA-Z0-9_.]*)\\s*\\}\\}((?:(?!\\{\\{\\s*#if)[\\s\\S])*?)\\{\\{\\s*\\/if\\s*\\}\\}/g, (_match, variableName, fullBlockContent) => {\n      const value = this.resolveValue(variableName, data);\n      const condition = Boolean(value) && value !== 'false' && value !== '0';\n\n      // Check for {{else}} block\n      const elseSplit = fullBlockContent.split(/\\{\\{\\s*else\\s*\\}\\}/);\n\n      if (elseSplit.length > 1) {\n        const trueBlock = elseSplit[0];\n        const falseBlock = elseSplit.slice(1).join('{{else}}'); // Rejoin if multiple elses (though invalid)\n        return condition ? this.renderTemplate(trueBlock, data) : this.renderTemplate(falseBlock, data);\n      }\n\n      return condition ? this.renderTemplate(fullBlockContent, data) : '';\n    });\n\n    return content;\n  }\n\n  /**\n   * Process loop blocks in template content\n   * @param content - Template content\n   * @param data - Data for rendering\n   * @returns Content with loops processed\n   */\n  private processLoops(content: string, data: TemplateRenderingContext): string {\n    // Use a regex that targets innermost loops first to handle nesting\n    // Matches {{#each var}} content {{/each}} where content doesn't contain another {{#each}}\n    const eachRegex = /\\{\\{\\s*#each\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*\\}\\}((?:(?!\\{\\{\\s*#each)[\\s\\S])*?)\\{\\{\\s*\\/each\\s*\\}\\}/g;\n    let result = content;\n    let match;\n\n    while ((match = eachRegex.exec(result)) !== null) {\n      const fullMatch = match[0];\n      const arrayName = match[1];\n      const blockContent = match[2];\n      \n      if (!arrayName) continue;\n\n      const arrayValue = (data as any)[arrayName];\n\n      // Skip processing if the variable is not defined\n      if (arrayValue === undefined) {\n        eachRegex.lastIndex = 0;\n        result = result.replace(fullMatch, '');\n        continue;\n      }\n\n      if (!Array.isArray(arrayValue)) {\n        // If we are here, it means validation passed but data is inconsistent or we are testing processLoops directly\n        // Throw error to satisfy \"should throw error for non-array\" test case when invoked directly\n        throw new TemplateRenderingError(`Variable '${arrayName}' must be an array for #each loop`);\n      }\n\n      if (arrayValue.length === 0) {\n        result = result.replace(fullMatch, '');\n        eachRegex.lastIndex = 0;\n        continue;\n      }\n\n      const renderedItems = arrayValue.map((item, index) => {\n        // Create a new context for each iteration\n        const iterationContext: TemplateRenderingContext = {\n          ...data,\n          // If item is object, spread it. If primitive, put in 'this'\n          // BUT: also need to support 'this' for objects if template uses {{this.prop}}\n          // The robust way: 'this': item, and spread properties if object\n          'this': item,\n          '@index': index,\n          '@first': index === 0,\n          '@last': index === arrayValue.length - 1\n        };\n\n        if (typeof item === 'object' && item !== null) {\n            Object.assign(iterationContext, item);\n        }\n\n        // We need to manually process {{this}} and @ variables BEFORE recursion\n        // because renderTemplate might not handle them if they are not in \"variables\" definition of template schema\n        // or simply to ensure they are bound to THIS iteration context immediately.\n        let processedBlock = blockContent || '';\n\n        \n        // Replace special variables eagerly in this block\n        // This is crucial because renderTemplate() recursion might treat them as standard variables\n        processedBlock = processedBlock.replace(/\\{\\{\\s*this\\s*\\}\\}/g, String(item));\n        processedBlock = processedBlock.replace(/\\{\\{\\s*@index\\s*\\}\\}/g, String(index));\n        processedBlock = processedBlock.replace(/\\{\\{\\s*@first\\s*\\}\\}/g, String(index === 0));\n        processedBlock = processedBlock.replace(/\\{\\{\\s*@last\\s*\\}\\}/g, String(index === arrayValue.length - 1));\n\n        // Now recursively render the rest (conditionals, other variables)\n        return this.renderTemplate(processedBlock, iterationContext);\n      }).join('');\n\n      result = result.replace(fullMatch, renderedItems);\n      eachRegex.lastIndex = 0; // Reset regex index after replacement\n    }\n\n    return result;\n  }\n\n  /**\n   * Check if a value is valid for the specified type\n   * @param value - Value to check\n   * @param type - Expected type\n   * @returns True if value is valid for the type\n   */\n  private isValidValue(value: string | number | boolean | object | unknown[], type: string): boolean {\n    switch (type) {\n      case 'string':\n        return typeof value === 'string';\n      case 'number':\n        return typeof value === 'number' && !isNaN(value);\n      case 'boolean':\n        return typeof value === 'boolean';\n      case 'array':\n        return Array.isArray(value);\n      case 'object':\n        return typeof value === 'object' && value !== null && !Array.isArray(value);\n      default:\n        return false;\n    }\n  }\n}\n\n/**\n * Singleton instance of TemplateRenderer\n */\nexport const templateRenderer = new TemplateRenderer();","/**\n * LessonGenerationEngine - Core service for generating dynamic lessons\n *\n * This service coordinates the lesson generation process by using:\n * 1. LessonTemplateRepository to select appropriate templates\n * 2. VocabularyService to fetch vocabulary items\n * 3. CulturalGrammarService to fetch grammar concepts\n * 4. TemplateRenderer to generate the final lesson content\n */\n\nimport { v4 as uuidv4 } from 'uuid';\nimport type {\n  ILessonGenerationEngine,\n  LessonGenerationParams,\n  LessonGenerationOptions,\n  GeneratedLesson,\n  GeneratedLessonSection,\n  TemplateRenderingContext,\n  CulturalGrammarConcept,\n  ILessonTemplateRepository,\n  ICulturalGrammarService,\n  ITemplateRenderer,\n  LessonDifficulty\n} from './types';\nimport { lessonTemplateRepository } from './lesson-templates';\nimport { culturalGrammarService } from './cultural-grammar';\nimport { templateRenderer } from './template-renderer';\nimport {\n  loadVocabulary,\n  loadVocabularyByCategory,\n  loadVocabularyBySearch,\n  getRandomVocabulary\n} from '../../data/loader';\nimport type { VocabularyItem, PartOfSpeech as _PartOfSpeech } from '$lib/types/vocabulary';\nimport type { VocabularyCategory } from '$lib/schemas/vocabulary';\n\n/**\n * LessonGenerationEngine class\n *\n * Implements the ILessonGenerationEngine interface to provide core lesson generation logic.\n */\nexport class LessonGenerationEngine implements ILessonGenerationEngine {\n  private templateRepository: ILessonTemplateRepository;\n  private grammarService: ICulturalGrammarService;\n  private renderer: ITemplateRenderer;\n  private vocabularyCache: VocabularyItem[] | null = null;\n\n  /**\n   * Initialize with dependencies\n   *\n   * @param templateRepository - Repository for lesson templates\n   * @param grammarService - Service for grammar concepts\n   * @param renderer - Service for template rendering\n   * @param vocabularyServicePromise - Promise resolving to VocabularyService instance\n   */\n  constructor(\n    templateRepository: ILessonTemplateRepository = lessonTemplateRepository,\n    grammarService: ICulturalGrammarService = culturalGrammarService,\n    renderer: ITemplateRenderer = templateRenderer\n  ) {\n    this.templateRepository = templateRepository;\n    this.grammarService = grammarService;\n    this.renderer = renderer;\n  }\n\n  /**\n   * Generate a lesson based on parameters and options\n   *\n   * @param params - Parameters for lesson generation\n   * @param options - Options for generation algorithm\n   * @returns Generated lesson\n   */\n  async generateLesson(\n    params: LessonGenerationParams,\n    options: LessonGenerationOptions = {}\n  ): Promise<GeneratedLesson> {\n    try {\n      const normalizedParams: LessonGenerationParams = {\n        ...params,\n        type: this.normalizeLessonType(params.type),\n        criteria: {\n          ...params.criteria,\n          categories: this.normalizeCategories(params.criteria.categories)\n        }\n      };\n\n      // Dispatch to specific generation method based on lesson type\n      switch (normalizedParams.type) {\n        case 'vocabulary':\n          return this.generateThematicLesson(normalizedParams, options);\n        case 'grammar':\n          return this.generateGrammarLesson(normalizedParams, options);\n        case 'culture':\n          return this.generateContextualLesson(normalizedParams, options);\n        case 'mixed':\n          return this.generateContextualLesson(normalizedParams, options);\n        default:\n          // Default to thematic/vocabulary if type is unknown or general\n          return this.generateThematicLesson(normalizedParams, options);\n      }\n    } catch (_error) {\n      // Error handling is done by throwing a new error with the original message\n      const error = _error as Error;\n      throw new Error(`Failed to generate lesson: ${error.message}`);\n    }\n  }\n\n  /**\n   * Generate a thematic vocabulary lesson\n   *\n   * @param params - Parameters for lesson generation\n   * @param options - Options for generation algorithm\n   * @returns Generated lesson\n   */\n  async generateThematicLesson(\n    params: LessonGenerationParams,\n    options: LessonGenerationOptions = {}\n  ): Promise<GeneratedLesson> {\n    // 1. Determine Lesson Structure based on metadata or defaults\n    // A standard thematic lesson has an Introduction and a Practice section\n    const includePractice = params.metadata?.['includePractice'] !== false;\n    const includeReview = params.metadata?.['includeReview'] === true;\n\n    const sections: GeneratedLessonSection[] = [];\n    const allVocabularyItems: VocabularyItem[] = [];\n    let learningObjectives: string[] = [];\n\n    // 2. Fetch Vocabulary\n    // Load vocabulary data if not already cached\n    if (!this.vocabularyCache) {\n      const vocabulary = await loadVocabulary();\n      this.vocabularyCache = vocabulary.items.map(item => this.normalizeVocabularyItem(item));\n    }\n    const limit = params.criteria.limit || options.maxItems || 10;\n    const numericDifficulty = this.mapDifficultyToNumber(params.difficulty);\n    \n    let vocabularyItems: VocabularyItem[] = [];\n    \n    // Smart Selection:\n    // - If categories provided, prioritize them\n    // - If partOfSpeech provided, filter by it\n    // - Ensure difficulty match\n    \n    if (params.criteria.categories && params.criteria.categories.length > 0) {\n      // Fetch for each category and combine\n      for (const category of params.criteria.categories) {\n        // We'll use searchVocabulary for more granular control if needed,\n        // but getVocabularyByCategory is optimized for this\n        const items = await loadVocabularyByCategory(category, {\n          difficulty: numericDifficulty,\n          limit: Math.ceil(limit / params.criteria.categories.length)\n        });\n        \n        // Filter by POS if requested, using validation method\n        const filteredItems = params.criteria.partOfSpeech\n          ? items.filter(i => this.validatePartOfSpeech(i.partOfSpeech, i.id) === params.criteria.partOfSpeech)\n          : items;\n          \n        vocabularyItems = [...vocabularyItems, ...this.normalizeVocabularyList(filteredItems)];\n      }\n    } else {\n      // Fallback: Random but respect POS, using validation method\n      if (params.criteria.partOfSpeech) {\n        const result = await loadVocabularyBySearch({\n           difficulty: numericDifficulty,\n           partOfSpeech: params.criteria.partOfSpeech ?? undefined,\n           limit: limit\n         });\n        // Apply validation to ensure correct POS filtering\n        vocabularyItems = this.normalizeVocabularyList(result.items.filter(i =>\n          this.validatePartOfSpeech(i.partOfSpeech, i.id) === params.criteria.partOfSpeech\n        ));\n      } else {\n        vocabularyItems = this.normalizeVocabularyList(await getRandomVocabulary(limit, {\n          difficulty: numericDifficulty\n        }));\n      }\n    }\n    \n    // Ensure we respect the limit\n    vocabularyItems = this.normalizeVocabularyList(vocabularyItems.slice(0, limit));\n    allVocabularyItems.push(...vocabularyItems);\n\n    // 3. Generate Introduction Section\n    try {\n      // We explicitly look for the 'vocabulary-intro' template we created\n      const introTemplate = await this.templateRepository.getTemplateById('vocabulary-intro')\n        || await this.templateRepository.getTemplate('vocabulary', params.difficulty);\n      \n      const themeName = params.criteria.categories?.map(c => c.charAt(0).toUpperCase() + c.slice(1)).join(', ') || 'General';\n      \n      // Enhance vocabulary items with corrected part-of-speech and grammar info\n      const enhancedVocabularyItems = vocabularyItems.map(item => ({\n        ...item,\n        correctedPartOfSpeech: this.correctPartOfSpeech(this.validatePartOfSpeech(item.partOfSpeech, item.id)),\n        grammarInfo: this.getFallbackGrammarInfo(this.validatePartOfSpeech(item.partOfSpeech, item.id))\n      }));\n\n      const introContext: TemplateRenderingContext = {\n        sectionTitle: `Vocabulary: ${themeName}`,\n        count: vocabularyItems.length,\n        theme: themeName,\n        difficulty: params.difficulty,\n        vocabulary: enhancedVocabularyItems,\n        learningTip: 'Focus on the gender of nouns (der, die, das) as you learn them.',\n        learningObjectives: [\n          `Learn ${vocabularyItems.length} new words related to ${themeName}`,\n          'Practice pronunciation and usage'\n        ]\n      };\n      \n      learningObjectives = [...introContext.learningObjectives || []];\n\n      const introContent = this.renderer.render(introTemplate, introContext);\n      \n      sections.push({\n        id: uuidv4(),\n        title: introContext.sectionTitle || 'Introduction',\n        content: introContent,\n        type: 'introduction',\n        metadata: { templateId: introTemplate.id }\n      });\n    } catch (_error) {\n      // Intro section generation failed, but we continue with other sections\n      // Continue or throw depending on severity. Here we log and continue if possible.\n    }\n\n    // 4. Generate Practice Section (if requested)\n    if (includePractice && vocabularyItems.length > 0) {\n      try {\n        const practiceTemplate = await this.templateRepository.getTemplateById('vocabulary-practice')\n          || await this.templateRepository.getTemplate('vocabulary', params.difficulty);\n\n        // Enhance vocabulary items with corrected part-of-speech and grammar info\n        const enhancedVocabularyItems = vocabularyItems.map(item => ({\n          ...item,\n          correctedPartOfSpeech: this.correctPartOfSpeech(this.validatePartOfSpeech(item.partOfSpeech, item.id)),\n          grammarInfo: this.getFallbackGrammarInfo(this.validatePartOfSpeech(item.partOfSpeech, item.id))\n        }));\n\n        const practiceContext: TemplateRenderingContext = {\n          sectionTitle: 'Practice Exercises',\n          instructions: 'Test your knowledge of the new words.',\n          vocabulary: enhancedVocabularyItems\n        };\n\n        const practiceContent = this.renderer.render(practiceTemplate, practiceContext);\n\n        sections.push({\n          id: uuidv4(),\n          title: 'Practice',\n          content: practiceContent,\n          type: 'exercise',\n          metadata: { templateId: practiceTemplate.id }\n        });\n      } catch (_error) {\n        // Practice section generation failed, but we continue with other sections\n      }\n    }\n\n    // 5. Generate Review Section (if requested)\n    if (includeReview) {\n      try {\n        const reviewTemplate = await this.templateRepository.getTemplateById('vocabulary-review')\n          || await this.templateRepository.getTemplate('vocabulary', params.difficulty);\n\n        // Fetch some older vocabulary for review (mocking this logic for now)\n        // In a real app, this would come from the user's learning history (UserLearningProfile)\n        // For now, we'll just grab some random words different from the main vocabulary\n        const reviewItems = this.normalizeVocabularyList(await getRandomVocabulary(5, {\n          difficulty: numericDifficulty\n        }));\n\n        // Enhance review items with corrected part-of-speech and grammar info\n        const enhancedReviewItems = reviewItems.map(item => ({\n          ...item,\n          correctedPartOfSpeech: this.correctPartOfSpeech(this.validatePartOfSpeech(item.partOfSpeech, item.id)),\n          grammarInfo: this.getFallbackGrammarInfo(this.validatePartOfSpeech(item.partOfSpeech, item.id))\n        }));\n\n        const reviewContext: TemplateRenderingContext = {\n          sectionTitle: 'Review',\n          context: 'Previous Lessons',\n          vocabulary: enhancedReviewItems\n        };\n\n        const reviewContent = this.renderer.render(reviewTemplate, reviewContext);\n\n        sections.push({\n          id: uuidv4(),\n          title: 'Review',\n          content: reviewContent,\n          type: 'summary', // using summary type for review for now\n          metadata: { templateId: reviewTemplate.id }\n        });\n      } catch (_error) {\n        // Review section generation failed, but we continue with other sections\n      }\n    }\n\n    // 6. Construct Final Lesson Object\n    return {\n      id: uuidv4(),\n      type: params.type,\n      difficulty: params.difficulty,\n      title: `Thematic Lesson: ${params.criteria.categories?.join(', ') || 'General'}`,\n      sections: sections,\n      vocabulary: allVocabularyItems,\n      grammarConcepts: [],\n      learningObjectives: learningObjectives,\n      metadata: params.metadata || {},\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n  }\n\n  /**\n   * Generate a grammar-focused lesson\n   *\n   * @param params - Parameters for lesson generation\n   * @param options - Options for generation algorithm\n   * @returns Generated lesson\n   */\n  async generateGrammarLesson(\n    params: LessonGenerationParams,\n    _options: LessonGenerationOptions = {}\n  ): Promise<GeneratedLesson> {\n    const includePractice = params.metadata?.['includePractice'] !== false;\n    const includeComparison = params.metadata?.['includeComparison'] !== false;\n\n    const sections: GeneratedLessonSection[] = [];\n    \n    // 1. Fetch Grammar Concepts\n    const queryParams: any = {\n      difficulty: params.difficulty\n    };\n    if (params.criteria.partOfSpeech) queryParams.partOfSpeech = params.criteria.partOfSpeech;\n    if (params.criteria.conceptType) queryParams.conceptType = params.criteria.conceptType;\n\n    // We try to find a concept matching specific criteria, or get a suitable one for the level\n    const grammarConcepts = await this.grammarService.query(queryParams);\n\n    if (grammarConcepts.length === 0) {\n      // No grammar concepts found, using fallback logic\n      // In production, might throw or fallback more gracefully\n    }\n\n    const mainConcept = grammarConcepts[0]; // Primary focus\n    \n    // 2. Fetch Supporting Vocabulary\n    // Load vocabulary data if not already cached\n    if (!this.vocabularyCache) {\n      const vocabulary = await loadVocabulary();\n      this.vocabularyCache = vocabulary.items.map(item => this.normalizeVocabularyItem(item));\n    }\n    const numericDifficulty = this.mapDifficultyToNumber(params.difficulty);\n    let exampleVocabulary: VocabularyItem[] = [];\n\n    // Find vocabulary relevant to the grammar concept (e.g. nouns for gender rules)\n    if (mainConcept && mainConcept.partOfSpeech && mainConcept.partOfSpeech.length > 0) {\n      const searchParams: any = {\n        difficulty: numericDifficulty,\n        limit: 8\n      };\n      if (mainConcept.partOfSpeech[0]) {\n        searchParams.partOfSpeech = mainConcept.partOfSpeech[0];\n      }\n\n      const searchResult = await loadVocabularyBySearch(searchParams);\n      exampleVocabulary = this.normalizeVocabularyList(searchResult.items);\n    } else {\n      exampleVocabulary = this.normalizeVocabularyList(await getRandomVocabulary(8, { difficulty: numericDifficulty }));\n    }\n\n    // 3. Generate Concept Explanation Section\n    try {\n      const conceptTemplate = await this.templateRepository.getTemplateById('grammar-concept')\n        || await this.templateRepository.getTemplate('grammar', params.difficulty);\n\n      const conceptContext: TemplateRenderingContext = {\n        sectionTitle: `Grammar: ${mainConcept ? mainConcept.name.german : 'Grammar Rule'}`,\n        vocabulary: exampleVocabulary,\n        learningTip: 'Focus on understanding the underlying logic rather than just memorizing rules.',\n        learningObjectives: [\n          `Understand the concept of ${mainConcept ? mainConcept.name.german : 'this grammar rule'}`,\n          `Compare ${mainConcept ? mainConcept.name.german : 'it'} with Bulgarian usage`\n        ]\n      };\n\n      if (mainConcept) {\n        conceptContext.grammarConcept = mainConcept;\n      }\n\n      const conceptContent = this.renderer.render(conceptTemplate, conceptContext);\n\n      sections.push({\n        id: uuidv4(),\n        title: 'Explanation',\n        content: conceptContent,\n        type: 'grammar',\n        metadata: { templateId: conceptTemplate.id, conceptId: mainConcept?.id || '' }\n      });\n    } catch (_error) {\n      // Grammar explanation generation failed, but we continue with other sections\n    }\n\n    // 4. Generate Practice Section (if requested)\n    if (includePractice && mainConcept) {\n      try {\n        const practiceTemplate = await this.templateRepository.getTemplateById('grammar-practice')\n          || await this.templateRepository.getTemplate('grammar', params.difficulty);\n\n        const practiceContext: TemplateRenderingContext = {\n          sectionTitle: 'Grammar Practice',\n          grammarConcept: mainConcept,\n          vocabulary: exampleVocabulary.slice(0, 5) // Use a subset for practice\n        };\n\n        const practiceContent = this.renderer.render(practiceTemplate, practiceContext);\n\n        sections.push({\n          id: uuidv4(),\n          title: 'Practice',\n          content: practiceContent,\n          type: 'exercise',\n          metadata: { templateId: practiceTemplate.id }\n        });\n      } catch (_error) {\n        // Grammar practice generation failed, but we continue with other sections\n      }\n    }\n\n    // 5. Generate Comparison Section (if requested and relevant)\n    if (includeComparison && mainConcept && mainConcept.culturalContext) {\n      try {\n        const comparisonTemplate = await this.templateRepository.getTemplateById('grammar-comparison');\n        \n        // Only generate if we have a specific comparison template\n        if (comparisonTemplate) {\n          const comparisonContext: TemplateRenderingContext = {\n            sectionTitle: 'Cultural Comparison',\n            grammarConcept: mainConcept\n          };\n\n          const comparisonContent = this.renderer.render(comparisonTemplate, comparisonContext);\n\n          sections.push({\n            id: uuidv4(),\n            title: 'Comparison',\n            content: comparisonContent,\n            type: 'cultural',\n            metadata: { templateId: comparisonTemplate.id }\n          });\n        }\n      } catch (_error) {\n        // Comparison section generation failed, but we continue with other sections\n      }\n    }\n\n    // 6. Construct Final Lesson Object\n    return {\n      id: uuidv4(),\n      type: params.type,\n      difficulty: params.difficulty,\n      title: mainConcept ? `Grammar: ${mainConcept.name.german}` : 'Grammar Lesson',\n      sections: sections,\n      vocabulary: exampleVocabulary,\n      grammarConcepts: mainConcept ? [mainConcept] : [],\n      learningObjectives: [\n        `Understand ${mainConcept ? mainConcept.name.german : 'the grammar rule'}`,\n        'Apply the rule in context',\n        'Compare with Bulgarian usage'\n      ],\n      metadata: params.metadata || {},\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n  }\n\n  /**\n   * Generate a contextual or mixed lesson\n   *\n   * @param params - Parameters for lesson generation\n   * @param options - Options for generation algorithm\n   * @returns Generated lesson\n   */\n  async generateContextualLesson(\n    params: LessonGenerationParams,\n    options: LessonGenerationOptions = {}\n  ): Promise<GeneratedLesson> {\n    // For now, treat as mixed vocabulary + grammar\n    // 1. Select Template (mixed or contextual)\n    const template = await this.templateRepository.getTemplateById('mixed-lesson')\n      || await this.templateRepository.getTemplate('mixed', params.difficulty);\n\n    // 2. Fetch Grammar & Vocabulary\n    // Get one grammar concept\n    const grammarConcepts = await this.grammarService.query({\n      difficulty: params.difficulty,\n      limit: 1\n    });\n    const mainConcept = grammarConcepts[0];\n\n    // Get vocabulary related to a theme\n    // Remove unused variable\n    const numericDifficulty = this.mapDifficultyToNumber(params.difficulty);\n    const limit = options.maxItems || 8;\n    \n    // Pick a category if none provided\n    const category = params.criteria.categories?.[0] || 'culture';\n    const normalizedCategories = this.normalizeCategories([category]);\n    const normalizedCategory = normalizedCategories[0] || 'everyday-phrases';\n\n    // Get vocabulary items and enhance them with corrected part-of-speech info\n    const vocabularyItems = this.normalizeVocabularyList(await loadVocabularyByCategory(normalizedCategory, {\n      difficulty: numericDifficulty,\n      limit: limit\n    }));\n\n    // Enhance vocabulary items with corrected part-of-speech and grammar info\n    const enhancedVocabularyItems = vocabularyItems.map(item => ({\n      ...item,\n      correctedPartOfSpeech: this.correctPartOfSpeech(this.validatePartOfSpeech(item.partOfSpeech, item.id)),\n      grammarInfo: this.getFallbackGrammarInfo(this.validatePartOfSpeech(item.partOfSpeech, item.id))\n    }));\n\n    // 3. Prepare Context\n    const context: TemplateRenderingContext = {\n      sectionTitle: `Contextual Lesson: ${normalizedCategory.charAt(0).toUpperCase() + normalizedCategory.slice(1)}`,\n      theme: normalizedCategory,\n      difficulty: params.difficulty,\n      vocabulary: enhancedVocabularyItems,\n      learningTip: 'Try to narrate a short story using these words.',\n      learningObjectives: [\n        `Master vocabulary related to ${category}`,\n        mainConcept ? `Apply ${mainConcept.name.german} in context` : 'Practice sentence construction',\n        'Build reading comprehension'\n      ]\n    };\n\n    if (mainConcept) {\n      context.grammarConcept = mainConcept;\n    }\n\n    // 4. Render\n    const renderedContent = this.renderer.render(template, context);\n\n    // 5. Construct\n    return this.createLessonObject(\n      params,\n      context.sectionTitle || 'Contextual Lesson',\n      renderedContent,\n      vocabularyItems,\n      mainConcept ? [mainConcept] : [],\n      context.learningObjectives || []\n    );\n  }\n\n  /**\n   * Generate an adaptive lesson based on user profile\n   * (Placeholder for future implementation)\n   */\n  async generateAdaptiveLesson(\n    params: LessonGenerationParams,\n    _options: LessonGenerationOptions = {}\n  ): Promise<GeneratedLesson> {\n    // Logic would involve analyzing user profile and picking weak spots\n    // For now, delegate to thematic\n    return this.generateThematicLesson(params, _options);\n  }\n\n  /**\n   * Helper to map CEFR difficulty (A1-C1) to numeric (1-5)\n   */\n  private mapDifficultyToNumber(difficulty: LessonDifficulty): number {\n    const map: Record<LessonDifficulty, number> = {\n      'A1': 1,\n      'A2': 2,\n      'B1': 3,\n      'B2': 4,\n      'C1': 5\n    };\n    return map[difficulty] || 1;\n  }\n\n  /**\n   * Normalize lesson types to the subset compatible with the schema\n   */\n  private normalizeLessonType(type: LessonGenerationParams['type']): LessonGenerationParams['type'] {\n    const allowed: LessonGenerationParams['type'][] = ['vocabulary', 'grammar', 'mixed', 'culture'];\n    if (allowed.includes(type)) {\n      return type;\n    }\n    if (type === 'contextual') {\n      return 'mixed';\n    }\n    return 'vocabulary';\n  }\n\n  /**\n   * Ensure categories conform to the vocabulary category union\n   */\n  private normalizeCategories(categories?: Array<VocabularyCategory | string>): VocabularyCategory[] {\n    const allowed: VocabularyCategory[] = [\n      'greetings',\n      'numbers',\n      'family',\n      'food',\n      'colors',\n      'animals',\n      'body-parts',\n      'clothing',\n      'home',\n      'nature',\n      'transport',\n      'technology',\n      'time',\n      'weather',\n      'professions',\n      'places',\n      'grammar',\n      'culture',\n      'everyday-phrases'\n    ];\n\n    if (!categories || categories.length === 0) {\n      return ['everyday-phrases'];\n    }\n\n    const normalized = categories\n      .map(category => (allowed.includes(category as VocabularyCategory) ? (category as VocabularyCategory) : 'everyday-phrases'))\n      .filter(Boolean) as VocabularyCategory[];\n\n    return normalized.length > 0 ? normalized : ['everyday-phrases'];\n  }\n\n  /**\n   * Align vocabulary items with lesson expectations (metadata, categories)\n   */\n  private normalizeVocabularyItem(item: any): VocabularyItem {\n    const normalized: VocabularyItem = {\n      ...item,\n      categories: this.normalizeCategories(item.categories as Array<VocabularyCategory | string>),\n      isCommon: item.isCommon ?? (item.metadata as any)?.isCommon ?? false,\n      isVerified: item.isVerified ?? (item.metadata as any)?.isVerified ?? false,\n      learningPhase: item.learningPhase ?? (item.metadata as any)?.learningPhase ?? 0,\n      metadata: (item.metadata ?? {}) as any,\n      createdAt: item.createdAt ?? new Date(),\n      updatedAt: item.updatedAt ?? new Date()\n    };\n    return normalized;\n  }\n\n  private normalizeVocabularyList(items: any[]): VocabularyItem[] {\n    return items.map(item => this.normalizeVocabularyItem(item));\n  }\n\n  /**\n   * Validate and correct part-of-speech classifications\n   *\n   * This method handles common misclassifications in the vocabulary data\n   * and provides fallback logic to ensure correct part-of-speech usage.\n   *\n   * @param pos - The original part-of-speech classification\n   * @param word - The vocabulary word or ID for context-specific corrections\n   * @returns The corrected part-of-speech classification\n   */\n  private validatePartOfSpeech(pos: string, word: string): string {\n    // Common misclassifications based on validation report\n    const commonMisclassifications: Record<string, string> = {\n      // Greetings and common phrases\n      'zdravej_001': 'interjection', // Hallo\n      'dobro_utro_002': 'phrase',    // Guten Morgen\n      'guten_tag': 'phrase',         // Guten Tag\n      'guten_abend': 'phrase',       // Guten Abend\n      'gute_nacht': 'phrase',        // Gute Nacht\n      'auf_wiedersehen': 'phrase',    // Auf Wiedersehen\n      'bitte': 'interjection',       // Bitte\n      'entschuldigung': 'interjection', // Entschuldigung\n      'es_tut_mir_leid': 'phrase',   // Es tut mir leid\n\n      // Question words\n      'a1_question_001': 'pronoun',  // wer\n      'a1_question_003': 'adverb',   // wann\n      'a1_question_004': 'adverb',   // wo\n      'a1_question_005': 'adverb',   // warum\n      'a1_question_006': 'adverb',   // wie\n      'a1_question_007': 'adverb',   // wie viel, wie viele\n      'a1_question_008': 'pronoun',  // wessen\n      'a1_question_009': 'pronoun',  // was fr ein, welcher Art\n      'a1_question_010': 'adverb',   // woher\n      'a1_question_011': 'adverb',   // wohin\n      'a1_question_012': 'conjunction', // ob\n\n      // Numbers\n      'eins': 'numeral',\n      'zwei': 'numeral',\n      'drei': 'numeral',\n      'vier': 'numeral',\n      'funf': 'numeral',\n      'sechs': 'numeral',\n      'sieben': 'numeral',\n      'acht': 'numeral',\n      'neun': 'numeral',\n      'zehn': 'numeral',\n      'elf': 'numeral',\n      'zwoelf': 'numeral',\n      'dreizehn': 'numeral',\n      'zwanzig': 'numeral',\n      'a1_number_200': 'numeral'\n    };\n\n    // Check for specific word misclassifications\n    if (commonMisclassifications[word]) {\n      return commonMisclassifications[word];\n    }\n\n    // Default fallback: return the original POS if no correction is needed\n    return pos;\n  }\n\n  /**\n   * Get fallback grammar information for a part-of-speech\n   *\n   * This method provides appropriate grammar information based on\n   * the corrected part-of-speech classification.\n   *\n   * @param pos - The part-of-speech classification\n   * @returns Grammar information string\n   */\n  private getFallbackGrammarInfo(pos: string): string {\n    const grammarInfoMap: Record<string, string> = {\n      'interjection': 'Interjections are words or phrases used to express emotion or greeting. They are often used at the beginning of sentences.',\n      'pronoun': 'Pronouns replace nouns to avoid repetition. They must agree with the noun they replace in gender, number, and case.',\n      'adverb': 'Adverbs describe verbs, adjectives, or other adverbs. They often answer questions like \"how?\", \"when?\", \"where?\", or \"to what extent?\".',\n      'numeral': 'Numerals represent numbers and can be cardinal (one, two) or ordinal (first, second). They are used for counting and ordering.',\n      'phrase': 'Phrases are groups of words that function as a single unit in the syntax of a sentence. They often express greetings, farewells, or common expressions.',\n      'conjunction': 'Conjunctions connect words, phrases, or clauses. They can be coordinating (and, but, or) or subordinating (because, although, if).'\n    };\n\n    return grammarInfoMap[pos] || 'No additional grammar information available.';\n  }\n\n  /**\n   * Correct part-of-speech label for display\n   *\n   * This utility function standardizes part-of-speech labels for\n   * consistent display in the UI.\n   *\n   * @param pos - The part-of-speech classification\n   * @returns Display-friendly part-of-speech label\n   */\n  correctPartOfSpeech(pos: string): string {\n    const displayNames: Record<string, string> = {\n      'noun': 'Noun',\n      'verb': 'Verb',\n      'adjective': 'Adjective',\n      'adverb': 'Adverb',\n      'pronoun': 'Pronoun',\n      'preposition': 'Preposition',\n      'conjunction': 'Conjunction',\n      'interjection': 'Interjection',\n      'numeral': 'Numeral',\n      'article': 'Article',\n      'phrase': 'Phrase'\n    };\n\n    return displayNames[pos] || pos;\n  }\n\n  /**\n   * Helper to create the standard GeneratedLesson object\n   */\n  private createLessonObject(\n    params: LessonGenerationParams,\n    title: string,\n    content: string,\n    vocabulary: VocabularyItem[],\n    grammarConcepts: CulturalGrammarConcept[],\n    learningObjectives: string[]\n  ): GeneratedLesson {\n    const normalizedType = this.normalizeLessonType(params.type);\n    const normalizedVocabulary = this.normalizeVocabularyList(vocabulary);\n    const sectionType: GeneratedLessonSection['type'] = normalizedType === 'grammar'\n      ? 'grammar'\n      : normalizedType === 'culture'\n        ? 'cultural'\n        : 'vocabulary';\n\n    const section: GeneratedLessonSection = {\n      id: uuidv4(),\n      title: 'Main Content', // Could be dynamic\n      content: content,\n      type: sectionType,\n      metadata: {}\n    };\n\n    return {\n      id: uuidv4(),\n      type: normalizedType,\n      difficulty: params.difficulty,\n      title: title,\n      sections: [section],\n      vocabulary: normalizedVocabulary,\n      grammarConcepts: grammarConcepts,\n      learningObjectives: learningObjectives,\n      metadata: params.metadata || {},\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n  }\n}\n\n/**\n * Singleton instance of LessonGenerationEngine\n */\nexport const lessonGenerationEngine = new LessonGenerationEngine();","/**\n * Dependency Injection Container\n *\n * This module provides a centralized container for managing service dependencies\n * across the application, enabling better testability and loose coupling.\n */\n\nimport { ProgressService } from './progress';\nimport { ErrorHandler } from './errors';\nimport { loadVocabulary, initializeVocabulary } from '../data/loader';\nimport { vocabularyRepository } from '../data/vocabulary-repository.svelte';\nimport { LessonGenerationEngine } from './lesson-generation/lesson-generator';\nimport { lessonTemplateRepository } from './lesson-generation/lesson-templates';\nimport { culturalGrammarService } from './lesson-generation/cultural-grammar';\nimport { templateRenderer } from './lesson-generation/template-renderer';\nimport { EventBus } from './event-bus';\nimport { LearningSession } from '../state/session.svelte';\n\n// Define service types\n// Import VocabularyService type for type checking (but not for instantiation)\nimport type { _VocabularyService } from '../data/vocabulary';\n\ntype ServiceTypes = {\n    progressService: ProgressService;\n    lessonGenerationEngine: LessonGenerationEngine;\n    eventBus: EventBus;\n    learningSession: LearningSession;\n};\n\n// Interface for the DI container (for type exports without exposing class)\nexport interface DIContainerInterface {\n    initialize(): Promise<void>;\n    getService<K extends keyof ServiceTypes>(serviceName: K): ServiceTypes[K];\n    getEventBus(): EventBus;\n}\n\n// Singleton DI container (private class)\nclass DIContainer implements DIContainerInterface {\n    private static instance: DIContainer;\n    private services: Partial<ServiceTypes> = {};\n    public eventBus: EventBus;\n    private isInitialized = false;\n    private initializationPromise: Promise<void> | null = null;\n\n    private constructor() {\n        // Initialize event bus\n        this.eventBus = new EventBus();\n        this.services.eventBus = this.eventBus;\n    }\n\n    public static getInstance(): DIContainer {\n        if (!DIContainer.instance) {\n            DIContainer.instance = new DIContainer();\n        }\n        return DIContainer.instance;\n    }\n\n    /**\n     * Initialize all services\n     */\n    public async initialize(): Promise<void> {\n        if (this.initializationPromise) {\n            return this.initializationPromise;\n        }\n\n        this.initializationPromise = new Promise<void>(async (resolve, reject) => {\n            try {\n                // Initialize event bus first\n                this.services.eventBus = this.eventBus;\n\n                // Initialize ProgressService - it's independent\n                this.services.progressService = new ProgressService(this.eventBus);\n\n                // Initialize LearningSession - now independent of ProgressService\n                this.services.learningSession = new LearningSession(this.eventBus);\n\n                // Note: AppDataState is now initialized separately to avoid circular dependencies\n\n                // VocabularyService has been removed - vocabulary data is loaded directly\n\n                // Initialize LessonGenerationEngine with dependencies\n                this.services.lessonGenerationEngine = new LessonGenerationEngine(\n                    lessonTemplateRepository,\n                    culturalGrammarService,\n                    templateRenderer\n                );\n\n                this.isInitialized = true;\n                resolve();\n            } catch (error) {\n                // Use centralized error handling\n                ErrorHandler.handleError(error as Error, 'DI Container initialization failed', this.eventBus);\n                reject(error);\n            }\n        });\n\n        return this.initializationPromise;\n    }\n\n    /**\n     * Get a service by type\n     * @param serviceName The name of the service to get\n     */\n    public getService<T extends keyof ServiceTypes>(serviceName: T): ServiceTypes[T] {\n        // Ensure initialization is complete before accessing services\n        if (!this.isInitialized) {\n            throw new Error(`Service ${serviceName} cannot be accessed: DI container not initialized. ` +\n                          `Make sure to await diContainer.initialize() before accessing services.`);\n        }\n\n        if (!this.services[serviceName]) {\n            throw new Error(`Service ${serviceName} not initialized. ` +\n                          `Make sure diContainer.initialize() has been called successfully.`);\n        }\n\n        return this.services[serviceName];\n    }\n\n    /**\n     * Get the AppDataState instance (initialized separately to avoid circular dependencies)\n     */\n    public getAppDataState(): any {\n        // This will be replaced with proper AppDataState import after initialization\n        throw new Error('AppDataState should be accessed through app-state.ts to avoid circular dependencies');\n    }\n\n    /**\n     * Register a service instance\n     * @param serviceName The name of the service\n     * @param instance The service instance\n     */\n    public registerService<T extends keyof ServiceTypes>(serviceName: T, instance: ServiceTypes[T]): void {\n        this.services[serviceName] = instance;\n    }\n\n    /**\n     * Get the event bus\n     */\n    public getEventBus(): EventBus {\n        return this.eventBus;\n    }\n}\n\n// Create and initialize the DI container\nconst diContainerInstance = DIContainer.getInstance();\n\n// Initialize services\ndiContainerInstance.initialize().catch((error: unknown) => {\n    // Non-fatal: app can still render minimal UI\n    ErrorHandler.handleError(error as Error, 'Failed to initialize DI container', diContainerInstance.getEventBus());\n});\n\n// Create a wrapper object that implements the interface  \nexport const diContainerApi: DIContainerInterface = {\n    initialize: () => diContainerInstance.initialize(),\n    getService: (serviceName) => diContainerInstance.getService(serviceName as any),\n    getEventBus: () => diContainerInstance.getEventBus()\n};\n\n// Export function to get the DI container\nexport function getDIContainer(): DIContainerInterface {\n    return diContainerApi;\n}\n\n// Export event bus immediately since it doesn't require initialization\nexport const eventBus: EventBus = diContainerInstance.getEventBus();\n\n// Export a function to get services after initialization\nexport function getProgressService(): ProgressService {\n    return getDIContainer().getService('progressService');\n}\n\n// VocabularyService has been removed - vocabulary data is loaded directly via loader functions\n\n/**\n * Get vocabulary data\n */\nexport async function getVocabularyData() {\n    return await loadVocabulary();\n}\n\n// Export vocabulary initialization function\nexport async function initializeVocabularyData() {\n    return await initializeVocabulary();\n}\n\n/** Initialize the unified vocabulary repository (client only) */\nexport async function initializeVocabularyRepository() {\n    await vocabularyRepository.load();\n    return vocabularyRepository;\n}\n\nexport function getLessonGenerationEngine(): LessonGenerationEngine {\n    return getDIContainer().getService('lessonGenerationEngine');\n}\n\n// Note: AppDataState is initialized separately in app-state.ts to avoid circular dependencies","import { browser } from '$app/environment';\nimport { Debug } from '$lib/utils';\nimport { vocabularyRepository } from '$lib/data/vocabulary-repository.svelte';\nimport { getDIContainer } from '$lib/services/di-container';\nimport { EventTypes } from '$lib/services/event-bus';\nimport type { VocabularyItem } from '$lib/types/vocabulary';\nimport type { LessonDifficulty } from '$lib/schemas/lesson';\nimport type { VocabularyCategory, PartOfSpeech } from '$lib/schemas/vocabulary';\n\nclass VocabularyDB {\n    // Reactive state using Svelte 5 Runes\n    /** @type {VocabularyItem[]} */\n    items = $state<VocabularyItem[]>([]);\n    /** @type {boolean} */\n    initialized = $state<boolean>(false);\n\n    constructor() {\n        // Don't load data in constructor to prevent SSR fetch calls\n        // Data loading will be triggered explicitly when needed\n    }\n\n    async initialize() {\n        if (browser && !this.initialized) {\n            await this.loadInitialData();\n        }\n    }\n\n    async loadInitialData() {\n        try {\n            Debug.log('VocabularyDB', 'Loading initial vocabulary data');\n            // Load via unified repository\n            await vocabularyRepository.load();\n            const repoItems = vocabularyRepository.getAll();\n\n            // Convert UnifiedVocabularyItem to VocabularyItem format\n            // Ensure all required fields are present with defaults\n            this.items = repoItems.map(item => ({\n                ...item,\n                category: item.categories[0] || 'greetings',\n                categories: item.categories || ['greetings'],\n                tags: (item.tags ?? []),\n                // Ensure required fields from metadata or use defaults\n                isCommon: item.metadata?.isCommon ?? false,\n                isVerified: item.metadata?.isVerified ?? false,\n                learningPhase: item.metadata?.learningPhase ?? 0,\n                xp_value: item.xp_value ?? item.metadata?.xpValue ?? 10\n            }));\n\n            this.initialized = true;\n            Debug.log('VocabularyDB', 'Vocabulary data loaded successfully', {\n                itemCount: this.items.length,\n                initialized: this.initialized\n            });\n        } catch (error) {\n            Debug.error('VocabularyDB', 'Failed to load initial vocabulary data', error as Error);\n            // Store the error for user feedback\n            this.items = [];\n            this.initialized = true;\n\n            // Emit error event for global error handling\n            const eventBus = getDIContainer().getService('eventBus');\n            eventBus.emit(EventTypes.ERROR, {\n                error: new Error('Failed to load vocabulary data'),\n                context: 'VocabularyDB.loadInitialData',\n                timestamp: new Date()\n            });\n        }\n    }\n\n    // Remove the unused import workaround since we're using DataLoader instead\n\n    /** @param {VocabularyItem} item */\n    add(item: VocabularyItem) {\n        this.items.push(item);\n    }\n\n    /** @param {string} id @param {Partial<VocabularyItem>} updates */\n    update(id: string, updates: Partial<VocabularyItem>) {\n        const index = this.items.findIndex((i) => i.id === id);\n        if (index !== -1) {\n            const current = this.items[index];\n            this.items[index] = { ...current, ...updates } as VocabularyItem;\n        }\n    }\n\n    /** @param {string} id @returns {VocabularyItem | undefined} */\n    get(id: string) {\n        return this.items.find((i) => i.id === id);\n    }\n\n    /**\n     * Get all vocabulary items\n     */\n    getVocabulary(): VocabularyItem[] {\n        return this.items;\n    }\n\n    /**\n     * Get vocabulary items by difficulty level\n     * @param difficulty CEFR difficulty level\n     * @returns Array of vocabulary items matching the difficulty\n     */\n    getVocabularyByDifficulty(difficulty: LessonDifficulty): VocabularyItem[] {\n        const difficultyRange = this.getDifficultyRange(difficulty);\n        return this.items.filter(item =>\n            item.difficulty >= difficultyRange.min && item.difficulty <= difficultyRange.max\n        );\n    }\n\n    /**\n     * Get vocabulary items by category\n     * @param category Vocabulary category\n     * @returns Array of vocabulary items in the specified category\n     */\n    getVocabularyByCategory(category: VocabularyCategory): VocabularyItem[] {\n        return this.items.filter(item => item.categories.includes(category));\n    }\n\n    /**\n     * Get vocabulary items by part of speech\n     * @param partOfSpeech Part of speech\n     * @returns Array of vocabulary items with the specified part of speech\n     */\n    getVocabularyByPartOfSpeech(partOfSpeech: PartOfSpeech): VocabularyItem[] {\n        return this.items.filter(item => item.partOfSpeech === partOfSpeech);\n    }\n\n    /**\n     * Get vocabulary items by multiple criteria\n     * @param criteria Search criteria\n     * @returns Array of vocabulary items matching all criteria\n     */\n    getVocabularyByCriteria(criteria: {\n        difficulty?: LessonDifficulty;\n        categories?: VocabularyCategory[];\n        partOfSpeech?: PartOfSpeech;\n        limit?: number;\n    }): VocabularyItem[] {\n        // Convert difficulty level to numeric range if provided\n        const difficultyRange = criteria.difficulty\n            ? this.getDifficultyRange(criteria.difficulty)\n            : null;\n\n        const filteredItems = this.items.filter(item => {\n            // Filter by difficulty\n            const difficultyMatch = difficultyRange\n                ? item.difficulty >= difficultyRange.min && item.difficulty <= difficultyRange.max\n                : true;\n\n            // Filter by categories\n            const categoryMatch = criteria.categories && criteria.categories.length > 0\n                ? item.categories.some(category => criteria.categories?.includes(category))\n                : true;\n\n            // Filter by part of speech\n            const partOfSpeechMatch = criteria.partOfSpeech\n                ? item.partOfSpeech === criteria.partOfSpeech\n                : true;\n\n            return difficultyMatch && categoryMatch && partOfSpeechMatch;\n        });\n\n        // Apply limit if specified\n        return criteria.limit\n            ? filteredItems.slice(0, criteria.limit)\n            : filteredItems;\n    }\n\n    /**\n     * Get random vocabulary items\n     * @param count Number of items to return\n     * @returns Array of random vocabulary items\n     */\n    getRandomVocabulary(count: number = 5): VocabularyItem[] {\n        if (this.items.length === 0) return [];\n\n        // Shuffle array and take first N items\n        const shuffled = [...this.items].sort(() => 0.5 - Math.random());\n        return shuffled.slice(0, Math.min(count, this.items.length));\n    }\n\n    /**\n     * Get vocabulary items by search query\n     * @param query Search term\n     * @returns Array of vocabulary items matching the search term\n     */\n    searchVocabulary(query: string): VocabularyItem[] {\n        Debug.log('VocabularyDB', 'Searching vocabulary', { query });\n        if (!query) {\n            Debug.log('VocabularyDB', 'Empty search query, returning empty results');\n            return [];\n        }\n\n        const lowerQuery = query.toLowerCase();\n        const results = this.items.filter(item =>\n            item.german.toLowerCase().includes(lowerQuery) ||\n            item.bulgarian.toLowerCase().includes(lowerQuery) ||\n            (item.tags ?? []).some(tag => tag.toLowerCase().includes(lowerQuery))\n        );\n\n        Debug.log('VocabularyDB', 'Vocabulary search completed', { query, results: results.length });\n        return results;\n    }\n\n    /**\n     * Get numeric difficulty range for a CEFR level\n     * @param difficulty CEFR difficulty level\n     * @returns Object with min and max difficulty values\n     */\n    private getDifficultyRange(difficulty: LessonDifficulty): { min: number; max: number } {\n        const ranges: Record<LessonDifficulty, { min: number; max: number }> = {\n            'A1': { min: 1, max: 1.5 },\n            'A2': { min: 1.5, max: 2.5 },\n            'B1': { min: 2.5, max: 3.5 },\n            'B2': { min: 3.5, max: 4.5 },\n            'C1': { min: 4.5, max: 5 }\n        };\n        return ranges[difficulty];\n    }\n\n    /**\n     * Get the count of vocabulary items\n     * @returns Total number of vocabulary items\n     */\n    getVocabularyCount(): number {\n        return this.items.length;\n    }\n\n    /**\n     * Get vocabulary statistics by difficulty level\n     * @returns Object with count of items per difficulty level\n     */\n    getVocabularyStatsByDifficulty(): Record<LessonDifficulty, number> {\n        const stats: Record<LessonDifficulty, number> = {\n            'A1': 0,\n            'A2': 0,\n            'B1': 0,\n            'B2': 0,\n            'C1': 0\n        };\n\n        this.items.forEach(item => {\n            if (item.difficulty <= 1.5) stats.A1++;\n            else if (item.difficulty <= 2.5) stats.A2++;\n            else if (item.difficulty <= 3.5) stats.B1++;\n            else if (item.difficulty <= 4.5) stats.B2++;\n            else stats.C1++;\n        });\n\n        return stats;\n    }\n}\n\n// Initialize the database instance\nconst vocabularyDb = new VocabularyDB();\n\n// Automatic initialization is now handled by the DataLoader\n// No automatic initialization here to avoid SSR issues\n\n/**\n * Singleton instance of VocabularyDB for global state management\n */\nexport { vocabularyDb };","/**\n * Transaction Utility for Atomic State Updates\n *\n * This module provides a transaction mechanism to ensure that related state updates\n * succeed or fail together, maintaining data consistency across the application.\n */\n\nimport { Debug } from '$lib/utils';\nimport { ErrorHandler } from '$lib/services/errors';\n\n/**\n * Transaction class for managing atomic operations\n */\nexport class Transaction {\n    private operations: Array<() => Promise<void>> = [];\n    private rollbackOperations: Array<() => Promise<void>> = [];\n    private isCommitted = false;\n\n    /**\n     * Add an operation to the transaction\n     * @param operation The operation to execute\n     * @param rollback The rollback operation if the transaction fails\n     */\n    addOperation(operation: () => Promise<void>, rollback: () => Promise<void>): void {\n        this.operations.push(operation);\n        this.rollbackOperations.push(rollback);\n    }\n\n    /**\n     * Execute all operations in the transaction\n     * @throws Error if any operation fails\n     */\n    async commit(): Promise<void> {\n        if (this.isCommitted) {\n            throw new Error('Transaction already committed');\n        }\n\n        const executedOperations: Array<() => Promise<void>> = [];\n\n        try {\n            // Execute all operations in sequence\n            for (const operation of this.operations) {\n                await operation();\n                executedOperations.push(operation);\n            }\n\n            this.isCommitted = true;\n        } catch (error: unknown) {\n            Debug.error('Transaction', 'Transaction failed, rolling back', error as Error);\n\n            const errors: Error[] = [];\n\n            // Rollback in reverse order\n            for (let i = executedOperations.length - 1; i >= 0; i--) {\n                try {\n                    const op = executedOperations[i];\n                    if (!op) continue;\n                    \n                    const rollbackIndex = this.operations.indexOf(op);\n                    const rollbackOp = this.rollbackOperations[rollbackIndex];\n                    if (rollbackIndex !== -1 && rollbackOp) {\n                        await rollbackOp();\n                    } else {\n                        Debug.error('Transaction', 'No rollback operation found for operation');\n                        errors.push(new Error(`No rollback operation found for operation index: ${i}`));\n                    }\n                } catch (rollbackError: unknown) {\n                    const typedRollbackError = rollbackError instanceof Error ? rollbackError : new Error(String(rollbackError));\n                    Debug.error('Transaction', 'Rollback failed for operation', typedRollbackError);\n                    errors.push(typedRollbackError);\n                    // Continue with other rollbacks even if one fails\n                }\n            }\n\n            ErrorHandler.handleError(error as Error, 'Transaction failed and rolled back');\n            throw error;\n        }\n    }\n\n    /**\n     * Check if the transaction has been committed\n     */\n    isComplete(): boolean {\n        return this.isCommitted;\n    }\n}\n\n/**\n * Transaction Manager for coordinating multiple transactions\n */\nexport class TransactionManager {\n    private static activeTransactions: Map<string, Transaction> = new Map();\n\n    /**\n     * Start a new transaction\n     * @param transactionId Unique identifier for the transaction\n     */\n    static startTransaction(transactionId: string): Transaction {\n        if (this.activeTransactions.has(transactionId)) {\n            throw new Error(`Transaction with ID ${transactionId} already exists`);\n        }\n\n        const transaction = new Transaction();\n        this.activeTransactions.set(transactionId, transaction);\n        return transaction;\n    }\n\n    /**\n     * Get an existing transaction\n     * @param transactionId Unique identifier for the transaction\n     */\n    static getTransaction(transactionId: string): Transaction | null {\n        return this.activeTransactions.get(transactionId) || null;\n    }\n\n    /**\n     * Commit a transaction\n     * @param transactionId Unique identifier for the transaction\n     */\n    static async commitTransaction(transactionId: string): Promise<void> {\n        const transaction = this.activeTransactions.get(transactionId);\n        if (!transaction) {\n            throw new Error(`Transaction with ID ${transactionId} not found`);\n        }\n\n        await transaction.commit();\n        this.activeTransactions.delete(transactionId);\n    }\n\n    /**\n     * Rollback a transaction\n     * @param transactionId Unique identifier for the transaction\n     */\n    static async rollbackTransaction(transactionId: string): Promise<void> {\n        const transaction = this.activeTransactions.get(transactionId);\n        if (!transaction) {\n            throw new Error(`Transaction with ID ${transactionId} not found`);\n        }\n\n        // Rollback is handled automatically in the commit method when an error occurs\n        this.activeTransactions.delete(transactionId);\n    }\n}","import { AppUIState } from './app-ui.svelte';\nimport { AppDataState } from './app-data.svelte';\nimport { getProgressService, eventBus } from '$lib/services/di-container';\nimport type { VocabularyMastery, OverallProgress } from '$lib/schemas/progress';\nimport { ErrorHandler } from '$lib/services/errors';\n\n// Export initialization function instead of direct instances\n// Initialize and export the state instances directly\nexport const appDataState = new AppDataState();\nexport const appUIState = new AppUIState(appDataState);\n\n// Export async initialization function\nexport async function initializeAppState() {\n    try {\n        // Initialize the state instances\n        await appDataState.init();\n        await appUIState.init();\n\n        return {\n            appDataState,\n            appUIState\n        };\n    } catch (error) {\n        console.error('Failed to initialize app state:', error);\n        throw error;\n    }\n}\n\n// Export a combined interface for backward compatibility\nimport type { VocabularyItem } from '$lib/types/vocabulary';\n\nexport class AppState {\n    // UI State accessors with proper typing\n    get languageMode(): 'DE_BG' | 'BG_DE' { return appUIState.languageMode; }\n    get searchQuery(): string { return appUIState.searchQuery; }\n    get currentItem(): VocabularyItem | null { return appUIState.currentItem; }\n    get showAnswer(): boolean { return appUIState.showAnswer; }\n    get practiceMode(): 'practice' | 'search' { return appUIState.practiceMode ? 'practice' : 'search'; }\n    get isLoading(): boolean { return appUIState.isLoading; }\n    get error(): string | null { return appUIState.error; }\n    get filteredItems(): VocabularyItem[] { return appUIState.filteredItems; }\n    get displayDirection(): string { return appUIState.displayDirection; }\n    get practiceRecommendations(): VocabularyItem[] { return appUIState.practiceRecommendations; }\n\n    // Data State accessors with proper typing\n    get practiceStats(): Map<string, { correct: number; incorrect: number; lastPracticed: string }> {\n        // Derive practice stats from ProgressService to avoid duplication\n        try {\n            const svc = getProgressService();\n            const all = svc.getAllVocabularyMastery();\n            const stats = new Map<string, { correct: number; incorrect: number; lastPracticed: string }>();\n            for (const [itemId, mastery] of Object.entries(all)) {\n                stats.set(itemId, {\n                    correct: mastery.correctCount,\n                    incorrect: mastery.incorrectCount,\n                    lastPracticed: mastery.lastPracticed || ''\n                });\n            }\n            return stats;\n        } catch (error) {\n            ErrorHandler.handleError(error as Error, 'AppState.practiceStats');\n            return appDataState.practiceStats;\n        }\n    }\n    get recentSearches(): string[] { return appDataState.recentSearches; }\n    get favorites(): string[] { return appDataState.favorites; }\n\n    // Method accessors with proper typing\n    toggleLanguageMode(): void { return appUIState.toggleLanguageMode(); }\n    toggleDirection(): void { return appUIState.toggleDirection(); }\n    setSearchQuery(query: string): void { return appUIState.setSearchQuery(query); }\n    setCurrentItem(item: VocabularyItem | null): void { return appUIState.setCurrentItem(item); }\n    togglePracticeMode(): void { return appUIState.togglePracticeMode(); }\n    startPracticeSession(item: VocabularyItem): void { return appUIState.startPracticeSession(item); }\n    toggleShowAnswer(): void { return appUIState.toggleShowAnswer(); }\n    setError(error: string | null): void { return appUIState.setError(error); }\n\n    /**\n     * Return all vocabulary items currently loaded\n     */\n    getAllVocabularyItems(): VocabularyItem[] { return appDataState.allItems; }\n\n    /**\n     * Record a practice result with proper typing\n     * @param itemId The ID of the vocabulary item\n     * @param correct Whether the answer was correct\n     * @param responseTime Response time in milliseconds (optional)\n     */\n    async recordPracticeResult(itemId: string, correct: boolean, responseTime?: number): Promise<void> {\n        try {\n            const svc = getProgressService();\n            await svc.recordVocabularyPractice(itemId, correct, responseTime);\n        } catch (error) {\n            ErrorHandler.handleError(error as Error, 'AppState.recordPracticeResult', eventBus);\n            // Fallback to legacy path if service fails\n            return appDataState.recordPracticeResult(itemId, correct, responseTime);\n        }\n    }\n\n    /** Get detailed mastery info from ProgressService */\n    getVocabularyMastery(itemId: string): VocabularyMastery | null {\n        try {\n            const svc = getProgressService();\n            return svc.getVocabularyMastery(itemId);\n        } catch (error) {\n            ErrorHandler.handleError(error as Error, 'AppState.getVocabularyMastery', eventBus);\n            return null;\n        }\n    }\n\n    /** Get overall progress summary */\n    getOverallProgress(): OverallProgress {\n        try {\n            const svc = getProgressService();\n            return svc.getOverallProgress();\n        } catch (error) {\n            ErrorHandler.handleError(error as Error, 'AppState.getOverallProgress', eventBus);\n            // Provide a minimal empty summary fallback\n            return {\n                id: 'fallback',\n                totalXP: 0,\n                totalWordsPracticed: 0,\n                totalLessonsCompleted: 0,\n                totalQuizzesTaken: 0,\n                totalTimeSpent: 0,\n                currentLevel: 1,\n                currentStreak: 0,\n                longestStreak: 0,\n                lastActiveDate: null,\n                createdAt: new Date().toISOString(),\n                updatedAt: new Date().toISOString()\n            };\n        }\n    }\n\n    /**\n     * Toggle favorite status for a vocabulary item\n     * @param itemId The ID of the vocabulary item\n     */\n    toggleFavorite(itemId: string): void { return appDataState.toggleFavorite(itemId); }\n\n    /**\n     * Check if an item is favorited\n     * @param itemId The ID of the vocabulary item\n     * @returns boolean indicating if the item is favorited\n     */\n    isFavorite(itemId: string): boolean { return appDataState.isFavorite(itemId); }\n\n    /**\n     * Clear all user data\n     */\n    async clearAllData(): Promise<void> { return appDataState.clearAllData(); }\n\n    /**\n     * Export user data as JSON\n     * @returns JSON string of user data\n     */\n    exportData(): string { return appDataState.exportData(); }\n\n    /**\n     * Import user data from JSON\n     * @param jsonData JSON string of user data\n     */\n    importData(jsonData: string): void { return appDataState.importData(jsonData); }\n}\n\n// Export the singleton instance for backward compatibility\n// Note: This should be used after calling initializeAppState()\nexport const appState = new AppState();","import { browser } from '$app/environment';\nimport { vocabularyDb } from '$lib/data/db.svelte';\n// import { vocabularyService } from '$lib/data/vocabulary';\nimport { LocalStorageManager } from '$lib/utils/localStorage';\nimport { Debug } from '$lib/utils';\nimport { TransactionManager } from '$lib/utils/transaction';\nimport type { VocabularyItem } from '$lib/types/vocabulary';\nimport { StateError, StorageError, ErrorHandler } from '../services/errors';\nimport { EventBus } from '../services/event-bus';\n\nexport class AppDataState {\n    // Data-related state with proper typing\n    practiceStats = $state<Map<string, { correct: number; incorrect: number; lastPracticed: string }>>(new Map());\n    recentSearches = $state<string[]>([]);\n    favorites = $state<string[]>([]);\n\n    // Error state for user feedback\n    lastError = $state<string | null>(null);\n    isError = $state<boolean>(false);\n\n    // Get all vocabulary items from the database\n    get allItems(): VocabularyItem[] {\n        return vocabularyDb.items;\n    }\n\n    /**\n     * Toggle favorite status for a vocabulary item\n     * @param itemId The ID of the vocabulary item\n     * @throws StateError if the item ID is invalid\n     */\n    toggleFavorite(itemId: string): void {\n        Debug.log('AppDataState', 'Toggling favorite', { itemId });\n        try {\n            // Validate input with type guard\n            if (typeof itemId !== 'string' || !itemId.trim()) {\n                throw new Error('Invalid item ID: must be a non-empty string');\n            }\n\n            const index = this.favorites.indexOf(itemId);\n            if (index > -1) {\n                this.favorites = this.favorites.filter(fav => fav !== itemId);\n            } else {\n                this.favorites = [...this.favorites, itemId];\n            }\n            this.saveProgress();\n        } catch (error) {\n            this.handleError(error, 'Failed to toggle favorite');\n            throw new StateError('Failed to toggle favorite', { itemId, error });\n        }\n    }\n\n    isFavorite(itemId: string): boolean {\n        return this.favorites.includes(itemId);\n    }\n\n    // Enhanced progress tracking\n    /**\n     * Record a practice result for a vocabulary item\n     * @param itemId The ID of the vocabulary item\n     * @param correct Whether the answer was correct\n     * @param responseTime Response time in seconds (optional)\n     * @throws StateError if recording fails\n     */\n    /**\n     * Record a practice result for a vocabulary item using atomic transaction\n     * @param itemId The ID of the vocabulary item\n     * @param correct Whether the answer was correct\n     * @param responseTime Response time in seconds (optional)\n     * @param eventBus Optional event bus for error handling\n     * @throws StateError if recording fails\n     */\n    /**\n     * Record a practice result for a vocabulary item using atomic transaction\n     * @param itemId The ID of the vocabulary item\n     * @param correct Whether the answer was correct\n     * @param responseTime Response time in seconds (optional)\n     * @param eventBus Optional event bus for error handling\n     * @throws StateError if recording fails\n     */\n    async recordPracticeResult(itemId: string, correct: boolean, responseTime?: number, eventBus?: EventBus): Promise<void> {\n        // Validate input parameters with type guards\n        if (typeof itemId !== 'string' || !itemId.trim()) {\n            const error = new Error('Invalid item ID: must be a non-empty string');\n            this.handleError(error, 'Failed to record practice result');\n            throw new StateError('Invalid item ID', { itemId });\n        }\n        if (typeof correct !== 'boolean') {\n            const error = new Error('Invalid correct flag: must be a boolean');\n            this.handleError(error, 'Failed to record practice result');\n            throw new StateError('Invalid correct flag', { correct });\n        }\n        if (responseTime !== undefined && (typeof responseTime !== 'number' || responseTime < 0 || !Number.isFinite(responseTime))) {\n            const error = new Error('Invalid response time: must be a non-negative number');\n            this.handleError(error, 'Failed to record practice result');\n            throw new StateError('Invalid response time', { responseTime });\n        }\n        // Create a transaction to ensure atomic updates\n        const transactionId = `practice-result-${itemId}-${Date.now()}`;\n        const transaction = TransactionManager.startTransaction(transactionId);\n\n        try {\n            // Store current state for rollback\n            const originalStats = new Map(this.practiceStats);\n            const originalFavorites = [...this.favorites];\n            const originalSearches = [...this.recentSearches];\n\n            // Add data loader update operation\n            // vocabularyService.updateStats removed as it's not supported in the new architecture\n            // transaction.addOperation(\n            //     async () => {\n            //         await vocabularyService.updateStats(itemId, correct, responseTime);\n            //     },\n            //     async () => {\n            //         Debug.log('AppDataState', 'Rolling back data loader update', { itemId });\n            //         // No rollback needed for data loader as it's read-only\n            //     }\n            // );\n\n            // Add local stats update operation\n            transaction.addOperation(\n                async () => {\n                    // Update local stats\n                    const current = this.practiceStats.get(itemId) || { correct: 0, incorrect: 0, lastPracticed: '' };\n\n                    // Update practice stats with proper typing\n                    const updatedStats = {\n                        correct: correct ? current.correct + 1 : current.correct,\n                        incorrect: !correct ? current.incorrect + 1 : current.incorrect,\n                        lastPracticed: new Date().toISOString()\n                    };\n\n                    // Create a new Map to trigger reactivity with Svelte 5 Runes\n                    const newStats = new Map(this.practiceStats);\n                    newStats.set(itemId, updatedStats);\n                    this.practiceStats = newStats;\n                },\n                async () => {\n                    Debug.log('AppDataState', 'Rolling back local stats update', { itemId });\n                    this.practiceStats = originalStats;\n                }\n            );\n\n            // Add save progress operation\n            transaction.addOperation(\n                async () => {\n                    await this.saveProgress(eventBus);\n                },\n                async () => {\n                    Debug.log('AppDataState', 'Rolling back save progress', { itemId });\n                    this.favorites = originalFavorites;\n                    this.recentSearches = originalSearches;\n                }\n            );\n\n            // Commit the transaction\n            await TransactionManager.commitTransaction(transactionId);\n\n        } catch (error) {\n            // Attempt to rollback the transaction if it wasn't committed\n            try {\n                await TransactionManager.rollbackTransaction(transactionId);\n            } catch (rollbackError) {\n                Debug.error('AppDataState', 'Failed to rollback transaction', rollbackError as Error);\n            }\n\n            this.handleError(error, 'Failed to record practice result');\n            ErrorHandler.handleError(error as Error, 'Failed to record practice result', eventBus);\n            throw new StateError('Failed to record practice result', { itemId, error });\n        }\n    }\n\n    // Enhanced localStorage integration\n    /**\n     * Save progress data to localStorage\n     * @param eventBus Optional event bus for error handling\n     * @throws StorageError if saving fails\n     */\n    private async saveProgress(eventBus?: EventBus): Promise<void> {\n        if (!browser) return;\n\n        try {\n            // Validate data before saving\n            if (!(this.practiceStats instanceof Map)) {\n                throw new Error('Invalid practice stats: expected Map');\n            }\n            if (!Array.isArray(this.favorites)) {\n                throw new Error('Invalid favorites: expected array');\n            }\n            if (!Array.isArray(this.recentSearches)) {\n                throw new Error('Invalid recent searches: expected array');\n            }\n\n            LocalStorageManager.saveUserProgress({\n                stats: this.practiceStats,\n                favorites: this.favorites,\n                recentSearches: this.recentSearches\n            }, eventBus);\n        } catch (error) {\n            this.handleError(error, 'Failed to save progress data');\n            ErrorHandler.handleError(error as Error, 'Failed to save app data state', eventBus);\n            throw new StorageError('Failed to save app data state', {\n                error,\n                statsType: typeof this.practiceStats,\n                favoritesType: typeof this.favorites,\n                searchesType: typeof this.recentSearches\n            });\n        }\n    }\n\n    /**\n     * Load progress data from localStorage\n     * @param eventBus Optional event bus for error handling\n     * @throws StorageError if loading fails\n     */\n    private loadProgress(eventBus?: EventBus): void {\n        if (!browser) return;\n\n        try {\n            const progress = LocalStorageManager.loadUserProgress(eventBus);\n            if (progress) {\n                // Validate loaded data\n                if (progress.stats && typeof progress.stats === 'object') {\n                    this.practiceStats = new Map(Object.entries(progress.stats));\n                } else {\n                    this.practiceStats = new Map();\n                }\n\n                this.favorites = Array.isArray(progress.favorites) ? progress.favorites : [];\n                this.recentSearches = Array.isArray(progress.recentSearches) ? progress.recentSearches : [];\n            }\n        } catch (error) {\n            this.handleError(error, 'Failed to load progress data');\n            ErrorHandler.handleError(error as Error, 'Failed to load app data state', eventBus);\n            // Provide basic error context without progress data\n            throw new StorageError('Failed to load app data state', {\n                error,\n                hasStats: false,\n                hasFavorites: false,\n                hasSearches: false\n            });\n        }\n    }\n\n    // Utility methods for enhanced functionality\n    /**\n     * Clear all user data\n     * @param eventBus Optional event bus for error handling\n     * @throws StorageError if clearing fails\n     */\n    /**\n     * Clear all user data\n     * @param eventBus Optional event bus for error handling\n     * @throws StorageError if clearing fails\n     */\n    async clearAllData(eventBus?: EventBus): Promise<void> {\n        try {\n            // Clear state with proper typing\n            this.practiceStats = new Map();\n            this.favorites = [];\n            this.recentSearches = [];\n            await this.saveProgress(eventBus);\n\n            // Clear vocabulary cache\n            if (typeof localStorage !== 'undefined') {\n                localStorage.removeItem('vocabulary-cache');\n            }\n            LocalStorageManager.clearAllData(eventBus);\n        } catch (error) {\n            this.handleError(error, 'Failed to clear all user data');\n            ErrorHandler.handleError(error as Error, 'Failed to clear all app data', eventBus);\n            throw new StorageError('Failed to clear all app data', { error });\n        }\n    }\n\n    /**\n     * Export user data as JSON\n     * @param eventBus Optional event bus for error handling\n     * @returns JSON string of user data\n     * @throws StorageError if export fails\n     */\n    exportData(eventBus?: EventBus): string {\n        try {\n            return LocalStorageManager.exportUserData(eventBus);\n        } catch (error) {\n            this.handleError(error, 'Failed to export user data');\n            ErrorHandler.handleError(error as Error, 'Failed to export app data', eventBus);\n            throw new StorageError('Failed to export app data', { error });\n        }\n    }\n\n    /**\n     * Import user data from JSON\n     * @param jsonData JSON string of user data\n     * @param eventBus Optional event bus for error handling\n     * @throws StateError if import fails\n     */\n    /**\n     * Import user data from JSON\n     * @param jsonData JSON string of user data\n     * @param eventBus Optional event bus for error handling\n     * @throws StateError if import fails\n     */\n    importData(jsonData: string, eventBus?: EventBus): void {\n        try {\n            // Validate input with type guard\n            if (typeof jsonData !== 'string' || !jsonData.trim()) {\n                throw new Error('Invalid JSON data: must be a non-empty string');\n            }\n\n            LocalStorageManager.importUserData(jsonData, eventBus);\n            this.loadProgress(eventBus);\n        } catch (error) {\n            this.handleError(error, 'Failed to import user data');\n            ErrorHandler.handleError(error as Error, 'Failed to import app data', eventBus);\n            throw new StateError('Failed to import app data', {\n                error,\n                jsonDataType: typeof jsonData,\n                jsonDataLength: jsonData?.length\n            });\n        }\n    }\n\n    /**\n     * Initialize the AppDataState\n     * @param eventBus Optional event bus for error handling\n     * @throws StateError if initialization fails\n     */\n    init(eventBus?: EventBus) {\n        if (browser) {\n            try {\n                // Load user progress\n                this.loadProgress(eventBus);\n            } catch (error) {\n                this.handleError(error, 'Failed to initialize application data');\n                ErrorHandler.handleError(error as Error, 'Failed to initialize AppDataState', eventBus);\n                // Re-throw to allow application to handle initialization failure\n                throw new StateError('Failed to initialize AppDataState', { error });\n            }\n        }\n    }\n\n    /**\n     * Handle errors and provide user feedback\n     * @param error The error to handle\n     * @param context Context for the error\n     */\n    private handleError(error: unknown, context: string): void {\n        this.isError = true;\n        this.lastError = `${context}: ${error instanceof Error ? error.message : String(error)}`;\n\n        // Clear error after 5 seconds\n        setTimeout(() => {\n            this.isError = false;\n            this.lastError = null;\n        }, 5000);\n    }\n\n    /**\n     * Clear the current error state\n     */\n    clearError(): void {\n        this.isError = false;\n        this.lastError = null;\n    }\n}","import { browser } from '$app/environment';\nimport { Debug } from '$lib/utils';\nimport type { VocabularyItem } from '$lib/types/vocabulary';\nimport type { AppDataState } from './app-data.svelte';\nimport { StateError, ErrorHandler } from '../services/errors';\n\nexport type LanguageMode = 'DE_BG' | 'BG_DE';\n\nexport class AppUIState {\n    // Reference to the data state\n    private dataState: AppDataState;\n\n    // UI State\n    languageMode = $state<LanguageMode>('DE_BG');\n    searchQuery = $state('');\n    currentItem = $state<VocabularyItem | null>(null);\n    showAnswer = $state(false);\n    practiceMode = $state(false);\n    isLoading = $state(false);\n    error = $state<string | null>(null);\n\n    // Derived state\n    displayDirection = $derived(\n        this.languageMode === 'DE_BG' ? 'German  Bulgarian' : 'Bulgarian  German'\n    );\n\n    constructor(dataState: AppDataState) {\n        this.dataState = dataState;\n    }\n\n    toggleLanguageMode() {\n        this.languageMode = this.languageMode === 'DE_BG' ? 'BG_DE' : 'DE_BG';\n        this.triggerLanguageModePersistence();\n  \n        // Notify localization service about language change\n        if (browser) {\n            try {\n                // Import the LocalizationService dynamically to avoid circular dependencies\n                import('../services/localization').then(({ LocalizationService }) => {\n                    LocalizationService.notifyLanguageChange();\n                });\n            } catch (error) {\n                console.error('Failed to notify language change:', error);\n            }\n        }\n    }\n\n    // Legacy support alias for compatibility\n    toggleDirection() {\n        this.toggleLanguageMode();\n    }\n\n    setSearchQuery(query: string) {\n        this.searchQuery = query;\n\n        // Add to recent searches if not empty and not already in list\n        if (query.trim() && !this.dataState.recentSearches.includes(query)) {\n            this.dataState.recentSearches = [query, ...this.dataState.recentSearches.slice(0, 9)]; // Keep last 10\n        }\n    }\n\n    /**\n     * Trigger language mode persistence to localStorage\n     * @throws StateError if saving fails\n     */\n    private triggerLanguageModePersistence(): void {\n        if (browser) {\n            try {\n                localStorage.setItem('app-language-mode', this.languageMode);\n                // Clean up old storage key if it exists\n                if (localStorage.getItem('tandem-direction')) {\n                    localStorage.removeItem('tandem-direction');\n                }\n            } catch (error) {\n                ErrorHandler.handleError(error, 'Failed to save language mode');\n                throw new StateError('Failed to save language mode', { error });\n            }\n        }\n    }\n\n    setCurrentItem(item: VocabularyItem | null) {\n        this.currentItem = item;\n        this.showAnswer = false;\n    }\n\n    togglePracticeMode() {\n        this.practiceMode = !this.practiceMode;\n        if (!this.practiceMode) {\n            this.setCurrentItem(null);\n        }\n    }\n\n    /**\n     * Enhanced practice session management for \"Practice This\" quick actions\n     * This method provides a seamless way to start practicing a specific item\n     */\n    startPracticeSession(item: VocabularyItem) {\n        // Set up the practice session\n        this.practiceMode = true;\n        this.setCurrentItem(item);\n        this.showAnswer = false;\n\n        // Clear any existing search query to focus on practice\n        this.searchQuery = '';\n    }\n\n    toggleShowAnswer() {\n        this.showAnswer = !this.showAnswer;\n    }\n\n    setError(error: string | null) {\n        Debug.log('AppUIState', 'Setting error', { error });\n        this.error = error;\n    }\n\n    // Derived state for filtered items\n    filteredItems = $derived.by(() => {\n        const query = this.searchQuery.trim();\n        if (!query) return this.dataState.allItems;\n\n        const q = query.toLowerCase();\n        return this.dataState.allItems.filter((item: VocabularyItem) => {\n            return item.german.toLowerCase().includes(q) ||\n                   item.bulgarian.toLowerCase().includes(q) ||\n                   item.categories.some(c => c.toLowerCase().includes(q)) ||\n                   (item.tags && item.tags.some(tag => tag.toLowerCase().includes(q)));\n        });\n    });\n\n    // Enhanced derived state for practice recommendations\n    practiceRecommendations = $derived.by(() => {\n        // Memoize the filtering logic to optimize performance\n        const recommendations = this.dataState.allItems\n            .filter((item: VocabularyItem) => {\n                const stats = this.dataState.practiceStats.get(item.id);\n                if (!stats) return true; // Include new items\n\n                // Prioritize items that need more practice\n                const totalAttempts = stats.correct + stats.incorrect;\n                const successRate = totalAttempts > 0 ? stats.correct / totalAttempts : 0;\n\n                // Include items with low success rate or few attempts\n                return successRate < 0.8 || totalAttempts < 3;\n            });\n\n        // Limit to top 10 recommendations and ensure we don't exceed array bounds\n        return recommendations.slice(0, Math.min(10, recommendations.length));\n    });\n\n    /**\n     * Initialize the UI state\n     * @throws StateError if initialization fails\n     */\n    init(): void {\n        if (browser) {\n            try {\n                // Load initial language mode\n                const saved = localStorage.getItem('app-language-mode');\n                const oldSaved = localStorage.getItem('tandem-direction');\n  \n                // Set default language if no preference exists\n                if (saved === 'DE_BG' || saved === 'BG_DE') {\n                    this.languageMode = saved as LanguageMode;\n                } else if (oldSaved === 'DE->BG') {\n                    this.languageMode = 'DE_BG';\n                    // Migrate from old format to new format\n                    localStorage.setItem('app-language-mode', 'DE_BG');\n                    localStorage.removeItem('tandem-direction');\n                } else if (oldSaved === 'BG->DE') {\n                    this.languageMode = 'BG_DE';\n                    // Migrate from old format to new format\n                    localStorage.setItem('app-language-mode', 'BG_DE');\n                    localStorage.removeItem('tandem-direction');\n                } else {\n                    // Set default language (DE_BG) when no saved preference exists\n                    this.languageMode = 'DE_BG';\n                    localStorage.setItem('app-language-mode', 'DE_BG');\n                }\n  \n                // Set up automatic syncing with event listener\n                window.addEventListener('storage', (e) => {\n                    if (e.key === 'app-language-mode') {\n                        const saved = localStorage.getItem('app-language-mode');\n                        if (saved === 'DE_BG' || saved === 'BG_DE') {\n                            this.languageMode = saved as LanguageMode;\n                        }\n                    }\n                });\n            } catch (error) {\n                ErrorHandler.handleError(error, 'Failed to initialize UI state');\n                throw new StateError('Failed to initialize UI state', { error });\n            }\n        }\n    }\n}"],"file":"wr4fSOtw.js"}