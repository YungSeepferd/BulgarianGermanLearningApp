{"version":3,"file":"Noj4Nr_w.js","sources":["../../../../../../src/lib/schemas/exercises.ts","../../../../../../src/lib/services/exercise.ts","../../../../../../src/lib/components/exercises/FillInTheBlankExercise.svelte","../../../../../../src/lib/components/exercises/MatchingExercise.svelte","../../../../../../src/lib/components/exercises/OrderingExercise.svelte","../../../../../../src/lib/components/exercises/TypingExercise.svelte"],"sourcesContent":["import { z } from 'zod';\n\n/**\n * Exercise Type Definitions\n * \n * Schemas for all 6 exercise types:\n * 1. Fill-in-the-Blank\n * 2. Multiple Choice\n * 3. Matching\n * 4. Ordering/Sequencing\n * 5. Typing\n * 6. Sentence Builder (NEW)\n */\n\n// ============================================================================\n// EXERCISE TYPE SCHEMAS\n// ============================================================================\n\n/**\n * Sentence Builder Exercise (NEW)\n * Users construct sentences by clicking words in the correct order\n */\nexport const SentenceBuilderExerciseSchema = z.object({\n  id: z.string(),\n  type: z.literal('sentence-builder'),\n  title: z.string(),\n  description: z.string().optional(),\n  grammarHint: z.string().optional(),\n  questions: z.array(\n    z.object({\n      id: z.string(),\n      prompt: z.string(),\n      words: z.array(z.string()),\n      correctOrder: z.array(z.string()),\n      difficulty: z.enum(['easy', 'medium', 'hard']).default('medium')\n    })\n  ),\n  currentQuestionIndex: z.number().default(0),\n  feedback: z.array(\n    z.object({\n      questionId: z.string(),\n      isCorrect: z.boolean(),\n      userAnswer: z.string(),\n      correctAnswer: z.string(),\n      attempts: z.number().default(1),\n      timestamp: z.date()\n    })\n  ).default([]),\n  feedbackMessages: z.object({\n    correct: z.string().optional(),\n    incorrect: z.string().optional()\n  }).optional()\n});\n\n/**\n * Fill-in-the-Blank Exercise\n */\nexport const FillInTheBlankExerciseSchema = z.object({\n  id: z.string(),\n  type: z.literal('fill-in-blank'),\n  title: z.string(),\n  description: z.string().optional(),\n  questions: z.array(\n    z.object({\n      id: z.string(),\n      prompt: z.string(),\n      correctAnswer: z.string(),\n      acceptedVariations: z.array(z.string()).optional(),\n      difficulty: z.enum(['easy', 'medium', 'hard']).default('medium')\n    })\n  ),\n  currentQuestionIndex: z.number().default(0),\n  feedback: z.array(\n    z.object({\n      questionId: z.string(),\n      isCorrect: z.boolean(),\n      userAnswer: z.string(),\n      correctAnswer: z.string(),\n      timestamp: z.date()\n    })\n  ).default([]),\n  feedbackMessages: z.object({\n    correct: z.string().optional(),\n    incorrect: z.string().optional()\n  }).optional()\n});\n\n// ============================================================================\n// SHARED SCHEMAS\n// ============================================================================\n\n/**\n * Base exercise item (shared across all types)\n */\nexport const ExerciseItemBaseSchema = z.object({\n  id: z.string().min(1, 'Exercise item ID is required'),\n  vocabularyId: z.string().min(1, 'Vocabulary ID is required'),\n  german: z.string().min(1, 'German text is required'),\n  bulgarian: z.string().min(1, 'Bulgarian text is required'),\n  partOfSpeech: z.enum(['noun', 'verb', 'adjective', 'adverb', 'other']),\n  difficulty: z.enum(['easy', 'medium', 'hard']).default('medium'),\n  category: z.string().optional()\n});\n\n/**\n * Exercise attempt result\n */\nexport const ExerciseAttemptResultSchema = z.object({\n  exerciseId: z.string(),\n  correct: z.boolean(),\n  userAnswer: z.string(),\n  correctAnswer: z.string(),\n  timeSpent: z.number().min(0, 'Time spent must be positive'),\n  timestamp: z.date().default(() => new Date())\n});\n\n/**\n * Exercise session progress\n */\nexport const ExerciseSessionSchema = z.object({\n  sessionId: z.string(),\n  exerciseType: z.enum(['fill-in-blank', 'multiple-choice', 'matching', 'ordering', 'typing']),\n  startTime: z.date(),\n  endTime: z.date().optional(),\n  totalAttempts: z.number().min(0).default(0),\n  correctAttempts: z.number().min(0).default(0),\n  results: z.array(ExerciseAttemptResultSchema).default([])\n});\n\n// ============================================================================\n// 1. FILL-IN-THE-BLANK EXERCISE\n// ============================================================================\n\n/**\n * Fill-in-the-Blank question with blanks marked by underscores\n * Example: \"Das Haus ist sehr ____\" -> answer: \"schön\"\n */\nexport const FillInTheBlankQuestionSchema = ExerciseItemBaseSchema.extend({\n  type: z.literal('fill-in-blank'),\n  question: z.string().min(10, 'Question must be at least 10 characters'),\n  blankPosition: z.number().min(0, 'Blank position must be non-negative'),\n  correctAnswer: z.string().min(1, 'Correct answer is required'),\n  hints: z.array(z.string()).optional(),\n  acceptedVariations: z.array(z.string()).optional(),\n  source: z.enum(['german', 'bulgarian'])\n});\n\nexport const FillInTheBlankExerciseV2Schema = z.object({\n  id: z.string(),\n  type: z.literal('fill-in-blank'),\n  questions: z.array(FillInTheBlankQuestionSchema),\n  currentQuestionIndex: z.number().min(0).default(0),\n  userAnswers: z.array(z.string()).default([]),\n  isComplete: z.boolean().default(false),\n  feedback: z.array(z.object({\n    questionId: z.string(),\n    isCorrect: z.boolean(),\n    userAnswer: z.string(),\n    correctAnswer: z.string()\n  })).default([])\n});\n\n// ============================================================================\n// 2. MULTIPLE CHOICE EXERCISE\n// ============================================================================\n\n/**\n * Multiple choice option\n */\nexport const MultipleChoiceOptionSchema = z.object({\n  id: z.string(),\n  text: z.string().min(1, 'Option text is required'),\n  isCorrect: z.boolean()\n});\n\n/**\n * Multiple choice question\n */\nexport const MultipleChoiceQuestionSchema = ExerciseItemBaseSchema.extend({\n  type: z.literal('multiple-choice'),\n  question: z.string().min(10, 'Question must be at least 10 characters'),\n  options: z.array(MultipleChoiceOptionSchema).min(2, 'At least 2 options required'),\n  explanation: z.string().optional(),\n  source: z.enum(['german', 'bulgarian'])\n});\n\nexport const MultipleChoiceExerciseSchema = z.object({\n  id: z.string(),\n  type: z.literal('multiple-choice'),\n  questions: z.array(MultipleChoiceQuestionSchema),\n  currentQuestionIndex: z.number().min(0).default(0),\n  userAnswers: z.array(z.string()).default([]),\n  isComplete: z.boolean().default(false),\n  feedback: z.array(z.object({\n    questionId: z.string(),\n    isCorrect: z.boolean(),\n    userAnswer: z.string(),\n    correctAnswerId: z.string()\n  })).default([])\n});\n\n// ============================================================================\n// 3. MATCHING EXERCISE\n// ============================================================================\n\n/**\n * Matching pair (connect left item to right item)\n */\nexport const MatchingPairSchema = z.object({\n  id: z.string(),\n  leftId: z.string(),\n  leftText: z.string().min(1, 'Left text is required'),\n  rightId: z.string(),\n  rightText: z.string().min(1, 'Right text is required')\n});\n\nexport const MatchingExerciseSchema = z.object({\n  id: z.string(),\n  type: z.literal('matching'),\n  title: z.string().min(5, 'Title is required'),\n  pairs: z.array(MatchingPairSchema).min(2, 'At least 2 pairs required'),\n  userMatches: z.array(z.object({\n    leftId: z.string(),\n    rightId: z.string()\n  })).default([]),\n  isComplete: z.boolean().default(false),\n  correctCount: z.number().min(0).default(0)\n});\n\n// ============================================================================\n// 4. ORDERING/SEQUENCING EXERCISE\n// ============================================================================\n\n/**\n * Sequencing item (words, sentences, or steps to arrange)\n */\nexport const SequencingItemSchema = z.object({\n  id: z.string(),\n  text: z.string().min(1, 'Item text is required'),\n  correctPosition: z.number().min(0, 'Correct position must be non-negative')\n});\n\nexport const OrderingExerciseSchema = z.object({\n  id: z.string(),\n  type: z.literal('ordering'),\n  title: z.string().min(5, 'Title is required'),\n  instruction: z.string().default('Put the items in the correct order'),\n  items: z.array(SequencingItemSchema).min(2, 'At least 2 items required'),\n  userOrder: z.array(z.string()).default([]),\n  isComplete: z.boolean().default(false),\n  correctCount: z.number().min(0).default(0)\n});\n\n// ============================================================================\n// 5. TYPING EXERCISE\n// ============================================================================\n\n/**\n * Typing exercise - translate or transcribe\n */\nexport const TypingExerciseQuestionSchema = ExerciseItemBaseSchema.extend({\n  type: z.literal('typing'),\n  prompt: z.string().min(5, 'Prompt is required'),\n  correctAnswer: z.string().min(1, 'Correct answer is required'),\n  caseSensitive: z.boolean().default(false),\n  acceptedVariations: z.array(z.string()).optional(),\n  hints: z.array(z.string()).optional(),\n  source: z.enum(['german', 'bulgarian']),\n  exerciseMode: z.enum(['translation', 'transcription'])\n});\n\nexport const TypingExerciseSchema = z.object({\n  id: z.string(),\n  type: z.literal('typing'),\n  questions: z.array(TypingExerciseQuestionSchema),\n  currentQuestionIndex: z.number().min(0).default(0),\n  userAnswers: z.array(z.string()).default([]),\n  isComplete: z.boolean().default(false),\n  feedback: z.array(z.object({\n    questionId: z.string(),\n    isCorrect: z.boolean(),\n    userAnswer: z.string(),\n    correctAnswer: z.string(),\n    similarity: z.number().min(0).max(1)\n  })).default([])\n});\n\n// ============================================================================\n// UNION TYPES & GENERAL SCHEMAS\n// ============================================================================\n\n/**\n * Any exercise type\n */\nexport const ExerciseSchema = z.union([\n  SentenceBuilderExerciseSchema,\n  FillInTheBlankExerciseSchema,\n  FillInTheBlankExerciseV2Schema,\n  MultipleChoiceExerciseSchema,\n  MatchingExerciseSchema,\n  OrderingExerciseSchema,\n  TypingExerciseSchema\n]);\n\n/**\n * Exercise results for tracking and analytics\n */\nexport const ExerciseResultsSchema = z.object({\n  userId: z.string(),\n  exerciseId: z.string(),\n  exerciseType: z.string(),\n  completionTime: z.number().min(0),\n  score: z.number().min(0).max(100),\n  attempts: z.number().min(1),\n  passedOnFirstAttempt: z.boolean(),\n  timestamp: z.date().default(() => new Date())\n});\n\n/**\n * Exercise statistics for user progress\n */\nexport const ExerciseStatsSchema = z.object({\n  totalExercises: z.number().min(0),\n  completedExercises: z.number().min(0),\n  averageScore: z.number().min(0).max(100),\n  totalTime: z.number().min(0),\n  byType: z.object({\n    'fill-in-blank': z.number().min(0),\n    'multiple-choice': z.number().min(0),\n    'matching': z.number().min(0),\n    'ordering': z.number().min(0),\n    'typing': z.number().min(0)\n  })\n});\n\n// ============================================================================\n// TYPE EXPORTS\n// ============================================================================\n\nexport type ExerciseItemBase = z.infer<typeof ExerciseItemBaseSchema>;\nexport type ExerciseAttemptResult = z.infer<typeof ExerciseAttemptResultSchema>;\nexport type ExerciseSession = z.infer<typeof ExerciseSessionSchema>;\n\nexport type SentenceBuilderExercise = z.infer<typeof SentenceBuilderExerciseSchema>;\nexport type SentenceBuilderQuestion = z.infer<\n  typeof SentenceBuilderExerciseSchema.shape.questions.element\n>;\n\nexport type FillInTheBlankQuestion = z.infer<typeof FillInTheBlankQuestionSchema>;\nexport type FillInTheBlankExercise = z.infer<typeof FillInTheBlankExerciseSchema>;\nexport type FillInTheBlankExerciseV2 = z.infer<typeof FillInTheBlankExerciseV2Schema>;\n\nexport type MultipleChoiceOption = z.infer<typeof MultipleChoiceOptionSchema>;\nexport type MultipleChoiceQuestion = z.infer<typeof MultipleChoiceQuestionSchema>;\nexport type MultipleChoiceExercise = z.infer<typeof MultipleChoiceExerciseSchema>;\n\nexport type MatchingPair = z.infer<typeof MatchingPairSchema>;\nexport type MatchingExercise = z.infer<typeof MatchingExerciseSchema>;\n\nexport type SequencingItem = z.infer<typeof SequencingItemSchema>;\nexport type OrderingExercise = z.infer<typeof OrderingExerciseSchema>;\n\nexport type TypingExerciseQuestion = z.infer<typeof TypingExerciseQuestionSchema>;\nexport type TypingExercise = z.infer<typeof TypingExerciseSchema>;\n\nexport type Exercise = z.infer<typeof ExerciseSchema>;\nexport type ExerciseResults = z.infer<typeof ExerciseResultsSchema>;\nexport type ExerciseStats = z.infer<typeof ExerciseStatsSchema>;","import { ExerciseResultsSchema, ExerciseStatsSchema } from '$lib/schemas/exercises';\n\n/**\n * Exercise Service\n * Handles all exercise-related business logic:\n * - Exercise generation\n * - Answer validation\n * - Progress tracking\n * - Statistics\n */\n\nexport class ExerciseService {\n  /**\n   * Check if a fill-in-the-blank answer is correct\n   * Handles variations and case sensitivity\n   */\n  static validateFillInBlankAnswer(\n    userAnswer: string,\n    correctAnswer: string,\n    acceptedVariations?: string[]\n  ): boolean {\n    const normalized = userAnswer.trim().toLowerCase();\n    const normalizedCorrect = correctAnswer.trim().toLowerCase();\n\n    // Check exact match\n    if (normalized === normalizedCorrect) return true;\n\n    // Check variations\n    if (acceptedVariations) {\n      for (const variation of acceptedVariations) {\n        if (normalized === variation.trim().toLowerCase()) return true;\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Check if a multiple choice answer is correct\n   */\n  static validateMultipleChoiceAnswer(selectedOptionId: string, correctOptionId: string): boolean {\n    return selectedOptionId === correctOptionId;\n  }\n\n  /**\n   * Validate matching exercise - check if all pairs are correct\n   */\n  static validateMatching(\n    userMatches: Array<{ leftId: string; rightId: string }>,\n    correctPairs: Array<{ leftId: string; rightId: string }>\n  ): boolean {\n    let correctCount = 0;\n\n    for (const correctPair of correctPairs) {\n      const userMatch = userMatches.find((m) => m.leftId === correctPair.leftId);\n      if (userMatch && userMatch.rightId === correctPair.rightId) {\n        correctCount++;\n      }\n    }\n\n    return correctCount === correctPairs.length;\n  }\n\n  /**\n   * Validate ordering exercise - check if items are in correct order\n   */\n  static validateOrdering(userOrder: string[], correctOrder: string[]): boolean {\n    if (userOrder.length !== correctOrder.length) {\n      return false;\n    }\n\n    for (let i = 0; i < userOrder.length; i++) {\n      if (userOrder[i] !== correctOrder[i]) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Calculate similarity between user and correct answer (0-1)\n   * Used for typing exercises\n   */\n  static calculateSimilarity(userAnswer: string, correctAnswer: string): number {\n    const user = userAnswer.trim().toLowerCase();\n    const correct = correctAnswer.trim().toLowerCase();\n\n    // Exact match\n    if (user === correct) return 1;\n\n    // Levenshtein distance\n    const maxLength = Math.max(user.length, correct.length);\n    if (maxLength === 0) return 1; // Both empty\n\n    const distance = this.levenshteinDistance(user, correct);\n    return Math.max(0, 1 - distance / maxLength);\n  }\n\n  /**\n   * Levenshtein distance algorithm for string similarity\n   */\n  private static levenshteinDistance(a: string, b: string): number {\n    const rows = b.length + 1;\n    const cols = a.length + 1;\n    const matrix: number[][] = [];\n\n    // Initialize matrix\n    for (let i = 0; i < rows; i++) {\n      const row = (matrix[i] = [] as number[]);\n      row[0] = i;\n    }\n\n    const firstRow = (matrix[0] ?? (matrix[0] = [] as number[]));\n    for (let j = 0; j < cols; j++) {\n      firstRow[j] = j;\n    }\n\n    // Fill the matrix\n    for (let i = 1; i < rows; i++) {\n      const row = (matrix[i] ?? (matrix[i] = [] as number[]));\n      for (let j = 1; j < cols; j++) {\n        if (b[i - 1] === a[j - 1]) {\n          row[j] = matrix[i - 1]?.[j - 1] ?? 0;\n        } else {\n          const val1 = matrix[i - 1]?.[j - 1] ?? 0;\n          const val2 = row[j - 1] ?? 0;\n          const val3 = matrix[i - 1]?.[j] ?? 0;\n\n          row[j] = Math.min(val1, val2, val3) + 1;\n        }\n      }\n    }\n\n    const lastRow = matrix[b.length] ?? [];\n    return lastRow[a.length] ?? 0;\n  }\n\n  /**\n   * Validate typing answer with similarity threshold\n   */\n  static validateTypingAnswer(\n    userAnswer: string,\n    correctAnswer: string,\n    caseSensitive: boolean = false,\n    acceptedVariations?: string[],\n    threshold: number = 0.85\n  ): { isCorrect: boolean; similarity: number } {\n    let normalizedUser = userAnswer.trim();\n    let normalizedCorrect = correctAnswer.trim();\n\n    if (!caseSensitive) {\n      normalizedUser = normalizedUser.toLowerCase();\n      normalizedCorrect = normalizedCorrect.toLowerCase();\n    }\n\n    // Check exact match\n    if (normalizedUser === normalizedCorrect) {\n      return { isCorrect: true, similarity: 1 };\n    }\n\n    // Check variations\n    if (acceptedVariations) {\n      for (const variation of acceptedVariations) {\n        let normalizedVariation = variation.trim();\n        if (!caseSensitive) {\n          normalizedVariation = normalizedVariation.toLowerCase();\n        }\n        if (normalizedUser === normalizedVariation) {\n          return { isCorrect: true, similarity: 1 };\n        }\n      }\n    }\n\n    // Calculate similarity\n    const similarity = this.calculateSimilarity(normalizedUser, normalizedCorrect);\n    return {\n      isCorrect: similarity >= threshold,\n      similarity\n    };\n  }\n\n  /**\n   * Calculate exercise score as percentage\n   */\n  static calculateScore(correctCount: number, totalCount: number): number {\n    if (totalCount === 0) return 0;\n    return Math.round((correctCount / totalCount) * 100);\n  }\n\n  /**\n   * Calculate statistics from exercise results\n   */\n  static calculateStats(results: any[]): {\n    totalAttempts: number;\n    correctAnswers: number;\n    incorrectAnswers: number;\n    accuracy: number;\n  } {\n    if (results.length === 0) {\n      return { totalAttempts: 0, correctAnswers: 0, incorrectAnswers: 0, accuracy: 0 };\n    }\n\n    const totalAttempts = results.length;\n    const correctAnswers = results.filter((r) => r.isCorrect || r.correct).length;\n    const incorrectAnswers = totalAttempts - correctAnswers;\n    const accuracy = (correctAnswers / totalAttempts) * 100;\n\n    return { totalAttempts, correctAnswers, incorrectAnswers, accuracy };\n  }\n\n  /**\n   * Validate exercise results\n   */\n  static validateResults(data: unknown) {\n    return ExerciseResultsSchema.parse(data);\n  }\n\n  /**\n   * Validate exercise statistics\n   */\n  static validateStats(data: unknown) {\n    return ExerciseStatsSchema.parse(data);\n  }\n}\n","<script lang=\"ts\">\n  import { createEventDispatcher } from 'svelte';\n  import type { FillInTheBlankExerciseV2, FillInTheBlankQuestion } from '$lib/schemas/exercises';\n  import { ExerciseService } from '$lib/services/exercise';\n\n  let { exercise = $bindable() }: { exercise: FillInTheBlankExerciseV2 } = $props();\n  const dispatch = createEventDispatcher();\n\n  let userAnswer = $state('');\n  let showFeedback = $state(false);\n  let isCorrect = $state(false);\n\n  const currentQuestion = $derived<FillInTheBlankQuestion | undefined>(\n    exercise.questions[exercise.currentQuestionIndex]\n  );\n\n  function checkAnswer() {\n    if (!userAnswer.trim() || !currentQuestion) return;\n\n    isCorrect = ExerciseService.validateFillInBlankAnswer(\n      userAnswer,\n      currentQuestion.correctAnswer,\n      currentQuestion.acceptedVariations\n    );\n\n    showFeedback = true;\n\n    // Store feedback\n    exercise.feedback.push({\n      questionId: currentQuestion.id,\n      isCorrect,\n      userAnswer,\n      correctAnswer: currentQuestion.correctAnswer\n    });\n\n    // Store user answer\n    exercise.userAnswers.push(userAnswer);\n\n    dispatch('exerciseComplete', { isCorrect });\n  }\n\n  function nextQuestion() {\n    userAnswer = '';\n    showFeedback = false;\n    dispatch('next');\n  }\n\n  function skipQuestion() {\n    exercise.userAnswers.push('');\n    dispatch('skip');\n  }\n</script>\n\n<div class=\"fill-in-blank\">\n  {#if currentQuestion}\n    <div class=\"question\">\n      <h3>{currentQuestion.question}</h3>\n    </div>\n\n    <div class=\"input-group\">\n      <input\n        type=\"text\"\n        bind:value={userAnswer}\n        placeholder=\"Enter your answer\"\n        class=\"answer-input\"\n        onkeydown={(e) => e.key === 'Enter' && checkAnswer()}\n        disabled={showFeedback}\n      />\n      {#if !showFeedback}\n        <button onclick={checkAnswer} class=\"btn btn-check\">Check</button>\n      {/if}\n    </div>\n\n    {#if showFeedback}\n      <div class={`feedback ${isCorrect ? 'correct' : 'incorrect'}`}>\n        {#if isCorrect}\n          <span class=\"feedback-icon\">✓</span>\n          <span>Correct!</span>\n        {:else}\n          <span class=\"feedback-icon\">✗</span>\n          <span>Incorrect. The correct answer is: <strong>{currentQuestion.correctAnswer}</strong></span>\n        {/if}\n      </div>\n\n        {#if currentQuestion.hints && currentQuestion.hints.length > 0}\n          <div class=\"hints\">\n            <strong>Hints:</strong>\n            <ul>\n              {#each currentQuestion.hints as hint}\n                <li>{hint}</li>\n              {/each}\n            </ul>\n          </div>\n        {/if}\n\n        <div class=\"action-buttons\">\n          <button onclick={nextQuestion} class=\"btn btn-primary\">Next</button>\n          <button onclick={skipQuestion} class=\"btn btn-secondary\">Skip</button>\n        </div>\n      {/if}\n    {/if}\n</div>\n\n<style>\n  .fill-in-blank {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-md);\n  }\n\n  .question {\n    padding: var(--spacing-md);\n    background: var(--color-bg-tertiary);\n    border-radius: var(--radius-md);\n  }\n\n  .question h3 {\n    margin: 0;\n    font-size: 1.125rem;\n    color: var(--color-text);\n  }\n\n  .input-group {\n    display: flex;\n    gap: var(--spacing-md);\n  }\n\n  .answer-input {\n    flex: 1;\n    padding: var(--spacing-md);\n    border: 2px solid var(--color-border);\n    border-radius: var(--radius-md);\n    font-size: 1rem;\n    transition: border-color 0.2s;\n  }\n\n  .answer-input:focus {\n    outline: none;\n    border-color: var(--color-primary);\n  }\n\n  .answer-input:disabled {\n    background: var(--color-bg-secondary);\n    cursor: not-allowed;\n  }\n\n  .btn-check {\n    padding: var(--spacing-md) var(--spacing-lg);\n    background: var(--color-primary);\n    color: white;\n    border: none;\n    border-radius: var(--radius-md);\n    font-weight: 500;\n    cursor: pointer;\n    transition: background 0.2s;\n  }\n\n  .btn-check:hover {\n    background: var(--color-primary-dark);\n  }\n\n  .feedback {\n    padding: var(--spacing-md);\n    border-radius: var(--radius-md);\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-md);\n    font-weight: 500;\n  }\n\n  .feedback.correct {\n    background: var(--color-success-light);\n    color: var(--color-success-dark);\n  }\n\n  .feedback.incorrect {\n    background: var(--color-error-light);\n    color: var(--color-error-dark);\n  }\n\n  .feedback-icon {\n    font-size: 1.25rem;\n    font-weight: bold;\n  }\n\n  .hints {\n    padding: var(--spacing-md);\n    background: var(--color-info-light);\n    border-left: 4px solid var(--color-info);\n    border-radius: var(--radius-md);\n  }\n\n  .hints strong {\n    display: block;\n    margin-bottom: var(--spacing-sm);\n    color: var(--color-info-dark);\n  }\n\n  .hints ul {\n    margin: 0;\n    padding-left: var(--spacing-lg);\n  }\n\n  .hints li {\n    margin: var(--spacing-sm) 0;\n    color: var(--color-text);\n  }\n\n  .action-buttons {\n    display: flex;\n    gap: var(--spacing-md);\n    justify-content: flex-end;\n  }\n\n  .btn {\n    padding: var(--spacing-md) var(--spacing-lg);\n    border: none;\n    border-radius: var(--radius-md);\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s;\n  }\n\n  .btn-primary {\n    background: var(--color-primary);\n    color: white;\n  }\n\n  .btn-primary:hover {\n    background: var(--color-primary-dark);\n  }\n\n  .btn-secondary {\n    background: var(--color-border);\n    color: var(--color-text);\n  }\n\n  .btn-secondary:hover {\n    background: var(--color-border-dark);\n  }\n</style>\n","<script lang=\"ts\">\n  import { createEventDispatcher } from 'svelte';\n  import type { MatchingExercise } from '$lib/schemas/exercises';\n\n  let { exercise = $bindable() }: { exercise: MatchingExercise } = $props();\n  const dispatch = createEventDispatcher();\n\n  let userMatches = $state<Record<string, string>>({});\n  let showFeedback = $state(false);\n  let isCorrect = $state(false);\n\n  // Derive left/right items from pairs\n  const leftItems = $derived(exercise.pairs.map((p) => ({ id: p.leftId, text: p.leftText })));\n  const rightItems = $derived(exercise.pairs.map((p) => ({ id: p.rightId, text: p.rightText })));\n\n  function toggleMatch(leftId: string, rightId: string) {\n    if (showFeedback) return;\n\n    if (userMatches[leftId] === rightId) {\n      delete userMatches[leftId];\n    } else {\n      userMatches[leftId] = rightId;\n    }\n  }\n\n  function checkAnswer() {\n    const pairs = exercise.pairs.map((pair) => ({\n      leftId: pair.leftId,\n      rightId: userMatches[pair.leftId],\n    }));\n\n    // Validate by comparing with original pairs\n    isCorrect = pairs.every((p) => {\n      const correct = exercise.pairs.find((cp) => cp.leftId === p.leftId);\n      return correct?.rightId === p.rightId;\n    });\n    showFeedback = true;\n  }\n\n  function nextQuestion() {\n    userMatches = {};\n    showFeedback = false;\n    dispatch('next');\n  }\n\n  function skipQuestion() {\n    dispatch('skip');\n  }\n\n  function isMatchCorrect(leftId: string, rightId: string): boolean {\n    const correctMatch = exercise.pairs.find((p) => p.leftId === leftId);\n    return correctMatch?.rightId === rightId;\n  }\n\n  function allMatched(): boolean {\n    return exercise.pairs.every((pair) => userMatches[pair.leftId]);\n  }\n\n  function getRandomLeftItems() {\n    return leftItems;\n  }\n\n  function getRightItems() {\n    return rightItems;\n  }\n</script>\n\n<div class=\"matching\">\n  <div class=\"question\">\n    <h3>{exercise.title}</h3>\n  </div>\n\n  <div class=\"matching-container\">\n    <div class=\"column left\">\n      <h4>Choose</h4>\n      <div class=\"items\">\n        {#each getRandomLeftItems() as leftItem (leftItem.id)}\n          <div class=\"item-group\">\n            <div class=\"item left-item\">{leftItem.text}</div>\n            <div class=\"connections\">\n              {#each getRightItems() as rightItem (rightItem.id)}\n                <button\n                  onclick={() => toggleMatch(leftItem.id, rightItem.id)}\n                  class={`connection ${userMatches[leftItem.id] === rightItem.id ? 'active' : ''} ${showFeedback && isMatchCorrect(leftItem.id, userMatches[leftItem.id] || '') ? 'correct' : ''} ${showFeedback && userMatches[leftItem.id] === rightItem.id && !isMatchCorrect(leftItem.id, rightItem.id) ? 'incorrect' : ''}`}\n                  disabled={showFeedback}\n                  title={`Match to ${rightItem.text}`}\n                >\n                </button>\n              {/each}\n            </div>\n          </div>\n        {/each}\n      </div>\n    </div>\n\n    <div class=\"column right\">\n      <h4>Match with</h4>\n      <div class=\"items\">\n        {#each getRightItems() as rightItem (rightItem.id)}\n          <div class=\"item right-item\">{rightItem.text}</div>\n        {/each}\n      </div>\n    </div>\n  </div>\n\n  {#if !showFeedback}\n    <div class=\"action-buttons\">\n      <button\n        onclick={checkAnswer}\n        disabled={!allMatched()}\n        class=\"btn btn-primary\"\n      >\n        Check Matches\n      </button>\n      <button onclick={skipQuestion} class=\"btn btn-secondary\">Skip</button>\n    </div>\n  {:else}\n    <div class={`feedback ${isCorrect ? 'correct' : 'incorrect'}`}>\n      {#if isCorrect}\n        <span class=\"feedback-icon\">✓</span>\n        <span>Perfect! All matches are correct!</span>\n      {:else}\n        <span class=\"feedback-icon\">✗</span>\n        <span>Some matches are incorrect. Try again or skip to continue.</span>\n      {/if}\n    </div>\n\n    <div class=\"action-buttons\">\n      <button onclick={nextQuestion} class=\"btn btn-primary\">Next</button>\n      <button onclick={skipQuestion} class=\"btn btn-secondary\">Skip</button>\n    </div>\n  {/if}\n</div>\n\n<style>\n  .matching {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-md);\n  }\n\n  .question {\n    padding: var(--spacing-md);\n    background: var(--color-bg-tertiary);\n    border-radius: var(--radius-md);\n  }\n\n  .question h3 {\n    margin: 0;\n    font-size: 1.125rem;\n    color: var(--color-text);\n  }\n\n  .matching-container {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: var(--spacing-lg);\n    padding: var(--spacing-md);\n    background: var(--color-bg-secondary);\n    border-radius: var(--radius-md);\n  }\n\n  .column {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-md);\n  }\n\n  .column h4 {\n    margin: 0;\n    font-weight: 600;\n    color: var(--color-text-secondary);\n    font-size: 0.875rem;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n  }\n\n  .items {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-md);\n  }\n\n  .item-group {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-md);\n  }\n\n  .item {\n    padding: var(--spacing-md);\n    background: white;\n    border: 2px solid var(--color-border);\n    border-radius: var(--radius-md);\n    flex: 1;\n    font-weight: 500;\n  }\n\n  .left-item {\n    text-align: right;\n  }\n\n  .right-item {\n    text-align: left;\n  }\n\n  .connections {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-sm);\n  }\n\n  .connection {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    border: 2px solid var(--color-border);\n    background: white;\n    cursor: pointer;\n    transition: all 0.2s;\n  }\n\n  .connection:hover {\n    background: var(--color-primary-light);\n    border-color: var(--color-primary);\n  }\n\n  .connection.active {\n    background: var(--color-primary);\n    border-color: var(--color-primary);\n  }\n\n  .connection.correct {\n    background: var(--color-success);\n    border-color: var(--color-success);\n  }\n\n  .connection.incorrect {\n    background: var(--color-error);\n    border-color: var(--color-error);\n  }\n\n  .connection:disabled {\n    cursor: not-allowed;\n    opacity: 0.6;\n  }\n\n  .feedback {\n    padding: var(--spacing-md);\n    border-radius: var(--radius-md);\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-md);\n    font-weight: 500;\n  }\n\n  .feedback.correct {\n    background: var(--color-success-light);\n    color: var(--color-success-dark);\n  }\n\n  .feedback.incorrect {\n    background: var(--color-error-light);\n    color: var(--color-error-dark);\n  }\n\n  .feedback-icon {\n    font-size: 1.25rem;\n    font-weight: bold;\n  }\n\n  .action-buttons {\n    display: flex;\n    gap: var(--spacing-md);\n    justify-content: flex-end;\n  }\n\n  .btn {\n    padding: var(--spacing-md) var(--spacing-lg);\n    border: none;\n    border-radius: var(--radius-md);\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s;\n  }\n\n  .btn-primary {\n    background: var(--color-primary);\n    color: white;\n  }\n\n  .btn-primary:hover:not(:disabled) {\n    background: var(--color-primary-dark);\n  }\n\n  .btn-primary:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n\n  .btn-secondary {\n    background: var(--color-border);\n    color: var(--color-text);\n  }\n\n  .btn-secondary:hover {\n    background: var(--color-border-dark);\n  }\n\n  @media (max-width: 768px) {\n    .matching-container {\n      grid-template-columns: 1fr;\n    }\n  }\n</style>\n","<script lang=\"ts\">\n  import { createEventDispatcher } from 'svelte';\n  import type { OrderingExercise } from '$lib/schemas/exercises';\n  import { ExerciseService } from '$lib/services/exercise';\n\n  let { exercise = $bindable() }: { exercise: OrderingExercise } = $props();\n  const dispatch = createEventDispatcher();\n\n  let items = $state<Array<{ id: string; text: string }>>([]);\n  let showFeedback = $state(false);\n  let isCorrect = $state(false);\n  let draggedItem = $state<string | null>(null);\n\n  // Derive correct order from item positions\n  const correctOrderIds = $derived([...exercise.items].sort((a, b) => a.correctPosition - b.correctPosition).map((i) => i.id));\n\n  $effect(() => {\n    // Shuffle items on component mount\n    items = exercise.items\n      .map((item) => ({ id: item.id, text: item.text }))\n      .sort(() => Math.random() - 0.5);\n  });\n\n  function handleDragStart(e: DragEvent, itemId: string) {\n    draggedItem = itemId;\n    if (e.dataTransfer) {\n      e.dataTransfer.effectAllowed = 'move';\n    }\n  }\n\n  function handleDragOver(e: DragEvent) {\n    e.preventDefault();\n    if (e.dataTransfer) {\n      e.dataTransfer.dropEffect = 'move';\n    }\n  }\n\n  function handleDrop(e: DragEvent, targetIndex: number) {\n    e.preventDefault();\n\n    if (!draggedItem) return;\n\n    const draggedIndex = items.findIndex((item) => item.id === draggedItem);\n    if (draggedIndex === -1 || draggedIndex === targetIndex) {\n      draggedItem = null;\n      return;\n    }\n\n    // Reorder items\n    const removed = items.splice(draggedIndex, 1)[0];\n    if (!removed) {\n      draggedItem = null;\n      return;\n    }\n    items.splice(targetIndex, 0, removed);\n    draggedItem = null;\n  }\n\n  function checkAnswer() {\n    const userOrder = items.map((item) => item.id);\n    const correctOrder = correctOrderIds;\n\n    isCorrect = ExerciseService.validateOrdering(userOrder, correctOrder);\n    showFeedback = true;\n  }\n\n  function nextQuestion() {\n    items = [];\n    showFeedback = false;\n    draggedItem = null;\n    dispatch('next');\n  }\n\n  function skipQuestion() {\n    dispatch('skip');\n  }\n\n  function shuffleItems() {\n    items = items.sort(() => Math.random() - 0.5);\n  }\n</script>\n\n<div class=\"ordering\">\n  <div class=\"question\">\n    <h3>{exercise.title}</h3>\n  </div>\n\n  <div class=\"description\">\n    <p>Drag and drop the items to arrange them in the correct order.</p>\n  </div>\n\n  <div class=\"items-container\">\n    {#each items as item, index (item.id)}\n      <div\n        class=\"item\"\n        draggable={!showFeedback}\n        ondragstart={(e) => handleDragStart(e, item.id)}\n        ondragover={handleDragOver}\n        ondrop={(e) => handleDrop(e, index)}\n        role=\"listitem\"\n        class:dragging={draggedItem === item.id}\n        class:disabled={showFeedback}\n      >\n        <span class=\"order-number\">{index + 1}</span>\n        <span class=\"item-text\">{item.text}</span>\n        {#if showFeedback}\n          {#if correctOrderIds[index] === item.id}\n            <span class=\"status correct\">✓</span>\n          {:else}\n            <span class=\"status incorrect\">✗</span>\n          {/if}\n        {/if}\n      </div>\n    {/each}\n  </div>\n\n  {#if !showFeedback}\n    <div class=\"action-buttons\">\n      <button onclick={shuffleItems} class=\"btn btn-secondary\">Shuffle</button>\n      <button onclick={checkAnswer} class=\"btn btn-primary\">Check Order</button>\n      <button onclick={skipQuestion} class=\"btn btn-secondary\">Skip</button>\n    </div>\n  {:else}\n    <div class={`feedback ${isCorrect ? 'correct' : 'incorrect'}`}>\n      {#if isCorrect}\n        <span class=\"feedback-icon\">✓</span>\n        <span>Perfect! You have the correct order!</span>\n      {:else}\n        <span class=\"feedback-icon\">✗</span>\n        <span>Not quite right. Check the marked items and try again.</span>\n      {/if}\n    </div>\n\n    <div class=\"correct-order\">\n      <strong>Correct Order:</strong>\n      <ol>\n        {#each correctOrderIds as itemId}\n          {@const correctItem = exercise.items.find((i) => i.id === itemId)}\n          <li>{correctItem?.text}</li>\n        {/each}\n      </ol>\n    </div>\n\n    <div class=\"action-buttons\">\n      <button onclick={nextQuestion} class=\"btn btn-primary\">Next</button>\n      <button onclick={skipQuestion} class=\"btn btn-secondary\">Skip</button>\n    </div>\n  {/if}\n</div>\n\n<style>\n  .ordering {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-md);\n  }\n\n  .question {\n    padding: var(--spacing-md);\n    background: var(--color-bg-tertiary);\n    border-radius: var(--radius-md);\n  }\n\n  .question h3 {\n    margin: 0;\n    font-size: 1.125rem;\n    color: var(--color-text);\n  }\n\n  .description {\n    padding: var(--spacing-md);\n    background: var(--color-info-light);\n    border-radius: var(--radius-md);\n    border-left: 4px solid var(--color-info);\n  }\n\n  .description p {\n    margin: 0;\n    color: var(--color-text);\n    font-size: 0.9375rem;\n  }\n\n  .items-container {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-md);\n  }\n\n  .item {\n    padding: var(--spacing-md);\n    background: white;\n    border: 2px solid var(--color-border);\n    border-radius: var(--radius-md);\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-md);\n    cursor: grab;\n    transition: all 0.2s;\n    user-select: none;\n  }\n\n  .item:not(.disabled):hover {\n    border-color: var(--color-primary);\n    background: var(--color-bg-tertiary);\n  }\n\n  .item.dragging {\n    opacity: 0.5;\n    background: var(--color-primary-light);\n    border-color: var(--color-primary);\n  }\n\n  .item.disabled {\n    cursor: not-allowed;\n  }\n\n  .order-number {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 32px;\n    height: 32px;\n    background: var(--color-primary);\n    color: white;\n    border-radius: 50%;\n    font-weight: bold;\n    flex-shrink: 0;\n  }\n\n  .item-text {\n    flex: 1;\n    font-weight: 500;\n  }\n\n  .status {\n    font-weight: bold;\n    font-size: 1.25rem;\n    flex-shrink: 0;\n  }\n\n  .status.correct {\n    color: var(--color-success);\n  }\n\n  .status.incorrect {\n    color: var(--color-error);\n  }\n\n  .feedback {\n    padding: var(--spacing-md);\n    border-radius: var(--radius-md);\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-md);\n    font-weight: 500;\n  }\n\n  .feedback.correct {\n    background: var(--color-success-light);\n    color: var(--color-success-dark);\n  }\n\n  .feedback.incorrect {\n    background: var(--color-error-light);\n    color: var(--color-error-dark);\n  }\n\n  .feedback-icon {\n    font-size: 1.25rem;\n    font-weight: bold;\n  }\n\n  .correct-order {\n    padding: var(--spacing-md);\n    background: var(--color-info-light);\n    border-left: 4px solid var(--color-info);\n    border-radius: var(--radius-md);\n  }\n\n  .correct-order strong {\n    display: block;\n    margin-bottom: var(--spacing-sm);\n    color: var(--color-info-dark);\n  }\n\n  .correct-order ol {\n    margin: 0;\n    padding-left: var(--spacing-lg);\n  }\n\n  .correct-order li {\n    margin: var(--spacing-sm) 0;\n    color: var(--color-text);\n  }\n\n  .action-buttons {\n    display: flex;\n    gap: var(--spacing-md);\n    justify-content: flex-end;\n    flex-wrap: wrap;\n  }\n\n  .btn {\n    padding: var(--spacing-md) var(--spacing-lg);\n    border: none;\n    border-radius: var(--radius-md);\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s;\n  }\n\n  .btn-primary {\n    background: var(--color-primary);\n    color: white;\n  }\n\n  .btn-primary:hover {\n    background: var(--color-primary-dark);\n  }\n\n  .btn-secondary {\n    background: var(--color-border);\n    color: var(--color-text);\n  }\n\n  .btn-secondary:hover {\n    background: var(--color-border-dark);\n  }\n</style>\n","<script lang=\"ts\">\n  import { createEventDispatcher } from 'svelte';\n  import type { TypingExercise } from '$lib/schemas/exercises';\n  import { ExerciseService } from '$lib/services/exercise';\n\n  let { exercise = $bindable() }: { exercise: TypingExercise } = $props();\n  const dispatch = createEventDispatcher();\n\n  let userAnswer = $state('');\n  let showFeedback = $state(false);\n  let isCorrect = $state(false);\n  let similarity = $state(0);\n\n  const currentQuestion = $derived(exercise.questions[exercise.currentQuestionIndex]);\n\n  function checkAnswer() {\n    if (!userAnswer.trim()) return;\n\n    // Calculate similarity\n    similarity = ExerciseService.calculateSimilarity(\n      userAnswer.toLowerCase(),\n      (currentQuestion?.correctAnswer || '').toLowerCase()\n    );\n\n    // Determine if correct (default threshold 0.85)\n    // Default threshold 0.85\n    isCorrect = similarity >= 0.85;\n\n    showFeedback = true;\n\n    // Store feedback\n    exercise.feedback.push({\n      questionId: currentQuestion?.id || 'unknown',\n      isCorrect,\n      userAnswer,\n      correctAnswer: currentQuestion?.correctAnswer || '',\n      similarity,\n    });\n\n    // Store user answer\n    exercise.userAnswers.push(userAnswer);\n  }\n\n  function nextQuestion() {\n    userAnswer = '';\n    showFeedback = false;\n    similarity = 0;\n    dispatch('next');\n  }\n\n  function skipQuestion() {\n    exercise.userAnswers.push('');\n    dispatch('skip');\n  }\n\n  function revealAnswer() {\n    userAnswer = currentQuestion?.correctAnswer || '';\n  }\n\n  function getSimilarityPercentage(): number {\n    return Math.round(similarity * 100);\n  }\n\n  function getSimilarityStatus(): 'correct' | 'close' | 'incorrect' {\n    if (isCorrect) return 'correct';\n    if (similarity >= 0.7) return 'close';\n    return 'incorrect';\n  }\n</script>\n\n<div class=\"typing\">\n  <div class=\"question\">\n    <h3>{currentQuestion ? (currentQuestion as any).prompt : ''}</h3>\n  </div>\n\n  <!-- Image is not part of TypingExercise schema; removed -->\n\n  <div class=\"input-group\">\n    <input\n      type=\"text\"\n      bind:value={userAnswer}\n      placeholder=\"Type your answer...\"\n      class=\"answer-input\"\n      onkeydown={(e) => e.key === 'Enter' && checkAnswer()}\n      disabled={showFeedback}\n      spellcheck=\"false\"\n      autocomplete=\"off\"\n    />\n    {#if !showFeedback}\n      <button onclick={checkAnswer} class=\"btn btn-check\">Check</button>\n    {/if}\n  </div>\n\n  {#if showFeedback}\n    <div class={`feedback ${getSimilarityStatus()}`}>\n      <div class=\"feedback-header\">\n        {#if isCorrect}\n          <span class=\"icon\">✓</span>\n          <span>Perfect!</span>\n        {:else if getSimilarityStatus() === 'close'}\n          <span class=\"icon\">~</span>\n          <span>Close!</span>\n        {:else}\n          <span class=\"icon\">✗</span>\n          <span>Not quite right</span>\n        {/if}\n      </div>\n\n      <div class=\"similarity-info\">\n        <div class=\"similarity-bar\">\n          <div class=\"similarity-fill\" style={`width: ${getSimilarityPercentage()}%`}></div>\n        </div>\n        <span class=\"similarity-text\">{getSimilarityPercentage()}% match</span>\n      </div>\n\n      <div class=\"answer-comparison\">\n        <div class=\"answer-row\">\n          <strong>Your answer:</strong>\n          <span>{userAnswer}</span>\n        </div>\n        <div class=\"answer-row\">\n          <strong>Correct answer:</strong>\n          <span>{currentQuestion?.correctAnswer || ''}</span>\n        </div>\n      </div>\n\n      {#if currentQuestion && currentQuestion.hints && currentQuestion.hints.length > 0}\n        <div class=\"hints\">\n          <strong>Tips:</strong>\n          <ul>\n            {#each (currentQuestion?.hints ?? []) as hint}\n              <li>{hint}</li>\n            {/each}\n          </ul>\n        </div>\n      {/if}\n\n      <div class=\"action-buttons\">\n        {#if !isCorrect}\n          <button onclick={revealAnswer} class=\"btn btn-secondary\">Show Answer</button>\n        {/if}\n        <button onclick={nextQuestion} class=\"btn btn-primary\">Next</button>\n        <button onclick={skipQuestion} class=\"btn btn-secondary\">Skip</button>\n      </div>\n    </div>\n  {/if}\n</div>\n\n<style>\n  .typing {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-md);\n  }\n\n  .question {\n    padding: var(--spacing-md);\n    background: var(--color-bg-tertiary);\n    border-radius: var(--radius-md);\n  }\n\n  .question h3 {\n    margin: 0;\n    font-size: 1.125rem;\n    color: var(--color-text);\n  }\n\n  .question-image {\n    width: 100%;\n    max-width: 400px;\n    height: auto;\n    border-radius: var(--radius-md);\n    margin-top: var(--spacing-md);\n  }\n\n  .input-group {\n    display: flex;\n    gap: var(--spacing-md);\n  }\n\n  .answer-input {\n    flex: 1;\n    padding: var(--spacing-md);\n    border: 2px solid var(--color-border);\n    border-radius: var(--radius-md);\n    font-size: 1rem;\n    font-family: monospace;\n    transition: border-color 0.2s;\n  }\n\n  .answer-input:focus {\n    outline: none;\n    border-color: var(--color-primary);\n  }\n\n  .answer-input:disabled {\n    background: var(--color-bg-secondary);\n    cursor: not-allowed;\n  }\n\n  .btn-check {\n    padding: var(--spacing-md) var(--spacing-lg);\n    background: var(--color-primary);\n    color: white;\n    border: none;\n    border-radius: var(--radius-md);\n    font-weight: 500;\n    cursor: pointer;\n    transition: background 0.2s;\n  }\n\n  .btn-check:hover {\n    background: var(--color-primary-dark);\n  }\n\n  .feedback {\n    padding: var(--spacing-md);\n    border-radius: var(--radius-md);\n    border-left: 4px solid;\n  }\n\n  .feedback.correct {\n    background: var(--color-success-light);\n    border-color: var(--color-success);\n    color: var(--color-success-dark);\n  }\n\n  .feedback.close {\n    background: var(--color-warning-light);\n    border-color: var(--color-warning);\n    color: var(--color-warning-dark);\n  }\n\n  .feedback.incorrect {\n    background: var(--color-error-light);\n    border-color: var(--color-error);\n    color: var(--color-error-dark);\n  }\n\n  .feedback-header {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-md);\n    font-weight: bold;\n    font-size: 1.125rem;\n    margin-bottom: var(--spacing-md);\n  }\n\n  .icon {\n    font-size: 1.5rem;\n  }\n\n  .similarity-info {\n    margin-bottom: var(--spacing-md);\n  }\n\n  .similarity-bar {\n    width: 100%;\n    height: 8px;\n    background: rgba(0, 0, 0, 0.1);\n    border-radius: 4px;\n    overflow: hidden;\n    margin-bottom: var(--spacing-sm);\n  }\n\n  .similarity-fill {\n    height: 100%;\n    background: linear-gradient(to right, var(--color-error), var(--color-warning), var(--color-success));\n    transition: width 0.3s ease;\n  }\n\n  .similarity-text {\n    font-size: 0.875rem;\n    font-weight: 500;\n    display: block;\n  }\n\n  .answer-comparison {\n    background: rgba(0, 0, 0, 0.05);\n    padding: var(--spacing-md);\n    border-radius: var(--radius-md);\n    margin-bottom: var(--spacing-md);\n  }\n\n  .answer-row {\n    display: flex;\n    justify-content: space-between;\n    gap: var(--spacing-md);\n    margin-bottom: var(--spacing-sm);\n  }\n\n  .answer-row:last-child {\n    margin-bottom: 0;\n  }\n\n  .answer-row strong {\n    min-width: 120px;\n  }\n\n  .answer-row span {\n    font-family: monospace;\n    word-break: break-all;\n  }\n\n  .hints {\n    background: rgba(0, 0, 0, 0.05);\n    padding: var(--spacing-md);\n    border-radius: var(--radius-md);\n    margin-bottom: var(--spacing-md);\n  }\n\n  .hints strong {\n    display: block;\n    margin-bottom: var(--spacing-sm);\n  }\n\n  .hints ul {\n    margin: 0;\n    padding-left: var(--spacing-lg);\n  }\n\n  .hints li {\n    margin: var(--spacing-sm) 0;\n    font-size: 0.9375rem;\n  }\n\n  .action-buttons {\n    display: flex;\n    gap: var(--spacing-md);\n    justify-content: flex-end;\n    flex-wrap: wrap;\n  }\n\n  .btn {\n    padding: var(--spacing-md) var(--spacing-lg);\n    border: none;\n    border-radius: var(--radius-md);\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s;\n  }\n\n  .btn-primary {\n    background: var(--color-primary);\n    color: white;\n  }\n\n  .btn-primary:hover {\n    background: var(--color-primary-dark);\n  }\n\n  .btn-secondary {\n    background: rgba(0, 0, 0, 0.1);\n    color: var(--color-text);\n  }\n\n  .btn-secondary:hover {\n    background: rgba(0, 0, 0, 0.15);\n  }\n\n  @media (max-width: 640px) {\n    .input-group {\n      flex-direction: column;\n    }\n\n    .btn-check {\n      width: 100%;\n    }\n\n    .action-buttons {\n      flex-direction: column;\n    }\n\n    .btn {\n      width: 100%;\n    }\n  }\n</style>\n"],"names":["SentenceBuilderExerciseSchema","z.object","id","z.string","type","z.literal","title","description","optional","grammarHint","questions","z.array","prompt","words","correctOrder","difficulty","z.enum","default","currentQuestionIndex","z.number","feedback","questionId","isCorrect","z.boolean","userAnswer","correctAnswer","attempts","timestamp","z.date","feedbackMessages","correct","incorrect","FillInTheBlankExerciseSchema","acceptedVariations","ExerciseItemBaseSchema","min","vocabularyId","german","bulgarian","partOfSpeech","category","ExerciseAttemptResultSchema","exerciseId","timeSpent","Date","sessionId","exerciseType","startTime","endTime","totalAttempts","correctAttempts","results","FillInTheBlankQuestionSchema","extend","question","blankPosition","hints","source","FillInTheBlankExerciseV2Schema","userAnswers","isComplete","MultipleChoiceOptionSchema","text","MultipleChoiceQuestionSchema","options","explanation","MultipleChoiceExerciseSchema","correctAnswerId","MatchingPairSchema","leftId","leftText","rightId","rightText","MatchingExerciseSchema","pairs","userMatches","correctCount","SequencingItemSchema","correctPosition","OrderingExerciseSchema","instruction","items","userOrder","TypingExerciseQuestionSchema","caseSensitive","exerciseMode","z.union","similarity","max","ExerciseResultsSchema","userId","completionTime","score","passedOnFirstAttempt","ExerciseStatsSchema","totalExercises","completedExercises","averageScore","totalTime","byType","matching","ordering","typing","ExerciseService","validateFillInBlankAnswer","normalized","trim","toLowerCase","variation","validateMultipleChoiceAnswer","selectedOptionId","correctOptionId","validateMatching","correctPairs","correctPair","userMatch","find","m","length","validateOrdering","i","calculateSimilarity","user","maxLength","Math","distance","this","levenshteinDistance","a","b","rows","cols","matrix","firstRow","j","row","val1","val2","val3","validateTypingAnswer","threshold","normalizedUser","normalizedCorrect","normalizedVariation","calculateScore","totalCount","round","calculateStats","correctAnswers","incorrectAnswers","accuracy","filter","r","validateResults","data","parse","validateStats","dispatch","createEventDispatcher","$.state","showFeedback","currentQuestion","$.derived","$$props","exercise","checkAnswer","$.get","$.set","push","nextQuestion","skipQuestion","div","root","div_1","$.first_child","fragment","h3","div_2","input","$.child","$.remove_input_defaults","__keydown","e","key","node_1","$.sibling","button","root_2","__click","consequent","div_3","fragment_1","span","fragment_3","strong","$.template_effect","$.set_text","text_1","$$render","consequent_1","alternate","div_4","root_6","ul","$.each","hint","li","root_7","consequent_2","div_5","node_4","button_1","$.set_class","consequent_3","disabled","$$value","consequent_4","$.proxy","leftItems","map","p","rightItems","pair","every","cp","isMatchCorrect","correctMatch","getRightItems","leftItem","$$anchor","root_1","div_6","div_7","rightItem","toggleMatch","$0","$.append","div_8","div_9","div_10","root_3","text_2","div_11","root_4","div_12","div_13","button_3","alternate_1","draggedItem","correctOrderIds","sort","handleDragOver","preventDefault","dataTransfer","dropEffect","item","shuffleItems","random","$.user_effect","index","span_1","span_2","span_3","$.reset","classes","$.set_attribute","itemId","effectAllowed","handleDragStart","$.event","targetIndex","draggedIndex","findIndex","removed","splice","handleDrop","root_5","ol","$.index","correctItem","root_9","text_3","alternate_2","revealAnswer","getSimilarityPercentage","getSimilarityStatus","node","root_8","button_2","node_5","$1","consequent_5"],"mappings":"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"}