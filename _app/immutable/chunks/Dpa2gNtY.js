const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DCt7Ycr1.js","./CfpCa8_-.js"])))=>i.map(i=>d[i]);
var e,t,r,a,i,s,o,n,l,c,d,u,m,p,h,g,f,y,b,w,v,S,P,x,D,k,E,A,I,T,_,C=e=>{throw TypeError(e)},O=(e,t,r)=>t.has(e)||C("Cannot "+r),L=(e,t,r)=>(O(e,t,"read from private field"),r?r.call(e):t.get(e)),z=(e,t,r)=>t.has(e)?C("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),M=(e,t,r,a)=>(O(e,t,"write to private field"),a?a.call(e,r):t.set(e,r),r);import{_ as j}from"./CgvsJPj0.js";import{L as B,ab as F,a9 as R,ae as V,a6 as G}from"./wBlqi3UJ.js";import{h as U}from"./rXKuYn7R.js";import{b as $}from"./CfpCa8_-.js";import{_ as q,u as X,l as N,o as W,s as Q,r as J,n as Y,b as Z,a as K,d as H,t as ee}from"./y3_YNDdE.js";const te=(e=new Map,t=null,r)=>({nextPart:e,validators:t,classGroupId:r}),re="-",ae=[],ie=e=>{const t=ne(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:a}=e;return{getClassGroupId:e=>{if(e.startsWith("[")&&e.endsWith("]"))return oe(e);const r=e.split(re),a=""===r[0]&&r.length>1?1:0;return se(r,a,t)},getConflictingClassGroupIds:(e,t)=>{if(t){const t=a[e],i=r[e];return t?i?((e,t)=>{const r=new Array(e.length+t.length);for(let a=0;a<e.length;a++)r[a]=e[a];for(let a=0;a<t.length;a++)r[e.length+a]=t[a];return r})(i,t):t:i||ae}return r[e]||ae}}},se=(e,t,r)=>{if(0===e.length-t)return r.classGroupId;const a=e[t],i=r.nextPart.get(a);if(i){const r=se(e,t+1,i);if(r)return r}const s=r.validators;if(null===s)return;const o=0===t?e.join(re):e.slice(t).join(re),n=s.length;for(let l=0;l<n;l++){const e=s[l];if(e.validator(o))return e.classGroupId}},oe=e=>-1===e.slice(1,-1).indexOf(":")?void 0:(()=>{const t=e.slice(1,-1),r=t.indexOf(":"),a=t.slice(0,r);return a?"arbitrary.."+a:void 0})(),ne=e=>{const{theme:t,classGroups:r}=e;return le(r,t)},le=(e,t)=>{const r=te();for(const a in e){const i=e[a];ce(i,r,a,t)}return r},ce=(e,t,r,a)=>{const i=e.length;for(let s=0;s<i;s++){const i=e[s];de(i,t,r,a)}},de=(e,t,r,a)=>{"string"!=typeof e?"function"!=typeof e?pe(e,t,r,a):me(e,t,r,a):ue(e,t,r)},ue=(e,t,r)=>{(""===e?t:he(t,e)).classGroupId=r},me=(e,t,r,a)=>{ge(e)?ce(e(a),t,r,a):(null===t.validators&&(t.validators=[]),t.validators.push(((e,t)=>({classGroupId:e,validator:t}))(r,e)))},pe=(e,t,r,a)=>{const i=Object.entries(e),s=i.length;for(let o=0;o<s;o++){const[e,s]=i[o];ce(s,he(t,e),r,a)}},he=(e,t)=>{let r=e;const a=t.split(re),i=a.length;for(let s=0;s<i;s++){const e=a[s];let t=r.nextPart.get(e);t||(t=te(),r.nextPart.set(e,t)),r=t}return r},ge=e=>"isThemeGetter"in e&&!0===e.isThemeGetter,fe=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,r=Object.create(null),a=Object.create(null);const i=(i,s)=>{r[i]=s,t++,t>e&&(t=0,a=r,r=Object.create(null))};return{get(e){let t=r[e];return void 0!==t?t:void 0!==(t=a[e])?(i(e,t),t):void 0},set(e,t){e in r?r[e]=t:i(e,t)}}},ye=[],be=(e,t,r,a,i)=>({modifiers:e,hasImportantModifier:t,baseClassName:r,maybePostfixModifierPosition:a,isExternal:i}),we=e=>{const{prefix:t,experimentalParseClassName:r}=e;let a=e=>{const t=[];let r,a=0,i=0,s=0;const o=e.length;for(let d=0;d<o;d++){const o=e[d];if(0===a&&0===i){if(":"===o){t.push(e.slice(s,d)),s=d+1;continue}if("/"===o){r=d;continue}}"["===o?a++:"]"===o?a--:"("===o?i++:")"===o&&i--}const n=0===t.length?e:e.slice(s);let l=n,c=!1;n.endsWith("!")?(l=n.slice(0,-1),c=!0):n.startsWith("!")&&(l=n.slice(1),c=!0);return be(t,c,l,r&&r>s?r-s:void 0)};if(t){const e=t+":",r=a;a=t=>t.startsWith(e)?r(t.slice(e.length)):be(ye,!1,t,void 0,!0)}if(r){const e=a;a=t=>r({className:t,parseClassName:e})}return a},ve=e=>{const t=new Map;return e.orderSensitiveModifiers.forEach((e,r)=>{t.set(e,1e6+r)}),e=>{const r=[];let a=[];for(let i=0;i<e.length;i++){const s=e[i],o="["===s[0],n=t.has(s);o||n?(a.length>0&&(a.sort(),r.push(...a),a=[]),r.push(s)):a.push(s)}return a.length>0&&(a.sort(),r.push(...a)),r}},Se=/\s+/,Pe=e=>{if("string"==typeof e)return e;let t,r="";for(let a=0;a<e.length;a++)e[a]&&(t=Pe(e[a]))&&(r&&(r+=" "),r+=t);return r},xe=(e,...t)=>{let r,a,i,s;const o=e=>{const t=a(e);if(t)return t;const s=((e,t)=>{const{parseClassName:r,getClassGroupId:a,getConflictingClassGroupIds:i,sortModifiers:s}=t,o=[],n=e.trim().split(Se);let l="";for(let c=n.length-1;c>=0;c-=1){const e=n[c],{isExternal:t,modifiers:d,hasImportantModifier:u,baseClassName:m,maybePostfixModifierPosition:p}=r(e);if(t){l=e+(l.length>0?" "+l:l);continue}let h=!!p,g=a(h?m.substring(0,p):m);if(!g){if(!h){l=e+(l.length>0?" "+l:l);continue}if(g=a(m),!g){l=e+(l.length>0?" "+l:l);continue}h=!1}const f=0===d.length?"":1===d.length?d[0]:s(d).join(":"),y=u?f+"!":f,b=y+g;if(o.indexOf(b)>-1)continue;o.push(b);const w=i(g,h);for(let r=0;r<w.length;++r){const e=w[r];o.push(y+e)}l=e+(l.length>0?" "+l:l)}return l})(e,r);return i(e,s),s};return s=n=>{const l=t.reduce((e,t)=>t(e),e());return r=(e=>({cache:fe(e.cacheSize),parseClassName:we(e),sortModifiers:ve(e),...ie(e)}))(l),a=r.cache.get,i=r.cache.set,s=o,o(n)},(...e)=>s(((...e)=>{let t,r,a=0,i="";for(;a<e.length;)(t=e[a++])&&(r=Pe(t))&&(i&&(i+=" "),i+=r);return i})(...e))},De=[],ke=e=>{const t=t=>t[e]||De;return t.isThemeGetter=!0,t},Ee=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,Ae=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Ie=/^\d+\/\d+$/,Te=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,_e=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Ce=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,Oe=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Le=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ze=e=>Ie.test(e),Me=e=>!!e&&!Number.isNaN(Number(e)),je=e=>!!e&&Number.isInteger(Number(e)),Be=e=>e.endsWith("%")&&Me(e.slice(0,-1)),Fe=e=>Te.test(e),Re=()=>!0,Ve=e=>_e.test(e)&&!Ce.test(e),Ge=()=>!1,Ue=e=>Oe.test(e),$e=e=>Le.test(e),qe=e=>!Ne(e)&&!Ke(e),Xe=e=>st(e,ct,Ge),Ne=e=>Ee.test(e),We=e=>st(e,dt,Ve),Qe=e=>st(e,ut,Me),Je=e=>st(e,nt,Ge),Ye=e=>st(e,lt,$e),Ze=e=>st(e,pt,Ue),Ke=e=>Ae.test(e),He=e=>ot(e,dt),et=e=>ot(e,mt),tt=e=>ot(e,nt),rt=e=>ot(e,ct),at=e=>ot(e,lt),it=e=>ot(e,pt,!0),st=(e,t,r)=>{const a=Ee.exec(e);return!!a&&(a[1]?t(a[1]):r(a[2]))},ot=(e,t,r=!1)=>{const a=Ae.exec(e);return!!a&&(a[1]?t(a[1]):r)},nt=e=>"position"===e||"percentage"===e,lt=e=>"image"===e||"url"===e,ct=e=>"length"===e||"size"===e||"bg-size"===e,dt=e=>"length"===e,ut=e=>"number"===e,mt=e=>"family-name"===e,pt=e=>"shadow"===e,ht=()=>{const e=ke("color"),t=ke("font"),r=ke("text"),a=ke("font-weight"),i=ke("tracking"),s=ke("leading"),o=ke("breakpoint"),n=ke("container"),l=ke("spacing"),c=ke("radius"),d=ke("shadow"),u=ke("inset-shadow"),m=ke("text-shadow"),p=ke("drop-shadow"),h=ke("blur"),g=ke("perspective"),f=ke("aspect"),y=ke("ease"),b=ke("animate"),w=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom",Ke,Ne],v=()=>[Ke,Ne,l],S=()=>[ze,"full","auto",...v()],P=()=>[je,"none","subgrid",Ke,Ne],x=()=>["auto",{span:["full",je,Ke,Ne]},je,Ke,Ne],D=()=>[je,"auto",Ke,Ne],k=()=>["auto","min","max","fr",Ke,Ne],E=()=>["auto",...v()],A=()=>[ze,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...v()],I=()=>[e,Ke,Ne],T=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom",tt,Je,{position:[Ke,Ne]}],_=()=>["auto","cover","contain",rt,Xe,{size:[Ke,Ne]}],C=()=>[Be,He,We],O=()=>["","none","full",c,Ke,Ne],L=()=>["",Me,He,We],z=()=>[Me,Be,tt,Je],M=()=>["","none",h,Ke,Ne],j=()=>["none",Me,Ke,Ne],B=()=>["none",Me,Ke,Ne],F=()=>[Me,Ke,Ne],R=()=>[ze,"full",...v()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Fe],breakpoint:[Fe],color:[Re],container:[Fe],"drop-shadow":[Fe],ease:["in","out","in-out"],font:[qe],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Fe],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Fe],shadow:[Fe],spacing:["px",Me],text:[Fe],"text-shadow":[Fe],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",ze,Ne,Ke,f]}],container:["container"],columns:[{columns:[Me,Ne,Ke,n]}],"break-after":[{"break-after":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-before":[{"break-before":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:w()}],overflow:[{overflow:["auto","hidden","clip","visible","scroll"]}],"overflow-x":[{"overflow-x":["auto","hidden","clip","visible","scroll"]}],"overflow-y":[{"overflow-y":["auto","hidden","clip","visible","scroll"]}],overscroll:[{overscroll:["auto","contain","none"]}],"overscroll-x":[{"overscroll-x":["auto","contain","none"]}],"overscroll-y":[{"overscroll-y":["auto","contain","none"]}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:S()}],"inset-x":[{"inset-x":S()}],"inset-y":[{"inset-y":S()}],start:[{start:S()}],end:[{end:S()}],top:[{top:S()}],right:[{right:S()}],bottom:[{bottom:S()}],left:[{left:S()}],visibility:["visible","invisible","collapse"],z:[{z:[je,"auto",Ke,Ne]}],basis:[{basis:[ze,"full","auto",n,...v()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Me,ze,"auto","initial","none",Ne]}],grow:[{grow:["",Me,Ke,Ne]}],shrink:[{shrink:["",Me,Ke,Ne]}],order:[{order:[je,"first","last","none",Ke,Ne]}],"grid-cols":[{"grid-cols":P()}],"col-start-end":[{col:x()}],"col-start":[{"col-start":D()}],"col-end":[{"col-end":D()}],"grid-rows":[{"grid-rows":P()}],"row-start-end":[{row:x()}],"row-start":[{"row-start":D()}],"row-end":[{"row-end":D()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":k()}],"auto-rows":[{"auto-rows":k()}],gap:[{gap:v()}],"gap-x":[{"gap-x":v()}],"gap-y":[{"gap-y":v()}],"justify-content":[{justify:["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe","normal"]}],"justify-items":[{"justify-items":["start","end","center","stretch","center-safe","end-safe","normal"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch","center-safe","end-safe"]}],"align-content":[{content:["normal","start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"]}],"align-items":[{items:["start","end","center","stretch","center-safe","end-safe",{baseline:["","last"]}]}],"align-self":[{self:["auto","start","end","center","stretch","center-safe","end-safe",{baseline:["","last"]}]}],"place-content":[{"place-content":["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"]}],"place-items":[{"place-items":["start","end","center","stretch","center-safe","end-safe","baseline"]}],"place-self":[{"place-self":["auto","start","end","center","stretch","center-safe","end-safe"]}],p:[{p:v()}],px:[{px:v()}],py:[{py:v()}],ps:[{ps:v()}],pe:[{pe:v()}],pt:[{pt:v()}],pr:[{pr:v()}],pb:[{pb:v()}],pl:[{pl:v()}],m:[{m:E()}],mx:[{mx:E()}],my:[{my:E()}],ms:[{ms:E()}],me:[{me:E()}],mt:[{mt:E()}],mr:[{mr:E()}],mb:[{mb:E()}],ml:[{ml:E()}],"space-x":[{"space-x":v()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":v()}],"space-y-reverse":["space-y-reverse"],size:[{size:A()}],w:[{w:[n,"screen",...A()]}],"min-w":[{"min-w":[n,"screen","none",...A()]}],"max-w":[{"max-w":[n,"screen","none","prose",{screen:[o]},...A()]}],h:[{h:["screen","lh",...A()]}],"min-h":[{"min-h":["screen","lh","none",...A()]}],"max-h":[{"max-h":["screen","lh",...A()]}],"font-size":[{text:["base",r,He,We]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[a,Ke,Qe]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Be,Ne]}],"font-family":[{font:[et,Ne,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[i,Ke,Ne]}],"line-clamp":[{"line-clamp":[Me,"none",Ke,Qe]}],leading:[{leading:[s,...v()]}],"list-image":[{"list-image":["none",Ke,Ne]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Ke,Ne]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:I()}],"text-color":[{text:I()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:["solid","dashed","dotted","double","wavy"]}],"text-decoration-thickness":[{decoration:[Me,"from-font","auto",Ke,We]}],"text-decoration-color":[{decoration:I()}],"underline-offset":[{"underline-offset":[Me,"auto",Ke,Ne]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:v()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ke,Ne]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ke,Ne]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:T()}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","space","round"]}]}],"bg-size":[{bg:_()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},je,Ke,Ne],radial:["",Ke,Ne],conic:[je,Ke,Ne]},at,Ye]}],"bg-color":[{bg:I()}],"gradient-from-pos":[{from:C()}],"gradient-via-pos":[{via:C()}],"gradient-to-pos":[{to:C()}],"gradient-from":[{from:I()}],"gradient-via":[{via:I()}],"gradient-to":[{to:I()}],rounded:[{rounded:O()}],"rounded-s":[{"rounded-s":O()}],"rounded-e":[{"rounded-e":O()}],"rounded-t":[{"rounded-t":O()}],"rounded-r":[{"rounded-r":O()}],"rounded-b":[{"rounded-b":O()}],"rounded-l":[{"rounded-l":O()}],"rounded-ss":[{"rounded-ss":O()}],"rounded-se":[{"rounded-se":O()}],"rounded-ee":[{"rounded-ee":O()}],"rounded-es":[{"rounded-es":O()}],"rounded-tl":[{"rounded-tl":O()}],"rounded-tr":[{"rounded-tr":O()}],"rounded-br":[{"rounded-br":O()}],"rounded-bl":[{"rounded-bl":O()}],"border-w":[{border:L()}],"border-w-x":[{"border-x":L()}],"border-w-y":[{"border-y":L()}],"border-w-s":[{"border-s":L()}],"border-w-e":[{"border-e":L()}],"border-w-t":[{"border-t":L()}],"border-w-r":[{"border-r":L()}],"border-w-b":[{"border-b":L()}],"border-w-l":[{"border-l":L()}],"divide-x":[{"divide-x":L()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":L()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:["solid","dashed","dotted","double","hidden","none"]}],"divide-style":[{divide:["solid","dashed","dotted","double","hidden","none"]}],"border-color":[{border:I()}],"border-color-x":[{"border-x":I()}],"border-color-y":[{"border-y":I()}],"border-color-s":[{"border-s":I()}],"border-color-e":[{"border-e":I()}],"border-color-t":[{"border-t":I()}],"border-color-r":[{"border-r":I()}],"border-color-b":[{"border-b":I()}],"border-color-l":[{"border-l":I()}],"divide-color":[{divide:I()}],"outline-style":[{outline:["solid","dashed","dotted","double","none","hidden"]}],"outline-offset":[{"outline-offset":[Me,Ke,Ne]}],"outline-w":[{outline:["",Me,He,We]}],"outline-color":[{outline:I()}],shadow:[{shadow:["","none",d,it,Ze]}],"shadow-color":[{shadow:I()}],"inset-shadow":[{"inset-shadow":["none",u,it,Ze]}],"inset-shadow-color":[{"inset-shadow":I()}],"ring-w":[{ring:L()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:I()}],"ring-offset-w":[{"ring-offset":[Me,We]}],"ring-offset-color":[{"ring-offset":I()}],"inset-ring-w":[{"inset-ring":L()}],"inset-ring-color":[{"inset-ring":I()}],"text-shadow":[{"text-shadow":["none",m,it,Ze]}],"text-shadow-color":[{"text-shadow":I()}],opacity:[{opacity:[Me,Ke,Ne]}],"mix-blend":[{"mix-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Me]}],"mask-image-linear-from-pos":[{"mask-linear-from":z()}],"mask-image-linear-to-pos":[{"mask-linear-to":z()}],"mask-image-linear-from-color":[{"mask-linear-from":I()}],"mask-image-linear-to-color":[{"mask-linear-to":I()}],"mask-image-t-from-pos":[{"mask-t-from":z()}],"mask-image-t-to-pos":[{"mask-t-to":z()}],"mask-image-t-from-color":[{"mask-t-from":I()}],"mask-image-t-to-color":[{"mask-t-to":I()}],"mask-image-r-from-pos":[{"mask-r-from":z()}],"mask-image-r-to-pos":[{"mask-r-to":z()}],"mask-image-r-from-color":[{"mask-r-from":I()}],"mask-image-r-to-color":[{"mask-r-to":I()}],"mask-image-b-from-pos":[{"mask-b-from":z()}],"mask-image-b-to-pos":[{"mask-b-to":z()}],"mask-image-b-from-color":[{"mask-b-from":I()}],"mask-image-b-to-color":[{"mask-b-to":I()}],"mask-image-l-from-pos":[{"mask-l-from":z()}],"mask-image-l-to-pos":[{"mask-l-to":z()}],"mask-image-l-from-color":[{"mask-l-from":I()}],"mask-image-l-to-color":[{"mask-l-to":I()}],"mask-image-x-from-pos":[{"mask-x-from":z()}],"mask-image-x-to-pos":[{"mask-x-to":z()}],"mask-image-x-from-color":[{"mask-x-from":I()}],"mask-image-x-to-color":[{"mask-x-to":I()}],"mask-image-y-from-pos":[{"mask-y-from":z()}],"mask-image-y-to-pos":[{"mask-y-to":z()}],"mask-image-y-from-color":[{"mask-y-from":I()}],"mask-image-y-to-color":[{"mask-y-to":I()}],"mask-image-radial":[{"mask-radial":[Ke,Ne]}],"mask-image-radial-from-pos":[{"mask-radial-from":z()}],"mask-image-radial-to-pos":[{"mask-radial-to":z()}],"mask-image-radial-from-color":[{"mask-radial-from":I()}],"mask-image-radial-to-color":[{"mask-radial-to":I()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"]}],"mask-image-conic-pos":[{"mask-conic":[Me]}],"mask-image-conic-from-pos":[{"mask-conic-from":z()}],"mask-image-conic-to-pos":[{"mask-conic-to":z()}],"mask-image-conic-from-color":[{"mask-conic-from":I()}],"mask-image-conic-to-color":[{"mask-conic-to":I()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:T()}],"mask-repeat":[{mask:["no-repeat",{repeat:["","x","y","space","round"]}]}],"mask-size":[{mask:_()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Ke,Ne]}],filter:[{filter:["","none",Ke,Ne]}],blur:[{blur:M()}],brightness:[{brightness:[Me,Ke,Ne]}],contrast:[{contrast:[Me,Ke,Ne]}],"drop-shadow":[{"drop-shadow":["","none",p,it,Ze]}],"drop-shadow-color":[{"drop-shadow":I()}],grayscale:[{grayscale:["",Me,Ke,Ne]}],"hue-rotate":[{"hue-rotate":[Me,Ke,Ne]}],invert:[{invert:["",Me,Ke,Ne]}],saturate:[{saturate:[Me,Ke,Ne]}],sepia:[{sepia:["",Me,Ke,Ne]}],"backdrop-filter":[{"backdrop-filter":["","none",Ke,Ne]}],"backdrop-blur":[{"backdrop-blur":M()}],"backdrop-brightness":[{"backdrop-brightness":[Me,Ke,Ne]}],"backdrop-contrast":[{"backdrop-contrast":[Me,Ke,Ne]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Me,Ke,Ne]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Me,Ke,Ne]}],"backdrop-invert":[{"backdrop-invert":["",Me,Ke,Ne]}],"backdrop-opacity":[{"backdrop-opacity":[Me,Ke,Ne]}],"backdrop-saturate":[{"backdrop-saturate":[Me,Ke,Ne]}],"backdrop-sepia":[{"backdrop-sepia":["",Me,Ke,Ne]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":v()}],"border-spacing-x":[{"border-spacing-x":v()}],"border-spacing-y":[{"border-spacing-y":v()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Ke,Ne]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Me,"initial",Ke,Ne]}],ease:[{ease:["linear","initial",y,Ke,Ne]}],delay:[{delay:[Me,Ke,Ne]}],animate:[{animate:["none",b,Ke,Ne]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[g,Ke,Ne]}],"perspective-origin":[{"perspective-origin":w()}],rotate:[{rotate:j()}],"rotate-x":[{"rotate-x":j()}],"rotate-y":[{"rotate-y":j()}],"rotate-z":[{"rotate-z":j()}],scale:[{scale:B()}],"scale-x":[{"scale-x":B()}],"scale-y":[{"scale-y":B()}],"scale-z":[{"scale-z":B()}],"scale-3d":["scale-3d"],skew:[{skew:F()}],"skew-x":[{"skew-x":F()}],"skew-y":[{"skew-y":F()}],transform:[{transform:[Ke,Ne,"","none","gpu","cpu"]}],"transform-origin":[{origin:w()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:R()}],"translate-x":[{"translate-x":R()}],"translate-y":[{"translate-y":R()}],"translate-z":[{"translate-z":R()}],"translate-none":["translate-none"],accent:[{accent:I()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:I()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ke,Ne]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":v()}],"scroll-mx":[{"scroll-mx":v()}],"scroll-my":[{"scroll-my":v()}],"scroll-ms":[{"scroll-ms":v()}],"scroll-me":[{"scroll-me":v()}],"scroll-mt":[{"scroll-mt":v()}],"scroll-mr":[{"scroll-mr":v()}],"scroll-mb":[{"scroll-mb":v()}],"scroll-ml":[{"scroll-ml":v()}],"scroll-p":[{"scroll-p":v()}],"scroll-px":[{"scroll-px":v()}],"scroll-py":[{"scroll-py":v()}],"scroll-ps":[{"scroll-ps":v()}],"scroll-pe":[{"scroll-pe":v()}],"scroll-pt":[{"scroll-pt":v()}],"scroll-pr":[{"scroll-pr":v()}],"scroll-pb":[{"scroll-pb":v()}],"scroll-pl":[{"scroll-pl":v()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ke,Ne]}],fill:[{fill:["none",...I()]}],"stroke-w":[{stroke:[Me,He,We,Qe]}],stroke:[{stroke:["none",...I()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},gt=(e,t,r)=>{void 0!==r&&(e[t]=r)},ft=(e,t)=>{if(t)for(const r in t)gt(e,r,t[r])},yt=(e,t)=>{if(t)for(const r in t)bt(e,t,r)},bt=(e,t,r)=>{const a=t[r];void 0!==a&&(e[r]=e[r]?e[r].concat(a):a)},wt=(e,...t)=>"function"==typeof e?xe(ht,e,...t):xe(()=>((e,{cacheSize:t,prefix:r,experimentalParseClassName:a,extend:i={},override:s={}})=>(gt(e,"cacheSize",t),gt(e,"prefix",r),gt(e,"experimentalParseClassName",a),ft(e.theme,s.theme),ft(e.classGroups,s.classGroups),ft(e.conflictingClassGroups,s.conflictingClassGroups),ft(e.conflictingClassGroupModifiers,s.conflictingClassGroupModifiers),gt(e,"orderSensitiveModifiers",s.orderSensitiveModifiers),yt(e.theme,i.theme),yt(e.classGroups,i.classGroups),yt(e.conflictingClassGroups,i.conflictingClassGroups),yt(e.conflictingClassGroupModifiers,i.conflictingClassGroupModifiers),bt(e,i,"orderSensitiveModifiers"),e))(ht(),e),...t),vt=xe(ht);function St(...e){return vt(U(e))}const Pt=class e{static enable(){e.enabled=!0,e.log("Debug","Debug logging enabled")}static disable(){e.log("Debug","Debug logging disabled"),e.enabled=!1}static log(t,r,a){e.enabled&&(void 0!==a?console.log(`${e.PREFIX} [${t}] ${r}`,a):console.log(`${e.PREFIX} [${t}] ${r}`))}static error(t,r,a){a?console.error(`${e.PREFIX} [${t}] ${r}`,a):console.error(`${e.PREFIX} [${t}] ${r}`)}static warn(t,r,a){void 0!==a?console.warn(`${e.PREFIX} [${t}] ${r}`,a):console.warn(`${e.PREFIX} [${t}] ${r}`)}};Pt.enabled=!1,Pt.PREFIX="[TandemDebug]";let xt=Pt;class Dt extends Error{constructor(e,t){super(e),this.context=t,this.name="AppError"}}class kt extends Dt{constructor(e,t){super(e,t),this.name="StateError"}}class Et extends Dt{constructor(e,t){super(e,t),this.name="DataError"}}class At extends Dt{constructor(e,t){super(e,t),this.name="StorageError"}}class It{static handleError(e,t,r){const a=e instanceof Error?e:new Error(String(e));console.error(`[${a.name}] ${t||"Error"}:`,a.message,a.stack),r&&r.emit("error",{error:a,context:t,timestamp:new Date}).catch(e=>{console.error("Failed to emit error event:",e)})}}e=new WeakMap,t=new WeakMap,r=new WeakMap,a=new WeakMap,i=new WeakMap,s=new WeakMap,o=new WeakMap,n=new WeakMap,l=new WeakMap,c=new WeakMap;class Tt{constructor(){this.listeners=new Map}subscribe(e,t){this.listeners.has(e)||this.listeners.set(e,new Set);const r=this.listeners.get(e);return r.add(t),()=>{r.delete(t),0===r.size&&this.listeners.delete(e)}}async emit(e,t){const r=this.listeners.get(e);if(r){const i=Array.from(r);for(const r of i)try{await r(t)}catch(a){console.error(`Error in event listener for ${e}:`,a)}}}clear(e){e?(xt.log("EventBus","Clearing listeners for event type",{eventType:e}),this.listeners.delete(e)):(xt.log("EventBus","Clearing all event listeners"),this.listeners.clear())}}const _t="xp_earned",Ct="level_up",Ot="error",Lt=q(["noun","verb","adjective","adverb","pronoun","preposition","conjunction","interjection","article","number","phrase","expression"]),zt=q(["greetings","numbers","family","food","colors","animals","body-parts","clothing","home","nature","transport","technology","time","weather","professions","places","grammar","culture","everyday-phrases"]),Mt=q(["A1","A2","B1","B2","C1"]),jt=X([N("perfective"),N("imperfective"),N(null)]),Bt=q(["masculine","feminine","neuter"]),Ft=W({german:Q().optional().describe("Latin transcription for German pronunciation"),bulgarian:Q().optional().describe("Latin transcription for Bulgarian pronunciation")}),Rt=W({german:Q().url().optional().describe("URL for German pronunciation audio"),bulgarian:Q().url().optional().describe("URL for Bulgarian pronunciation audio")}),Vt=W({gender:Bt.optional().describe("Noun gender (masculine, feminine, neuter)"),pluralForm:Q().optional().describe("Plural form of the word"),verbAspect:jt.optional().describe("Verb aspect (perfective/imperfective)"),verbPartnerId:Q().optional().describe("ID of the aspectual partner verb"),conjugation:J(Q(),X([Q(),J(Q(),Q())])).optional().describe("Verb conjugations by person/tense"),declension:J(Q(),W({singular:Q().optional(),plural:Q().optional()})).optional().describe("Noun declension by case")}),Gt=W({enriched:Z().optional().describe("Indicates item has been enriched"),confidence:Y().min(0).max(1).optional().describe("Confidence score for enrichment match"),sourceURL:Q().url().optional().describe("Primary dictionary URL for the enrichment"),enrichedAt:Q().datetime().optional().describe("ISO timestamp of enrichment run"),source:Q().optional().describe("Source label for enrichment run")}).partial(),Ut=W({source:Q().optional().describe("Dictionary source identifier (e.g., langenscheidt, duden)"),url:Q().url().describe("Absolute URL to external definition"),confidence:Y().min(0).max(1).optional().describe("Confidence score for this link"),language:Q().optional().describe("Language pair or locale for the definition")}),$t=W({german:Q().describe("German example sentence"),bulgarian:Q().describe("Bulgarian example sentence"),context:Q().optional().describe("Context description for the example"),source:q(["current","legacy","merged","generated"]).default("merged").describe("Source of the example")}),qt=W({general:Q().optional().describe("General notes about the word/phrase"),forBulgarianSpeakers:Q().optional().describe("Notes for Bulgarian speakers learning German"),forGermanSpeakers:Q().optional().describe("Notes for German speakers learning Bulgarian"),linguistic:Q().optional().describe("Linguistic observations"),linguisticForBulgarians:Q().optional().describe("Linguistic notes for Bulgarian speakers"),linguisticForGermans:Q().optional().describe("Linguistic notes for German speakers"),source:q(["current","legacy","merged","generated"]).default("merged").describe("Source of the notes")}),Xt=W({frequency:Y().min(1).max(100).optional().describe("Frequency rating (1-100)"),level:Mt.optional().describe("CEFR language level (A1, A2, B1, B2, C1)"),isCommon:Z().default(!1).describe("Whether the word is common"),isVerified:Z().default(!1).describe("Whether the item has been verified"),learningPhase:Y().min(0).max(6).optional().describe("SRS learning phase (0-6)"),xpValue:Y().min(1).max(100).optional().describe("Experience points value"),components:K(W({part:Q(),meaning:Q()})).optional().describe("Word components for compound words"),notes:Q().optional().describe("General notes about the item"),mnemonic:Q().optional().describe("Memory aid or mnemonic device"),etymology:Q().optional().describe("Word origin and etymology"),culturalNote:Q().optional().describe("Cultural context or usage notes"),sourceFiles:K(Q()).optional().describe("Source files where this item appeared"),mergeSources:K(Q()).optional().describe("IDs of items merged into this one"),createdBy:Q().optional().describe("Creator of the item"),lastUpdatedBy:Q().optional().describe("Last person to update the item"),declension:J(Q(),W({singular:Q().optional(),plural:Q().optional()})).optional().describe("Declension table for nouns: case -> {singular, plural}"),links:K(W({label:Q().describe('Link label (e.g., "DWDS", "Duden")'),url:Q().url().describe("Absolute URL to external dictionary")})).optional().describe("External dictionary links")}),Nt=W({id:Q().describe("Unique identifier for the vocabulary item"),german:Q().min(1).max(200).describe("German word or phrase"),bulgarian:Q().min(1).max(200).describe("Bulgarian word or phrase"),partOfSpeech:Lt.describe("Part of speech classification"),difficulty:Y().min(1).max(5).describe("Difficulty level (1-5, 1=easiest)"),cefrLevel:Mt.optional().describe("CEFR proficiency level (A1/A2/B1/B2/C1)"),categories:K(zt).min(1).describe("Categories the item belongs to"),transliteration:Ft.optional().describe("Pronunciation guides in Latin script"),emoji:Q().emoji().optional().describe("Emoji representation of the word"),literalBreakdown:K(W({segment:Q(),literal:Q(),grammarTag:Q()})).optional().describe("Breakdown of compound words/grammar for learning"),audio:Rt.optional().describe("Audio resources for pronunciation"),audioUrl:Q().url().optional().describe("Direct URL to audio file (Forvo/MP3)"),grammar:Vt.optional().describe("Grammar details and properties"),examples:K($t).default([]).describe("Usage examples"),notes:qt.optional().describe("Comprehensive notes about the item"),etymology:Q().optional().describe("Word origin and etymology"),culturalNotes:Q().optional().describe("Cultural context notes"),mnemonic:W({text:Q().describe("Mnemonic or Esels-BrÃ¼cke"),author:Q().optional(),upvotes:Y().int().default(0),confidence:Y().min(0).max(1).optional(),createdAt:Q().datetime().optional()}).optional().describe("Memory aid"),mnemonics:K(Q()).optional().describe("Legacy: Memory aids and techniques"),synonyms:K(Q()).optional().describe("Synonyms for this word/phrase"),antonyms:K(Q()).optional().describe("Antonyms for this word/phrase"),relatedWords:K(Q()).optional().describe("Related words or phrases"),type:q(["word","rule","phrase"]).optional().default("word").describe("Type of vocabulary entry"),tags:K(Q()).optional().describe("Custom tags for filtering and organization"),level:Mt.optional().describe("CEFR language level (direct accessor, mirrors cefrLevel)"),xp_value:Y().min(1).max(100).optional().describe("Experience points value (direct accessor, mirrors metadata.xpValue)"),global_stats:W({correct_count:Y().min(0).default(0),incorrect_count:Y().min(0).default(0),success_rate:Y().min(0).max(100).default(0)}).optional().describe("Global practice statistics for this item"),metadata:Xt.optional().describe("Additional metadata"),enrichment:Gt.optional().describe("External enrichment metadata"),definitions:K(Ut).optional().describe("Links to external dictionary definitions"),createdAt:X([H(),Q().datetime().transform(e=>new Date(e))]).describe("Creation timestamp"),updatedAt:X([H(),Q().datetime().transform(e=>new Date(e))]).describe("Last update timestamp"),version:Y().default(1).describe("Schema version number")}),Wt=W({id:Q().uuid().describe("Unique identifier for the collection"),name:Q().min(3).max(100).describe("Name of the vocabulary collection"),description:Q().min(10).max(1e3).describe("Description of the collection"),languagePair:q(["de-bg","bg-de"]).describe("Language direction"),difficultyRange:ee([Y().min(1),Y().max(5)]).describe("Min and max difficulty levels"),categories:K(zt).describe("All categories in the collection"),itemCount:Y().min(0).describe("Total number of items in the collection"),createdAt:X([H(),Q().datetime().transform(e=>new Date(e))]).describe("Creation timestamp"),updatedAt:X([H(),Q().datetime().transform(e=>new Date(e))]).describe("Last update timestamp"),version:Y().default(1).describe("Schema version number"),items:K(Nt).describe("Array of vocabulary items"),statistics:W({byPartOfSpeech:J(Q(),Y()).optional().describe("Count by part of speech"),byDifficulty:J(Q(),Y()).optional().describe("Count by difficulty level"),byCategory:J(Q(),Y()).optional().describe("Count by category"),byLevel:J(Q(),Y()).optional().describe("Count by CEFR level")}).optional().describe("Collection statistics")}),Qt=Nt.catch(e=>(e=>{const t=new Date;return{id:`fallback-${crypto.randomUUID()}`,german:"object"==typeof e&&e&&"german"in e&&"string"==typeof e.german?e.german:"unknown",bulgarian:"object"==typeof e&&e&&"bulgarian"in e&&"string"==typeof e.bulgarian?e.bulgarian:"unknown",partOfSpeech:"noun",difficulty:1,categories:["greetings"],examples:[],type:"word",tags:[],createdAt:t,updatedAt:t,version:1}})(e.input)),Jt=Wt.extend({items:K(Qt)}),Yt=W({version:X([Q().transform(e=>parseInt(e,10)),Y()]).describe("Schema version (string or number)"),lastUpdated:X([Q().datetime().transform(e=>new Date(e)),H()]).describe("Last update timestamp"),totalItems:Y().min(0).describe("Total number of items"),language:Q().describe("Language pair description"),direction:q(["DE_BG","BG_DE"]).describe("Learning direction"),items:K(Qt).describe("Array of vocabulary items")}),Zt="vocabulary-cache";async function Kt(e){try{return await async function(e){try{if("undefined"!=typeof process&&process.versions&&process.versions.node){const e=await j(()=>import("./FmFgRqLi.js"),[],import.meta.url),t=await j(()=>import("./FmFgRqLi.js"),[],import.meta.url),{fileURLToPath:r}=await j(async()=>{const{fileURLToPath:e}=await import("./FmFgRqLi.js");return{fileURLToPath:e}},[],import.meta.url),{dirname:a}=await j(async()=>{const{dirname:e}=await import("./FmFgRqLi.js");return{dirname:e}},[],import.meta.url),i=a(r(import.meta.url)),s=t.join(i,"unified-vocabulary.json"),o=await e.readFile(s,"utf-8"),n=JSON.parse(o),l=Yt.parse(n);return{id:crypto.randomUUID(),name:`${l.language} Vocabulary`,description:`Vocabulary collection with ${l.totalItems} items`,languagePair:"DE_BG"===l.direction?"de-bg":"bg-de",difficultyRange:[1,5],categories:[...new Set(l.items.flatMap(e=>e.categories))],itemCount:l.totalItems,createdAt:l.lastUpdated,updatedAt:l.lastUpdated,version:l.version,items:l.items}}{const e=await fetch(`${$}/data/unified-vocabulary.linguistic-corrected.json`);if(!e.ok)throw new Et(`HTTP error! status: ${e.status}`,{status:e.status});const t=await e.json();let r=[];if(Array.isArray(t))r=t;else{if(!t.items||!Array.isArray(t.items))throw new Et("Invalid vocabulary data format: expected array or object with items property");r=t.items}const a=r.filter(e=>e&&"object"==typeof e&&e.german&&e.bulgarian).map(e=>({id:e.id||`wv_${Math.random().toString(36).substr(2,9)}`,german:String(e.german||""),bulgarian:String(e.bulgarian||""),partOfSpeech:e.partOfSpeech||"noun",difficulty:Math.min(5,Math.max(1,parseInt(e.difficulty)||1)),categories:Array.isArray(e.categories)?e.categories:e.categories?[e.categories]:[],examples:Array.isArray(e.examples)?e.examples:e.examples?[e.examples]:[],createdAt:e.createdAt?new Date(e.createdAt):new Date,updatedAt:e.updatedAt?new Date(e.updatedAt):new Date,version:e.version||1}));return{id:crypto.randomUUID(),name:"German-Bulgarian Vocabulary",description:`Vocabulary collection with ${a.length} items`,languagePair:"de-bg",difficultyRange:[1,5],categories:[...new Set(a.flatMap(e=>e.categories||[]))],itemCount:a.length,createdAt:new Date,updatedAt:new Date,version:1,items:a}}}catch(t){const r=t instanceof Error?t:new Error(String(t));throw It.handleError(r,"Failed to load vocabulary from static endpoint",e),new Et("Failed to load vocabulary from static endpoint",{error:r})}}(e)}catch(t){const i=t instanceof Error?t:new Error(String(t));It.handleError(i,"Failed to load vocabulary from static endpoint",e);try{return await async function(e){try{if("undefined"!=typeof process&&process.versions&&process.versions.node)throw new Error("Cache not available in Node.js environment");if("undefined"==typeof localStorage)throw new Et("localStorage not available");const e=localStorage.getItem(Zt);if(!e)throw new Et("No cached vocabulary data found");const{data:t,timestamp:r}=JSON.parse(e),a=new Date,i=new Date(r),s=(a.getTime()-i.getTime())/36e5;if(s>24)throw new Et("Cache expired",{hoursDiff:s,cacheExpiryHours:24});return Jt.parse(t)}catch(t){const a=t instanceof Error?t:new Error(String(t));throw It.handleError(a,"Failed to load vocabulary from cache",e),new Et("Failed to load vocabulary from cache",{error:a})}}(e)}catch(r){const i=r instanceof Error?r:new Error(String(r));It.handleError(i,"Failed to load vocabulary from cache",e);try{return await async function(e){try{if("undefined"!=typeof process&&process.versions&&process.versions.node){const e=await j(()=>import("./FmFgRqLi.js"),[],import.meta.url),t=await j(()=>import("./FmFgRqLi.js"),[],import.meta.url),{fileURLToPath:r}=await j(async()=>{const{fileURLToPath:e}=await import("./FmFgRqLi.js");return{fileURLToPath:e}},[],import.meta.url),{dirname:a}=await j(async()=>{const{dirname:e}=await import("./FmFgRqLi.js");return{dirname:e}},[],import.meta.url),i=a(r(import.meta.url)),s=t.join(i,"unified-vocabulary.json"),o=await e.readFile(s,"utf-8"),n=JSON.parse(o);return Jt.parse(n)}let e=null;try{const t=await fetch(`${$}/data/unified-vocabulary.linguistic-corrected.json`);if(!t.ok)throw new Et(`HTTP error! status: ${t.status}`,{status:t.status});e=await t.json()}catch(r){e=null}if(e)try{return Jt.parse(e)}catch(a){}const t={id:crypto.randomUUID(),name:"German-Bulgarian Vocabulary Collection (Fallback)",description:"Fallback vocabulary collection when bundled data is unavailable",items:[],languagePair:"de-bg",difficultyRange:[1,5],categories:[],itemCount:0,createdAt:new Date,updatedAt:new Date,version:1};return Jt.parse(t)}catch(t){const a=t instanceof Error?t:new Error(String(t));throw It.handleError(a,"Failed to load bundled vocabulary data",e),new Et("Failed to load bundled vocabulary data",{error:a})}}(e)}catch(a){const i=a instanceof Error?a:new Error(String(a));throw It.handleError(i,"Failed to load vocabulary from bundled data",e),new Et("Failed to load vocabulary data from all sources",{error:t,cacheError:r,bundledError:a})}}}}async function Ht(e,t){try{let r=[...(await Kt(t)).items];if(e.query){const t=e.query.toLowerCase();r=r.filter(e=>e.german.toLowerCase().includes(t)||e.bulgarian.toLowerCase().includes(t)||((e.examples&&e.examples.some(e=>e.german&&e.german.toLowerCase().includes(t)||e.bulgarian&&e.bulgarian.toLowerCase().includes(t)))??!1))}e.partOfSpeech&&(r=r.filter(t=>t.partOfSpeech===e.partOfSpeech)),e.difficulty&&(r=r.filter(t=>t.difficulty===e.difficulty)),e.categories&&e.categories.length>0&&(r=r.filter(t=>t.categories.some(t=>e.categories?.includes(t))));const a=r.length,i=e.limit||20,s=e.offset||0;return r=r.slice(s,s+i),{items:r,total:a,hasMore:s+i<a}}catch(r){const a=r instanceof Error?r:new Error(String(r));throw It.handleError(a,"Failed to search vocabulary",t),new Et("Failed to search vocabulary",{params:e,error:a})}}async function er(e,t={},r){try{let a=(await Kt(r)).items.filter(t=>t.categories.includes(e));return t.difficulty&&(a=a.filter(e=>e.difficulty===t.difficulty)),t.limit&&(a=a.slice(0,t.limit)),a}catch(a){const i=a instanceof Error?a:new Error(String(a));throw It.handleError(i,"Failed to load vocabulary by category",r),new Et("Failed to load vocabulary by category",{category:e,options:t,error:i})}}async function tr(e=5,t={},r){try{let a=[...(await Kt(r)).items];if(t.difficulty&&(a=a.filter(e=>e.difficulty===t.difficulty)),t.category){const e=t.category;a=a.filter(t=>t.categories.includes(e))}const i=a.sort(()=>.5-Math.random());return i.slice(0,Math.min(e,i.length))}catch(a){const i=a instanceof Error?a:new Error(String(a));throw It.handleError(i,"Failed to get random vocabulary items",r),new Et("Failed to get random vocabulary items",{count:e,options:t,error:i})}}d=new WeakMap,u=new WeakMap;const rr=new class{constructor(e){z(this,d),z(this,u),M(this,d,R(G([]))),M(this,u,R(!1)),this.eventBus=e}get items(){return B(L(this,d))}set items(e){F(L(this,d),e,!0)}get loaded(){return B(L(this,u))}set loaded(e){F(L(this,u),e,!0)}async load(){if(!(this.loaded&&this.items.length>0))try{xt.log("VocabularyRepository","Loading vocabulary collection");const e=await Kt(this.eventBus);this.items=e.items,this.loaded=!0,xt.log("VocabularyRepository","Loaded items",{count:this.items.length})}catch(e){It.handleError(e,"VocabularyRepository.load"),this.items=[],this.loaded=!1}}invalidate(){this.items=[],this.loaded=!1,xt.log("VocabularyRepository","Cache invalidated")}getAll(){return this.items}getById(e){return this.items.find(t=>t.id===e)}basicSearch(e){const t=(e||"").toLowerCase();return t?this.items.filter(e=>e.german.toLowerCase().includes(t)||e.bulgarian.toLowerCase().includes(t)||(e.tags??[]).some(e=>e.toLowerCase().includes(t))):[]}},ar=[];for(let ba=0;ba<256;++ba)ar.push((ba+256).toString(16).slice(1));let ir;const sr=new Uint8Array(16);const or={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function nr(e,t,r){const a=(e=e||{}).random??e.rng?.()??function(){if(!ir){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ir=crypto.getRandomValues.bind(crypto)}return ir(sr)}();if(a.length<16)throw new Error("Random bytes length must be >= 16");return a[6]=15&a[6]|64,a[8]=63&a[8]|128,function(e,t=0){return(ar[e[t+0]]+ar[e[t+1]]+ar[e[t+2]]+ar[e[t+3]]+"-"+ar[e[t+4]]+ar[e[t+5]]+"-"+ar[e[t+6]]+ar[e[t+7]]+"-"+ar[e[t+8]]+ar[e[t+9]]+"-"+ar[e[t+10]]+ar[e[t+11]]+ar[e[t+12]]+ar[e[t+13]]+ar[e[t+14]]+ar[e[t+15]]).toLowerCase()}(a)}function lr(e,t,r){return or.randomUUID&&!e?or.randomUUID():nr(e)}const cr=W({id:Q().uuid(),currentItemId:Q().uuid(),startTime:Q().datetime(),endTime:Q().datetime().optional(),score:Y().min(0).max(100).default(0),itemsPracticed:Y().min(0).default(0),correctAnswers:Y().min(0).default(0),incorrectAnswers:Y().min(0).default(0),sessionType:q(["vocabulary","grammar","listening","speaking"]),completed:Z().default(!1)}),dr=q(["noun","verb","adjective","adverb","pronoun","preposition","conjunction","interjection","article","number","phrase"]),ur=q(["greetings","numbers","family","food","colors","animals","body","clothing","house","nature","transport","technology","time","weather","professions","places","grammar","culture","common_phrases","uncategorized"]);q(["beginner","elementary","intermediate","upper_intermediate","advanced"]);const mr=W({gender:q(["masculine","feminine","neuter"]).optional(),pluralForm:Q().optional(),conjugation:J(Q(),Q()).optional(),examples:K(W({german:Q(),bulgarian:Q(),context:Q().optional()})).optional(),synonyms:K(Q()).optional(),antonyms:K(Q()).optional(),relatedWords:K(Q()).optional(),notes:Q().optional(),mnemonic:Q().optional(),culturalNote:Q().optional(),etymology:Q().optional()}),pr=X([Q().uuid(),Q().min(1).max(100),Y().positive()]).transform(e=>"number"==typeof e?`legacy-${e}`:e),hr=ur.or(N("uncategorized")),gr=W({id:pr,german:Q().min(1).max(100),bulgarian:Q().min(1).max(100),partOfSpeech:dr.default("noun"),difficulty:Y().min(1).max(5).default(1).describe("1-5 scale where 1 is easiest"),categories:K(hr).min(1).default(["uncategorized"]),transliteration:Q().optional(),emoji:Q().optional(),literalBreakdown:K(W({segment:Q(),literal:Q(),grammarTag:Q()})).optional(),metadata:mr.optional(),createdAt:X([H(),Q().datetime().transform(e=>new Date(e))]).default(new Date).transform(e=>e instanceof Date?e:new Date(e)),updatedAt:X([H(),Q().datetime().transform(e=>new Date(e))]).default(new Date).transform(e=>e instanceof Date?e:new Date(e)),isCommon:Z().default(!1),isVerified:Z().default(!1),learningPhase:Y().min(0).max(6).optional().default(0)}),fr=gr.catch(e=>{return"object"==typeof e.input&&e.input?(e.input,e.input.metadata):e.input,t=e.input,{id:`fallback-${crypto.randomUUID()}`,german:"object"==typeof t&&t&&"german"in t&&"string"==typeof t.german?t.german:"unknown",bulgarian:"object"==typeof t&&t&&"bulgarian"in t&&"string"==typeof t.bulgarian?t.bulgarian:"unknown",partOfSpeech:"noun",difficulty:1,categories:["uncategorized"],metadata:{},createdAt:new Date,updatedAt:new Date,isCommon:!1,isVerified:!1,learningPhase:0};var t});W({id:Q().uuid(),name:Q().min(3).max(100),description:Q().min(10).max(500),items:K(fr),languagePair:q(["de-bg","bg-de"]),difficultyRange:ee([Y().min(1),Y().max(5)]),categories:K(ur),createdAt:X([H(),Q().datetime().transform(e=>new Date(e))]).default(new Date).transform(e=>e instanceof Date?e:new Date(e)),updatedAt:X([H(),Q().datetime().transform(e=>new Date(e))]).default(new Date).transform(e=>e instanceof Date?e:new Date(e))}),W({query:Q().optional(),partOfSpeech:dr.optional(),difficulty:Y().min(1).max(5).optional(),categories:K(ur).optional(),learningPhase:Y().min(0).max(6).optional(),limit:Y().min(1).max(100).default(20),offset:Y().min(0).default(0),sortBy:q(["german","bulgarian","difficulty","createdAt"]).default("german"),sortOrder:q(["asc","desc"]).default("asc")}),W({userId:Q().uuid(),vocabularyId:Q().uuid(),learned:Z().default(!1),proficiency:Y().min(0).max(100).default(0),lastReviewed:H().optional(),reviewCount:Y().min(0).default(0),nextReviewDate:H().optional()});const yr=W({id:Q().uuid(),currentItemId:Q().uuid(),startTime:Q().datetime(),endTime:Q().datetime().optional(),score:Y().min(0).max(100).default(0),itemsPracticed:Y().min(0).default(0),correctAnswers:Y().min(0).default(0),incorrectAnswers:Y().min(0).default(0),sessionType:q(["vocabulary","grammar","listening","speaking"]),completed:Z().default(!1)}),br=W({id:Q(),correct:Y().int().nonnegative(),incorrect:Y().int().nonnegative(),lastPracticed:Q().datetime()}),wr=W({stats:K(br),favorites:K(Q()),recentSearches:K(Q()),lastUpdated:Q().datetime()});W({progress:wr.optional(),session:yr.optional(),exportedAt:Q().datetime()});const vr=class e{static saveUserProgress(t,r){try{const r={stats:Array.from(t.stats.entries()).map(([e,t])=>({id:e,correct:t.correct,incorrect:t.incorrect,lastPracticed:t.lastPracticed})),favorites:t.favorites,recentSearches:t.recentSearches,lastUpdated:(new Date).toISOString()},a=wr.safeParse(r);if(!a.success)throw new At("Invalid user progress data",{validationResult:a});localStorage.setItem(e.USER_PROGRESS_KEY,JSON.stringify(r))}catch(a){const e=a instanceof Error?a:new Error(String(a));throw It.handleError(e,"Failed to save user progress",r),new At("Failed to save user progress",{error:e})}}static loadUserProgress(t){try{const t=localStorage.getItem(e.USER_PROGRESS_KEY);if(!t)return null;const r=function(e){const t=wr.safeParse(e);return t.success?{success:!0,data:t.data}:{success:!1,error:t.error}}(JSON.parse(t));if(!r.success)throw new At("Invalid user progress data format",{validationResult:r});const a=new Map;return r.data.stats.forEach(e=>{(function(e){return br.safeParse(e).success})(e)&&a.set(e.id,{correct:e.correct,incorrect:e.incorrect,lastPracticed:e.lastPracticed})}),{stats:a,favorites:r.data.favorites||[],recentSearches:r.data.recentSearches||[],lastUpdated:r.data.lastUpdated}}catch(r){const e=r instanceof Error?r:new Error(String(r));throw It.handleError(e,"Failed to load user progress",t),new At("Failed to load user progress",{error:e})}}static savePracticeSession(t,r){try{const r=cr.safeParse(t);if(!r.success)throw new At("Invalid practice session data",{result:r});localStorage.setItem(e.SESSION_KEY,JSON.stringify(t))}catch(a){const e=a instanceof Error?a:new Error(String(a));throw It.handleError(e,"Failed to save practice session",r),new At("Failed to save practice session",{error:e})}}static loadPracticeSession(t){try{const t=localStorage.getItem(e.SESSION_KEY);if(!t)return null;const r=JSON.parse(t),a=cr.safeParse(r);if(!a.success)throw new At("Invalid practice session data format",{result:a});return a.data}catch(r){const e=r instanceof Error?r:new Error(String(r));throw It.handleError(e,"Failed to load practice session",t),new At("Failed to load practice session",{error:e})}}static clearPracticeSession(t){try{localStorage.removeItem(e.SESSION_KEY)}catch(r){const e=r instanceof Error?r:new Error(String(r));throw It.handleError(e,"Failed to clear practice session",t),new At("Failed to clear practice session",{error:e})}}static exportUserData(e){try{const t=this.loadUserProgress(e),r=this.loadPracticeSession(e);return JSON.stringify({progress:t,session:r,exportedAt:(new Date).toISOString()},null,2)}catch(t){const r=t instanceof Error?t:new Error(String(t));throw It.handleError(r,"Failed to export user data",e),new At("Failed to export user data",{error:r})}}static importUserData(e,t){try{const r=JSON.parse(e);r.progress&&this.saveUserProgress({stats:r.progress.stats,favorites:r.progress.favorites,recentSearches:r.progress.recentSearches},t),r.session&&this.savePracticeSession(r.session,t)}catch(r){const e=r instanceof Error?r:new Error(String(r));throw It.handleError(e,"Failed to import user data",t),new At("Failed to import user data",{error:e})}}static clearAllData(t){try{Object.keys(localStorage).filter(t=>t.startsWith(e.PREFIX)).forEach(e=>localStorage.removeItem(e))}catch(r){const e=r instanceof Error?r:new Error(String(r));throw It.handleError(e,"Failed to clear all user data",t),new At("Failed to clear all user data",{error:e})}}};vr.PREFIX="tandem_",vr.USER_PROGRESS_KEY=`${vr.PREFIX}user_progress`,vr.SESSION_KEY=`${vr.PREFIX}active_session`;let Sr=vr;const Pr=W({id:Q().uuid(),itemId:Q().uuid(),correctCount:Y().int().min(0).default(0),incorrectCount:Y().int().min(0).default(0),totalAttempts:Y().int().min(0).default(0),lastPracticed:Q().datetime().nullable().default(null),masteryLevel:Y().min(0).max(100).default(0),isMastered:Z().default(!1),createdAt:Q().datetime().default((new Date).toISOString()),updatedAt:Q().datetime().default((new Date).toISOString())}),xr=W({id:Q().uuid(),lessonId:Q().uuid(),userId:Q().uuid().optional(),status:q(["not_started","in_progress","completed","mastered"]).default("not_started"),completionPercentage:Y().min(0).max(100).default(0),lastAccessed:Q().datetime().nullable().default(null),completedAt:Q().datetime().nullable().default(null),createdAt:Q().datetime().default((new Date).toISOString()),updatedAt:Q().datetime().default((new Date).toISOString())}),Dr=W({id:Q().uuid(),quizId:Q().uuid(),sessionId:Q().uuid(),score:Y().min(0).max(100).default(0),totalQuestions:Y().int().min(1).default(1),correctAnswers:Y().int().min(0).default(0),incorrectAnswers:Y().int().min(0).default(0),timeTaken:Y().int().min(0).default(0),completedAt:Q().datetime().default((new Date).toISOString()),createdAt:Q().datetime().default((new Date).toISOString())}),kr=W({id:Q().uuid(),quizPerformanceId:Q().uuid(),questionId:Q().uuid(),questionType:Q().min(1),wasCorrect:Z().default(!1),userAnswer:Q().nullable().default(null),correctAnswer:Q().min(1),timeTaken:Y().int().min(0).default(0),createdAt:Q().datetime().default((new Date).toISOString())}),Er=W({id:Q().uuid(),date:Q().datetime().default((new Date).toISOString()),xpEarned:Y().int().min(0).default(0),wordsPracticed:Y().int().min(0).default(0),lessonsCompleted:Y().int().min(0).default(0),quizzesTaken:Y().int().min(0).default(0),timeSpent:Y().int().min(0).default(0),createdAt:Q().datetime().default((new Date).toISOString()),updatedAt:Q().datetime().default((new Date).toISOString())}),Ar=W({id:Q().uuid(),userId:Q().uuid().optional(),totalXP:Y().int().min(0).default(0),totalWordsPracticed:Y().int().min(0).default(0),totalLessonsCompleted:Y().int().min(0).default(0),totalQuizzesTaken:Y().int().min(0).default(0),totalTimeSpent:Y().int().min(0).default(0),currentLevel:Y().int().min(1).default(1),currentStreak:Y().int().min(0).default(0),longestStreak:Y().int().min(0).default(0),lastActiveDate:Q().datetime().nullable().default(null),createdAt:Q().datetime().default((new Date).toISOString()),updatedAt:Q().datetime().default((new Date).toISOString())}),Ir=W({vocabularyMastery:J(Q().uuid(),Pr),lessonProgress:J(Q().uuid(),xr),quizPerformance:J(Q().uuid(),Dr),questionPerformance:J(Q().uuid(),kr),dailyProgress:J(Q(),Er),overallProgress:Ar}),Tr=(e,t)=>{const r=e+t;if(0===r)return 0;const a=e/r*100;return Math.min(100,Math.max(0,Math.round(a)))},_r=e=>{if(e<200)return 1;if(e<500)return 2;if(e<900)return 3;if(e<1400)return 4;if(e<2e3)return 5;const t=Math.floor(Math.sqrt(e/100))+1;return Math.max(1,t)},Cr=e=>1===e?0:2===e?200:3===e?500:4===e?900:5===e?1400:100*Math.pow(e-1,2);class Or{constructor(e){z(this,m),z(this,p),z(this,h),z(this,g),z(this,f),z(this,y),z(this,b),z(this,w),z(this,v),z(this,S),z(this,P),z(this,x),M(this,m,R(!1)),M(this,p,R(0)),M(this,h,R(0)),M(this,g,R(0)),M(this,f,R(null)),M(this,y,R(0)),this.dailyTarget=50,this.xpEventUnsubscribe=null,this.levelUpEventUnsubscribe=null,M(this,b,V(()=>_r(this.totalXP))),M(this,w,V(()=>Cr(this.level+1))),M(this,v,V(()=>Cr(this.level))),M(this,S,V(()=>{const e=this.totalXP-this.currentLevelStartXP,t=this.nextLevelXP-this.currentLevelStartXP;return t<=0?0:Math.min(100,Math.max(0,e/t*100))})),M(this,P,V(()=>this.dailyTarget<=0?0:Math.min(100,this.dailyXP/this.dailyTarget*100))),M(this,x,V(()=>this.dailyXP>=this.dailyTarget)),this.eventBus=e,this.loadState(),this.xpEventUnsubscribe=e.subscribe(_t,e=>{this.handleXPEarned(e)}),this.levelUpEventUnsubscribe=e.subscribe(Ct,e=>{this.handleLevelUp(e)}),this.level,this.nextLevelXP,this.currentLevelStartXP,this.levelProgress,this.progressPercentage,this.isDailyGoalReached}get isActive(){return B(L(this,m))}set isActive(e){F(L(this,m),e,!0)}get currentStreak(){return B(L(this,p))}set currentStreak(e){F(L(this,p),e,!0)}get sessionXP(){return B(L(this,h))}set sessionXP(e){F(L(this,h),e,!0)}get dailyXP(){return B(L(this,g))}set dailyXP(e){F(L(this,g),e,!0)}get lastPracticeDate(){return B(L(this,f))}set lastPracticeDate(e){F(L(this,f),e,!0)}get totalXP(){return B(L(this,y))}set totalXP(e){F(L(this,y),e,!0)}get level(){return B(L(this,b))}set level(e){F(L(this,b),e)}get nextLevelXP(){return B(L(this,w))}set nextLevelXP(e){F(L(this,w),e)}get currentLevelStartXP(){return B(L(this,v))}set currentLevelStartXP(e){F(L(this,v),e)}get levelProgress(){return B(L(this,S))}set levelProgress(e){F(L(this,S),e)}get progressPercentage(){return B(L(this,P))}set progressPercentage(e){F(L(this,P),e)}get isDailyGoalReached(){return B(L(this,x))}set isDailyGoalReached(e){F(L(this,x),e)}startSession(){this.isActive=!0,this.sessionXP=0,this.checkStreak()}endSession(){this.isActive=!1,this.saveState()}awardXP(e=10){if("number"!=typeof e||e<=0||!Number.isFinite(e))throw new kt("Invalid XP amount",{amount:e});return this.sessionXP+=e,this.dailyXP+=e,this.eventBus.emit(_t,{amount:e,reason:"Session activity",timestamp:new Date}),this.saveState(),!1}handleXPEarned(e){this.totalXP+=e.amount,this.checkStreak(),this.saveState()}handleLevelUp(e){this.totalXP=e.totalXP,xt.log("LearningSession",`Level up detected: ${e.oldLevel} -> ${e.newLevel}`)}getTotalXP(){return this.totalXP}checkStreak(){try{const e=(new Date).toISOString().split("T")[0];if(!e)throw new Error("Failed to get current date");if(this.lastPracticeDate===e)return;const t=new Date;t.setDate(t.getDate()-1);const r=t.toISOString().split("T")[0];if(!r)throw new Error("Failed to get yesterday date");this.lastPracticeDate===r?this.currentStreak++:(this.lastPracticeDate&&this.lastPracticeDate<r||0===this.currentStreak)&&(this.currentStreak=1),this.lastPracticeDate!==e&&(this.dailyXP=0),this.lastPracticeDate=e,this.saveState()}catch(e){throw It.handleError(e,"Failed to check streak"),new kt("Failed to check streak",{error:e})}}loadState(){let e=null;try{if(e=localStorage.getItem("learning-session"),e){const t=JSON.parse(e);this.currentStreak="number"==typeof t.currentStreak?t.currentStreak:0,this.lastPracticeDate="string"==typeof t.lastPracticeDate?t.lastPracticeDate:null,this.dailyXP="number"==typeof t.dailyXP?t.dailyXP:0,this.totalXP="number"==typeof t.totalXP?t.totalXP:0;const r=(new Date).toISOString().split("T")[0];t.lastPracticeDate!==r&&(this.dailyXP=0)}}catch(t){throw It.handleError(t,"Failed to load learning session state"),new At("Failed to load learning session state",{error:t,hasSavedData:null!==e})}}saveState(){try{if("number"!=typeof this.currentStreak||"number"!=typeof this.dailyXP||"number"!=typeof this.totalXP)throw new Error("Invalid session state: numbers expected");localStorage.setItem("learning-session",JSON.stringify({currentStreak:this.currentStreak,dailyXP:this.dailyXP,lastPracticeDate:this.lastPracticeDate,totalXP:this.totalXP}))}catch(e){throw It.handleError(e,"Failed to save learning session state"),new At("Failed to save learning session state",{error:e,currentStreakType:typeof this.currentStreak,dailyXPType:typeof this.dailyXP,lastPracticeDateType:typeof this.lastPracticeDate,totalXPType:typeof this.totalXP})}}destroy(){xt.log("LearningSession","Destroying LearningSession, cleaning up resources"),this.xpEventUnsubscribe&&(this.xpEventUnsubscribe(),this.xpEventUnsubscribe=null),this.levelUpEventUnsubscribe&&(this.levelUpEventUnsubscribe(),this.levelUpEventUnsubscribe=null)}}m=new WeakMap,p=new WeakMap,h=new WeakMap,g=new WeakMap,f=new WeakMap,y=new WeakMap,b=new WeakMap,w=new WeakMap,v=new WeakMap,S=new WeakMap,P=new WeakMap,x=new WeakMap;window.addEventListener("beforeunload",()=>{});class Lr{constructor(){this.progressData=this.getDefaultProgressData(),this.loadProgress()}static getInstance(){return Lr.instance||(Lr.instance=new Lr),Lr.instance}getDefaultProgressData(){return{vocabularyMastery:{},lessonProgress:{},quizPerformance:{},questionPerformance:{},dailyProgress:{},overallProgress:{id:lr(),totalXP:0,totalWordsPracticed:0,totalLessonsCompleted:0,totalQuizzesTaken:0,totalTimeSpent:0,currentLevel:1,currentStreak:0,longestStreak:0,lastActiveDate:null,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}}}recordVocabularyPractice(e,t,r){const a=(new Date).toISOString();let i=this.progressData.vocabularyMastery[e]||{id:lr(),itemId:e,correctCount:0,incorrectCount:0,totalAttempts:0,lastPracticed:null,masteryLevel:0,isMastered:!1,createdAt:a,updatedAt:a};t?i.correctCount++:i.incorrectCount++,i.totalAttempts++,i.lastPracticed=a,i.updatedAt=a,i.masteryLevel=Tr(i.correctCount,i.incorrectCount),i.isMastered=i.masteryLevel>=80,this.progressData.vocabularyMastery[e]=Pr.parse(i),this.updateOverallProgress({xpEarned:Lr.XP_VALUES.VOCABULARY_PRACTICE,wordsPracticed:1,timeSpent:responseTime||0}),i.isMastered&&1===i.totalAttempts&&this.awardXP(Lr.XP_VALUES.VOCABULARY_MASTERED,"Vocabulary mastered"),this.saveProgress()}getVocabularyMastery(e){return this.progressData.vocabularyMastery[e]||null}getAllVocabularyMastery(){return this.progressData.vocabularyMastery}getVocabularyNeedingPractice(e=10){return Object.values(this.progressData.vocabularyMastery).filter(e=>{if(e.isMastered)return!1;const t=e.correctCount+e.incorrectCount;return(t>0?e.correctCount/t:0)<.8||t<3}).sort((e,t)=>e.masteryLevel!==t.masteryLevel?e.masteryLevel-t.masteryLevel:new Date(e.lastPracticed||0).getTime()-new Date(t.lastPracticed||0).getTime()).slice(0,e)}recordLessonProgress(e,t){const r=(new Date).toISOString();r.split("T")[0];let a=this.progressData.lessonProgress[e]||{id:lr(),lessonId:e,status:"not_started",completionPercentage:0,lastAccessed:null,completedAt:null,createdAt:r,updatedAt:r};a.completionPercentage=Math.min(100,Math.max(0,t)),a.lastAccessed=r,a.updatedAt=r,a.completionPercentage>=100?(a.status="completed",a.completedAt=r):a.completionPercentage>0&&(a.status="in_progress"),this.progressData.lessonProgress[e]=xr.parse(a),"completed"===a.status&&100===a.completionPercentage&&this.updateOverallProgress({xpEarned:Lr.XP_VALUES.LESSON_COMPLETED,lessonsCompleted:1,timeSpent:0}),this.saveProgress()}getLessonProgress(e){return this.progressData.lessonProgress[e]||null}getAllLessonProgress(){return this.progressData.lessonProgress}recordQuizPerformance(e,t,r,a,i,s){const o=(new Date).toISOString(),n={id:lr(),quizId:e,sessionId:s,score:Math.min(100,Math.max(0,t)),totalQuestions:r,correctAnswers:a,incorrectAnswers:r-a,timeTaken:i,completedAt:o,createdAt:o};this.progressData.quizPerformance[n.id]=Dr.parse(n),this.updateOverallProgress({xpEarned:Lr.XP_VALUES.QUIZ_COMPLETED,quizzesTaken:1,timeSpent:i}),this.saveProgress()}recordQuestionPerformance(e,t,r,a,i,s,o){const n=(new Date).toISOString(),l={id:lr(),quizPerformanceId:e,questionId:t,questionType:r,wasCorrect:a,userAnswer:i,correctAnswer:s,timeTaken:o,createdAt:n};this.progressData.questionPerformance[l.id]=kr.parse(l),r.includes("vocabulary")&&t&&this.recordVocabularyPractice(t,a,o),this.saveProgress()}getQuizPerformance(e){return this.progressData.quizPerformance[e]||null}getAllQuizPerformance(){return this.progressData.quizPerformance}getQuizPerformanceByQuizId(e){return Object.values(this.progressData.quizPerformance).filter(t=>t.quizId===e).sort((e,t)=>new Date(t.completedAt).getTime()-new Date(e.completedAt).getTime())}recordDailyProgress(e,t,r,a,i,s){const o=(new Date).toISOString();let n=this.progressData.dailyProgress[e]||{id:lr(),date:new Date(e).toISOString(),xpEarned:0,wordsPracticed:0,lessonsCompleted:0,quizzesTaken:0,timeSpent:0,createdAt:o,updatedAt:o};n.xpEarned+=t,n.wordsPracticed+=r,n.lessonsCompleted+=a,n.quizzesTaken+=i,n.timeSpent+=s,n.updatedAt=o,this.progressData.dailyProgress[e]=Er.parse(n),this.saveProgress()}getDailyProgress(e){return this.progressData.dailyProgress[e]||null}getAllDailyProgress(){return this.progressData.dailyProgress}getRecentDailyProgress(e=7){const t=new Date,r=[];for(let a=0;a<e;a++){const e=new Date(t);e.setDate(t.getDate()-a);const i=e.toISOString().split("T")[0],s=this.progressData.dailyProgress[i];s&&r.push(s)}return r.sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())}updateOverallProgress(e){const t=(new Date).toISOString(),r=t.split("T")[0];this.progressData.overallProgress.totalXP+=e.xpEarned,this.progressData.overallProgress.totalWordsPracticed+=e.wordsPracticed||0,this.progressData.overallProgress.totalLessonsCompleted+=e.lessonsCompleted||0,this.progressData.overallProgress.totalQuizzesTaken+=e.quizzesTaken||0,this.progressData.overallProgress.totalTimeSpent+=e.timeSpent,this.progressData.overallProgress.lastActiveDate=t,this.progressData.overallProgress.updatedAt=t;const a=_r(this.progressData.overallProgress.totalXP);a>this.progressData.overallProgress.currentLevel&&(this.progressData.overallProgress.currentLevel=a),this.updateStreak(r),this.recordDailyProgress(r,e.xpEarned,e.wordsPracticed||0,e.lessonsCompleted||0,e.quizzesTaken||0,e.timeSpent),null.awardXP(e.xpEarned),this.saveProgress()}updateStreak(e){const t=new Date;t.setDate(t.getDate()-1);const r=t.toISOString().split("T")[0];if(!this.progressData.overallProgress.lastActiveDate)return this.progressData.overallProgress.currentStreak=1,void(this.progressData.overallProgress.longestStreak=1);this.progressData.overallProgress.lastActiveDate===r?this.progressData.overallProgress.currentStreak++:this.progressData.overallProgress.lastActiveDate!==e&&(this.progressData.overallProgress.currentStreak=1),this.progressData.overallProgress.currentStreak>this.progressData.overallProgress.longestStreak&&(this.progressData.overallProgress.longestStreak=this.progressData.overallProgress.currentStreak)}getOverallProgress(){return this.progressData.overallProgress}getLevelInfo(){const e=this.progressData.overallProgress.currentLevel,t=this.progressData.overallProgress.totalXP,r=Cr(e+1),a=Cr(e),i=t-a,s=r-a;return{level:e,currentXP:t,nextLevelXP:r,progressPercentage:Math.min(100,Math.max(0,i/s*100))}}awardXP(e,t){this.updateOverallProgress({xpEarned:e,timeSpent:0})}loadProgress(){try{const e=Sr.loadUserProgress();if(e){const t=Ir.safeParse(e);t.success?this.progressData=t.data:this.progressData=this.getDefaultProgressData()}}catch(e){this.progressData=this.getDefaultProgressData()}}saveProgress(){try{Sr.saveUserProgress(this.progressData)}catch(e){}}exportProgress(){return JSON.stringify(this.progressData,null,2)}importProgress(e){try{const t=JSON.parse(e),r=Ir.parse(t);this.progressData=r,this.saveProgress()}catch(t){throw new Error("Failed to import progress data")}}resetProgress(){this.progressData=this.getDefaultProgressData(),this.saveProgress()}getProgressSummary(){const e=this.getLevelInfo(),t=this.getOverallProgress(),r=(new Date).toISOString().split("T")[0],a=this.getDailyProgress(r)||{xpEarned:0};return{totalXP:t.totalXP,currentLevel:e.level,levelProgress:e.progressPercentage,wordsPracticed:t.totalWordsPracticed,lessonsCompleted:t.totalLessonsCompleted,quizzesTaken:t.totalQuizzesTaken,currentStreak:t.currentStreak,longestStreak:t.longestStreak,dailyGoalProgress:Math.min(100,a.xpEarned/null.dailyTarget*100)}}getVocabularyMasteryStats(){const e=Object.values(this.progressData.vocabularyMastery),t=e.filter(e=>e.isMastered).length,r=e.length;return{totalItems:r,masteredItems:t,masteryPercentage:r>0?t/r*100:0,averageMasteryLevel:r>0?e.reduce((e,t)=>e+t.masteryLevel,0)/r:0}}getLessonCompletionStats(){const e=Object.values(this.progressData.lessonProgress),t=e.filter(e=>"completed"===e.status).length,r=e.length;return{totalLessons:r,completedLessons:t,completionPercentage:r>0?t/r*100:0}}}Lr.XP_VALUES={VOCABULARY_PRACTICE:10,VOCABULARY_MASTERED:50,LESSON_COMPLETED:100,QUIZ_COMPLETED:150,DAILY_GOAL:200},Lr.getInstance();class zr extends Error{constructor(e){super(e),this.name="LessonGenerationError"}}class Mr extends Error{constructor(e){super(e),this.name="TemplateRenderingError"}}class jr extends Error{constructor(e){super(e),this.name="DataValidationError"}}const Br=e=>["A1","A2","B1","B2","C1"].includes(e),Fr=e=>["vocabulary","grammar","mixed","cultural","contextual"].includes(e);const Rr=new class{constructor(){this.templates=[],this._initialized=!1,this.templateCache=new Map}get initialized(){return this._initialized}async initialize(){if(!this._initialized)try{this.templates=await this.loadTemplates(),this._initialized=!0,this.cacheTemplates()}catch(e){throw new zr("Failed to initialize template repository")}}async getTemplate(e,t){this._initialized||await this.initialize();const r=`${e}-${t}`;if(this.templateCache.has(r))return this.templateCache.get(r);const a=this.templates.filter(r=>r.type===e&&this.isDifficultyInRange(t,r.difficultyRange));if(0===a.length)throw new zr(`No template found for type ${e} and difficulty ${t}`);const i=a[Math.floor(Math.random()*a.length)];if(!i)throw new zr(`Failed to select a template for type ${e}`);return this.templateCache.set(r,i),i}async getTemplateById(e){return this._initialized||await this.initialize(),this.templates.find(t=>t.id===e)}async getAllTemplates(){return this.initialized||await this.initialize(),[...this.templates]}validateTemplate(e){if(!e.id||"string"!=typeof e.id)throw new jr("Template id is required and must be a string");if(!e.name||"string"!=typeof e.name)throw new jr("Template name is required and must be a string");if(!e.description||"string"!=typeof e.description)throw new jr("Template description is required and must be a string");if(!e.type||!["vocabulary","grammar","mixed","cultural","contextual"].includes(e.type))throw new jr("Template type is required and must be a valid LessonType");if(!e.difficultyRange||!Array.isArray(e.difficultyRange)||2!==e.difficultyRange.length)throw new jr("Template difficultyRange is required and must be an array of two elements");if(!this.isValidDifficultyRange(e.difficultyRange))throw new jr("Template difficultyRange must contain valid difficulty levels in ascending order");if(!e.template||"string"!=typeof e.template)throw new jr("Template content is required and must be a string");if(!e.variables||!Array.isArray(e.variables))throw new jr("Template variables is required and must be an array");for(const t of e.variables){if(!t.name||"string"!=typeof t.name)throw new jr(`Variable name is required and must be a string: ${JSON.stringify(t)}`);if(!t.type||!["string","number","boolean","array","object"].includes(t.type))throw new jr(`Variable type is required and must be a valid TemplateVariableType: ${t.name}`);if("boolean"!=typeof t.required)throw new jr(`Variable required must be a boolean: ${t.name}`);if(void 0!==t.defaultValue&&!this.isValidDefaultValue(t.defaultValue,t.type))throw new jr(`Variable defaultValue must match the specified type: ${t.name}`)}return!0}async loadTemplates(){try{0;const t=Object.assign({"/src/lib/data/templates/grammar/grammar_comparison_template.json":()=>j(()=>import("./CMBSqt9Q.js"),[],import.meta.url),"/src/lib/data/templates/grammar/grammar_concept_template.json":()=>j(()=>import("./BYr2C4Bn.js"),[],import.meta.url),"/src/lib/data/templates/grammar/grammar_practice_template.json":()=>j(()=>import("./D2E1_v-9.js"),[],import.meta.url),"/src/lib/data/templates/mixed/mixed_lesson_template.json":()=>j(()=>import("./BpkRujMc.js"),[],import.meta.url),"/src/lib/data/templates/vocabulary/vocabulary_intro_template.json":()=>j(()=>import("./BkIg_Sn7.js"),[],import.meta.url),"/src/lib/data/templates/vocabulary/vocabulary_practice_template.json":()=>j(()=>import("./Dvmtb9D_.js"),[],import.meta.url),"/src/lib/data/templates/vocabulary/vocabulary_review_template.json":()=>j(()=>import("./BZ6TEcXe.js"),[],import.meta.url)}),r=[];for(const[a,i]of Object.entries(t))try{const e=(await i()).default;this.validateTemplate(e)&&r.push(e)}catch(e){}return 0===r.length?[this.createFallbackTemplate()]:r}catch(e){return[this.createFallbackTemplate()]}}cacheTemplates(){this.templateCache.clear();for(const e of this.templates)for(const t of this.getDifficultiesInRange(e.difficultyRange)){const r=`${e.type}-${t}`;this.templateCache.set(r,e)}}isDifficultyInRange(e,t){const r=["A1","A2","B1","B2","C1"],a=r.indexOf(t[0]),i=r.indexOf(t[1]),s=r.indexOf(e);return s>=a&&s<=i}getDifficultiesInRange(e){const t=["A1","A2","B1","B2","C1"],r=t.indexOf(e[0]),a=t.indexOf(e[1]);return t.slice(r,a+1)}isValidDefaultValue(e,t){switch(t){case"string":return"string"==typeof e;case"number":return"number"==typeof e;case"boolean":return"boolean"==typeof e;case"array":return Array.isArray(e);case"object":return"object"==typeof e&&null!==e&&!Array.isArray(e);default:return!1}}isValidDifficultyRange(e){const t=["A1","A2","B1","B2","C1"],r=t.indexOf(e[0]),a=t.indexOf(e[1]);return-1!==r&&-1!==a&&r<=a}createFallbackTemplate(){return{id:"fallback_template",name:"Fallback Template",description:"Fallback template used when no other templates are available",type:"vocabulary",difficultyRange:["A1","C1"],template:"# {{sectionTitle}}\n\nThis lesson contains {{count}} vocabulary items.\n\n{{#each vocabulary}}\n- {{german}} / {{bulgarian}}\n{{/each}}",variables:[{name:"sectionTitle",type:"string",required:!0,description:"Title for the section"},{name:"count",type:"number",required:!0,description:"Number of vocabulary items"},{name:"vocabulary",type:"array",required:!0,description:"Array of vocabulary items"}]}}};const Vr=new class{constructor(){this.grammarConcepts=[],this._initialized=!1}get initialized(){return this._initialized}async initialize(){if(!this._initialized)try{this.grammarConcepts=await this.loadGrammarData(),this._initialized=!0}catch(e){throw new zr("Failed to initialize grammar service")}}async query(e){return this._initialized||await this.initialize(),this.grammarConcepts.filter(t=>{const r=!e.difficulty||t.difficulty===e.difficulty,a=!e.partOfSpeech||this.conceptAppliesToPartOfSpeech(t,e.partOfSpeech),i=!e.conceptType||(t.id.includes(e.conceptType)||t.relatedConcepts.includes(e.conceptType));return r&&a&&i}).slice(0,e.limit||1)}async getAllConcepts(){return this._initialized||await this.initialize(),[...this.grammarConcepts]}conceptAppliesToPartOfSpeech(e,t){return e.partOfSpeech.includes(t)}async loadGrammarData(){try{0;const e=await j(()=>import("./DbG3dHC6.js"),[],import.meta.url),t=e.default.concepts||e.default;if(!Array.isArray(t))return this.getFallbackGrammarData();const r=t.filter(e=>this.validateConcept(e));return 0===r.length?this.getFallbackGrammarData():r}catch(e){return this.getFallbackGrammarData()}}validateConcept(e){if(!e.id||"string"!=typeof e.id)throw new jr("Concept id is required and must be a string");if(!e.name||"object"!=typeof e.name||!e.name.bulgarian||!e.name.german)throw new jr("Concept name is required and must have bulgarian and german properties");if(!e.description||"object"!=typeof e.description||!e.description.bulgarian||!e.description.german)throw new jr("Concept description is required and must have bulgarian and german properties");if(!e.difficulty||!["A1","A2","B1","B2","C1"].includes(e.difficulty))throw new jr("Concept difficulty is required and must be a valid LessonDifficulty");if(!e.partOfSpeech||!Array.isArray(e.partOfSpeech)||0===e.partOfSpeech.length)throw new jr("Concept partOfSpeech is required and must be a non-empty array");if(!e.culturalContext||"object"!=typeof e.culturalContext)throw new jr("Concept culturalContext is required and must be an object");if(!e.examples||!Array.isArray(e.examples)||0===e.examples.length)throw new jr("Concept examples is required and must be a non-empty array");if(!e.commonMistakes||"object"!=typeof e.commonMistakes)throw new jr("Concept commonMistakes is required and must be an object");if(!e.relatedConcepts||!Array.isArray(e.relatedConcepts))throw new jr("Concept relatedConcepts is required and must be an array");for(const t of e.partOfSpeech)if(!["noun","verb","adjective","adverb","preposition","conjunction","pronoun","interjection","article","numeral"].includes(t))throw new jr(`Invalid part of speech: ${t}`);return!0}getFallbackGrammarData(){return[{id:"fallback-article-usage",name:{bulgarian:"Ð£Ð¿Ð¾ÑÑÐµÐ±Ð° Ð½Ð° ÑÐ»ÐµÐ½Ð¾Ð²Ðµ",german:"Artikelgebrauch"},description:{bulgarian:"ÐÑÐ½Ð¾Ð²Ð½Ð° ÑÐ¿Ð¾ÑÑÐµÐ±Ð° Ð½Ð° ÑÐ»ÐµÐ½Ð¾Ð²Ðµ Ð² Ð½ÐµÐ¼ÑÐºÐ¸ ÐµÐ·Ð¸Ðº",german:"Grundlegender Artikelgebrauch im Deutschen"},difficulty:"A1",partOfSpeech:["noun"],culturalContext:{bulgarianPerspective:"Ð Ð±ÑÐ»Ð³Ð°ÑÑÐºÐ¸ Ð½ÑÐ¼Ð° ÑÐ»ÐµÐ½Ð¾Ð²Ðµ, ÐºÐ¾ÐµÑÐ¾ ÑÑÐ·Ð´Ð°Ð²Ð° ÑÑÑÐ´Ð½Ð¾ÑÑÐ¸ Ð¿ÑÐ¸ Ð¸Ð·ÑÑÐ°Ð²Ð°Ð½ÐµÑÐ¾ Ð½Ð° Ð½ÐµÐ¼ÑÐºÐ¸.",germanPerspective:"Im Deutschen sind Artikel obligatorisch, was fÃ¼r bulgarische Lernende ungewohnt ist.",crossLinguisticExplanation:{bgToDe:"Ð Ð±ÑÐ»Ð³Ð°ÑÑÐºÐ¸ Ð½ÑÐ¼Ð° ÑÐ»ÐµÐ½Ð¾Ð²Ðµ. Ð Ð½ÐµÐ¼ÑÐºÐ¸ ÑÑÑÐ±Ð²Ð° Ð´Ð° Ð¸Ð·Ð¿Ð¾Ð»Ð·Ð²Ð°ÑÐµ der, die, das ÑÐ¿Ð¾ÑÐµÐ´ ÑÐ¾Ð´Ð°.",deToBg:"Im Bulgarischen gibt es keine Artikel. Substantive werden ohne Artikel verwendet."}},examples:[{bulgarian:"ÐÐ½Ð¸Ð³Ð°ÑÐ° Ðµ Ð½Ð° Ð¼Ð°ÑÐ°ÑÐ°.",german:"Das Buch ist auf dem Tisch.",explanationBgToDe:"Ð Ð±ÑÐ»Ð³Ð°ÑÑÐºÐ¸ Ð½ÑÐ¼Ð° ÑÐ»ÐµÐ½Ð¾Ð²Ðµ. Ð Ð½ÐµÐ¼ÑÐºÐ¸ ÑÐµ Ð¸Ð·Ð¿Ð¾Ð»Ð·Ð²Ð°Ñ der/die/das.",explanationDeToBg:"Im Deutschen gibt es Artikel (das, dem), im Bulgarischen nicht."}],commonMistakes:{bgToDe:["ÐÐ°Ð±ÑÐ°Ð²ÑÐ½Ðµ Ð½Ð° ÑÐ»ÐµÐ½Ð¾Ð²Ðµ","ÐÑÐµÑÐµÐ½ ÑÐ¾Ð´"],deToBg:["ÐÐ¾Ð±Ð°Ð²ÑÐ½Ðµ Ð½Ð° Ð½ÐµÑÑÑÐµÑÑÐ²ÑÐ²Ð°ÑÐ¸ ÑÐ»ÐµÐ½Ð¾Ð²Ðµ"]},relatedConcepts:["noun-gender"],metadata:{}}]}};function Gr(e){return"DE_BG"===ya.languageMode?e.german:e.bulgarian}function Ur(e){return"DE_BG"===ya.languageMode?e.bulgarian:e.german}function $r(){return"DE_BG"===ya.languageMode?"de":"bg"}function qr(){return"DE_BG"===ya.languageMode?"bg":"de"}function Xr(){return"DE_BG"===ya.languageMode?"German":"Bulgarian"}function Nr(){return"DE_BG"===ya.languageMode?"Bulgarian":"German"}function Wr(){return"DE_BG"===ya.languageMode?"â":"â"}function Qr(){return"DE_BG"===ya.languageMode?"DEâBG":"BGâDE"}function Jr(){return"DE_BG"===ya.languageMode?"BGâDE":"DEâBG"}function Yr(e,t){if(!e)return"";const r=$r();return e[`${t}.${r}`]?e[`${t}.${r}`]:e[t]&&e[t][r]?e[t][r]:e[t]?e[t]:""}function Zr(e,t){if(!e)return"";const r=qr();return e[`${t}.${r}`]?e[`${t}.${r}`]:e[t]&&e[t][r]?e[t][r]:""}function Kr(e){if(!e)return"";return`- ${Gr(e)}\n- ${Ur(e)}`}function Hr(e,t){return"DE_BG"===ya.languageMode?e:t}const ea=new class{render(e,t){this.validateData(e,t);try{return this.renderTemplate(e.template,t)}catch(r){if(r instanceof Mr)throw r;throw new Mr(`Template rendering failed: ${r instanceof Error?r.message:String(r)}`)}}validateData(e,t){for(const r of e.variables){const e=t[r.name];if(r.required&&void 0===e)throw new jr(`Required variable '${r.name}' is missing`);if(void 0!==e&&!this.isValidValue(e,r.type))throw new jr(`Variable '${r.name}' must be of type ${r.type}`)}return!0}validateTemplate(e){if(!e.template||"string"!=typeof e.template)throw new jr("Template content is required and must be a string");if(!e.variables||!Array.isArray(e.variables))throw new jr("Template variables is required and must be an array");return!0}renderTemplate(e,t){let r,a=e,i=0;do{if(r=a,a=this.processLoops(a,t),a=this.processConditionals(a,t),a=this.processVariables(a,t),i++,i>=20)break}while(a!==r);return a}resolveValue(e,t){return void 0!==t[e]?t[e]:e.includes(".")?e.split(".").reduce((e,t)=>e&&"object"==typeof e?e[t]:void 0,t):void 0}processVariables(e,t){const r={...t,getSourceText:Gr,getTargetText:Ur,getSourceLanguage:$r,getTargetLanguage:qr,getSourceLanguageName:Xr,getTargetLanguageName:Nr,getDirectionArrow:Wr,getDirectionText:Qr,getOppositeDirectionText:Jr,getLanguageProperty:Yr,getOppositeLanguageProperty:Zr,formatBilingualExample:Kr,getDirectionalTemplate:Hr};return e.replace(/\{\{\s*([a-zA-Z_][a-zA-Z0-9_.]*)\s*\}\}/g,(e,t)=>{if(t.startsWith("@")||"this"===t||"else"===t)return e;const a=this.resolveValue(t,r);if(void 0===a)throw new Mr(`Variable '${t}' is not defined`);if("object"==typeof a&&null!==a&&"function"!=typeof a)throw new Mr(`Variable '${t}' is an object and cannot be rendered directly`);if("function"==typeof a)try{return String(a())}catch(i){throw new Mr(`Function '${t}' failed: ${i instanceof Error?i.message:String(i)}`)}return String(a)})}processConditionals(e,t){return e=(e=e.replace(/\{\{\s*#unless\s+([@a-zA-Z_][a-zA-Z0-9_.]*)\s*\}\}((?:(?!\{\{\s*#unless)[\s\S])*?)\{\{\s*\/unless\s*\}\}/g,(e,r,a)=>{const i=this.resolveValue(r,t);return Boolean(i)&&"false"!==i&&"0"!==i?"":this.renderTemplate(a,t)})).replace(/\{\{\s*#if\s+([@a-zA-Z_][a-zA-Z0-9_.]*)\s*\}\}((?:(?!\{\{\s*#if)[\s\S])*?)\{\{\s*\/if\s*\}\}/g,(e,r,a)=>{const i=this.resolveValue(r,t),s=Boolean(i)&&"false"!==i&&"0"!==i,o=a.split(/\{\{\s*else\s*\}\}/);if(o.length>1){const e=o[0],r=o.slice(1).join("{{else}}");return s?this.renderTemplate(e,t):this.renderTemplate(r,t)}return s?this.renderTemplate(a,t):""})}processLoops(e,t){const r=/\{\{\s*#each\s+([a-zA-Z_][a-zA-Z0-9_]*)\s*\}\}((?:(?!\{\{\s*#each)[\s\S])*?)\{\{\s*\/each\s*\}\}/g;let a,i=e;for(;null!==(a=r.exec(i));){const e=a[0],s=a[1],o=a[2];if(!s)continue;const n=t[s];if(void 0===n){r.lastIndex=0,i=i.replace(e,"");continue}if(!Array.isArray(n))throw new Mr(`Variable '${s}' must be an array for #each loop`);if(0===n.length){i=i.replace(e,""),r.lastIndex=0;continue}const l=n.map((e,r)=>{const a={...t,this:e,"@index":r,"@first":0===r,"@last":r===n.length-1};"object"==typeof e&&null!==e&&Object.assign(a,e);let i=o||"";return i=i.replace(/\{\{\s*this\s*\}\}/g,String(e)),i=i.replace(/\{\{\s*@index\s*\}\}/g,String(r)),i=i.replace(/\{\{\s*@first\s*\}\}/g,String(0===r)),i=i.replace(/\{\{\s*@last\s*\}\}/g,String(r===n.length-1)),this.renderTemplate(i,a)}).join("");i=i.replace(e,l),r.lastIndex=0}return i}isValidValue(e,t){switch(t){case"string":return"string"==typeof e;case"number":return"number"==typeof e&&!isNaN(e);case"boolean":return"boolean"==typeof e;case"array":return Array.isArray(e);case"object":return"object"==typeof e&&null!==e&&!Array.isArray(e);default:return!1}}};class ta{constructor(e=Rr,t=Vr,r=ea){this.vocabularyCache=null,this.templateRepository=e,this.grammarService=t,this.renderer=r}async generateLesson(e,t={}){try{const r={...e,type:this.normalizeLessonType(e.type),criteria:{...e.criteria,categories:this.normalizeCategories(e.criteria.categories)}};switch(r.type){case"vocabulary":default:return this.generateThematicLesson(r,t);case"grammar":return this.generateGrammarLesson(r,t);case"culture":case"mixed":return this.generateContextualLesson(r,t)}}catch(r){throw new Error(`Failed to generate lesson: ${r.message}`)}}async generateThematicLesson(e,t={}){const r=!1!==e.metadata?.includePractice,a=!0===e.metadata?.includeReview,i=[],s=[];let o=[];if(!this.vocabularyCache){const e=await Kt();this.vocabularyCache=e.items.map(e=>this.normalizeVocabularyItem(e))}const n=e.criteria.limit||t.maxItems||10,l=this.mapDifficultyToNumber(e.difficulty);let c=[];if(e.criteria.categories&&e.criteria.categories.length>0)for(const u of e.criteria.categories){const t=await er(u,{difficulty:l,limit:Math.ceil(n/e.criteria.categories.length)}),r=e.criteria.partOfSpeech?t.filter(t=>this.validatePartOfSpeech(t.partOfSpeech,t.id)===e.criteria.partOfSpeech):t;c=[...c,...this.normalizeVocabularyList(r)]}else if(e.criteria.partOfSpeech){const t=await Ht({difficulty:l,partOfSpeech:e.criteria.partOfSpeech??void 0,limit:n});c=this.normalizeVocabularyList(t.items.filter(t=>this.validatePartOfSpeech(t.partOfSpeech,t.id)===e.criteria.partOfSpeech))}else c=this.normalizeVocabularyList(await tr(n,{difficulty:l}));c=this.normalizeVocabularyList(c.slice(0,n)),s.push(...c);try{const t=await this.templateRepository.getTemplateById("vocabulary-intro")||await this.templateRepository.getTemplate("vocabulary",e.difficulty),r=e.criteria.categories?.map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(", ")||"General",a=c.map(e=>({...e,correctedPartOfSpeech:this.correctPartOfSpeech(this.validatePartOfSpeech(e.partOfSpeech,e.id)),grammarInfo:this.getFallbackGrammarInfo(this.validatePartOfSpeech(e.partOfSpeech,e.id))})),s={sectionTitle:`Vocabulary: ${r}`,count:c.length,theme:r,difficulty:e.difficulty,vocabulary:a,learningTip:"Focus on the gender of nouns (der, die, das) as you learn them.",learningObjectives:[`Learn ${c.length} new words related to ${r}`,"Practice pronunciation and usage"]};o=[...s.learningObjectives||[]];const n=this.renderer.render(t,s);i.push({id:lr(),title:s.sectionTitle||"Introduction",content:n,type:"introduction",metadata:{templateId:t.id}})}catch(d){}if(r&&c.length>0)try{const t=await this.templateRepository.getTemplateById("vocabulary-practice")||await this.templateRepository.getTemplate("vocabulary",e.difficulty),r={sectionTitle:"Practice Exercises",instructions:"Test your knowledge of the new words.",vocabulary:c.map(e=>({...e,correctedPartOfSpeech:this.correctPartOfSpeech(this.validatePartOfSpeech(e.partOfSpeech,e.id)),grammarInfo:this.getFallbackGrammarInfo(this.validatePartOfSpeech(e.partOfSpeech,e.id))}))},a=this.renderer.render(t,r);i.push({id:lr(),title:"Practice",content:a,type:"exercise",metadata:{templateId:t.id}})}catch(d){}if(a)try{const t=await this.templateRepository.getTemplateById("vocabulary-review")||await this.templateRepository.getTemplate("vocabulary",e.difficulty),r=this.normalizeVocabularyList(await tr(5,{difficulty:l})),a={sectionTitle:"Review",context:"Previous Lessons",vocabulary:r.map(e=>({...e,correctedPartOfSpeech:this.correctPartOfSpeech(this.validatePartOfSpeech(e.partOfSpeech,e.id)),grammarInfo:this.getFallbackGrammarInfo(this.validatePartOfSpeech(e.partOfSpeech,e.id))}))},s=this.renderer.render(t,a);i.push({id:lr(),title:"Review",content:s,type:"summary",metadata:{templateId:t.id}})}catch(d){}return{id:lr(),type:e.type,difficulty:e.difficulty,title:`Thematic Lesson: ${e.criteria.categories?.join(", ")||"General"}`,sections:i,vocabulary:s,grammarConcepts:[],learningObjectives:o,metadata:e.metadata||{},createdAt:new Date,updatedAt:new Date}}async generateGrammarLesson(e,t={}){const r=!1!==e.metadata?.includePractice,a=!1!==e.metadata?.includeComparison,i=[],s={difficulty:e.difficulty};e.criteria.partOfSpeech&&(s.partOfSpeech=e.criteria.partOfSpeech),e.criteria.conceptType&&(s.conceptType=e.criteria.conceptType);const o=await this.grammarService.query(s);o.length;const n=o[0];if(!this.vocabularyCache){const e=await Kt();this.vocabularyCache=e.items.map(e=>this.normalizeVocabularyItem(e))}const l=this.mapDifficultyToNumber(e.difficulty);let c=[];if(n&&n.partOfSpeech&&n.partOfSpeech.length>0){const e={difficulty:l,limit:8};n.partOfSpeech[0]&&(e.partOfSpeech=n.partOfSpeech[0]);const t=await Ht(e);c=this.normalizeVocabularyList(t.items)}else c=this.normalizeVocabularyList(await tr(8,{difficulty:l}));try{const t=await this.templateRepository.getTemplateById("grammar-concept")||await this.templateRepository.getTemplate("grammar",e.difficulty),r={sectionTitle:`Grammar: ${n?n.name.german:"Grammar Rule"}`,vocabulary:c,learningTip:"Focus on understanding the underlying logic rather than just memorizing rules.",learningObjectives:[`Understand the concept of ${n?n.name.german:"this grammar rule"}`,`Compare ${n?n.name.german:"it"} with Bulgarian usage`]};n&&(r.grammarConcept=n);const a=this.renderer.render(t,r);i.push({id:lr(),title:"Explanation",content:a,type:"grammar",metadata:{templateId:t.id,conceptId:n?.id||""}})}catch(d){}if(r&&n)try{const t=await this.templateRepository.getTemplateById("grammar-practice")||await this.templateRepository.getTemplate("grammar",e.difficulty),r={sectionTitle:"Grammar Practice",grammarConcept:n,vocabulary:c.slice(0,5)},a=this.renderer.render(t,r);i.push({id:lr(),title:"Practice",content:a,type:"exercise",metadata:{templateId:t.id}})}catch(d){}if(a&&n&&n.culturalContext)try{const e=await this.templateRepository.getTemplateById("grammar-comparison");if(e){const t={sectionTitle:"Cultural Comparison",grammarConcept:n},r=this.renderer.render(e,t);i.push({id:lr(),title:"Comparison",content:r,type:"cultural",metadata:{templateId:e.id}})}}catch(d){}return{id:lr(),type:e.type,difficulty:e.difficulty,title:n?`Grammar: ${n.name.german}`:"Grammar Lesson",sections:i,vocabulary:c,grammarConcepts:n?[n]:[],learningObjectives:[`Understand ${n?n.name.german:"the grammar rule"}`,"Apply the rule in context","Compare with Bulgarian usage"],metadata:e.metadata||{},createdAt:new Date,updatedAt:new Date}}async generateContextualLesson(e,t={}){const r=await this.templateRepository.getTemplateById("mixed-lesson")||await this.templateRepository.getTemplate("mixed",e.difficulty),a=(await this.grammarService.query({difficulty:e.difficulty,limit:1}))[0],i=this.mapDifficultyToNumber(e.difficulty),s=t.maxItems||8,o=e.criteria.categories?.[0]||"culture",n=this.normalizeCategories([o])[0]||"everyday-phrases",l=this.normalizeVocabularyList(await er(n,{difficulty:i,limit:s})),c=l.map(e=>({...e,correctedPartOfSpeech:this.correctPartOfSpeech(this.validatePartOfSpeech(e.partOfSpeech,e.id)),grammarInfo:this.getFallbackGrammarInfo(this.validatePartOfSpeech(e.partOfSpeech,e.id))})),d={sectionTitle:`Contextual Lesson: ${n.charAt(0).toUpperCase()+n.slice(1)}`,theme:n,difficulty:e.difficulty,vocabulary:c,learningTip:"Try to narrate a short story using these words.",learningObjectives:[`Master vocabulary related to ${o}`,a?`Apply ${a.name.german} in context`:"Practice sentence construction","Build reading comprehension"]};a&&(d.grammarConcept=a);const u=this.renderer.render(r,d);return this.createLessonObject(e,d.sectionTitle||"Contextual Lesson",u,l,a?[a]:[],d.learningObjectives||[])}async generateAdaptiveLesson(e,t={}){return this.generateThematicLesson(e,t)}mapDifficultyToNumber(e){return{A1:1,A2:2,B1:3,B2:4,C1:5}[e]||1}normalizeLessonType(e){return["vocabulary","grammar","mixed","culture"].includes(e)?e:"contextual"===e?"mixed":"vocabulary"}normalizeCategories(e){const t=["greetings","numbers","family","food","colors","animals","body-parts","clothing","home","nature","transport","technology","time","weather","professions","places","grammar","culture","everyday-phrases"];if(!e||0===e.length)return["everyday-phrases"];const r=e.map(e=>t.includes(e)?e:"everyday-phrases").filter(Boolean);return r.length>0?r:["everyday-phrases"]}normalizeVocabularyItem(e){return{...e,categories:this.normalizeCategories(e.categories),isCommon:e.isCommon??e.metadata?.isCommon??!1,isVerified:e.isVerified??e.metadata?.isVerified??!1,learningPhase:e.learningPhase??e.metadata?.learningPhase??0,metadata:e.metadata??{},createdAt:e.createdAt??new Date,updatedAt:e.updatedAt??new Date}}normalizeVocabularyList(e){return e.map(e=>this.normalizeVocabularyItem(e))}validatePartOfSpeech(e,t){const r={zdravej_001:"interjection",dobro_utro_002:"phrase",guten_tag:"phrase",guten_abend:"phrase",gute_nacht:"phrase",auf_wiedersehen:"phrase",bitte:"interjection",entschuldigung:"interjection",es_tut_mir_leid:"phrase",a1_question_001:"pronoun",a1_question_003:"adverb",a1_question_004:"adverb",a1_question_005:"adverb",a1_question_006:"adverb",a1_question_007:"adverb",a1_question_008:"pronoun",a1_question_009:"pronoun",a1_question_010:"adverb",a1_question_011:"adverb",a1_question_012:"conjunction",eins:"numeral",zwei:"numeral",drei:"numeral",vier:"numeral",funf:"numeral",sechs:"numeral",sieben:"numeral",acht:"numeral",neun:"numeral",zehn:"numeral",elf:"numeral",zwoelf:"numeral",dreizehn:"numeral",zwanzig:"numeral",a1_number_200:"numeral"};return r[t]?r[t]:e}getFallbackGrammarInfo(e){return{interjection:"Interjections are words or phrases used to express emotion or greeting. They are often used at the beginning of sentences.",pronoun:"Pronouns replace nouns to avoid repetition. They must agree with the noun they replace in gender, number, and case.",adverb:'Adverbs describe verbs, adjectives, or other adverbs. They often answer questions like "how?", "when?", "where?", or "to what extent?".',numeral:"Numerals represent numbers and can be cardinal (one, two) or ordinal (first, second). They are used for counting and ordering.",phrase:"Phrases are groups of words that function as a single unit in the syntax of a sentence. They often express greetings, farewells, or common expressions.",conjunction:"Conjunctions connect words, phrases, or clauses. They can be coordinating (and, but, or) or subordinating (because, although, if)."}[e]||"No additional grammar information available."}correctPartOfSpeech(e){return{noun:"Noun",verb:"Verb",adjective:"Adjective",adverb:"Adverb",pronoun:"Pronoun",preposition:"Preposition",conjunction:"Conjunction",interjection:"Interjection",numeral:"Numeral",article:"Article",phrase:"Phrase"}[e]||e}createLessonObject(e,t,r,a,i,s){const o=this.normalizeLessonType(e.type),n=this.normalizeVocabularyList(a),l="grammar"===o?"grammar":"culture"===o?"cultural":"vocabulary",c={id:lr(),title:"Main Content",content:r,type:l,metadata:{}};return{id:lr(),type:o,difficulty:e.difficulty,title:t,sections:[c],vocabulary:n,grammarConcepts:i,learningObjectives:s,metadata:e.metadata||{},createdAt:new Date,updatedAt:new Date}}}const ra=new ta;class aa{constructor(){this.services={},this.isInitialized=!1,this.initializationPromise=null,this.eventBus=new Tt,this.services.eventBus=this.eventBus}static getInstance(){return aa.instance||(aa.instance=new aa),aa.instance}async initialize(){return this.initializationPromise||(this.initializationPromise=new Promise(async(e,t)=>{try{this.services.eventBus=this.eventBus,this.services.progressService=new Lr(this.eventBus),this.services.learningSession=new Or(this.eventBus),this.services.lessonGenerationEngine=new ta(Rr,Vr,ea),this.isInitialized=!0,e()}catch(r){It.handleError(r,"DI Container initialization failed",this.eventBus),t(r)}})),this.initializationPromise}getService(e){if(!this.isInitialized)throw new Error(`Service ${e} cannot be accessed: DI container not initialized. Make sure to await diContainer.initialize() before accessing services.`);if(!this.services[e])throw new Error(`Service ${e} not initialized. Make sure diContainer.initialize() has been called successfully.`);return this.services[e]}getAppDataState(){throw new Error("AppDataState should be accessed through app-state.ts to avoid circular dependencies")}registerService(e,t){this.services[e]=t}getEventBus(){return this.eventBus}}const ia=aa.getInstance();ia.initialize().catch(e=>{It.handleError(e,"Failed to initialize DI container",ia.getEventBus())});const sa={initialize:()=>ia.initialize(),getService:e=>ia.getService(e),getEventBus:()=>ia.getEventBus()};function oa(){return sa}const na=ia.getEventBus();function la(){return oa().getService("progressService")}async function ca(){return await rr.load(),rr}D=new WeakMap,k=new WeakMap;const da=new class{constructor(){z(this,D),z(this,k),M(this,D,R(G([]))),M(this,k,R(!1))}get items(){return B(L(this,D))}set items(e){F(L(this,D),e,!0)}get initialized(){return B(L(this,k))}set initialized(e){F(L(this,k),e,!0)}async initialize(){this.initialized||await this.loadInitialData()}async loadInitialData(){try{xt.log("VocabularyDB","Loading initial vocabulary data"),await rr.load();const e=rr.getAll();this.items=e.map(e=>({...e,category:e.categories[0]||"greetings",categories:e.categories||["greetings"],tags:e.tags??[],isCommon:e.metadata?.isCommon??!1,isVerified:e.metadata?.isVerified??!1,learningPhase:e.metadata?.learningPhase??0,xp_value:e.xp_value??e.metadata?.xpValue??10})),this.initialized=!0,xt.log("VocabularyDB","Vocabulary data loaded successfully",{itemCount:this.items.length,initialized:this.initialized})}catch(e){xt.error("VocabularyDB","Failed to load initial vocabulary data",e),this.items=[],this.initialized=!0;oa().getService("eventBus").emit(Ot,{error:new Error("Failed to load vocabulary data"),context:"VocabularyDB.loadInitialData",timestamp:new Date})}}add(e){this.items.push(e)}update(e,t){const r=this.items.findIndex(t=>t.id===e);if(-1!==r){const e=this.items[r];this.items[r]={...e,...t}}}get(e){return this.items.find(t=>t.id===e)}getVocabulary(){return this.items}getVocabularyByDifficulty(e){const t=this.getDifficultyRange(e);return this.items.filter(e=>e.difficulty>=t.min&&e.difficulty<=t.max)}getVocabularyByCategory(e){return this.items.filter(t=>t.categories.includes(e))}getVocabularyByPartOfSpeech(e){return this.items.filter(t=>t.partOfSpeech===e)}getVocabularyByCriteria(e){const t=e.difficulty?this.getDifficultyRange(e.difficulty):null,r=this.items.filter(r=>{const a=!t||r.difficulty>=t.min&&r.difficulty<=t.max,i=!(e.categories&&e.categories.length>0)||r.categories.some(t=>e.categories?.includes(t)),s=!e.partOfSpeech||r.partOfSpeech===e.partOfSpeech;return a&&i&&s});return e.limit?r.slice(0,e.limit):r}getRandomVocabulary(e=5){if(0===this.items.length)return[];return[...this.items].sort(()=>.5-Math.random()).slice(0,Math.min(e,this.items.length))}searchVocabulary(e){if(xt.log("VocabularyDB","Searching vocabulary",{query:e}),!e)return xt.log("VocabularyDB","Empty search query, returning empty results"),[];const t=e.toLowerCase(),r=this.items.filter(e=>e.german.toLowerCase().includes(t)||e.bulgarian.toLowerCase().includes(t)||(e.tags??[]).some(e=>e.toLowerCase().includes(t)));return xt.log("VocabularyDB","Vocabulary search completed",{query:e,results:r.length}),r}getDifficultyRange(e){return{A1:{min:1,max:1.5},A2:{min:1.5,max:2.5},B1:{min:2.5,max:3.5},B2:{min:3.5,max:4.5},C1:{min:4.5,max:5}}[e]}getVocabularyCount(){return this.items.length}getVocabularyStatsByDifficulty(){const e={A1:0,A2:0,B1:0,B2:0,C1:0};return this.items.forEach(t=>{t.difficulty<=1.5?e.A1++:t.difficulty<=2.5?e.A2++:t.difficulty<=3.5?e.B1++:t.difficulty<=4.5?e.B2++:e.C1++}),e}};class ua{constructor(){this.operations=[],this.rollbackOperations=[],this.isCommitted=!1}addOperation(e,t){this.operations.push(e),this.rollbackOperations.push(t)}async commit(){if(this.isCommitted)throw new Error("Transaction already committed");const e=[];try{for(const t of this.operations)await t(),e.push(t);this.isCommitted=!0}catch(t){xt.error("Transaction","Transaction failed, rolling back",t);const a=[];for(let i=e.length-1;i>=0;i--)try{const t=e[i];if(!t)continue;const r=this.operations.indexOf(t),s=this.rollbackOperations[r];-1!==r&&s?await s():(xt.error("Transaction","No rollback operation found for operation"),a.push(new Error(`No rollback operation found for operation index: ${i}`)))}catch(r){const e=r instanceof Error?r:new Error(String(r));xt.error("Transaction","Rollback failed for operation",e),a.push(e)}throw It.handleError(t,"Transaction failed and rolled back"),t}}isComplete(){return this.isCommitted}}const ma=class{static startTransaction(e){if(this.activeTransactions.has(e))throw new Error(`Transaction with ID ${e} already exists`);const t=new ua;return this.activeTransactions.set(e,t),t}static getTransaction(e){return this.activeTransactions.get(e)||null}static async commitTransaction(e){const t=this.activeTransactions.get(e);if(!t)throw new Error(`Transaction with ID ${e} not found`);await t.commit(),this.activeTransactions.delete(e)}static async rollbackTransaction(e){if(!this.activeTransactions.get(e))throw new Error(`Transaction with ID ${e} not found`);this.activeTransactions.delete(e)}};ma.activeTransactions=new Map;let pa=ma;E=new WeakMap,A=new WeakMap,I=new WeakMap,T=new WeakMap,_=new WeakMap;const ha=new class{constructor(){z(this,E),z(this,A),z(this,I),z(this,T),z(this,_),M(this,E,R(G(new Map))),M(this,A,R(G([]))),M(this,I,R(G([]))),M(this,T,R(null)),M(this,_,R(!1))}get practiceStats(){return B(L(this,E))}set practiceStats(e){F(L(this,E),e,!0)}get recentSearches(){return B(L(this,A))}set recentSearches(e){F(L(this,A),e,!0)}get favorites(){return B(L(this,I))}set favorites(e){F(L(this,I),e,!0)}get lastError(){return B(L(this,T))}set lastError(e){F(L(this,T),e,!0)}get isError(){return B(L(this,_))}set isError(e){F(L(this,_),e,!0)}get allItems(){return da.items}toggleFavorite(e){xt.log("AppDataState","Toggling favorite",{itemId:e});try{if("string"!=typeof e||!e.trim())throw new Error("Invalid item ID: must be a non-empty string");const t=this.favorites.indexOf(e);this.favorites=t>-1?this.favorites.filter(t=>t!==e):[...this.favorites,e],this.saveProgress()}catch(t){throw this.handleError(t,"Failed to toggle favorite"),new kt("Failed to toggle favorite",{itemId:e,error:t})}}isFavorite(e){return this.favorites.includes(e)}async recordPracticeResult(e,t,r,a){if("string"!=typeof e||!e.trim()){const t=new Error("Invalid item ID: must be a non-empty string");throw this.handleError(t,"Failed to record practice result"),new kt("Invalid item ID",{itemId:e})}if("boolean"!=typeof t){const e=new Error("Invalid correct flag: must be a boolean");throw this.handleError(e,"Failed to record practice result"),new kt("Invalid correct flag",{correct:t})}if(void 0!==r&&("number"!=typeof r||r<0||!Number.isFinite(r))){const e=new Error("Invalid response time: must be a non-negative number");throw this.handleError(e,"Failed to record practice result"),new kt("Invalid response time",{responseTime:r})}const i=`practice-result-${e}-${Date.now()}`,s=pa.startTransaction(i);try{const r=new Map(this.practiceStats),o=[...this.favorites],n=[...this.recentSearches];s.addOperation(async()=>{const r=this.practiceStats.get(e)||{correct:0,incorrect:0,lastPracticed:""},a={correct:t?r.correct+1:r.correct,incorrect:t?r.incorrect:r.incorrect+1,lastPracticed:(new Date).toISOString()},i=new Map(this.practiceStats);i.set(e,a),this.practiceStats=i},async()=>{xt.log("AppDataState","Rolling back local stats update",{itemId:e}),this.practiceStats=r}),s.addOperation(async()=>{await this.saveProgress(a)},async()=>{xt.log("AppDataState","Rolling back save progress",{itemId:e}),this.favorites=o,this.recentSearches=n}),await pa.commitTransaction(i)}catch(o){try{await pa.rollbackTransaction(i)}catch(n){xt.error("AppDataState","Failed to rollback transaction",n)}throw this.handleError(o,"Failed to record practice result"),It.handleError(o,"Failed to record practice result",a),new kt("Failed to record practice result",{itemId:e,error:o})}}async saveProgress(e){try{if(!(this.practiceStats instanceof Map))throw new Error("Invalid practice stats: expected Map");if(!Array.isArray(this.favorites))throw new Error("Invalid favorites: expected array");if(!Array.isArray(this.recentSearches))throw new Error("Invalid recent searches: expected array");Sr.saveUserProgress({stats:this.practiceStats,favorites:this.favorites,recentSearches:this.recentSearches},e)}catch(t){throw this.handleError(t,"Failed to save progress data"),It.handleError(t,"Failed to save app data state",e),new At("Failed to save app data state",{error:t,statsType:typeof this.practiceStats,favoritesType:typeof this.favorites,searchesType:typeof this.recentSearches})}}loadProgress(e){try{const t=Sr.loadUserProgress(e);t&&(t.stats&&"object"==typeof t.stats?this.practiceStats=new Map(Object.entries(t.stats)):this.practiceStats=new Map,this.favorites=Array.isArray(t.favorites)?t.favorites:[],this.recentSearches=Array.isArray(t.recentSearches)?t.recentSearches:[])}catch(t){throw this.handleError(t,"Failed to load progress data"),It.handleError(t,"Failed to load app data state",e),new At("Failed to load app data state",{error:t,hasStats:!1,hasFavorites:!1,hasSearches:!1})}}async clearAllData(e){try{this.practiceStats=new Map,this.favorites=[],this.recentSearches=[],await this.saveProgress(e),"undefined"!=typeof localStorage&&localStorage.removeItem("vocabulary-cache"),Sr.clearAllData(e)}catch(t){throw this.handleError(t,"Failed to clear all user data"),It.handleError(t,"Failed to clear all app data",e),new At("Failed to clear all app data",{error:t})}}exportData(e){try{return Sr.exportUserData(e)}catch(t){throw this.handleError(t,"Failed to export user data"),It.handleError(t,"Failed to export app data",e),new At("Failed to export app data",{error:t})}}importData(e,t){try{if("string"!=typeof e||!e.trim())throw new Error("Invalid JSON data: must be a non-empty string");Sr.importUserData(e,t),this.loadProgress(t)}catch(r){throw this.handleError(r,"Failed to import user data"),It.handleError(r,"Failed to import app data",t),new kt("Failed to import app data",{error:r,jsonDataType:typeof e,jsonDataLength:e?.length})}}init(e){try{this.loadProgress(e)}catch(t){throw this.handleError(t,"Failed to initialize application data"),It.handleError(t,"Failed to initialize AppDataState",e),new kt("Failed to initialize AppDataState",{error:t})}}handleError(e,t){this.isError=!0,this.lastError=`${t}: ${e instanceof Error?e.message:String(e)}`,setTimeout(()=>{this.isError=!1,this.lastError=null},5e3)}clearError(){this.isError=!1,this.lastError=null}},ga=new class{constructor(d){z(this,e),z(this,t),z(this,r),z(this,a),z(this,i),z(this,s),z(this,o),z(this,n),z(this,l),z(this,c),M(this,e,R("DE_BG")),M(this,t,R("")),M(this,r,R(null)),M(this,a,R(!1)),M(this,i,R(!1)),M(this,s,R(!1)),M(this,o,R(null)),M(this,n,V(()=>"DE_BG"===this.languageMode?"German â Bulgarian":"Bulgarian â German")),M(this,l,V(()=>{const e=this.searchQuery.trim();if(!e)return this.dataState.allItems;const t=e.toLowerCase();return this.dataState.allItems.filter(e=>e.german.toLowerCase().includes(t)||e.bulgarian.toLowerCase().includes(t)||e.categories.some(e=>e.toLowerCase().includes(t))||e.tags&&e.tags.some(e=>e.toLowerCase().includes(t)))})),M(this,c,V(()=>{const e=this.dataState.allItems.filter(e=>{const t=this.dataState.practiceStats.get(e.id);if(!t)return!0;const r=t.correct+t.incorrect;return(r>0?t.correct/r:0)<.8||r<3});return e.slice(0,Math.min(10,e.length))})),this.dataState=d}get languageMode(){return B(L(this,e))}set languageMode(t){F(L(this,e),t,!0)}get searchQuery(){return B(L(this,t))}set searchQuery(e){F(L(this,t),e,!0)}get currentItem(){return B(L(this,r))}set currentItem(e){F(L(this,r),e,!0)}get showAnswer(){return B(L(this,a))}set showAnswer(e){F(L(this,a),e,!0)}get practiceMode(){return B(L(this,i))}set practiceMode(e){F(L(this,i),e,!0)}get isLoading(){return B(L(this,s))}set isLoading(e){F(L(this,s),e,!0)}get error(){return B(L(this,o))}set error(e){F(L(this,o),e,!0)}get displayDirection(){return B(L(this,n))}set displayDirection(e){F(L(this,n),e)}get filteredItems(){return B(L(this,l))}set filteredItems(e){F(L(this,l),e)}get practiceRecommendations(){return B(L(this,c))}set practiceRecommendations(e){F(L(this,c),e)}toggleLanguageMode(){this.languageMode="DE_BG"===this.languageMode?"BG_DE":"DE_BG",this.triggerLanguageModePersistence();try{j(async()=>{const{LocalizationService:e}=await import("./DCt7Ycr1.js");return{LocalizationService:e}},__vite__mapDeps([0,1]),import.meta.url).then(({LocalizationService:e})=>{e.notifyLanguageChange()})}catch(e){console.error("Failed to notify language change:",e)}}toggleDirection(){this.toggleLanguageMode()}setSearchQuery(e){this.searchQuery=e,e.trim()&&!this.dataState.recentSearches.includes(e)&&(this.dataState.recentSearches=[e,...this.dataState.recentSearches.slice(0,9)])}triggerLanguageModePersistence(){try{localStorage.setItem("app-language-mode",this.languageMode),localStorage.getItem("tandem-direction")&&localStorage.removeItem("tandem-direction")}catch(e){throw It.handleError(e,"Failed to save language mode"),new kt("Failed to save language mode",{error:e})}}setCurrentItem(e){this.currentItem=e,this.showAnswer=!1}togglePracticeMode(){this.practiceMode=!this.practiceMode,this.practiceMode||this.setCurrentItem(null)}startPracticeSession(e){this.practiceMode=!0,this.setCurrentItem(e),this.showAnswer=!1,this.searchQuery=""}toggleShowAnswer(){this.showAnswer=!this.showAnswer}setError(e){xt.log("AppUIState","Setting error",{error:e}),this.error=e}init(){try{const e=localStorage.getItem("app-language-mode"),t=localStorage.getItem("tandem-direction");"DE_BG"===e||"BG_DE"===e?this.languageMode=e:"DE->BG"===t?(this.languageMode="DE_BG",localStorage.setItem("app-language-mode","DE_BG"),localStorage.removeItem("tandem-direction")):"BG->DE"===t?(this.languageMode="BG_DE",localStorage.setItem("app-language-mode","BG_DE"),localStorage.removeItem("tandem-direction")):(this.languageMode="DE_BG",localStorage.setItem("app-language-mode","DE_BG")),window.addEventListener("storage",e=>{if("app-language-mode"===e.key){const e=localStorage.getItem("app-language-mode");"DE_BG"!==e&&"BG_DE"!==e||(this.languageMode=e)}})}catch(e){throw It.handleError(e,"Failed to initialize UI state"),new kt("Failed to initialize UI state",{error:e})}}}(ha);async function fa(){try{return await ha.init(),await ga.init(),{appDataState:ha,appUIState:ga}}catch(e){throw console.error("Failed to initialize app state:",e),e}}const ya=new class{get languageMode(){return ga.languageMode}get searchQuery(){return ga.searchQuery}get currentItem(){return ga.currentItem}get showAnswer(){return ga.showAnswer}get practiceMode(){return ga.practiceMode?"practice":"search"}get isLoading(){return ga.isLoading}get error(){return ga.error}get filteredItems(){return ga.filteredItems}get displayDirection(){return ga.displayDirection}get practiceRecommendations(){return ga.practiceRecommendations}get practiceStats(){try{const e=la().getAllVocabularyMastery(),t=new Map;for(const[r,a]of Object.entries(e))t.set(r,{correct:a.correctCount,incorrect:a.incorrectCount,lastPracticed:a.lastPracticed||""});return t}catch(e){return It.handleError(e,"AppState.practiceStats"),ha.practiceStats}}get recentSearches(){return ha.recentSearches}get favorites(){return ha.favorites}toggleLanguageMode(){return ga.toggleLanguageMode()}toggleDirection(){return ga.toggleDirection()}setSearchQuery(e){return ga.setSearchQuery(e)}setCurrentItem(e){return ga.setCurrentItem(e)}togglePracticeMode(){return ga.togglePracticeMode()}startPracticeSession(e){return ga.startPracticeSession(e)}toggleShowAnswer(){return ga.toggleShowAnswer()}setError(e){return ga.setError(e)}getAllVocabularyItems(){return ha.allItems}async recordPracticeResult(e,t,r){try{const a=la();await a.recordVocabularyPractice(e,t,r)}catch(a){return It.handleError(a,"AppState.recordPracticeResult",na),ha.recordPracticeResult(e,t,r)}}getVocabularyMastery(e){try{return la().getVocabularyMastery(e)}catch(t){return It.handleError(t,"AppState.getVocabularyMastery",na),null}}getOverallProgress(){try{return la().getOverallProgress()}catch(e){return It.handleError(e,"AppState.getOverallProgress",na),{id:"fallback",totalXP:0,totalWordsPracticed:0,totalLessonsCompleted:0,totalQuizzesTaken:0,totalTimeSpent:0,currentLevel:1,currentStreak:0,longestStreak:0,lastActiveDate:null,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}}}toggleFavorite(e){return ha.toggleFavorite(e)}isFavorite(e){return ha.isFavorite(e)}async clearAllData(){return ha.clearAllData()}exportData(){return ha.exportData()}importData(e){return ha.importData(e)}};export{xt as D,It as E,pr as L,dr as P,mr as V,ya as a,fa as b,St as c,Tr as d,wt as e,hr as f,lr as g,Fr as h,ca as i,Br as j,ra as l,vt as t,da as v};
//# sourceMappingURL=Dpa2gNtY.js.map
