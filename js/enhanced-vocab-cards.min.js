class EnhancedVocabCards{constructor(){this.currentDirection=localStorage.getItem("bgde:learning_direction")||"bg_to_de",this.showCulturalContext=localStorage.getItem("bgde:show_cultural")==="true",this.vocabularyData=[],this.filteredData=[],this.init()}async init(){await this.loadVocabularyData(),this.setupEventListeners(),this.renderVocabularyCards(),this.updateBodyClass()}async loadVocabularyData(){try{const t=await fetch("/search-index.json"),n=await t.json(),e=n.filter(e=>e.type==="vocabulary");this.vocabularyData=window.VocabularyAdapter?window.VocabularyAdapter.adaptVocabularyArray(e):e}catch(e){console.error("Failed to load vocabulary data:",e),this.vocabularyData=[]}}setupEventListeners(){window.addEventListener("learning-direction-changed",e=>{this.currentDirection=e.detail.direction,this.updateBodyClass(),this.renderVocabularyCards()});const e=document.getElementById("cultural-context-toggle");e&&e.addEventListener("change",e=>{this.showCulturalContext=e.target.checked,localStorage.setItem("bgde:show_cultural",this.showCulturalContext),this.renderVocabularyCards()})}updateBodyClass(){document.body.className=document.body.className.replace(/lang-\w+-\w+/g,""),document.body.classList.add(`lang-${this.currentDirection.replace("_","-")}`)}renderVocabularyCards(){const e=document.getElementById("vocabulary-cards-container");if(!e)return;const t=window.VocabularyAdapter?window.VocabularyAdapter.getVocabularyByDirection(this.vocabularyData,this.currentDirection):this.vocabularyData;this.filteredData=t,e.innerHTML=t.map(e=>this.createVocabCard(e)).join(""),this.attachCardHandlers()}createVocabCard(e){const t=this.currentDirection==="de_to_bg",n=t?e.translation:e.word,s=t?e.word:e.translation,o=t?"german-text":"bulgarian-text",i=t?"bulgarian-text":"german-text";return`
            <div class="vocab-card" data-item-id="${e.id||""}" data-level="${e.level||"A1"}">
                <div class="vocab-card-inner">
                    <div class="vocab-card-front">
                        <div class="vocab-word ${o}">${n}</div>
                        <div class="vocab-category">${e.category||""}</div>
                        <div class="vocab-level">${e.level||"A1"}</div>
                        ${this.renderDifficultyIndicator(e.difficulty)}
                    </div>
                    
                    <div class="vocab-card-back">
                        <div class="vocab-translation ${i}">${s}</div>
                        ${this.renderCulturalContext(e)}
                        ${this.renderExamples(e)}
                        ${this.renderActions(e)}
                    </div>
                </div>
            </div>
        `}renderDifficultyIndicator(e){if(!e)return"";const t="â˜…".repeat(e)+"â˜†".repeat(5-e);return`<div class="difficulty-indicator" title="Difficulty: ${e}/5">${t}</div>`}renderCulturalContext(e){if(!this.showCulturalContext)return"";let t="";return e.etymology&&(t+=`<div class="etymology"><strong>Etymology:</strong> ${e.etymology}</div>`),e.cultural_note&&(t+=`<div class="cultural-note"><strong>Cultural Note:</strong> ${e.cultural_note}</div>`),e.linguistic_note&&(t+=`<div class="linguistic-note"><strong>Pronunciation:</strong> ${e.linguistic_note}</div>`),t?`<div class="cultural-context">${t}</div>`:""}renderExamples(e){if(!e.examples||!Array.isArray(e.examples)||e.examples.length===0)return"";const t=e.examples.map(e=>`
            <div class="example">
                <div class="example-sentence">${e.sentence}</div>
                <div class="example-translation">${e.translation}</div>
                ${e.context?`<div class="example-context">(${e.context})</div>`:""}
            </div>
        `).join("");return`<div class="examples"><strong>Examples:</strong>${t}</div>`}renderActions(e){return`
            <div class="vocab-actions">
                <button class="action-btn practice-btn" data-action="practice" data-item-id="${e.id||""}">
                    Practice
                </button>
                <button class="action-btn audio-btn" data-action="audio" data-item-id="${e.id||""}" ${e.audio?"":"disabled"}>
                    ðŸ”Š
                </button>
                <button class="action-btn favorite-btn" data-action="favorite" data-item-id="${e.id||""}">
                    â™¡
                </button>
            </div>
        `}attachCardHandlers(){document.querySelectorAll(".vocab-card").forEach(e=>{e.addEventListener("click",t=>{t.target.closest(".vocab-actions")||e.classList.toggle("flipped")})}),document.querySelectorAll(".action-btn").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.dataset.action,s=e.dataset.itemId;this.handleAction(n,s)})})}handleAction(e,t){const n=this.filteredData.find(e=>(e.id||"")===t);if(!n)return;switch(e){case"practice":this.startPracticeSession(n);break;case"audio":this.playAudio(n);break;case"favorite":this.toggleFavorite(n);break}}startPracticeSession(e){const t=`/practice/?item=${e.id||""}&direction=${this.currentDirection}`;window.location.href=t}playAudio(e){if(!e.audio)return;const t=new Audio(e.audio);t.play().catch(e=>{console.warn("Audio playback failed:",e)})}toggleFavorite(e){const t=JSON.parse(localStorage.getItem("bgde:favorites")||"[]"),s=e.id||"",n=t.indexOf(s);n===-1?t.push(s):t.splice(n,1),localStorage.setItem("bgde:favorites",JSON.stringify(t));const o=document.querySelector(`[data-item-id="${s}"][data-action="favorite"]`);o&&(o.textContent=n===-1?"â™¥":"â™¡",o.classList.toggle("favorited",n===-1))}filterByLevel(e){const t=this.filteredData.filter(t=>!e||t.level===e);this.renderFilteredCards(t)}filterByCategory(e){const t=this.filteredData.filter(t=>!e||t.category===e);this.renderFilteredCards(t)}searchVocabulary(e){if(!e){this.renderVocabularyCards();return}const t=e.toLowerCase(),n=this.filteredData.filter(e=>e.word.toLowerCase().includes(t)||e.translation.toLowerCase().includes(t)||e.notes&&e.notes.toLowerCase().includes(t));this.renderFilteredCards(n)}renderFilteredCards(e){const t=document.getElementById("vocabulary-cards-container");if(!t)return;t.innerHTML=e.map(e=>this.createVocabCard(e)).join(""),this.attachCardHandlers()}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.enhancedVocabCards=new EnhancedVocabCards}):window.enhancedVocabCards=new EnhancedVocabCards