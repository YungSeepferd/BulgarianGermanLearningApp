class BulgarianGermanApp{constructor(){this.theme=localStorage.getItem("theme")||"light",this.searchIndex=null,this.init()}init(){this.initTheme(),this.initSearch(),this.initNavigation(),this.initLanguageToggle(),this.initServiceWorker()}initTheme(){document.documentElement.setAttribute("data-theme",this.theme);const e=document.getElementById("theme-toggle");e&&(e.addEventListener("click",()=>this.toggleTheme()),this.updateThemeIcon())}toggleTheme(){this.theme=this.theme==="light"?"dark":"light",document.documentElement.setAttribute("data-theme",this.theme),localStorage.setItem("theme",this.theme),this.updateThemeIcon()}updateThemeIcon(){const e=document.querySelector(".theme-icon");e&&(e.textContent=this.theme==="light"?"🌙":"☀️")}initSearch(){const t=document.getElementById("search-toggle"),e=document.getElementById("search-overlay"),n=document.getElementById("search-input");t&&e&&(t.addEventListener("click",()=>{e.classList.toggle("hidden"),e.classList.contains("hidden")||n?.focus()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&!e.classList.contains("hidden")&&e.classList.add("hidden")}))}async initLanguageToggle(){try{const{languageToggle:t}=await import("./language-toggle.js"),e=document.getElementById("language-toggle-container");e&&t.init(e)}catch(e){console.warn("Language toggle not available:",e)}}initNavigation(){const e=document.querySelectorAll(".nav-link");e.forEach(e=>{e.addEventListener("click",t=>{if(e.getAttribute("href").startsWith("#")){t.preventDefault();const n=document.querySelector(e.getAttribute("href"));n&&n.scrollIntoView({behavior:"smooth"})}})})}initServiceWorker(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("SW registered: ",e)}).catch(e=>{console.log("SW registration failed: ",e)})})}}class SpacedRepetition{static calculateNextReview(e,t=1,n=2.5,s=0){let o=t,i=n,a=s;e>=3?(s===0?o=1:s===1?o=6:o=Math.round(t*n),a++):(a=0,o=1),i=n+(.1-(5-e)*(.08+(5-e)*.02)),i<1.3&&(i=1.3);const r=new Date;return r.setDate(r.getDate()+o),{interval:o,easeFactor:i,repetitions:a,nextReview:r.toISOString()}}static isDue(e){return!e||new Date>=new Date(e)}}class ProgressTracker{constructor(){this.storageKey="bulgarian-german-progress",this.data=this.loadProgress()}loadProgress(){const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):{vocabulary:{},grammar:{},sessions:[],streak:0,lastStudyDate:null}}saveProgress(){localStorage.setItem(this.storageKey,JSON.stringify(this.data))}updateVocabularyItem(e,t){const n=this.data.vocabulary[e]||{interval:1,easeFactor:2.5,repetitions:0,nextReview:null,totalReviews:0,correctReviews:0},s=SpacedRepetition.calculateNextReview(t,n.interval,n.easeFactor,n.repetitions);return this.data.vocabulary[e]={...n,...s,totalReviews:n.totalReviews+1,correctReviews:n.correctReviews+(t>=3?1:0),lastReview:(new Date).toISOString()},this.saveProgress(),this.data.vocabulary[e]}getDueItems(e){return e.filter(e=>{const t=this.data.vocabulary[e.word];return!t||SpacedRepetition.isDue(t.nextReview)})}getItemProgress(e){return this.data.vocabulary[e]||null}recordSession(e){this.data.sessions.push({...e,date:(new Date).toISOString()}),this.updateStreak(),this.saveProgress()}updateStreak(){const t=(new Date).toDateString(),e=this.data.lastStudyDate?new Date(this.data.lastStudyDate).toDateString():null;if(e===t)return;if(e){const t=new Date;t.setDate(t.getDate()-1),e===t.toDateString()?this.data.streak++:this.data.streak=1}else this.data.streak=1;this.data.lastStudyDate=(new Date).toISOString()}getStats(){const e=Object.keys(this.data.vocabulary).length,t=Object.values(this.data.vocabulary).filter(e=>e.repetitions>=3).length;return{totalItems:e,masteredItems:t,streak:this.data.streak,totalSessions:this.data.sessions.length,accuracy:this.calculateOverallAccuracy()}}calculateOverallAccuracy(){const e=Object.values(this.data.vocabulary);if(e.length===0)return 0;const t=e.reduce((e,t)=>e+t.totalReviews,0),n=e.reduce((e,t)=>e+t.correctReviews,0);return t>0?Math.round(n/t*100):0}}class AudioManager{constructor(){this.enabled=localStorage.getItem("audio-enabled")!=="false",this.synthesis=window.speechSynthesis,this.voices=[],this.loadVoices()}loadVoices(){this.voices=this.synthesis.getVoices(),this.voices.length===0&&this.synthesis.addEventListener("voiceschanged",()=>{this.voices=this.synthesis.getVoices()})}playWord(e,t="bg"){if(!this.enabled||!this.synthesis)return;const n=new SpeechSynthesisUtterance(e),s=this.voices.find(e=>e.lang.startsWith(t==="bg"?"bg":"de"));s&&(n.voice=s),n.rate=.8,n.pitch=1,this.synthesis.speak(n)}toggle(){return this.enabled=!this.enabled,localStorage.setItem("audio-enabled",this.enabled.toString()),this.enabled}}document.addEventListener("DOMContentLoaded",function(){window.app=new BulgarianGermanApp,window.progressTracker=new ProgressTracker,window.audioManager=new AudioManager}),typeof module!="undefined"&&module.exports&&(module.exports={BulgarianGermanApp,SpacedRepetition,ProgressTracker,AudioManager})