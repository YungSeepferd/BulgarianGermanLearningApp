{{ define "title" }}Grammar - {{ .Site.Title }}{{ end }}
{{ define "main" }}

<div class="grammar-container">
    <div class="page-header">
        <h1>Grammar</h1>
        <p>Master Bulgarian and German grammar rules with examples and exercises</p>
    </div>
    
    <div class="grammar-filters">
        <select id="grammar-level-filter">
            <option value="">All Levels</option>
            <option value="A1">A1 - Beginner</option>
            <option value="A2">A2 - Elementary</option>
            <option value="B1">B1 - Intermediate</option>
            <option value="B2">B2 - Upper Intermediate</option>
        </select>
        
        <input type="text" id="grammar-search" placeholder="Search grammar topics..." class="search-input">
    </div>
    
    <div class="grammar-stats">
        <span class="stat">Total Topics: <span id="grammar-total">{{ len .Site.Data.grammar }}</span></span>
        <span class="stat">Showing: <span id="grammar-showing">{{ len .Site.Data.grammar }}</span></span>
    </div>
    
    <div class="grammar-list" id="grammar-list">
        {{ range .Site.Data.grammar }}
        <article class="grammar-item" 
                 data-level="{{ .level }}" 
                 data-title="{{ .title | lower }}"
                 data-description="{{ .description | lower }}">
            <header class="grammar-header">
                <h2>{{ .title }}</h2>
                <span class="level-badge level-{{ .level | lower }}">{{ .level }}</span>
            </header>
            
            <div class="grammar-description">
                {{ .description | markdownify }}
            </div>

            {{ if or .notes_bg_to_de .notes_de_to_bg }}
            <div class="grammar-notes" aria-live="polite">
                {{ if .notes_bg_to_de }}
                <div class="grammar-note-direction" data-direction="bg-de">{{ .notes_bg_to_de }}</div>
                {{ end }}
                {{ if .notes_de_to_bg }}
                <div class="grammar-note-direction" data-direction="de-bg" style="display:none;">{{ .notes_de_to_bg }}</div>
                {{ end }}
            </div>
            {{ end }}
            
            {{ if .examples }}
            <div class="grammar-examples">
                <h3>Examples:</h3>
                <ul class="examples-list">
                    {{ range .examples }}
                    <li class="example-item">{{ . }}</li>
                    {{ end }}
                </ul>
                
                {{ if gt (len .examples) 3 }}
                <button class="show-more-examples" data-target="examples-{{ .title | urlize }}">
                    Show More Examples
                </button>
                {{ end }}
            </div>
            {{ end }}
            
            <div class="grammar-actions">
                <button class="start-exercise-btn" data-grammar-title="{{ .title }}">
                    Practice This Rule
                </button>
                <button class="bookmark-btn" data-grammar-title="{{ .title }}" title="Bookmark this rule">
                    ‚≠ê
                </button>
            </div>
        </article>
        {{ end }}
    </div>
    
    <div class="no-results hidden" id="grammar-no-results">
        <p>No grammar topics found matching your criteria.</p>
        <button id="clear-grammar-filters" class="btn-secondary">Clear Filters</button>
    </div>
</div>

{{ end }}

{{ define "scripts" }}
{{ $grammarJs := resources.Get "js/grammar.js" | resources.Minify }}
<script src="{{ $grammarJs.RelPermalink }}" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    if (!window.GrammarApp) {
        console.warn('GrammarApp is not available.');
        return;
    }

    new window.GrammarApp({
        data: {{ .Site.Data.grammar | jsonify }},
        container: '#grammar-list'
    });
});
</script>
{{ end }}
