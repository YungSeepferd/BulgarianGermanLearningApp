{{ define "title" }}Grammar - {{ .Site.Title }}{{ end }}
{{ define "main" }}

<div class="grammar-container">
    <div class="page-header">
        <h1>Grammar</h1>
        <p>Master Bulgarian and German grammar rules with examples and exercises</p>
    </div>
    
    <div class="grammar-filters">
        <label for="grammar-level-filter" id="grammar-level-filter-label" class="filter-label">Filter by grammar level:</label>
        <select id="grammar-level-filter" aria-labelledby="grammar-level-filter-label">
            <option value="">All Levels</option>
            <option value="A1">A1 - Beginner</option>
            <option value="A2">A2 - Elementary</option>
            <option value="B1">B1 - Intermediate</option>
            <option value="B2">B2 - Upper Intermediate</option>
        </select>
        
        <label for="grammar-search" id="grammar-search-label" class="filter-label">Search grammar topics:</label>
        <input type="text" id="grammar-search" placeholder="Search grammar topics..." class="search-input" aria-labelledby="grammar-search-label">
    </div>
    
    {{ $grammarPages := where .Site.RegularPages "Type" "grammar" }}
    <div class="grammar-stats">
        <span class="stat">Total Topics: <span id="grammar-total">{{ len $grammarPages }}</span></span>
        <span class="stat">Showing: <span id="grammar-showing">{{ len $grammarPages }}</span></span>
    </div>

    <div class="grammar-list" id="grammar-list">
        {{ range $grammarPages.ByWeight }}
        <article class="grammar-item"
                 data-level="{{ .Params.level }}"
                 data-title="{{ .Title | lower }}"
                 data-description="{{ .Description | lower }}">
            <header class="grammar-header">
                <h2><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
                <span class="level-badge level-{{ .Params.level | lower }}">{{ .Params.level }}</span>
            </header>

            <div class="grammar-description">
                {{ .Description | markdownify }}
            </div>

            {{ if or .Params.notes_bg_to_de .Params.notes_de_to_bg }}
            <div class="grammar-notes" aria-live="polite">
                {{ if .Params.notes_bg_to_de }}
                <div class="grammar-note-direction" data-direction="bg-de">{{ .Params.notes_bg_to_de }}</div>
                {{ end }}
                {{ if .Params.notes_de_to_bg }}
                <div class="grammar-note-direction" data-direction="de-bg" style="display:none;">{{ .Params.notes_de_to_bg }}</div>
                {{ end }}
            </div>
            {{ end }}

            <div class="grammar-preview">
                <p>{{ .Summary }}</p>
                <a href="{{ .RelPermalink }}" class="read-more-link">Read more →</a>
            </div>

            <div class="grammar-actions">
                <a href="{{ .RelPermalink }}" class="btn-primary">View Full Topic</a>
                <button class="bookmark-btn" data-grammar-title="{{ .Title }}" title="Bookmark this rule" aria-label="Bookmark {{ .Title }} grammar rule">
                    ⭐
                </button>
            </div>
        </article>
        {{ end }}
    </div>
    
    <div class="no-results hidden" id="grammar-no-results">
        <p>No grammar topics found matching your criteria.</p>
        <button id="clear-grammar-filters" class="btn-secondary">Clear Filters</button>
    </div>
</div>

{{ end }}

{{ define "scripts" }}
{{ $grammarJs := resources.Get "js/grammar.ts" }}
<script src="{{ $grammarJs.RelPermalink }}" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Grammar filtering and interaction now handled by grammar.js
    // Content is rendered server-side from MD files in content/grammar/
    if (window.GrammarApp) {
        new window.GrammarApp({
            container: '#grammar-list'
        });
    }
});
</script>
{{ end }}
