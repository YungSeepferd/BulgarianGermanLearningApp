<!-- Performance optimizations -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//fonts.gstatic.com">

<!-- Google Fonts: Roboto and Noto Sans for Bulgarian Cyrillic support -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600&family=Noto+Sans:wght@400;500;600&display=swap" rel="stylesheet">

<!-- Security headers -->
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="X-Frame-Options" content="DENY">
<meta http-equiv="X-XSS-Protection" content="1; mode=block">
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">

{{ $scriptSrc := slice "'self'" "'unsafe-inline'" }}
{{ if .Site.Params.googleAnalytics }}
  {{ $scriptSrc = $scriptSrc | append "https://www.googletagmanager.com" }}
{{ end }}
{{ $styleSrc := slice "'self'" "'unsafe-inline'" "https://fonts.googleapis.com" }}
{{ $fontSrc := slice "'self'" "https://fonts.gstatic.com" }}
{{ $imgSrc := "'self' data:" }}
{{ $connectSrc := slice "'self'" }}
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src {{ delimit $scriptSrc " " }}; style-src {{ delimit $styleSrc " " }}; font-src {{ delimit $fontSrc " " }}; img-src {{ $imgSrc }}; connect-src {{ delimit $connectSrc " " }}; manifest-src 'self'; frame-ancestors 'self';">
<meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">

<!-- SEO optimizations -->
<meta name="robots" content="index, follow">
<meta name="googlebot" content="index, follow">
<link rel="canonical" href="{{ .Permalink }}">

<!-- Open Graph / Facebook -->
<meta property="og:title" content="{{ .Title }}">
<meta property="og:description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}">
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
<meta property="og:url" content="{{ .Permalink }}">
<meta property="og:site_name" content="{{ .Site.Title }}">
<meta property="og:locale" content="{{ .Site.Language.Lang }}">
{{ with .Params.images }}
<meta property="og:image" content="{{ index . 0 | absURL }}">
{{ end }}

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ .Title }}">
<meta name="twitter:description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}">
{{ with .Params.images }}
<meta name="twitter:image" content="{{ index . 0 | absURL }}">
{{ end }}

<!-- Multilingual hreflang tags -->
<link rel="alternate" hreflang="{{ .Site.Language.Lang }}" href="{{ .Permalink }}" />
{{ range .Translations }}
<link rel="alternate" hreflang="{{ .Lang }}" href="{{ .Permalink }}" />
{{ end }}
{{ if .IsTranslated }}
<link rel="alternate" hreflang="x-default" href="{{ .Permalink }}" />
{{ end }}

<!-- JSON-LD Structured Data -->
{{ partial "structured-data.html" . }}

{{ if .Site.Params.googleAnalytics }}
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id={{ .Site.Params.googleAnalytics }}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', '{{ .Site.Params.googleAnalytics }}');
</script>
{{ end }}
