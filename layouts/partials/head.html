{{ $sass := resources.Get "scss/main.scss" }}
{{ $style := $sass | resources.ToCSS | resources.Minify | resources.Fingerprint }}
<link rel="stylesheet" href="{{ $style.RelPermalink }}" integrity="{{ $style.Data.Integrity }}">

{{ if .Site.Params.enablePWA }}
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="{{ .Site.Params.themeColor | default "#4a6fa5" }}">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="{{ .Site.Params.shortName | default "BG-DE Learn" }}">
{{ end }}

<!-- Performance optimizations -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//fonts.gstatic.com">

<!-- Google Fonts: Roboto and Noto Sans for Bulgarian Cyrillic support -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600&family=Noto+Sans:wght@400;500;600&display=swap" rel="stylesheet">

<!-- Security headers -->
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="X-Frame-Options" content="DENY">
<meta http-equiv="X-XSS-Protection" content="1; mode=block">
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">

{{ $scriptSrc := slice "'self'" "'unsafe-inline'" }}
{{ if .Site.Params.googleAnalytics }}
  {{ $scriptSrc = $scriptSrc | append "https://www.googletagmanager.com" }}
{{ end }}
{{ $styleSrc := slice "'self'" "'unsafe-inline'" "https://fonts.googleapis.com" }}
{{ $fontSrc := slice "'self'" "https://fonts.gstatic.com" }}
{{ $imgSrc := "'self' data:" }}
{{ $connectSrc := slice "'self'" }}
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src {{ delimit $scriptSrc " " }}; style-src {{ delimit $styleSrc " " }}; font-src {{ delimit $fontSrc " " }}; img-src {{ $imgSrc }}; connect-src {{ delimit $connectSrc " " }}; manifest-src 'self'; frame-ancestors 'self';">
<meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">

<!-- SEO optimizations -->
<meta name="robots" content="index, follow">
<meta name="googlebot" content="index, follow">
<link rel="canonical" href="{{ .Permalink }}">

{{ if .Site.Params.googleAnalytics }}
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id={{ .Site.Params.googleAnalytics }}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', '{{ .Site.Params.googleAnalytics }}');
</script>
{{ end }}
