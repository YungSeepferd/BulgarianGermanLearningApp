{{ define "title" }}{{ if eq .Params.layout "flashcard-practice" }}{{ .Title }} - {{ .Site.Title }}{{ else }}Practice Session - {{ .Site.Title }}{{ end }}{{ end }}
{{ define "main" }}

{{ if eq .Params.layout "flashcard-practice" }}
<!-- Markdown Flashcard Practice Layout -->
<div class="flashcard-practice-container">
  <div class="practice-header">
    <h1>{{ .Title }}</h1>
    <p>{{ .Description }}</p>
  </div>
  
  <div class="flashcard-content">
    {{ .Content }}
  </div>
</div>

<style>
.flashcard-practice-container {
  max-width: 800px;
  margin: 0 auto;
  padding: 2rem;
}

.practice-header {
  text-align: center;
  margin-bottom: 2rem;
}

.practice-header h1 {
  color: #2c3e50;
  margin-bottom: 1rem;
}

.practice-header p {
  color: #6c757d;
  font-size: 1.1rem;
}

.flashcard-content h1 {
  display: none; /* Hide duplicate title from content */
}

.flashcard-content h2 {
  color: #007bff;
  border-bottom: 2px solid #007bff;
  padding-bottom: 0.5rem;
  margin: 2rem 0 1.5rem 0;
}

.flashcard-content h3 {
  color: #28a745;
  margin: 1.5rem 0 1rem 0;
}

.flashcard-content ol, .flashcard-content ul {
  margin: 1rem 0;
  padding-left: 2rem;
}

.flashcard-content li {
  margin: 0.5rem 0;
  line-height: 1.6;
}

.flashcard-content strong {
  color: #007bff;
}

/* Responsive design */
@media (max-width: 768px) {
  .flashcard-practice-container {
    padding: 1rem;
  }
  
  .practice-header h1 {
    font-size: 1.8rem;
  }
}
</style>

{{ else }}
<!-- JavaScript Practice Session Layout -->

<div class="practice-container">
    <div class="practice-header">
        <div class="session-stats">
            <span class="stat">
                <span class="stat-label">Fortschritt / –ü—Ä–æ–≥—Ä–µ—Å:</span>
                <span class="stat-value" id="progress">0/0</span>
            </span>
            <span class="stat">
                <span class="stat-label">Genauigkeit / –¢–æ—á–Ω–æ—Å—Ç:</span>
                <span class="stat-value" id="accuracy">0%</span>
            </span>
            <span class="stat">
                <span class="stat-label">Zeit / –í—Ä–µ–º–µ:</span>
                <span class="stat-value" id="session-time">00:00</span>
            </span>
        </div>
        
        <div class="session-controls">
            <button id="end-session" class="btn-secondary">Sitzung beenden / –ö—Ä–∞–π –Ω–∞ —Å–µ—Å–∏—è—Ç–∞</button>
            <button id="onboarding-help-btn" class="btn-secondary" title="Hilfe / –ü–æ–º–æ—â">‚ùì</button>
            <button id="settings-toggle" class="btn-secondary" title="Sitzungseinstellungen / –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ —Å–µ—Å–∏—è—Ç–∞">‚öôÔ∏è</button>
        </div>
    </div>
    
    <!-- Session Settings Panel -->
    <div class="settings-panel hidden" id="settings-panel">
        <div class="setting-group">
            <label for="session-length">Sitzungsl√§nge / –î—ä–ª–∂–∏–Ω–∞ –Ω–∞ —Å–µ—Å–∏—è—Ç–∞:</label>
            <select id="session-length">
                <option value="10">10 Elemente / –µ–ª–µ–º–µ–Ω—Ç–∞</option>
                <option value="20" selected>20 Elemente / –µ–ª–µ–º–µ–Ω—Ç–∞</option>
                <option value="30">30 Elemente / –µ–ª–µ–º–µ–Ω—Ç–∞</option>
                <option value="50">50 Elemente / –µ–ª–µ–º–µ–Ω—Ç–∞</option>
            </select>
        </div>
        
        <div class="setting-group">
            <label for="difficulty-filter">Schwierigkeit / –¢—Ä—É–¥–Ω–æ—Å—Ç:</label>
            <select id="difficulty-filter">
                <option value="">Alle Niveaus / –í—Å–∏—á–∫–∏ –Ω–∏–≤–∞</option>
                <option value="A1">A1 - Anf√§nger / –ù–∞—á–∏–Ω–∞–µ—â–∏</option>
                <option value="A2">A2 - Grundstufe / –û—Å–Ω–æ–≤–Ω–æ</option>
                <option value="B1">B1 - Mittelstufe / –°—Ä–µ–¥–Ω–æ</option>
                <option value="B2">B2 - Obere Mittelstufe / –ì–æ—Ä–Ω–æ —Å—Ä–µ–¥–Ω–æ</option>
            </select>
        </div>
        
        <div class="setting-group">
            <label>
                <input type="checkbox" id="audio-enabled" checked>
                Audio aktivieren / –í–∫–ª—é—á–≤–∞–Ω–µ –Ω–∞ –∞—É–¥–∏–æ
            </label>
        </div>
    </div>
    
    <!-- Loading State -->
    <div class="loading-state" id="loading-state">
        <div class="spinner"></div>
        <p>Ihre √úbungssitzung wird vorbereitet... / –ü–æ–¥–≥–æ—Ç–≤—è–º–µ –≤–∞—à–∞—Ç–∞ —Å–µ—Å–∏—è –∑–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è...</p>
    </div>
    
    <!-- No Items Available -->
    <div class="no-items-state hidden" id="no-items-state">
        <div class="no-items-content">
            <h2>üéâ Gro√üartige Arbeit! / –û—Ç–ª–∏—á–Ω–∞ —Ä–∞–±–æ—Ç–∞!</h2>
            <p>Sie haben alle verf√ºgbaren Elemente f√ºr heute abgeschlossen. / –ó–∞–≤—ä—Ä—à–∏—Ö—Ç–µ –≤—Å–∏—á–∫–∏ –Ω–∞–ª–∏—á–Ω–∏ –µ–ª–µ–º–µ–Ω—Ç–∏ –∑–∞ –¥–Ω–µ—Å.</p>
            <p>Kommen Sie morgen f√ºr mehr √úbung zur√ºck oder wiederholen Sie Wortschatz und Grammatik. / –í—ä—Ä–Ω–µ—Ç–µ —Å–µ —É—Ç—Ä–µ –∑–∞ –ø–æ–≤–µ—á–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –∏–ª–∏ –ø—Ä–µ–≥–ª–µ–¥–∞–π—Ç–µ —Ä–µ—á–Ω–∏–∫–∞ –∏ –≥—Ä–∞–º–∞—Ç–∏–∫–∞—Ç–∞.</p>
            
            <div class="no-items-actions">
                <a href="/vocabulary/" class="btn-primary">Wortschatz durchsuchen / –ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ —Ä–µ—á–Ω–∏–∫–∞</a>
                <a href="/grammar/" class="btn-secondary">Grammatik studieren / –ò–∑—É—á–∞–≤–∞–Ω–µ –Ω–∞ –≥—Ä–∞–º–∞—Ç–∏–∫–∞</a>
            </div>
        </div>
    </div>
    
    <!-- Practice Session -->
    <div class="practice-session" id="practice-session" style="display: block;">
        <div class="flashcard-container" style="max-width: 600px; margin: 0 auto; padding: 20px;">
            <div class="flashcard" id="flashcard" role="region" aria-label="Vocabulary flashcard - click or press space to flip" style="background: white; border: 1px solid #ddd; border-radius: 8px; padding: 30px; min-height: 200px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <div class="flashcard-inner" style="position: relative;">
                    <div class="flashcard-front" id="flashcard-front" style="display: block;">
                        <div class="card-content" style="text-align: center;">
                            <div class="word" id="current-word" style="font-size: 32px; font-weight: bold; color: #333; margin-bottom: 20px; min-height: 40px;">–ó–¥—Ä–∞–≤–µ–π</div>
                            <div class="meta-info" style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
                                <span class="level-badge" id="word-level" style="background: #007bff; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">A1</span>
                                <span class="category-badge" id="word-category" style="background: #6c757d; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Begr√º√üung</span>
                            </div>
                        </div>
                        {{ if .Site.Params.enableAudio }}
                        <button class="audio-btn" id="play-audio" title="Play pronunciation" style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 20px;">
                            <span class="audio-icon">üîä</span>
                        </button>
                        {{ end }}
                    </div>
                    
                    <div class="flashcard-back" id="flashcard-back" style="display: none; position: relative; transform: none !important;">
                        <div class="card-content" style="text-align: center;">
                            <div class="translation" id="current-translation" style="font-size: 28px; font-weight: bold; color: #28a745; margin-bottom: 15px; min-height: 35px;">Hallo</div>
                            <div class="notes" id="current-notes" style="font-size: 14px; color: #666; font-style: italic; margin-top: 15px;">Standard informal greeting used throughout the day in Bulgaria</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flashcard-controls" style="text-align: center; margin-top: 30px;">
                <button id="show-answer" class="btn-primary" aria-label="Show answer - press space or enter" style="background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 6px; font-size: 16px; cursor: pointer; margin-bottom: 20px;">Antwort zeigen / –ü–æ–∫–∞–∂–∏ –æ—Ç–≥–æ–≤–æ—Ä–∞</button>
                
                <div class="response-buttons hidden" id="response-buttons" style="display: none; gap: 15px; justify-content: center; margin-top: 20px;">
                    <button id="incorrect-btn" class="btn-incorrect" aria-label="Mark as incorrect - press 1" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
                        <span class="icon">‚úó</span>
                        <span class="text">Falsch / –ì—Ä–µ—à–Ω–æ</span>
                        <span class="shortcut" style="background: rgba(255,255,255,0.3); padding: 2px 6px; border-radius: 3px; font-size: 12px;">1</span>
                    </button>
                    <button id="correct-btn" class="btn-correct" aria-label="Mark as correct - press 2" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
                        <span class="icon">‚úì</span>
                        <span class="text">Richtig / –ü—Ä–∞–≤–∏–ª–Ω–æ</span>
                        <span class="shortcut" style="background: rgba(255,255,255,0.3); padding: 2px 6px; border-radius: 3px; font-size: 12px;">2</span>
                    </button>
                </div>
                
                <div class="hint-section" style="margin-top: 20px;">
                    <button id="show-hint" class="btn-hint" aria-label="Show hint" style="background: #ffc107; color: #212529; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">üí° Hinweis / –ü–æ–¥—Å–∫–∞–∑–∫–∞</button>
                    <div class="hint-content hidden" id="hint-content" style="display: none; margin-top: 15px; padding: 15px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 6px; font-size: 14px;"></div>
                </div>
            </div>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
    </div>
    
    <!-- Session Complete -->
    <div class="session-complete hidden" id="session-complete">
        <div class="completion-stats">
            <h2>üéâ Sitzung abgeschlossen! / –°–µ—Å–∏—è—Ç–∞ –∑–∞–≤—ä—Ä—à–∏!</h2>
            
            <div class="final-stats">
                <div class="stat-item">
                    <span class="stat-number" id="final-correct">0</span>
                    <span class="stat-label">Richtig / –ü—Ä–∞–≤–∏–ª–Ω–∏</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="final-total">0</span>
                    <span class="stat-label">Gesamt / –û–±—â–æ</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="final-accuracy">0%</span>
                    <span class="stat-label">Genauigkeit / –¢–æ—á–Ω–æ—Å—Ç</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="final-time">0:00</span>
                    <span class="stat-label">Zeit / –í—Ä–µ–º–µ</span>
                </div>
            </div>
            
            <div class="performance-feedback" id="performance-feedback">
                <!-- Dynamic feedback based on performance -->
            </div>
            
            <div class="session-actions">
                <button id="new-session" class="btn-primary">Neue Sitzung / –ù–æ–≤–∞ —Å–µ—Å–∏—è</button>
                <a href="/vocabulary/" class="btn-secondary">Wortschatz durchsuchen / –ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ —Ä–µ—á–Ω–∏–∫–∞</a>
                <button id="review-mistakes" class="btn-secondary">Fehler √ºberpr√ºfen / –ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ –≥—Ä–µ—à–∫–∏—Ç–µ</button>
            </div>
        </div>
    </div>
</div>

{{ end }}
{{ end }}

{{ define "scripts" }}
{{ if ne .Params.layout "flashcard-practice" }}
<!-- Vocabulary data for JavaScript -->
<script id="practice-vocabulary-data" type="application/json">
{{- .Site.Data.vocabulary | jsonify | safeJS -}}
</script>

<!-- Practice configuration -->
<script id="practice-config" type="application/json">
{
    "enableAudio": {{ if .Site.Params.enableAudio }}true{{ else }}false{{ end }},
    "sessionLength": {{ .Site.Params.defaultSessionLength | default 20 }}
}
</script>

<!-- Load unified JavaScript modules via Hugo resources -->
{{ $spacedRepetition := resources.Get "js/unified-spaced-repetition.js" }}
{{ if $spacedRepetition }}
{{ $spacedRepetitionMin := $spacedRepetition | resources.Minify }}
<script src="{{ $spacedRepetitionMin.RelPermalink }}" defer></script>
{{ end }}

{{ $unifiedPracticeSession := resources.Get "js/unified-practice-session.js" }}
{{ if $unifiedPracticeSession }}
{{ $unifiedPracticeSessionMin := $unifiedPracticeSession | resources.Minify }}
<script src="{{ $unifiedPracticeSessionMin.RelPermalink }}" defer></script>
{{ end }}

<script>
// Initialize unified practice system
document.addEventListener('DOMContentLoaded', function() {
    console.log('[Init] DOM loaded, initializing practice session');
    
    // Wait for all deferred scripts to load
    setTimeout(() => {
        console.log('[Init] Checking for dependencies...');
        console.log('[Init] - languageToggle available:', !!window.languageToggle);
        console.log('[Init] - UnifiedPracticeSession available:', !!window.UnifiedPracticeSession);
        
        if (window.UnifiedPracticeSession) {
            try {
                console.log('[Init] Creating UnifiedPracticeSession instance...');
                const session = new window.UnifiedPracticeSession();
                window.practiceSession = session;
                // Backward compatibility alias
                window.enhancedPracticeSession = session;
                console.log('[Init] Practice session initialized successfully');
            } catch (error) {
                console.error('[Init] Failed to initialize practice session:', error);
                console.error('[Init] Stack:', error.stack);
            }
        } else if (window.BgDeApp && window.BgDeApp.initPractice) {
            // Fallback to simple practice
            console.log('[Init] Using fallback BgDeApp.initPractice');
            window.BgDeApp.initPractice();
            console.log('Simple practice session initialized');
        } else {
            console.error('[Init] No practice system loaded - check that unified-practice-session.js is included');
        }
    }, 100);
});
</script>
{{ end }}
{{ end }}
