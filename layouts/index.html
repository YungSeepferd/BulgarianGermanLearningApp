{{ define "title" }}{{ .Site.Title }} ‚Äì Deutsch & –ë—ä–ª–≥–∞—Ä—Å–∫–∏ –æ–±—É—á–µ–Ω–∏–µ{{ end }}
{{ define "main" }}

<div class="home-container">
    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">–£—á–µ—Ç–µ –±—ä–ª–≥–∞—Ä—Å–∫–∏ –∏ –Ω–µ–º—Å–∫–∏ / Lernen Sie Bulgarisch und Deutsch</h1>
            <p class="hero-subtitle">–û–≤–ª–∞–¥–µ–π—Ç–µ —Ä–µ—á–Ω–∏–∫ –∏ –≥—Ä–∞–º–∞—Ç–∏–∫–∞ —Å—ä—Å —Å–∏—Å—Ç–µ–º–∞ –∑–∞ —Ä–∞–∑—Ä–µ–¥–µ–Ω–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è / Beherrschen Sie Wortschatz und Grammatik mit einer wissenschaftlich belegten Spaced-Repetition-Methode</p>
            
            <div class="hero-stats">
                <div class="stat-item">
                    <span class="stat-number">{{ len .Site.Data.vocabulary }}</span>
                    <span class="stat-label">–†–µ—á–Ω–∏–∫–æ–≤–∏ –µ–¥–∏–Ω–∏—Ü–∏ / Wortschatz-Eintr√§ge</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ len (index .Site.Data "cultural-grammar") }}</span>
                    <span class="stat-label">–ì—Ä–∞–º–∞—Ç–∏—á–Ω–∏ –ø—Ä–∞–≤–∏–ª–∞ / Grammatikregeln</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">4</span>
                    <span class="stat-label">–ù–∏–≤–∞ –Ω–∞ —Ç—Ä—É–¥–Ω–æ—Å—Ç / Schwierigkeitsstufen</span>
                </div>
            </div>
            
            <div class="hero-actions">
                <a href="/practice/" class="btn-primary btn-large">–ó–∞–ø–æ—á–Ω–µ—Ç–µ —É—á–µ–Ω–µ / Lernsitzung starten</a>
                <a href="/vocabulary/" class="btn-secondary btn-large">–†–∞–∑–≥–ª–µ–¥–∞–π—Ç–µ —Ä–µ—á–Ω–∏–∫–∞ / Wortschatz durchsuchen</a>
            </div>
        </div>
    </section>
    
    <!-- Learning Progress Dashboard -->
    <section class="dashboard-section">
        <h2>–í–∞—à–∏—è—Ç –Ω–∞–ø—Ä–µ–¥—ä–∫ / Ihr Fortschritt</h2>

        <!-- Phase Distribution Widget -->
        <div class="widget phase-distribution-widget" id="phase-widget">
            <div class="widget-header">
                <h3>üìä –†–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ñ–∞–∑–∏ / Phasenverteilung</h3>
                <a href="/principles/" class="widget-link">–ö–∞–∫–≤–æ –æ–∑–Ω–∞—á–∞–≤–∞—Ç —Ñ–∞–∑–∏—Ç–µ? / Was bedeuten die Phasen?</a>
            </div>
            <div class="phase-bars" id="phase-bars">
                <div class="phase-bar-loading">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ... / Wird geladen...</div>
            </div>
        </div>

        <!-- Today's Session Widget -->
        <div class="widget today-session-widget" id="today-widget">
            <div class="widget-header">
                <h3>üìÖ –î–Ω–µ—Å / Heute</h3>
            </div>
            <div class="today-stats" id="today-stats">
                <div class="today-stat">
                    <span class="today-stat-value" id="today-reviews">0</span>
                    <span class="today-stat-label">–ü—Ä–µ–≥–ª–µ–¥–∞–Ω–∏ / √úberpr√ºft</span>
                </div>
                <div class="today-stat">
                    <span class="today-stat-value" id="today-correct">0%</span>
                    <span class="today-stat-label">–¢–æ—á–Ω–æ—Å—Ç / Genauigkeit</span>
                </div>
                <div class="today-stat">
                    <span class="today-stat-value" id="today-time">0m</span>
                    <span class="today-stat-label">–í—Ä–µ–º–µ / Zeit</span>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Recent Activity Section -->
    <section class="recent-activity-section">
        <h2>–ü—Ä–æ–¥—ä–ª–∂–µ—Ç–µ –æ–±—É—á–µ–Ω–∏–µ—Ç–æ / Lernen fortsetzen</h2>
        <div class="activity-cards">
            <div class="activity-card" id="due-items-card">
                <div class="activity-icon">‚è∞</div>
                <div class="activity-content">
                    <h3>–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏ –∑–∞ –ø—Ä–µ–≥–æ–≤–æ—Ä / F√§llige Wiederholungen</h3>
                    <p class="activity-count" id="due-count">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ... / Wird geladen...</p>
                    <a href="/practice/" class="activity-action">–£–ø—Ä–∞–∂–Ω—è–≤–∞–π —Å–µ —Å–µ–≥–∞ / Jetzt √ºben</a>
                </div>
            </div>
            
            <div class="activity-card" id="new-items-card">
                <div class="activity-icon">‚ú®</div>
                <div class="activity-content">
                    <h3>–ù–æ–≤–∏ –¥—É–º–∏ –∑–∞ —É—á–µ–Ω–µ / Neue W√∂rter zum Lernen</h3>
                    <p class="activity-count" id="new-count">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ... / Wird geladen...</p>
                    <a href="/vocabulary/" class="activity-action">–†–∞–∑–≥–ª–µ–¥–∞–π—Ç–µ / Entdecken</a>
                </div>
            </div>
            
            <div class="activity-card" id="streak-card">
                <div class="activity-icon">üî•</div>
                <div class="activity-content">
                    <h3>–°–µ—Ä–∏—è –æ—Ç –¥–Ω–∏ / Lernserie</h3>
                    <p class="activity-count" id="streak-count">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ... / Wird geladen...</p>
                    <span class="activity-action">–ü—Ä–æ–¥—ä–ª–∂–∞–≤–∞–π —Ç–∞–∫–∞! / Weiter so!</span>
                </div>
            </div>
        </div>
    </section>
</div>

{{ end }}

{{ define "scripts" }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('[Home] Page loaded with {{ len .Site.Data.vocabulary }} vocabulary items');

    // Populate phase distribution widget
    function populatePhaseWidget() {
        if (!window.unifiedSpacedRepetition || !window.phaseCalculator) {
            console.warn('[Home] SR system not loaded yet');
            return;
        }

        try {
            const stats = window.unifiedSpacedRepetition.getStats();
            const phaseBarsContainer = document.getElementById('phase-bars');

            if (!phaseBarsContainer) return;

            // Get counts for each phase
            const phases = [
                { phase: 0, name: window.phaseCalculator.getPhaseName(0, 'bg'), icon: 'üéì', count: 0, color: '#06b6d4' },
                { phase: 1, name: window.phaseCalculator.getPhaseName(1, 'bg'), icon: 'üå±', count: 0, color: '#ef4444' },
                { phase: 2, name: window.phaseCalculator.getPhaseName(2, 'bg'), icon: 'üìñ', count: 0, color: '#f97316' },
                { phase: 3, name: window.phaseCalculator.getPhaseName(3, 'bg'), icon: 'üëÅÔ∏è', count: 0, color: '#eab308' },
                { phase: 4, name: window.phaseCalculator.getPhaseName(4, 'bg'), icon: '‚úÖ', count: 0, color: '#84cc16' },
                { phase: 5, name: window.phaseCalculator.getPhaseName(5, 'bg'), icon: '‚≠ê', count: 0, color: '#22c55e' },
                { phase: 6, name: window.phaseCalculator.getPhaseName(6, 'bg'), icon: 'üèÜ', count: 0, color: '#10b981' }
            ];

            // Count reviews in each phase
            const reviews = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.includes(':review_') && window.profileManager) {
                    const profileId = window.profileManager.getActiveProfileId();
                    if (key.startsWith(`bgde:${profileId}:`)) {
                        try {
                            const data = JSON.parse(localStorage.getItem(key));
                            if (data && data.phase !== undefined) {
                                const phase = phases.find(p => p.phase === data.phase);
                                if (phase) phase.count++;
                            }
                        } catch (e) {}
                    }
                }
            }

            const totalReviews = phases.reduce((sum, p) => sum + p.count, 0);

            // Build phase bars HTML
            let html = '';
            phases.forEach(phase => {
                const percentage = totalReviews > 0 ? (phase.count / totalReviews * 100).toFixed(1) : 0;
                html += `
                    <div class="phase-bar-row">
                        <div class="phase-label">
                            <span class="phase-icon">${phase.icon}</span>
                            <span class="phase-name">${phase.name}</span>
                        </div>
                        <div class="phase-bar-container">
                            <div class="phase-bar-fill" style="width: ${percentage}%; background-color: ${phase.color};"></div>
                        </div>
                        <div class="phase-count">${phase.count}</div>
                    </div>
                `;
            });

            if (totalReviews === 0) {
                html = '<div class="phase-empty">–ó–∞–ø–æ—á–Ω–µ—Ç–µ —É—á–µ–Ω–µ, –∑–∞ –¥–∞ –≤–∏–¥–∏—Ç–µ –Ω–∞–ø—Ä–µ–¥—ä–∫–∞ —Å–∏ / Beginnen Sie zu lernen, um Ihren Fortschritt zu sehen</div>';
            }

            phaseBarsContainer.innerHTML = html;
        } catch (e) {
            console.error('[Home] Error populating phase widget:', e);
        }
    }

    // Populate today's session widget
    function populateTodayWidget() {
        try {
            const todayReviews = document.getElementById('today-reviews');
            const todayCorrect = document.getElementById('today-correct');
            const todayTime = document.getElementById('today-time');

            // Get today's session history
            const historyKey = `bgde:${window.profileManager?.getActiveProfileId() || 'german_learner'}:session_history`;
            const historyData = localStorage.getItem(historyKey);

            if (historyData) {
                const history = JSON.parse(historyData);
                const today = new Date().toDateString();
                const todaySessions = history.filter(s => new Date(s.timestamp).toDateString() === today);

                let totalReviews = 0;
                let totalCorrect = 0;
                let totalTime = 0;

                todaySessions.forEach(session => {
                    totalReviews += session.cardsReviewed || 0;
                    totalCorrect += session.correctAnswers || 0;
                    totalTime += session.duration || 0;
                });

                if (todayReviews) todayReviews.textContent = totalReviews;
                if (todayCorrect) todayCorrect.textContent = totalReviews > 0 ? Math.round(totalCorrect / totalReviews * 100) + '%' : '0%';
                if (todayTime) todayTime.textContent = Math.round(totalTime / 60) + 'm';
            }
        } catch (e) {
            console.error('[Home] Error populating today widget:', e);
        }
    }

    // Populate activity cards
    function populateActivityCards() {
        try {
            const dueCount = document.getElementById('due-count');
            const newCount = document.getElementById('new-count');
            const streakCount = document.getElementById('streak-count');

            if (window.unifiedSpacedRepetition) {
                // Get due items
                const dueItems = window.unifiedSpacedRepetition.getDueItems();
                if (dueCount) {
                    if (dueItems.length > 0) {
                        dueCount.textContent = `${dueItems.length} –¥—É–º–∏ / W√∂rter`;
                    } else {
                        dueCount.textContent = '–ó–∞–ø–æ—á–Ω–µ—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è—Ç–∞, –∑–∞ –¥–∞ —Å–ª–µ–¥–∏—Ç–µ –Ω–∞–ø—Ä–µ–¥—ä–∫–∞ / Beginnen Sie zu √ºben, um Ihren Fortschritt zu verfolgen';
                    }
                }
            }

            // New items count
            if (newCount) newCount.textContent = '{{ len .Site.Data.vocabulary }} –¥—É–º–∏ –Ω–∞–ª–∏—á–Ω–∏ / W√∂rter verf√ºgbar';

            // Streak (TODO: implement streak tracking)
            if (streakCount) streakCount.textContent = '0 –¥–Ω–∏ ‚Äì –∑–∞–ø–æ—á–Ω–µ—Ç–µ –¥–Ω–µ—Å! / 0 Tage ‚Äì starten Sie heute!';
        } catch (e) {
            console.error('[Home] Error updating activity cards:', e);
        }
    }

    // Initialize all widgets
    setTimeout(() => {
        populatePhaseWidget();
        populateTodayWidget();
        populateActivityCards();
    }, 100);
});
</script>
{{ end }}
