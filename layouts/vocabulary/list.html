{{ define "title" }}Vocabulary - {{ .Site.Title }}{{ end }}
{{ define "main" }}

<div class="vocabulary-container">
    <div class="page-header">
        <h1>Wortschatz / –†–µ—á–Ω–∏–∫</h1>
        <p>Lernen Sie bulgarischen und deutschen Wortschatz mit Wiederholung in Abst√§nden / –£—á–µ—Ç–µ –±—ä–ª–≥–∞—Ä—Å–∫–∏ –∏ –Ω–µ–º—Å–∫–∏ —Ä–µ—á–Ω–∏–∫ —Å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –Ω–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∏</p>
    </div>
    
    <!-- Quick Icon-Based Filters for Tandem Learning -->
    <div class="quick-filters">
        <div class="quick-filter-section">
            <h3>üìä Niveau / –ù–∏–≤–æ</h3>
            <div class="quick-filter-buttons">
                <button class="quick-filter-btn" data-filter-type="level" data-filter-value="" title="Alle Niveaus / –í—Å–∏—á–∫–∏ –Ω–∏–≤–∞" aria-label="Filter by all levels">
                    <span class="icon" aria-hidden="true">üåê</span>
                    <span class="label">Alle / –í—Å–∏—á–∫–∏</span>
                </button>
                <button class="quick-filter-btn" data-filter-type="level" data-filter-value="A1" title="A1 - Anf√§nger / –ù–∞—á–∏–Ω–∞–µ—â–∏" aria-label="Filter by A1 level">
                    <span class="icon" aria-hidden="true">üå±</span>
                    <span class="label">A1</span>
                </button>
                <button class="quick-filter-btn" data-filter-type="level" data-filter-value="A2" title="A2 - Grundstufe / –û—Å–Ω–æ–≤–Ω–æ" aria-label="Filter by A2 level">
                    <span class="icon" aria-hidden="true">üåø</span>
                    <span class="label">A2</span>
                </button>
                <button class="quick-filter-btn" data-filter-type="level" data-filter-value="B1" title="B1 - Mittelstufe / –°—Ä–µ–¥–Ω–æ" aria-label="Filter by B1 level">
                    <span class="icon" aria-hidden="true">üå≥</span>
                    <span class="label">B1</span>
                </button>
                <button class="quick-filter-btn" data-filter-type="level" data-filter-value="B2" title="B2 - Obere Mittelstufe / –ì–æ—Ä–Ω–æ —Å—Ä–µ–¥–Ω–æ" aria-label="Filter by B2 level">
                    <span class="icon" aria-hidden="true">üèÜ</span>
                    <span class="label">B2</span>
                </button>
            </div>
        </div>
        
        <div class="quick-filter-section">
            <h3>üè∑Ô∏è Kategorien / –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
            <div class="quick-filter-buttons">
                <button class="quick-filter-btn" data-filter-type="category" data-filter-value="" title="Alle Kategorien / –í—Å–∏—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" aria-label="Filter by all categories">
                    <span class="icon" aria-hidden="true">üìö</span>
                    <span class="label">Alle / –í—Å–∏—á–∫–∏</span>
                </button>
                <button class="quick-filter-btn" data-filter-type="category" data-filter-value="Begr√º√üung" title="Greetings / –ü–æ–∑–¥—Ä–∞–≤–∏" aria-label="Filter by greetings category">
                    <span class="icon" aria-hidden="true">üëã</span>
                    <span class="label">Begr√º√üung</span>
                </button>
                <button class="quick-filter-btn" data-filter-type="category" data-filter-value="Substantiv" title="Nouns / –°—ä—â–µ—Å—Ç–≤–∏—Ç–µ–ª–Ω–∏" aria-label="Filter by nouns category">
                    <span class="icon" aria-hidden="true">üì¶</span>
                    <span class="label">Substantiv</span>
                </button>
                <button class="quick-filter-btn" data-filter-type="category" data-filter-value="Verb" title="Verbs / –ì–ª–∞–≥–æ–ª–∏" aria-label="Filter by verbs category">
                    <span class="icon" aria-hidden="true">‚ö°</span>
                    <span class="label">Verb</span>
                </button>
                <button class="quick-filter-btn" data-filter-type="category" data-filter-value="Adjektiv" title="Adjectives / –ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª–Ω–∏" aria-label="Filter by adjectives category">
                    <span class="icon" aria-hidden="true">üé®</span>
                    <span class="label">Adjektiv</span>
                </button>
                <button class="quick-filter-btn" data-filter-type="category" data-filter-value="Adverb" title="Adverbs / –ù–∞—Ä–µ—á–∏—è" aria-label="Filter by adverbs category">
                    <span class="icon" aria-hidden="true">‚è©</span>
                    <span class="label">Adverb</span>
                </button>
                <button class="quick-filter-btn" data-filter-type="category" data-filter-value="Ausdruck" title="Expressions / –ò–∑—Ä–∞–∑–∏" aria-label="Filter by expressions category">
                    <span class="icon" aria-hidden="true">üí¨</span>
                    <span class="label">Ausdruck</span>
                </button>
                <button class="quick-filter-btn" data-filter-type="category" data-filter-value="Familie" title="Family / –°–µ–º–µ–π—Å—Ç–≤–æ" aria-label="Filter by family category">
                    <span class="icon" aria-hidden="true">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                    <span class="label">Familie</span>
                </button>
                <button class="quick-filter-btn" data-filter-type="category" data-filter-value="Lebensmittel" title="Food / –•—Ä–∞–Ω–∞" aria-label="Filter by food category">
                    <span class="icon" aria-hidden="true">üçΩÔ∏è</span>
                    <span class="label">Lebensmittel</span>
                </button>
                <button class="quick-filter-btn" data-filter-type="category" data-filter-value="Zeit" title="Time / –í—Ä–µ–º–µ" aria-label="Filter by time category">
                    <span class="icon" aria-hidden="true">‚è∞</span>
                    <span class="label">Zeit</span>
                </button>
                <button class="quick-filter-btn" data-filter-type="category" data-filter-value="Zahl" title="Numbers / –ß–∏—Å–ª–∞" aria-label="Filter by numbers category">
                    <span class="icon" aria-hidden="true">üî¢</span>
                    <span class="label">Zahl</span>
                </button>
            </div>
        </div>
    </div>
    
    <div class="filters">
        <select id="level-filter">
            <option value="">Alle Niveaus / –í—Å–∏—á–∫–∏ –Ω–∏–≤–∞</option>
            <option value="A1">A1 - Anf√§nger / –ù–∞—á–∏–Ω–∞–µ—â–∏</option>
            <option value="A2">A2 - Grundstufe / –û—Å–Ω–æ–≤–Ω–æ</option>
            <option value="B1">B1 - Mittelstufe / –°—Ä–µ–¥–Ω–æ</option>
            <option value="B2">B2 - Obere Mittelstufe / –ì–æ—Ä–Ω–æ —Å—Ä–µ–¥–Ω–æ</option>
        </select>
        
        <select id="category-filter">
            <option value="">Alle Kategorien / –í—Å–∏—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
            {{ $categories := slice }}
            {{ range .Site.Data.vocabulary }}
                {{ $categories = $categories | append .category }}
            {{ end }}
            {{ range ($categories | uniq | sort) }}
            <option value="{{ . }}">{{ . }}</option>
            {{ end }}
        </select>
        
        <input type="text" id="search-input" placeholder="Wortschatz suchen... / –¢—ä—Ä—Å–µ–Ω–µ –Ω–∞ —Ä–µ—á–Ω–∏–∫..." class="search-input">
        
        <button id="practice-selected" class="btn-primary">Ausgew√§hlte √ºben / –£–ø—Ä–∞–∂–Ω—è–≤–∞–π—Ç–µ –∏–∑–±—Ä–∞–Ω–∏—Ç–µ</button>
    </div>
    
    <!-- Cultural Context Toggle -->
    <div id="cultural-context-container"></div>
    
    <div class="vocabulary-stats">
        <span class="stat">Gesamt / –û–±—â–æ: <span id="total-count">{{ len .Site.Data.vocabulary }}</span></span>
        <span class="stat">Angezeigt / –ü–æ–∫–∞–∑–∞–Ω–∏: <span id="showing-count">{{ len .Site.Data.vocabulary }}</span></span>
    </div>
    
    <!-- Pagination Controls -->
    {{ $vocabulary := .Site.Data.vocabulary }}
    {{ $itemsPerPage := 50 }}
    {{ $currentPage := .Params.page | default 1 }}
    {{ $totalItems := len $vocabulary }}
    {{ $totalPages := div (add $totalItems (sub $itemsPerPage 1)) $itemsPerPage }}
    {{ $offset := mul (sub $currentPage 1) $itemsPerPage }}
    {{ $paginatedItems := after $offset (first (add $offset $itemsPerPage) $vocabulary) }}
    
    <div class="pagination-info">
        <span>Seite {{ $currentPage }} von {{ $totalPages }} / –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ $currentPage }} –æ—Ç {{ $totalPages }}</span>
        <span>({{ len $paginatedItems }} von {{ $totalItems }} Eintr√§ge / –∑–∞–ø–∏—Å–∏)</span>
    </div>
    
    <div class="vocabulary-grid" id="vocabulary-grid">
        {{ range $vocabulary }}
        <div class="vocab-card" 
             data-level="{{ .level }}" 
             data-category="{{ .category }}"
             data-word="{{ .word | lower }}"
             data-translation="{{ .translation | lower }}"
             data-id="{{ .id }}"
             data-slug="{{ .word | urlize }}">
            
            <div class="vocab-header">
                <div class="vocab-word">{{ .word }}</div>
                <input type="checkbox" class="vocab-select" data-word="{{ .word }}">
            </div>
            
            <div class="vocab-translation">{{ .translation }}</div>
            
            {{ if .audio }}
            <button class="audio-btn" data-audio="{{ .audio }}" title="Play pronunciation">
                <span class="audio-icon">üîä</span>
            </button>
            {{ end }}
            
            <div class="vocab-meta">
                <span class="level-badge level-{{ .level | lower }}">{{ .level }}</span>
                <span class="category-tag">{{ .category }}</span>
            </div>
            
            {{/* Display notes based on available fields - priority: direction-specific > cultural > general */}}
            {{ $hasNotes := false }}
            <div class="vocab-notes-container" data-direction-aware="true">
                {{/* Direction-aware notes - BOTH variants included, JS will show correct one */}}
                {{ if .notes_de_to_bg }}
                <div class="vocab-note vocab-note-direction vocab-note-de-bg" data-direction="de-bg">
                    <span class="note-label">üéØ</span> {{ .notes_de_to_bg }}
                </div>
                {{ $hasNotes = true }}
                {{ end }}
                {{ if .notes_bg_to_de }}
                <div class="vocab-note vocab-note-direction vocab-note-bg-de" data-direction="bg-de">
                    <span class="note-label">üéØ</span> {{ .notes_bg_to_de }}
                </div>
                {{ $hasNotes = true }}
                {{ end }}
                
                {{/* Cultural context */}}
                {{ if .cultural_note }}
                <div class="vocab-note vocab-cultural">
                    <span class="note-label">üí°</span> {{ .cultural_note }}
                </div>
                {{ $hasNotes = true }}
                {{ end }}
                
                {{/* Etymology */}}
                {{ if .etymology }}
                <div class="vocab-note vocab-etymology">
                    <span class="note-label">üìú</span> {{ .etymology }}
                </div>
                {{ $hasNotes = true }}
                {{ end }}
                
                {{/* Linguistic note */}}
                {{ if .linguistic_note }}
                <div class="vocab-note vocab-linguistic">
                    <span class="note-label">üó£Ô∏è</span> {{ .linguistic_note }}
                </div>
                {{ $hasNotes = true }}
                {{ end }}
                
                {{/* Fallback to general notes if nothing else is available */}}
                {{ if and (not $hasNotes) .notes }}
                <div class="vocab-note">{{ .notes }}</div>
                {{ end }}
            </div>
            
            <div class="vocab-actions">
                <button class="practice-single-btn" data-word="{{ .word }}">√úben / –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</button>
            </div>
        </div>
        {{ end }}
    </div>
    
    <!-- Pagination Navigation -->
    {{ if gt $totalPages 1 }}
    <nav class="pagination" role="navigation" aria-label="Vocabulary pagination">
        <div class="pagination-controls">
            {{ if gt $currentPage 1 }}
                {{ $prevPage := sub $currentPage 1 }}
                <a href="/vocabulary/?page={{ $prevPage }}" class="pagination-btn pagination-prev" rel="prev">
                    <span class="pagination-icon">‚Üê</span>
                    <span class="pagination-text">Vorherige / –ü—Ä–µ–¥–∏—à–Ω–∞</span>
                </a>
            {{ end }}
            
            <div class="pagination-numbers">
                <!-- First page -->
                {{ if gt $currentPage 3 }}
                    <a href="/vocabulary/?page=1" class="pagination-number">1</a>
                    {{ if gt $currentPage 4 }}
                        <span class="pagination-ellipsis">‚Ä¶</span>
                    {{ end }}
                {{ end }}
            </div>
            
            {{ if lt $currentPage $totalPages }}
                {{ $nextPage := add $currentPage 1 }}
                <a href="/vocabulary/?page={{ $nextPage }}" class="pagination-btn pagination-next" rel="next">
                    <span class="pagination-text">N√§chste / –°–ª–µ–¥–≤–∞—â–∞</span>
                    <span class="pagination-icon">‚Üí</span>
                </a>
            {{ end }}
        </div>
        
        <!-- Quick jump -->
        <div class="pagination-jump">
            <label for="page-jump">Gehe zu Seite / –û—Ç–∏–¥–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞:</label>
            <select id="page-jump">
                {{ range seq $totalPages }}
                    <option value="{{ . }}" {{ if eq . $currentPage }}selected{{ end }}>
                        {{ . }}
                    </option>
                {{ end }}
            </select>
        </div>
    </nav>
    {{ end }}
    
    <div class="no-results hidden" id="no-results">
        <p>Keine Wortschatzeintr√§ge gefunden, die Ihren Kriterien entsprechen. / –ù–µ —Å–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ –¥—É–º–∏, –æ—Ç–≥–æ–≤–∞—Ä—è—â–∏ –Ω–∞ –≤–∞—à–∏—Ç–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏.</p>
        <button id="clear-filters" class="btn-secondary">Filter l√∂schen / –ò–∑—á–∏—Å—Ç–≤–∞–Ω–µ –Ω–∞ —Ñ–∏–ª—Ç—Ä–∏—Ç–µ</button>
    </div>
</div>

{{ end }}

{{ define "scripts" }}
<!-- Vocabulary data for JavaScript -->
<script id="vocabulary-data" type="application/json">
{{ .Site.Data.vocabulary | jsonify }}
</script>

<!-- Enhanced vocabulary data for JavaScript -->
<script id="enhanced-vocabulary-data" type="application/json">
{{ index .Site.Data "vocabulary-enhanced" | jsonify }}
</script>

<!-- Cultural grammar data for JavaScript -->
<script id="cultural-grammar-data" type="application/json">
{{ index .Site.Data "cultural-grammar" | jsonify }}
</script>

<!-- Load JavaScript modules via Hugo resources -->
{{ $vocabularyAdapter := resources.Get "js/vocabulary-adapter.js" }}
{{ if $vocabularyAdapter }}
{{ $vocabularyAdapterMin := $vocabularyAdapter | resources.Minify }}
<script src="{{ $vocabularyAdapterMin.RelPermalink }}"></script>
{{ end }}

{{/* vocab-cards.js is only used in shortcodes with type="module", not on list page */}}

{{ $vocabularyPage := resources.Get "js/modules/vocabulary-page.js" }}
{{ if $vocabularyPage }}
{{ $vocabularyPageMin := $vocabularyPage | resources.Minify }}
<script src="{{ $vocabularyPageMin.RelPermalink }}"></script>
{{ end }}

<script>
// Enhanced initialization with retry logic and debugging
(function initVocabularyPage() {
  const maxRetries = 50; // 5 seconds max wait
  let retryCount = 0;
  
  function attemptInit() {
    console.log(`[VocabPage] Init attempt ${retryCount + 1}/${maxRetries}`);
    console.log('[VocabPage] VocabularyAdapter available:', !!window.VocabularyAdapter);
    console.log('[VocabPage] VocabularyPageModule available:', !!window.VocabularyPageModule);
    
    if (window.VocabularyPageModule && window.VocabularyAdapter) {
      try {
        console.log('[VocabPage] Initializing with adapter...');
        const adapter = new window.VocabularyAdapter();
        const module = new window.VocabularyPageModule({
          container: '#vocabulary-grid',
          adapter
        });
        
        // Store globally for debugging
        window.vocabPageInstance = module;
        
        module.init();
        console.log('[VocabPage] ‚úÖ Successfully initialized with adapter');
        return true;
      } catch (error) {
        console.error('[VocabPage] ‚ùå Initialization failed:', error);
        return false;
      }
    }
    
    retryCount++;
    if (retryCount < maxRetries) {
      setTimeout(attemptInit, 100);
    } else {
      console.warn('[VocabPage] ‚ö†Ô∏è Timeout - falling back to basic DOM filtering');
      // Fallback to basic search functionality
      initBasicSearch();
    }
  }
  
  function initBasicSearch() {
    const searchInput = document.getElementById('search-input');
    if (!searchInput) return;
    
    console.log('[VocabPage] üîÑ Initializing basic search fallback');
    
    searchInput.addEventListener('input', function(e) {
      const query = e.target.value.toLowerCase();
      let visibleCount = 0;
      
      document.querySelectorAll('#vocabulary-grid .vocab-card').forEach(card => {
        const word = (card.getAttribute('data-word') || '').toLowerCase();
        const translation = (card.getAttribute('data-translation') || '').toLowerCase();
        const matches = !query || word.includes(query) || translation.includes(query);
        
        card.style.display = matches ? '' : 'none';
        if (matches) visibleCount++;
      });
      
      // Update counter
      const showingCount = document.getElementById('showing-count');
      if (showingCount) {
        showingCount.textContent = visibleCount;
      }
      
      console.log(`[VocabPage] üîç Search "${query}" -> ${visibleCount} results`);
    });
  }
  
  // Start initialization
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', attemptInit);
  } else {
    attemptInit();
  }
})();
</script>
{{ end }}

