{{ define "title" }}Vocabulary - {{ .Site.Title }}{{ end }}
{{ define "main" }}

<div class="vocabulary-container">
    <div class="page-header">
        <h1>Wortschatz / –†–µ—á–Ω–∏–∫</h1>
        <p>Lernen Sie bulgarischen und deutschen Wortschatz mit Wiederholung in Abst√§nden / –£—á–µ—Ç–µ –±—ä–ª–≥–∞—Ä—Å–∫–∏ –∏ –Ω–µ–º—Å–∫–∏ —Ä–µ—á–Ω–∏–∫ —Å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –Ω–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∏</p>
    </div>
    
    <div class="filters">
        <select id="level-filter">
            <option value="">Alle Niveaus / –í—Å–∏—á–∫–∏ –Ω–∏–≤–∞</option>
            <option value="A1">A1 - Anf√§nger / –ù–∞—á–∏–Ω–∞–µ—â–∏</option>
            <option value="A2">A2 - Grundstufe / –û—Å–Ω–æ–≤–Ω–æ</option>
            <option value="B1">B1 - Mittelstufe / –°—Ä–µ–¥–Ω–æ</option>
            <option value="B2">B2 - Obere Mittelstufe / –ì–æ—Ä–Ω–æ —Å—Ä–µ–¥–Ω–æ</option>
        </select>
        
        <select id="category-filter">
            <option value="">Alle Kategorien / –í—Å–∏—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
            {{ $categories := slice }}
            {{ range .Site.Data.vocabulary }}
                {{ $categories = $categories | append .category }}
            {{ end }}
            {{ range ($categories | uniq | sort) }}
            <option value="{{ . }}">{{ . }}</option>
            {{ end }}
        </select>
        
        <input type="text" id="search-input" placeholder="Wortschatz suchen... / –¢—ä—Ä—Å–µ–Ω–µ –Ω–∞ —Ä–µ—á–Ω–∏–∫..." class="search-input">
        
        <button id="practice-selected" class="btn-primary">Ausgew√§hlte √ºben / –£–ø—Ä–∞–∂–Ω—è–≤–∞–π—Ç–µ –∏–∑–±—Ä–∞–Ω–∏—Ç–µ</button>
    </div>
    
    <!-- Cultural Context Toggle -->
    <div id="cultural-context-container"></div>
    
    <div class="vocabulary-stats">
        <span class="stat">Gesamt / –û–±—â–æ: <span id="total-count">{{ len .Site.Data.vocabulary }}</span></span>
        <span class="stat">Angezeigt / –ü–æ–∫–∞–∑–∞–Ω–∏: <span id="showing-count">{{ len .Site.Data.vocabulary }}</span></span>
    </div>
    
    <div class="vocabulary-grid" id="vocabulary-grid">
        {{ range .Site.Data.vocabulary }}
        <div class="vocab-card" 
             data-level="{{ .level }}" 
             data-category="{{ .category }}"
             data-word="{{ .word | lower }}"
             data-translation="{{ .translation | lower }}"
             data-slug="{{ .word | urlize }}">
            
            <div class="vocab-header">
                <div class="vocab-word">{{ .word }}</div>
                <input type="checkbox" class="vocab-select" data-word="{{ .word }}">
            </div>
            
            <div class="vocab-translation">{{ .translation }}</div>
            
            {{ if .audio }}
            <button class="audio-btn" data-audio="{{ .audio }}" title="Play pronunciation">
                <span class="audio-icon">üîä</span>
            </button>
            {{ end }}
            
            <div class="vocab-meta">
                <span class="level-badge level-{{ .level | lower }}">{{ .level }}</span>
                <span class="category-tag">{{ .category }}</span>
            </div>
            
            {{ if .notes }}
            <div class="vocab-notes">{{ .notes }}</div>
            {{ end }}
            
            <div class="vocab-actions">
                <button class="practice-single-btn" data-word="{{ .word }}">√úben / –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</button>
            </div>
        </div>
        {{ end }}
    </div>
    
    <div class="no-results hidden" id="no-results">
        <p>Keine Wortschatzeintr√§ge gefunden, die Ihren Kriterien entsprechen. / –ù–µ —Å–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ –¥—É–º–∏, –æ—Ç–≥–æ–≤–∞—Ä—è—â–∏ –Ω–∞ –≤–∞—à–∏—Ç–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏.</p>
        <button id="clear-filters" class="btn-secondary">Filter l√∂schen / –ò–∑—á–∏—Å—Ç–≤–∞–Ω–µ –Ω–∞ —Ñ–∏–ª—Ç—Ä–∏—Ç–µ</button>
    </div>
</div>

{{ end }}

{{ define "scripts" }}
<!-- Vocabulary data for JavaScript -->
<script id="vocabulary-data" type="application/json">
{{ .Site.Data.vocabulary | jsonify }}
</script>

<script>
// Initialize enhanced vocabulary with bidirectional learning
document.addEventListener('DOMContentLoaded', function() {
    // Load vocabulary data from script tag
    const vocabularyData = JSON.parse(document.getElementById('vocabulary-data').textContent);
    
    // Initialize vocabulary adapter for backward compatibility
    const adapter = new VocabularyAdapter(vocabularyData);
    
    // Initialize enhanced vocabulary cards
    const enhancedVocab = new EnhancedVocabCards({
        container: '#vocabulary-grid',
        adapter: adapter,
        showCulturalContext: true,
        enableInteractions: true
    });
    
    enhancedVocab.init();
    
    // Initialize cultural context toggle
    const culturalToggle = new CulturalContextToggle({
        container: document.getElementById('cultural-context-container')
    });
    culturalToggle.init();
    
    // Initialize filtering and search
    const filters = {
        level: document.getElementById('level-filter'),
        category: document.getElementById('category-filter'),
        search: document.getElementById('search-input')
    };
    
    // Filter functionality
    function applyFilters() {
        const currentDirection = localStorage.getItem('bgde:learning_direction') || 'bg_to_de';
        const items = adapter.getItemsForDirection(currentDirection);
        
        let filtered = items.filter(item => {
            const levelMatch = !filters.level.value || item.level === filters.level.value;
            const categoryMatch = !filters.category.value || item.category === filters.category.value;
            const searchMatch = !filters.search.value || 
                item.word.toLowerCase().includes(filters.search.value.toLowerCase()) ||
                item.translation.toLowerCase().includes(filters.search.value.toLowerCase());
            
            return levelMatch && categoryMatch && searchMatch;
        });
        
        enhancedVocab.renderItems(filtered);
        document.getElementById('showing-count').textContent = filtered.length;
        
        // Show/hide no results message
        const noResults = document.getElementById('no-results');
        if (filtered.length === 0) {
            noResults.classList.remove('hidden');
        } else {
            noResults.classList.add('hidden');
        }
    }
    
    // Add event listeners
    filters.level.addEventListener('change', applyFilters);
    filters.category.addEventListener('change', applyFilters);
    
    // Debounced search
    let searchTimeout;
    filters.search.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(applyFilters, 300);
    });
    
    // Clear filters
    document.getElementById('clear-filters').addEventListener('click', function() {
        filters.level.value = '';
        filters.category.value = '';
        filters.search.value = '';
        applyFilters();
    });
    
    // Practice selected functionality
    document.getElementById('practice-selected').addEventListener('click', function() {
        const selected = Array.from(document.querySelectorAll('.vocab-select:checked'))
            .map(checkbox => checkbox.dataset.word);
        
        if (selected.length > 0) {
            // Store selected items for practice session
            localStorage.setItem('bgde:practice_selection', JSON.stringify(selected));
            window.location.href = '/practice/';
        } else {
            alert('Bitte w√§hlen Sie mindestens ein Wortschatzelement zum √úben aus. / –ú–æ–ª—è, –∏–∑–±–µ—Ä–µ—Ç–µ –ø–æ–Ω–µ –µ–¥–∏–Ω –µ–ª–µ–º–µ–Ω—Ç –æ—Ç —Ä–µ—á–Ω–∏–∫–∞ –∑–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ.');
        }
    });
    
    // Listen for language direction changes
    document.addEventListener('learning-direction-changed', function(event) {
        applyFilters(); // Re-filter for new direction
    });
    
    // Initial render
    applyFilters();
});
</script>
{{ end }}
