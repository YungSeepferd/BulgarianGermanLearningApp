{{ define "title" }}Vocabulary - {{ .Site.Title }}{{ end }}
{{ define "main" }}

<div class="vocabulary-container">
    <div class="page-header">
        <h1>Wortschatz / –†–µ—á–Ω–∏–∫</h1>
        <p>Lernen Sie bulgarischen und deutschen Wortschatz mit Wiederholung in Abst√§nden / –£—á–µ—Ç–µ –±—ä–ª–≥–∞—Ä—Å–∫–∏ –∏ –Ω–µ–º—Å–∫–∏ —Ä–µ—á–Ω–∏–∫ —Å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –Ω–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∏</p>
    </div>
    
    <div class="filters">
        <select id="level-filter">
            <option value="">Alle Niveaus / –í—Å–∏—á–∫–∏ –Ω–∏–≤–∞</option>
            <option value="A1">A1 - Anf√§nger / –ù–∞—á–∏–Ω–∞–µ—â–∏</option>
            <option value="A2">A2 - Grundstufe / –û—Å–Ω–æ–≤–Ω–æ</option>
            <option value="B1">B1 - Mittelstufe / –°—Ä–µ–¥–Ω–æ</option>
            <option value="B2">B2 - Obere Mittelstufe / –ì–æ—Ä–Ω–æ —Å—Ä–µ–¥–Ω–æ</option>
        </select>
        
        <select id="category-filter">
            <option value="">Alle Kategorien / –í—Å–∏—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
            {{ $categories := slice }}
            {{ range .Site.Data.vocabulary }}
                {{ $categories = $categories | append .category }}
            {{ end }}
            {{ range ($categories | uniq | sort) }}
            <option value="{{ . }}">{{ . }}</option>
            {{ end }}
        </select>
        
        <input type="text" id="search-input" placeholder="Wortschatz suchen... / –¢—ä—Ä—Å–µ–Ω–µ –Ω–∞ —Ä–µ—á–Ω–∏–∫..." class="search-input">
        
        <button id="practice-selected" class="btn-primary">Ausgew√§hlte √ºben / –£–ø—Ä–∞–∂–Ω—è–≤–∞–π—Ç–µ –∏–∑–±—Ä–∞–Ω–∏—Ç–µ</button>
    </div>
    
    <!-- Cultural Context Toggle -->
    <div id="cultural-context-container"></div>
    
    <div class="vocabulary-stats">
        <span class="stat">Gesamt / –û–±—â–æ: <span id="total-count">{{ len .Site.Data.vocabulary }}</span></span>
        <span class="stat">Angezeigt / –ü–æ–∫–∞–∑–∞–Ω–∏: <span id="showing-count">{{ len .Site.Data.vocabulary }}</span></span>
    </div>
    
    <!-- Pagination Controls -->
    {{ $vocabulary := .Site.Data.vocabulary }}
    {{ $itemsPerPage := 50 }}
    {{ $currentPage := .Params.page | default 1 }}
    {{ $totalItems := len $vocabulary }}
    {{ $totalPages := div (add $totalItems (sub $itemsPerPage 1)) $itemsPerPage }}
    {{ $offset := mul (sub $currentPage 1) $itemsPerPage }}
    {{ $paginatedItems := after $offset (first (add $offset $itemsPerPage) $vocabulary) }}
    
    <div class="pagination-info">
        <span>Seite {{ $currentPage }} von {{ $totalPages }} / –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ $currentPage }} –æ—Ç {{ $totalPages }}</span>
        <span>({{ len $paginatedItems }} von {{ $totalItems }} Eintr√§ge / –∑–∞–ø–∏—Å–∏)</span>
    </div>
    
    <div class="vocabulary-grid" id="vocabulary-grid">
        {{ range $paginatedItems }}
        <div class="vocab-card" 
             data-level="{{ .level }}" 
             data-category="{{ .category }}"
             data-word="{{ .word | lower }}"
             data-translation="{{ .translation | lower }}"
             data-id="{{ .id }}"
             data-slug="{{ .word | urlize }}">
            
            <div class="vocab-header">
                <div class="vocab-word">{{ .word }}</div>
                <input type="checkbox" class="vocab-select" data-word="{{ .word }}">
            </div>
            
            <div class="vocab-translation">{{ .translation }}</div>
            
            {{ if .audio }}
            <button class="audio-btn" data-audio="{{ .audio }}" title="Play pronunciation">
                <span class="audio-icon">üîä</span>
            </button>
            {{ end }}
            
            <div class="vocab-meta">
                <span class="level-badge level-{{ .level | lower }}">{{ .level }}</span>
                <span class="category-tag">{{ .category }}</span>
            </div>
            
            {{/* Display notes based on available fields - priority: direction-specific > cultural > general */}}
            {{ $hasNotes := false }}
            <div class="vocab-notes-container">
                {{/* Direction-aware notes */}}
                {{ if .notes_de_to_bg }}
                <div class="vocab-note vocab-note-de-bg">{{ .notes_de_to_bg }}</div>
                {{ $hasNotes = true }}
                {{ else if .notes_bg_to_de }}
                <div class="vocab-note vocab-note-bg-de">{{ .notes_bg_to_de }}</div>
                {{ $hasNotes = true }}
                {{ end }}
                
                {{/* Cultural context */}}
                {{ if .cultural_note }}
                <div class="vocab-note vocab-cultural">
                    <span class="note-label">üí°</span> {{ .cultural_note }}
                </div>
                {{ $hasNotes = true }}
                {{ end }}
                
                {{/* Etymology */}}
                {{ if .etymology }}
                <div class="vocab-note vocab-etymology">
                    <span class="note-label">üìú</span> {{ .etymology }}
                </div>
                {{ $hasNotes = true }}
                {{ end }}
                
                {{/* Linguistic note */}}
                {{ if .linguistic_note }}
                <div class="vocab-note vocab-linguistic">
                    <span class="note-label">üó£Ô∏è</span> {{ .linguistic_note }}
                </div>
                {{ $hasNotes = true }}
                {{ end }}
                
                {{/* Fallback to general notes if nothing else is available */}}
                {{ if and (not $hasNotes) .notes }}
                <div class="vocab-note">{{ .notes }}</div>
                {{ end }}
            </div>
            
            <div class="vocab-actions">
                <button class="practice-single-btn" data-word="{{ .word }}">√úben / –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</button>
            </div>
        </div>
        {{ end }}
    </div>
    
    <!-- Pagination Navigation -->
    {{ if gt $totalPages 1 }}
    <nav class="pagination" role="navigation" aria-label="Vocabulary pagination">
        <div class="pagination-controls">
            {{ if gt $currentPage 1 }}
                {{ $prevPage := sub $currentPage 1 }}
                <a href="/vocabulary/?page={{ $prevPage }}" class="pagination-btn pagination-prev" rel="prev">
                    <span class="pagination-icon">‚Üê</span>
                    <span class="pagination-text">Vorherige / –ü—Ä–µ–¥–∏—à–Ω–∞</span>
                </a>
            {{ end }}
            
            <div class="pagination-numbers">
                <!-- First page -->
                {{ if gt $currentPage 3 }}
                    <a href="/vocabulary/?page=1" class="pagination-number">1</a>
                    {{ if gt $currentPage 4 }}
                        <span class="pagination-ellipsis">‚Ä¶</span>
                    {{ end }}
                {{ end }}
            </div>
            
            {{ if lt $currentPage $totalPages }}
                {{ $nextPage := add $currentPage 1 }}
                <a href="/vocabulary/?page={{ $nextPage }}" class="pagination-btn pagination-next" rel="next">
                    <span class="pagination-text">N√§chste / –°–ª–µ–¥–≤–∞—â–∞</span>
                    <span class="pagination-icon">‚Üí</span>
                </a>
            {{ end }}
        </div>
        
        <!-- Quick jump -->
        <div class="pagination-jump">
            <label for="page-jump">Gehe zu Seite / –û—Ç–∏–¥–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞:</label>
            <select id="page-jump" onchange="location.href='/vocabulary/?page=' + this.value">
                {{ range seq $totalPages }}
                    <option value="{{ . }}" {{ if eq . $currentPage }}selected{{ end }}>
                        {{ . }}
                    </option>
                {{ end }}
            </select>
        </div>
    </nav>
    {{ end }}
    
    <div class="no-results hidden" id="no-results">
        <p>Keine Wortschatzeintr√§ge gefunden, die Ihren Kriterien entsprechen. / –ù–µ —Å–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ –¥—É–º–∏, –æ—Ç–≥–æ–≤–∞—Ä—è—â–∏ –Ω–∞ –≤–∞—à–∏—Ç–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏.</p>
        <button id="clear-filters" class="btn-secondary">Filter l√∂schen / –ò–∑—á–∏—Å—Ç–≤–∞–Ω–µ –Ω–∞ —Ñ–∏–ª—Ç—Ä–∏—Ç–µ</button>
    </div>
</div>

{{ end }}

{{ define "scripts" }}
<!-- Vocabulary data for JavaScript -->
<script id="vocabulary-data" type="application/json">
{{ .Site.Data.vocabulary | jsonify }}
</script>

<!-- Enhanced vocabulary data for JavaScript -->
<script id="enhanced-vocabulary-data" type="application/json">
{{ index .Site.Data "vocabulary-enhanced" | jsonify }}
</script>

<!-- Cultural grammar data for JavaScript -->
<script id="cultural-grammar-data" type="application/json">
{{ index .Site.Data "cultural-grammar" | jsonify }}
</script>

<!-- Load JavaScript modules via Hugo resources -->
{{ $enhancedBidirectionalSystem := resources.Get "js/enhanced-bidirectional-system.js" }}
{{ if $enhancedBidirectionalSystem }}
{{ $enhancedBidirectionalSystemMin := $enhancedBidirectionalSystem | resources.Minify }}
<script src="{{ $enhancedBidirectionalSystemMin.RelPermalink }}" defer></script>
{{ end }}

{{ $vocabularyAdapter := resources.Get "js/vocabulary-adapter.js" }}
{{ if $vocabularyAdapter }}
{{ $vocabularyAdapterMin := $vocabularyAdapter | resources.Minify }}
<script src="{{ $vocabularyAdapterMin.RelPermalink }}" defer></script>
{{ end }}

{{ $enhancedVocabCards := resources.Get "js/enhanced-vocab-cards.js" }}
{{ if $enhancedVocabCards }}
{{ $enhancedVocabCardsMin := $enhancedVocabCards | resources.Minify }}
<script src="{{ $enhancedVocabCardsMin.RelPermalink }}" defer></script>
{{ end }}

{{ $vocabularyPage := resources.Get "js/modules/vocabulary-page.js" }}
{{ if $vocabularyPage }}
{{ $vocabularyPageMin := $vocabularyPage | resources.Minify }}
<script src="{{ $vocabularyPageMin.RelPermalink }}" defer></script>
{{ end }}

<script>
document.addEventListener('DOMContentLoaded', () => {
  if (!window.VocabularyPageModule || !window.VocabularyAdapter) return;
  const adapter = new window.VocabularyAdapter();
  const module = new window.VocabularyPageModule({
    container: '#vocabulary-grid',
    adapter
  });
  module.init();
});
</script>
{{ end }}

